PAPAYA_VERSION_ID="0.6.2";PAPAYA_BUILD_NUM="512";var papayaLoadableImages=[];
/*!
 * jQuery JavaScript Library v2.0.2
 * http://jquery.com/
 *
 * Includes Sizzle.js
 * http://sizzlejs.com/
 *
 * Copyright 2005, 2013 jQuery Foundation, Inc. and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: 2013-05-30T21:25Z
 */
(function(window,undefined){var rootjQuery,readyList,core_strundefined=typeof undefined,location=window.location,document=window.document,docElem=document.documentElement,_jQuery=window.jQuery,_$=window.$,class2type={},core_deletedIds=[],core_version="2.0.2",core_concat=core_deletedIds.concat,core_push=core_deletedIds.push,core_slice=core_deletedIds.slice,core_indexOf=core_deletedIds.indexOf,core_toString=class2type.toString,core_hasOwn=class2type.hasOwnProperty,core_trim=core_version.trim,jQuery=function(selector,context){return new jQuery.fn.init(selector,context,rootjQuery)},core_pnum=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,core_rnotwhite=/\S+/g,rquickExpr=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,rsingleTag=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,rmsPrefix=/^-ms-/,rdashAlpha=/-([\da-z])/gi,fcamelCase=function(all,letter){return letter.toUpperCase()},completed=function(){document.removeEventListener("DOMContentLoaded",completed,false);window.removeEventListener("load",completed,false);jQuery.ready()};jQuery.fn=jQuery.prototype={jquery:core_version,constructor:jQuery,init:function(selector,context,rootjQuery){var match,elem;if(!selector){return this}if(typeof selector==="string"){if(selector.charAt(0)==="<"&&selector.charAt(selector.length-1)===">"&&selector.length>=3){match=[null,selector,null]}else{match=rquickExpr.exec(selector)}if(match&&(match[1]||!context)){if(match[1]){context=context instanceof jQuery?context[0]:context;jQuery.merge(this,jQuery.parseHTML(match[1],context&&context.nodeType?context.ownerDocument||context:document,true));if(rsingleTag.test(match[1])&&jQuery.isPlainObject(context)){for(match in context){if(jQuery.isFunction(this[match])){this[match](context[match])}else{this.attr(match,context[match])}}}return this}else{elem=document.getElementById(match[2]);if(elem&&elem.parentNode){this.length=1;this[0]=elem}this.context=document;this.selector=selector;return this}}else{if(!context||context.jquery){return(context||rootjQuery).find(selector)}else{return this.constructor(context).find(selector)}}}else{if(selector.nodeType){this.context=this[0]=selector;this.length=1;return this}else{if(jQuery.isFunction(selector)){return rootjQuery.ready(selector)}}}if(selector.selector!==undefined){this.selector=selector.selector;this.context=selector.context}return jQuery.makeArray(selector,this)},selector:"",length:0,toArray:function(){return core_slice.call(this)},get:function(num){return num==null?this.toArray():(num<0?this[this.length+num]:this[num])},pushStack:function(elems){var ret=jQuery.merge(this.constructor(),elems);ret.prevObject=this;ret.context=this.context;return ret},each:function(callback,args){return jQuery.each(this,callback,args)},ready:function(fn){jQuery.ready.promise().done(fn);return this},slice:function(){return this.pushStack(core_slice.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(i){var len=this.length,j=+i+(i<0?len:0);return this.pushStack(j>=0&&j<len?[this[j]]:[])},map:function(callback){return this.pushStack(jQuery.map(this,function(elem,i){return callback.call(elem,i,elem)}))},end:function(){return this.prevObject||this.constructor(null)},push:core_push,sort:[].sort,splice:[].splice};jQuery.fn.init.prototype=jQuery.fn;jQuery.extend=jQuery.fn.extend=function(){var options,name,src,copy,copyIsArray,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=false;if(typeof target==="boolean"){deep=target;target=arguments[1]||{};i=2}if(typeof target!=="object"&&!jQuery.isFunction(target)){target={}}if(length===i){target=this;--i}for(;i<length;i++){if((options=arguments[i])!=null){for(name in options){src=target[name];copy=options[name];if(target===copy){continue}if(deep&&copy&&(jQuery.isPlainObject(copy)||(copyIsArray=jQuery.isArray(copy)))){if(copyIsArray){copyIsArray=false;clone=src&&jQuery.isArray(src)?src:[]}else{clone=src&&jQuery.isPlainObject(src)?src:{}}target[name]=jQuery.extend(deep,clone,copy)}else{if(copy!==undefined){target[name]=copy}}}}}return target};jQuery.extend({expando:"jQuery"+(core_version+Math.random()).replace(/\D/g,""),noConflict:function(deep){if(window.$===jQuery){window.$=_$}if(deep&&window.jQuery===jQuery){window.jQuery=_jQuery}return jQuery},isReady:false,readyWait:1,holdReady:function(hold){if(hold){jQuery.readyWait++}else{jQuery.ready(true)}},ready:function(wait){if(wait===true?--jQuery.readyWait:jQuery.isReady){return}jQuery.isReady=true;if(wait!==true&&--jQuery.readyWait>0){return}readyList.resolveWith(document,[jQuery]);if(jQuery.fn.trigger){jQuery(document).trigger("ready").off("ready")}},isFunction:function(obj){return jQuery.type(obj)==="function"},isArray:Array.isArray,isWindow:function(obj){return obj!=null&&obj===obj.window},isNumeric:function(obj){return !isNaN(parseFloat(obj))&&isFinite(obj)},type:function(obj){if(obj==null){return String(obj)}return typeof obj==="object"||typeof obj==="function"?class2type[core_toString.call(obj)]||"object":typeof obj},isPlainObject:function(obj){if(jQuery.type(obj)!=="object"||obj.nodeType||jQuery.isWindow(obj)){return false}try{if(obj.constructor&&!core_hasOwn.call(obj.constructor.prototype,"isPrototypeOf")){return false}}catch(e){return false}return true},isEmptyObject:function(obj){var name;for(name in obj){return false}return true},error:function(msg){throw new Error(msg)},parseHTML:function(data,context,keepScripts){if(!data||typeof data!=="string"){return null}if(typeof context==="boolean"){keepScripts=context;context=false}context=context||document;var parsed=rsingleTag.exec(data),scripts=!keepScripts&&[];if(parsed){return[context.createElement(parsed[1])]}parsed=jQuery.buildFragment([data],context,scripts);if(scripts){jQuery(scripts).remove()}return jQuery.merge([],parsed.childNodes)},parseJSON:JSON.parse,parseXML:function(data){var xml,tmp;if(!data||typeof data!=="string"){return null}try{tmp=new DOMParser();xml=tmp.parseFromString(data,"text/xml")}catch(e){xml=undefined}if(!xml||xml.getElementsByTagName("parsererror").length){jQuery.error("Invalid XML: "+data)}return xml},noop:function(){},globalEval:function(code){var script,indirect=eval;code=jQuery.trim(code);if(code){if(code.indexOf("use strict")===1){script=document.createElement("script");script.text=code;document.head.appendChild(script).parentNode.removeChild(script)}else{indirect(code)}}},camelCase:function(string){return string.replace(rmsPrefix,"ms-").replace(rdashAlpha,fcamelCase)},nodeName:function(elem,name){return elem.nodeName&&elem.nodeName.toLowerCase()===name.toLowerCase()},each:function(obj,callback,args){var value,i=0,length=obj.length,isArray=isArraylike(obj);if(args){if(isArray){for(;i<length;i++){value=callback.apply(obj[i],args);if(value===false){break}}}else{for(i in obj){value=callback.apply(obj[i],args);if(value===false){break}}}}else{if(isArray){for(;i<length;i++){value=callback.call(obj[i],i,obj[i]);if(value===false){break}}}else{for(i in obj){value=callback.call(obj[i],i,obj[i]);if(value===false){break}}}}return obj},trim:function(text){return text==null?"":core_trim.call(text)},makeArray:function(arr,results){var ret=results||[];if(arr!=null){if(isArraylike(Object(arr))){jQuery.merge(ret,typeof arr==="string"?[arr]:arr)}else{core_push.call(ret,arr)}}return ret},inArray:function(elem,arr,i){return arr==null?-1:core_indexOf.call(arr,elem,i)},merge:function(first,second){var l=second.length,i=first.length,j=0;if(typeof l==="number"){for(;j<l;j++){first[i++]=second[j]}}else{while(second[j]!==undefined){first[i++]=second[j++]}}first.length=i;return first},grep:function(elems,callback,inv){var retVal,ret=[],i=0,length=elems.length;inv=!!inv;for(;i<length;i++){retVal=!!callback(elems[i],i);if(inv!==retVal){ret.push(elems[i])}}return ret},map:function(elems,callback,arg){var value,i=0,length=elems.length,isArray=isArraylike(elems),ret=[];if(isArray){for(;i<length;i++){value=callback(elems[i],i,arg);if(value!=null){ret[ret.length]=value}}}else{for(i in elems){value=callback(elems[i],i,arg);if(value!=null){ret[ret.length]=value}}}return core_concat.apply([],ret)},guid:1,proxy:function(fn,context){var tmp,args,proxy;if(typeof context==="string"){tmp=fn[context];context=fn;fn=tmp}if(!jQuery.isFunction(fn)){return undefined}args=core_slice.call(arguments,2);proxy=function(){return fn.apply(context||this,args.concat(core_slice.call(arguments)))};proxy.guid=fn.guid=fn.guid||jQuery.guid++;return proxy},access:function(elems,fn,key,value,chainable,emptyGet,raw){var i=0,length=elems.length,bulk=key==null;if(jQuery.type(key)==="object"){chainable=true;for(i in key){jQuery.access(elems,fn,i,key[i],true,emptyGet,raw)}}else{if(value!==undefined){chainable=true;if(!jQuery.isFunction(value)){raw=true}if(bulk){if(raw){fn.call(elems,value);fn=null}else{bulk=fn;fn=function(elem,key,value){return bulk.call(jQuery(elem),value)}}}if(fn){for(;i<length;i++){fn(elems[i],key,raw?value:value.call(elems[i],i,fn(elems[i],key)))}}}}return chainable?elems:bulk?fn.call(elems):length?fn(elems[0],key):emptyGet},now:Date.now,swap:function(elem,options,callback,args){var ret,name,old={};for(name in options){old[name]=elem.style[name];elem.style[name]=options[name]}ret=callback.apply(elem,args||[]);for(name in options){elem.style[name]=old[name]}return ret}});jQuery.ready.promise=function(obj){if(!readyList){readyList=jQuery.Deferred();if(document.readyState==="complete"){setTimeout(jQuery.ready)}else{document.addEventListener("DOMContentLoaded",completed,false);window.addEventListener("load",completed,false)}}return readyList.promise(obj)};jQuery.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(i,name){class2type["[object "+name+"]"]=name.toLowerCase()});function isArraylike(obj){var length=obj.length,type=jQuery.type(obj);if(jQuery.isWindow(obj)){return false}if(obj.nodeType===1&&length){return true}return type==="array"||type!=="function"&&(length===0||typeof length==="number"&&length>0&&(length-1) in obj)}rootjQuery=jQuery(document);
/*!
 * Sizzle CSS Selector Engine v1.9.4-pre
 * http://sizzlejs.com/
 *
 * Copyright 2013 jQuery Foundation, Inc. and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: 2013-05-27
 */
(function(window,undefined){var i,support,cachedruns,Expr,getText,isXML,compile,outermostContext,sortInput,setDocument,document,docElem,documentIsHTML,rbuggyQSA,rbuggyMatches,matches,contains,expando="sizzle"+-(new Date()),preferredDoc=window.document,dirruns=0,done=0,classCache=createCache(),tokenCache=createCache(),compilerCache=createCache(),hasDuplicate=false,sortOrder=function(){return 0},strundefined=typeof undefined,MAX_NEGATIVE=1<<31,hasOwn=({}).hasOwnProperty,arr=[],pop=arr.pop,push_native=arr.push,push=arr.push,slice=arr.slice,indexOf=arr.indexOf||function(elem){var i=0,len=this.length;for(;i<len;i++){if(this[i]===elem){return i}}return -1},booleans="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",whitespace="[\\x20\\t\\r\\n\\f]",characterEncoding="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",identifier=characterEncoding.replace("w","w#"),attributes="\\["+whitespace+"*("+characterEncoding+")"+whitespace+"*(?:([*^$|!~]?=)"+whitespace+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+identifier+")|)|)"+whitespace+"*\\]",pseudos=":("+characterEncoding+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+attributes.replace(3,8)+")*)|.*)\\)|)",rtrim=new RegExp("^"+whitespace+"+|((?:^|[^\\\\])(?:\\\\.)*)"+whitespace+"+$","g"),rcomma=new RegExp("^"+whitespace+"*,"+whitespace+"*"),rcombinators=new RegExp("^"+whitespace+"*([>+~]|"+whitespace+")"+whitespace+"*"),rsibling=new RegExp(whitespace+"*[+~]"),rattributeQuotes=new RegExp("="+whitespace+"*([^\\]'\"]*)"+whitespace+"*\\]","g"),rpseudo=new RegExp(pseudos),ridentifier=new RegExp("^"+identifier+"$"),matchExpr={ID:new RegExp("^#("+characterEncoding+")"),CLASS:new RegExp("^\\.("+characterEncoding+")"),TAG:new RegExp("^("+characterEncoding.replace("w","w*")+")"),ATTR:new RegExp("^"+attributes),PSEUDO:new RegExp("^"+pseudos),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+whitespace+"*(even|odd|(([+-]|)(\\d*)n|)"+whitespace+"*(?:([+-]|)"+whitespace+"*(\\d+)|))"+whitespace+"*\\)|)","i"),bool:new RegExp("^(?:"+booleans+")$","i"),needsContext:new RegExp("^"+whitespace+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+whitespace+"*((?:-\\d)?\\d*)"+whitespace+"*\\)|)(?=[^-]|$)","i")},rnative=/^[^{]+\{\s*\[native \w/,rquickExpr=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,rinputs=/^(?:input|select|textarea|button)$/i,rheader=/^h\d$/i,rescape=/'|\\/g,runescape=new RegExp("\\\\([\\da-f]{1,6}"+whitespace+"?|("+whitespace+")|.)","ig"),funescape=function(_,escaped,escapedWhitespace){var high="0x"+escaped-65536;return high!==high||escapedWhitespace?escaped:high<0?String.fromCharCode(high+65536):String.fromCharCode(high>>10|55296,high&1023|56320)};try{push.apply((arr=slice.call(preferredDoc.childNodes)),preferredDoc.childNodes);arr[preferredDoc.childNodes.length].nodeType}catch(e){push={apply:arr.length?function(target,els){push_native.apply(target,slice.call(els))}:function(target,els){var j=target.length,i=0;while((target[j++]=els[i++])){}target.length=j-1}}}function Sizzle(selector,context,results,seed){var match,elem,m,nodeType,i,groups,old,nid,newContext,newSelector;if((context?context.ownerDocument||context:preferredDoc)!==document){setDocument(context)}context=context||document;results=results||[];if(!selector||typeof selector!=="string"){return results}if((nodeType=context.nodeType)!==1&&nodeType!==9){return[]}if(documentIsHTML&&!seed){if((match=rquickExpr.exec(selector))){if((m=match[1])){if(nodeType===9){elem=context.getElementById(m);if(elem&&elem.parentNode){if(elem.id===m){results.push(elem);return results}}else{return results}}else{if(context.ownerDocument&&(elem=context.ownerDocument.getElementById(m))&&contains(context,elem)&&elem.id===m){results.push(elem);return results}}}else{if(match[2]){push.apply(results,context.getElementsByTagName(selector));return results}else{if((m=match[3])&&support.getElementsByClassName&&context.getElementsByClassName){push.apply(results,context.getElementsByClassName(m));return results}}}}if(support.qsa&&(!rbuggyQSA||!rbuggyQSA.test(selector))){nid=old=expando;newContext=context;newSelector=nodeType===9&&selector;if(nodeType===1&&context.nodeName.toLowerCase()!=="object"){groups=tokenize(selector);if((old=context.getAttribute("id"))){nid=old.replace(rescape,"\\$&")}else{context.setAttribute("id",nid)}nid="[id='"+nid+"'] ";i=groups.length;while(i--){groups[i]=nid+toSelector(groups[i])}newContext=rsibling.test(selector)&&context.parentNode||context;newSelector=groups.join(",")}if(newSelector){try{push.apply(results,newContext.querySelectorAll(newSelector));return results}catch(qsaError){}finally{if(!old){context.removeAttribute("id")}}}}}return select(selector.replace(rtrim,"$1"),context,results,seed)}function isNative(fn){return rnative.test(fn+"")}function createCache(){var keys=[];function cache(key,value){if(keys.push(key+=" ")>Expr.cacheLength){delete cache[keys.shift()]}return(cache[key]=value)}return cache}function markFunction(fn){fn[expando]=true;return fn}function assert(fn){var div=document.createElement("div");try{return !!fn(div)}catch(e){return false}finally{if(div.parentNode){div.parentNode.removeChild(div)}div=null}}function addHandle(attrs,handler,test){attrs=attrs.split("|");var current,i=attrs.length,setHandle=test?null:handler;while(i--){if(!(current=Expr.attrHandle[attrs[i]])||current===handler){Expr.attrHandle[attrs[i]]=setHandle}}}function boolHandler(elem,name){var val=elem.getAttributeNode(name);return val&&val.specified?val.value:elem[name]===true?name.toLowerCase():null}function interpolationHandler(elem,name){return elem.getAttribute(name,name.toLowerCase()==="type"?1:2)}function valueHandler(elem){if(elem.nodeName.toLowerCase()==="input"){return elem.defaultValue}}function siblingCheck(a,b){var cur=b&&a,diff=cur&&a.nodeType===1&&b.nodeType===1&&(~b.sourceIndex||MAX_NEGATIVE)-(~a.sourceIndex||MAX_NEGATIVE);if(diff){return diff}if(cur){while((cur=cur.nextSibling)){if(cur===b){return -1}}}return a?1:-1}function createInputPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return name==="input"&&elem.type===type}}function createButtonPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return(name==="input"||name==="button")&&elem.type===type}}function createPositionalPseudo(fn){return markFunction(function(argument){argument=+argument;return markFunction(function(seed,matches){var j,matchIndexes=fn([],seed.length,argument),i=matchIndexes.length;while(i--){if(seed[(j=matchIndexes[i])]){seed[j]=!(matches[j]=seed[j])}}})})}isXML=Sizzle.isXML=function(elem){var documentElement=elem&&(elem.ownerDocument||elem).documentElement;return documentElement?documentElement.nodeName!=="HTML":false};support=Sizzle.support={};setDocument=Sizzle.setDocument=function(node){var doc=node?node.ownerDocument||node:preferredDoc,parent=doc.parentWindow;if(doc===document||doc.nodeType!==9||!doc.documentElement){return document}document=doc;docElem=doc.documentElement;documentIsHTML=!isXML(doc);if(parent&&parent.frameElement){parent.attachEvent("onbeforeunload",function(){setDocument()})}support.attributes=assert(function(div){div.innerHTML="<a href='#'></a>";addHandle("type|href|height|width",interpolationHandler,div.firstChild.getAttribute("href")==="#");addHandle(booleans,boolHandler,div.getAttribute("disabled")==null);div.className="i";return !div.getAttribute("className")});support.input=assert(function(div){div.innerHTML="<input>";div.firstChild.setAttribute("value","");return div.firstChild.getAttribute("value")===""});addHandle("value",valueHandler,support.attributes&&support.input);support.getElementsByTagName=assert(function(div){div.appendChild(doc.createComment(""));return !div.getElementsByTagName("*").length});support.getElementsByClassName=assert(function(div){div.innerHTML="<div class='a'></div><div class='a i'></div>";div.firstChild.className="i";return div.getElementsByClassName("i").length===2});support.getById=assert(function(div){docElem.appendChild(div).id=expando;return !doc.getElementsByName||!doc.getElementsByName(expando).length});if(support.getById){Expr.find.ID=function(id,context){if(typeof context.getElementById!==strundefined&&documentIsHTML){var m=context.getElementById(id);return m&&m.parentNode?[m]:[]}};Expr.filter.ID=function(id){var attrId=id.replace(runescape,funescape);return function(elem){return elem.getAttribute("id")===attrId}}}else{delete Expr.find.ID;Expr.filter.ID=function(id){var attrId=id.replace(runescape,funescape);return function(elem){var node=typeof elem.getAttributeNode!==strundefined&&elem.getAttributeNode("id");return node&&node.value===attrId}}}Expr.find.TAG=support.getElementsByTagName?function(tag,context){if(typeof context.getElementsByTagName!==strundefined){return context.getElementsByTagName(tag)}}:function(tag,context){var elem,tmp=[],i=0,results=context.getElementsByTagName(tag);if(tag==="*"){while((elem=results[i++])){if(elem.nodeType===1){tmp.push(elem)}}return tmp}return results};Expr.find.CLASS=support.getElementsByClassName&&function(className,context){if(typeof context.getElementsByClassName!==strundefined&&documentIsHTML){return context.getElementsByClassName(className)}};rbuggyMatches=[];rbuggyQSA=[];if((support.qsa=isNative(doc.querySelectorAll))){assert(function(div){div.innerHTML="<select><option selected=''></option></select>";if(!div.querySelectorAll("[selected]").length){rbuggyQSA.push("\\["+whitespace+"*(?:value|"+booleans+")")}if(!div.querySelectorAll(":checked").length){rbuggyQSA.push(":checked")}});assert(function(div){var input=doc.createElement("input");input.setAttribute("type","hidden");div.appendChild(input).setAttribute("t","");if(div.querySelectorAll("[t^='']").length){rbuggyQSA.push("[*^$]="+whitespace+"*(?:''|\"\")")}if(!div.querySelectorAll(":enabled").length){rbuggyQSA.push(":enabled",":disabled")}div.querySelectorAll("*,:x");rbuggyQSA.push(",.*:")})}if((support.matchesSelector=isNative((matches=docElem.webkitMatchesSelector||docElem.mozMatchesSelector||docElem.oMatchesSelector||docElem.msMatchesSelector)))){assert(function(div){support.disconnectedMatch=matches.call(div,"div");matches.call(div,"[s!='']:x");rbuggyMatches.push("!=",pseudos)})}rbuggyQSA=rbuggyQSA.length&&new RegExp(rbuggyQSA.join("|"));rbuggyMatches=rbuggyMatches.length&&new RegExp(rbuggyMatches.join("|"));contains=isNative(docElem.contains)||docElem.compareDocumentPosition?function(a,b){var adown=a.nodeType===9?a.documentElement:a,bup=b&&b.parentNode;return a===bup||!!(bup&&bup.nodeType===1&&(adown.contains?adown.contains(bup):a.compareDocumentPosition&&a.compareDocumentPosition(bup)&16))}:function(a,b){if(b){while((b=b.parentNode)){if(b===a){return true}}}return false};support.sortDetached=assert(function(div1){return div1.compareDocumentPosition(doc.createElement("div"))&1});sortOrder=docElem.compareDocumentPosition?function(a,b){if(a===b){hasDuplicate=true;return 0}var compare=b.compareDocumentPosition&&a.compareDocumentPosition&&a.compareDocumentPosition(b);if(compare){if(compare&1||(!support.sortDetached&&b.compareDocumentPosition(a)===compare)){if(a===doc||contains(preferredDoc,a)){return -1}if(b===doc||contains(preferredDoc,b)){return 1}return sortInput?(indexOf.call(sortInput,a)-indexOf.call(sortInput,b)):0}return compare&4?-1:1}return a.compareDocumentPosition?-1:1}:function(a,b){var cur,i=0,aup=a.parentNode,bup=b.parentNode,ap=[a],bp=[b];if(a===b){hasDuplicate=true;return 0}else{if(!aup||!bup){return a===doc?-1:b===doc?1:aup?-1:bup?1:sortInput?(indexOf.call(sortInput,a)-indexOf.call(sortInput,b)):0}else{if(aup===bup){return siblingCheck(a,b)}}}cur=a;while((cur=cur.parentNode)){ap.unshift(cur)}cur=b;while((cur=cur.parentNode)){bp.unshift(cur)}while(ap[i]===bp[i]){i++}return i?siblingCheck(ap[i],bp[i]):ap[i]===preferredDoc?-1:bp[i]===preferredDoc?1:0};return doc};Sizzle.matches=function(expr,elements){return Sizzle(expr,null,null,elements)};Sizzle.matchesSelector=function(elem,expr){if((elem.ownerDocument||elem)!==document){setDocument(elem)}expr=expr.replace(rattributeQuotes,"='$1']");if(support.matchesSelector&&documentIsHTML&&(!rbuggyMatches||!rbuggyMatches.test(expr))&&(!rbuggyQSA||!rbuggyQSA.test(expr))){try{var ret=matches.call(elem,expr);if(ret||support.disconnectedMatch||elem.document&&elem.document.nodeType!==11){return ret}}catch(e){}}return Sizzle(expr,document,null,[elem]).length>0};Sizzle.contains=function(context,elem){if((context.ownerDocument||context)!==document){setDocument(context)}return contains(context,elem)};Sizzle.attr=function(elem,name){if((elem.ownerDocument||elem)!==document){setDocument(elem)}var fn=Expr.attrHandle[name.toLowerCase()],val=(fn&&hasOwn.call(Expr.attrHandle,name.toLowerCase())?fn(elem,name,!documentIsHTML):undefined);return val===undefined?support.attributes||!documentIsHTML?elem.getAttribute(name):(val=elem.getAttributeNode(name))&&val.specified?val.value:null:val};Sizzle.error=function(msg){throw new Error("Syntax error, unrecognized expression: "+msg)};Sizzle.uniqueSort=function(results){var elem,duplicates=[],j=0,i=0;hasDuplicate=!support.detectDuplicates;sortInput=!support.sortStable&&results.slice(0);results.sort(sortOrder);if(hasDuplicate){while((elem=results[i++])){if(elem===results[i]){j=duplicates.push(i)}}while(j--){results.splice(duplicates[j],1)}}return results};getText=Sizzle.getText=function(elem){var node,ret="",i=0,nodeType=elem.nodeType;if(!nodeType){for(;(node=elem[i]);i++){ret+=getText(node)}}else{if(nodeType===1||nodeType===9||nodeType===11){if(typeof elem.textContent==="string"){return elem.textContent}else{for(elem=elem.firstChild;elem;elem=elem.nextSibling){ret+=getText(elem)}}}else{if(nodeType===3||nodeType===4){return elem.nodeValue}}}return ret};Expr=Sizzle.selectors={cacheLength:50,createPseudo:markFunction,match:matchExpr,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:true}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:true},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(match){match[1]=match[1].replace(runescape,funescape);match[3]=(match[4]||match[5]||"").replace(runescape,funescape);if(match[2]==="~="){match[3]=" "+match[3]+" "}return match.slice(0,4)},CHILD:function(match){match[1]=match[1].toLowerCase();if(match[1].slice(0,3)==="nth"){if(!match[3]){Sizzle.error(match[0])}match[4]=+(match[4]?match[5]+(match[6]||1):2*(match[3]==="even"||match[3]==="odd"));match[5]=+((match[7]+match[8])||match[3]==="odd")}else{if(match[3]){Sizzle.error(match[0])}}return match},PSEUDO:function(match){var excess,unquoted=!match[5]&&match[2];if(matchExpr.CHILD.test(match[0])){return null}if(match[3]&&match[4]!==undefined){match[2]=match[4]}else{if(unquoted&&rpseudo.test(unquoted)&&(excess=tokenize(unquoted,true))&&(excess=unquoted.indexOf(")",unquoted.length-excess)-unquoted.length)){match[0]=match[0].slice(0,excess);match[2]=unquoted.slice(0,excess)}}return match.slice(0,3)}},filter:{TAG:function(nodeNameSelector){var nodeName=nodeNameSelector.replace(runescape,funescape).toLowerCase();return nodeNameSelector==="*"?function(){return true}:function(elem){return elem.nodeName&&elem.nodeName.toLowerCase()===nodeName}},CLASS:function(className){var pattern=classCache[className+" "];return pattern||(pattern=new RegExp("(^|"+whitespace+")"+className+"("+whitespace+"|$)"))&&classCache(className,function(elem){return pattern.test(typeof elem.className==="string"&&elem.className||typeof elem.getAttribute!==strundefined&&elem.getAttribute("class")||"")})},ATTR:function(name,operator,check){return function(elem){var result=Sizzle.attr(elem,name);if(result==null){return operator==="!="}if(!operator){return true}result+="";return operator==="="?result===check:operator==="!="?result!==check:operator==="^="?check&&result.indexOf(check)===0:operator==="*="?check&&result.indexOf(check)>-1:operator==="$="?check&&result.slice(-check.length)===check:operator==="~="?(" "+result+" ").indexOf(check)>-1:operator==="|="?result===check||result.slice(0,check.length+1)===check+"-":false}},CHILD:function(type,what,argument,first,last){var simple=type.slice(0,3)!=="nth",forward=type.slice(-4)!=="last",ofType=what==="of-type";return first===1&&last===0?function(elem){return !!elem.parentNode}:function(elem,context,xml){var cache,outerCache,node,diff,nodeIndex,start,dir=simple!==forward?"nextSibling":"previousSibling",parent=elem.parentNode,name=ofType&&elem.nodeName.toLowerCase(),useCache=!xml&&!ofType;if(parent){if(simple){while(dir){node=elem;while((node=node[dir])){if(ofType?node.nodeName.toLowerCase()===name:node.nodeType===1){return false}}start=dir=type==="only"&&!start&&"nextSibling"}return true}start=[forward?parent.firstChild:parent.lastChild];if(forward&&useCache){outerCache=parent[expando]||(parent[expando]={});cache=outerCache[type]||[];nodeIndex=cache[0]===dirruns&&cache[1];diff=cache[0]===dirruns&&cache[2];node=nodeIndex&&parent.childNodes[nodeIndex];while((node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop())){if(node.nodeType===1&&++diff&&node===elem){outerCache[type]=[dirruns,nodeIndex,diff];break}}}else{if(useCache&&(cache=(elem[expando]||(elem[expando]={}))[type])&&cache[0]===dirruns){diff=cache[1]}else{while((node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop())){if((ofType?node.nodeName.toLowerCase()===name:node.nodeType===1)&&++diff){if(useCache){(node[expando]||(node[expando]={}))[type]=[dirruns,diff]}if(node===elem){break}}}}}diff-=last;return diff===first||(diff%first===0&&diff/first>=0)}}},PSEUDO:function(pseudo,argument){var args,fn=Expr.pseudos[pseudo]||Expr.setFilters[pseudo.toLowerCase()]||Sizzle.error("unsupported pseudo: "+pseudo);if(fn[expando]){return fn(argument)}if(fn.length>1){args=[pseudo,pseudo,"",argument];return Expr.setFilters.hasOwnProperty(pseudo.toLowerCase())?markFunction(function(seed,matches){var idx,matched=fn(seed,argument),i=matched.length;while(i--){idx=indexOf.call(seed,matched[i]);seed[idx]=!(matches[idx]=matched[i])}}):function(elem){return fn(elem,0,args)}}return fn}},pseudos:{not:markFunction(function(selector){var input=[],results=[],matcher=compile(selector.replace(rtrim,"$1"));return matcher[expando]?markFunction(function(seed,matches,context,xml){var elem,unmatched=matcher(seed,null,xml,[]),i=seed.length;while(i--){if((elem=unmatched[i])){seed[i]=!(matches[i]=elem)}}}):function(elem,context,xml){input[0]=elem;matcher(input,null,xml,results);return !results.pop()}}),has:markFunction(function(selector){return function(elem){return Sizzle(selector,elem).length>0}}),contains:markFunction(function(text){return function(elem){return(elem.textContent||elem.innerText||getText(elem)).indexOf(text)>-1}}),lang:markFunction(function(lang){if(!ridentifier.test(lang||"")){Sizzle.error("unsupported lang: "+lang)}lang=lang.replace(runescape,funescape).toLowerCase();return function(elem){var elemLang;do{if((elemLang=documentIsHTML?elem.lang:elem.getAttribute("xml:lang")||elem.getAttribute("lang"))){elemLang=elemLang.toLowerCase();return elemLang===lang||elemLang.indexOf(lang+"-")===0}}while((elem=elem.parentNode)&&elem.nodeType===1);return false}}),target:function(elem){var hash=window.location&&window.location.hash;return hash&&hash.slice(1)===elem.id},root:function(elem){return elem===docElem},focus:function(elem){return elem===document.activeElement&&(!document.hasFocus||document.hasFocus())&&!!(elem.type||elem.href||~elem.tabIndex)},enabled:function(elem){return elem.disabled===false},disabled:function(elem){return elem.disabled===true},checked:function(elem){var nodeName=elem.nodeName.toLowerCase();return(nodeName==="input"&&!!elem.checked)||(nodeName==="option"&&!!elem.selected)},selected:function(elem){if(elem.parentNode){elem.parentNode.selectedIndex}return elem.selected===true},empty:function(elem){for(elem=elem.firstChild;elem;elem=elem.nextSibling){if(elem.nodeName>"@"||elem.nodeType===3||elem.nodeType===4){return false}}return true},parent:function(elem){return !Expr.pseudos.empty(elem)},header:function(elem){return rheader.test(elem.nodeName)},input:function(elem){return rinputs.test(elem.nodeName)},button:function(elem){var name=elem.nodeName.toLowerCase();return name==="input"&&elem.type==="button"||name==="button"},text:function(elem){var attr;return elem.nodeName.toLowerCase()==="input"&&elem.type==="text"&&((attr=elem.getAttribute("type"))==null||attr.toLowerCase()===elem.type)},first:createPositionalPseudo(function(){return[0]}),last:createPositionalPseudo(function(matchIndexes,length){return[length-1]}),eq:createPositionalPseudo(function(matchIndexes,length,argument){return[argument<0?argument+length:argument]}),even:createPositionalPseudo(function(matchIndexes,length){var i=0;for(;i<length;i+=2){matchIndexes.push(i)}return matchIndexes}),odd:createPositionalPseudo(function(matchIndexes,length){var i=1;for(;i<length;i+=2){matchIndexes.push(i)}return matchIndexes}),lt:createPositionalPseudo(function(matchIndexes,length,argument){var i=argument<0?argument+length:argument;for(;--i>=0;){matchIndexes.push(i)}return matchIndexes}),gt:createPositionalPseudo(function(matchIndexes,length,argument){var i=argument<0?argument+length:argument;for(;++i<length;){matchIndexes.push(i)}return matchIndexes})}};for(i in {radio:true,checkbox:true,file:true,password:true,image:true}){Expr.pseudos[i]=createInputPseudo(i)}for(i in {submit:true,reset:true}){Expr.pseudos[i]=createButtonPseudo(i)}function tokenize(selector,parseOnly){var matched,match,tokens,type,soFar,groups,preFilters,cached=tokenCache[selector+" "];if(cached){return parseOnly?0:cached.slice(0)}soFar=selector;groups=[];preFilters=Expr.preFilter;while(soFar){if(!matched||(match=rcomma.exec(soFar))){if(match){soFar=soFar.slice(match[0].length)||soFar}groups.push(tokens=[])}matched=false;if((match=rcombinators.exec(soFar))){matched=match.shift();tokens.push({value:matched,type:match[0].replace(rtrim," ")});soFar=soFar.slice(matched.length)}for(type in Expr.filter){if((match=matchExpr[type].exec(soFar))&&(!preFilters[type]||(match=preFilters[type](match)))){matched=match.shift();tokens.push({value:matched,type:type,matches:match});soFar=soFar.slice(matched.length)}}if(!matched){break}}return parseOnly?soFar.length:soFar?Sizzle.error(selector):tokenCache(selector,groups).slice(0)}function toSelector(tokens){var i=0,len=tokens.length,selector="";for(;i<len;i++){selector+=tokens[i].value}return selector}function addCombinator(matcher,combinator,base){var dir=combinator.dir,checkNonElements=base&&dir==="parentNode",doneName=done++;return combinator.first?function(elem,context,xml){while((elem=elem[dir])){if(elem.nodeType===1||checkNonElements){return matcher(elem,context,xml)}}}:function(elem,context,xml){var data,cache,outerCache,dirkey=dirruns+" "+doneName;if(xml){while((elem=elem[dir])){if(elem.nodeType===1||checkNonElements){if(matcher(elem,context,xml)){return true}}}}else{while((elem=elem[dir])){if(elem.nodeType===1||checkNonElements){outerCache=elem[expando]||(elem[expando]={});if((cache=outerCache[dir])&&cache[0]===dirkey){if((data=cache[1])===true||data===cachedruns){return data===true}}else{cache=outerCache[dir]=[dirkey];cache[1]=matcher(elem,context,xml)||cachedruns;if(cache[1]===true){return true}}}}}}}function elementMatcher(matchers){return matchers.length>1?function(elem,context,xml){var i=matchers.length;while(i--){if(!matchers[i](elem,context,xml)){return false}}return true}:matchers[0]}function condense(unmatched,map,filter,context,xml){var elem,newUnmatched=[],i=0,len=unmatched.length,mapped=map!=null;for(;i<len;i++){if((elem=unmatched[i])){if(!filter||filter(elem,context,xml)){newUnmatched.push(elem);if(mapped){map.push(i)}}}}return newUnmatched}function setMatcher(preFilter,selector,matcher,postFilter,postFinder,postSelector){if(postFilter&&!postFilter[expando]){postFilter=setMatcher(postFilter)}if(postFinder&&!postFinder[expando]){postFinder=setMatcher(postFinder,postSelector)}return markFunction(function(seed,results,context,xml){var temp,i,elem,preMap=[],postMap=[],preexisting=results.length,elems=seed||multipleContexts(selector||"*",context.nodeType?[context]:context,[]),matcherIn=preFilter&&(seed||!selector)?condense(elems,preMap,preFilter,context,xml):elems,matcherOut=matcher?postFinder||(seed?preFilter:preexisting||postFilter)?[]:results:matcherIn;if(matcher){matcher(matcherIn,matcherOut,context,xml)}if(postFilter){temp=condense(matcherOut,postMap);postFilter(temp,[],context,xml);i=temp.length;while(i--){if((elem=temp[i])){matcherOut[postMap[i]]=!(matcherIn[postMap[i]]=elem)}}}if(seed){if(postFinder||preFilter){if(postFinder){temp=[];i=matcherOut.length;while(i--){if((elem=matcherOut[i])){temp.push((matcherIn[i]=elem))}}postFinder(null,(matcherOut=[]),temp,xml)}i=matcherOut.length;while(i--){if((elem=matcherOut[i])&&(temp=postFinder?indexOf.call(seed,elem):preMap[i])>-1){seed[temp]=!(results[temp]=elem)}}}}else{matcherOut=condense(matcherOut===results?matcherOut.splice(preexisting,matcherOut.length):matcherOut);if(postFinder){postFinder(null,results,matcherOut,xml)}else{push.apply(results,matcherOut)}}})}function matcherFromTokens(tokens){var checkContext,matcher,j,len=tokens.length,leadingRelative=Expr.relative[tokens[0].type],implicitRelative=leadingRelative||Expr.relative[" "],i=leadingRelative?1:0,matchContext=addCombinator(function(elem){return elem===checkContext},implicitRelative,true),matchAnyContext=addCombinator(function(elem){return indexOf.call(checkContext,elem)>-1},implicitRelative,true),matchers=[function(elem,context,xml){return(!leadingRelative&&(xml||context!==outermostContext))||((checkContext=context).nodeType?matchContext(elem,context,xml):matchAnyContext(elem,context,xml))}];for(;i<len;i++){if((matcher=Expr.relative[tokens[i].type])){matchers=[addCombinator(elementMatcher(matchers),matcher)]}else{matcher=Expr.filter[tokens[i].type].apply(null,tokens[i].matches);if(matcher[expando]){j=++i;for(;j<len;j++){if(Expr.relative[tokens[j].type]){break}}return setMatcher(i>1&&elementMatcher(matchers),i>1&&toSelector(tokens.slice(0,i-1).concat({value:tokens[i-2].type===" "?"*":""})).replace(rtrim,"$1"),matcher,i<j&&matcherFromTokens(tokens.slice(i,j)),j<len&&matcherFromTokens((tokens=tokens.slice(j))),j<len&&toSelector(tokens))}matchers.push(matcher)}}return elementMatcher(matchers)}function matcherFromGroupMatchers(elementMatchers,setMatchers){var matcherCachedRuns=0,bySet=setMatchers.length>0,byElement=elementMatchers.length>0,superMatcher=function(seed,context,xml,results,expandContext){var elem,j,matcher,setMatched=[],matchedCount=0,i="0",unmatched=seed&&[],outermost=expandContext!=null,contextBackup=outermostContext,elems=seed||byElement&&Expr.find.TAG("*",expandContext&&context.parentNode||context),dirrunsUnique=(dirruns+=contextBackup==null?1:Math.random()||0.1);if(outermost){outermostContext=context!==document&&context;cachedruns=matcherCachedRuns}for(;(elem=elems[i])!=null;i++){if(byElement&&elem){j=0;while((matcher=elementMatchers[j++])){if(matcher(elem,context,xml)){results.push(elem);break}}if(outermost){dirruns=dirrunsUnique;cachedruns=++matcherCachedRuns}}if(bySet){if((elem=!matcher&&elem)){matchedCount--}if(seed){unmatched.push(elem)}}}matchedCount+=i;if(bySet&&i!==matchedCount){j=0;while((matcher=setMatchers[j++])){matcher(unmatched,setMatched,context,xml)}if(seed){if(matchedCount>0){while(i--){if(!(unmatched[i]||setMatched[i])){setMatched[i]=pop.call(results)}}}setMatched=condense(setMatched)}push.apply(results,setMatched);if(outermost&&!seed&&setMatched.length>0&&(matchedCount+setMatchers.length)>1){Sizzle.uniqueSort(results)}}if(outermost){dirruns=dirrunsUnique;outermostContext=contextBackup}return unmatched};return bySet?markFunction(superMatcher):superMatcher}compile=Sizzle.compile=function(selector,group){var i,setMatchers=[],elementMatchers=[],cached=compilerCache[selector+" "];if(!cached){if(!group){group=tokenize(selector)}i=group.length;while(i--){cached=matcherFromTokens(group[i]);if(cached[expando]){setMatchers.push(cached)}else{elementMatchers.push(cached)}}cached=compilerCache(selector,matcherFromGroupMatchers(elementMatchers,setMatchers))}return cached};function multipleContexts(selector,contexts,results){var i=0,len=contexts.length;for(;i<len;i++){Sizzle(selector,contexts[i],results)}return results}function select(selector,context,results,seed){var i,tokens,token,type,find,match=tokenize(selector);if(!seed){if(match.length===1){tokens=match[0]=match[0].slice(0);if(tokens.length>2&&(token=tokens[0]).type==="ID"&&support.getById&&context.nodeType===9&&documentIsHTML&&Expr.relative[tokens[1].type]){context=(Expr.find.ID(token.matches[0].replace(runescape,funescape),context)||[])[0];if(!context){return results}selector=selector.slice(tokens.shift().value.length)}i=matchExpr.needsContext.test(selector)?0:tokens.length;while(i--){token=tokens[i];if(Expr.relative[(type=token.type)]){break}if((find=Expr.find[type])){if((seed=find(token.matches[0].replace(runescape,funescape),rsibling.test(tokens[0].type)&&context.parentNode||context))){tokens.splice(i,1);selector=seed.length&&toSelector(tokens);if(!selector){push.apply(results,seed);return results}break}}}}}compile(selector,match)(seed,context,!documentIsHTML,results,rsibling.test(selector));return results}Expr.pseudos.nth=Expr.pseudos.eq;function setFilters(){}setFilters.prototype=Expr.filters=Expr.pseudos;Expr.setFilters=new setFilters();support.sortStable=expando.split("").sort(sortOrder).join("")===expando;setDocument();[0,0].sort(sortOrder);support.detectDuplicates=hasDuplicate;jQuery.find=Sizzle;jQuery.expr=Sizzle.selectors;jQuery.expr[":"]=jQuery.expr.pseudos;jQuery.unique=Sizzle.uniqueSort;jQuery.text=Sizzle.getText;jQuery.isXMLDoc=Sizzle.isXML;jQuery.contains=Sizzle.contains})(window);var optionsCache={};function createOptions(options){var object=optionsCache[options]={};jQuery.each(options.match(core_rnotwhite)||[],function(_,flag){object[flag]=true});return object}jQuery.Callbacks=function(options){options=typeof options==="string"?(optionsCache[options]||createOptions(options)):jQuery.extend({},options);var memory,fired,firing,firingStart,firingLength,firingIndex,list=[],stack=!options.once&&[],fire=function(data){memory=options.memory&&data;fired=true;firingIndex=firingStart||0;firingStart=0;firingLength=list.length;firing=true;for(;list&&firingIndex<firingLength;firingIndex++){if(list[firingIndex].apply(data[0],data[1])===false&&options.stopOnFalse){memory=false;break}}firing=false;if(list){if(stack){if(stack.length){fire(stack.shift())}}else{if(memory){list=[]}else{self.disable()}}}},self={add:function(){if(list){var start=list.length;(function add(args){jQuery.each(args,function(_,arg){var type=jQuery.type(arg);if(type==="function"){if(!options.unique||!self.has(arg)){list.push(arg)}}else{if(arg&&arg.length&&type!=="string"){add(arg)}}})})(arguments);if(firing){firingLength=list.length}else{if(memory){firingStart=start;fire(memory)}}}return this},remove:function(){if(list){jQuery.each(arguments,function(_,arg){var index;while((index=jQuery.inArray(arg,list,index))>-1){list.splice(index,1);if(firing){if(index<=firingLength){firingLength--}if(index<=firingIndex){firingIndex--}}}})}return this},has:function(fn){return fn?jQuery.inArray(fn,list)>-1:!!(list&&list.length)},empty:function(){list=[];firingLength=0;return this},disable:function(){list=stack=memory=undefined;return this},disabled:function(){return !list},lock:function(){stack=undefined;if(!memory){self.disable()}return this},locked:function(){return !stack},fireWith:function(context,args){args=args||[];args=[context,args.slice?args.slice():args];if(list&&(!fired||stack)){if(firing){stack.push(args)}else{fire(args)}}return this},fire:function(){self.fireWith(this,arguments);return this},fired:function(){return !!fired}};return self};jQuery.extend({Deferred:function(func){var tuples=[["resolve","done",jQuery.Callbacks("once memory"),"resolved"],["reject","fail",jQuery.Callbacks("once memory"),"rejected"],["notify","progress",jQuery.Callbacks("memory")]],state="pending",promise={state:function(){return state},always:function(){deferred.done(arguments).fail(arguments);return this},then:function(){var fns=arguments;return jQuery.Deferred(function(newDefer){jQuery.each(tuples,function(i,tuple){var action=tuple[0],fn=jQuery.isFunction(fns[i])&&fns[i];deferred[tuple[1]](function(){var returned=fn&&fn.apply(this,arguments);if(returned&&jQuery.isFunction(returned.promise)){returned.promise().done(newDefer.resolve).fail(newDefer.reject).progress(newDefer.notify)}else{newDefer[action+"With"](this===promise?newDefer.promise():this,fn?[returned]:arguments)}})});fns=null}).promise()},promise:function(obj){return obj!=null?jQuery.extend(obj,promise):promise}},deferred={};promise.pipe=promise.then;jQuery.each(tuples,function(i,tuple){var list=tuple[2],stateString=tuple[3];promise[tuple[1]]=list.add;if(stateString){list.add(function(){state=stateString},tuples[i^1][2].disable,tuples[2][2].lock)}deferred[tuple[0]]=function(){deferred[tuple[0]+"With"](this===deferred?promise:this,arguments);return this};deferred[tuple[0]+"With"]=list.fireWith});promise.promise(deferred);if(func){func.call(deferred,deferred)}return deferred},when:function(subordinate){var i=0,resolveValues=core_slice.call(arguments),length=resolveValues.length,remaining=length!==1||(subordinate&&jQuery.isFunction(subordinate.promise))?length:0,deferred=remaining===1?subordinate:jQuery.Deferred(),updateFunc=function(i,contexts,values){return function(value){contexts[i]=this;values[i]=arguments.length>1?core_slice.call(arguments):value;if(values===progressValues){deferred.notifyWith(contexts,values)}else{if(!(--remaining)){deferred.resolveWith(contexts,values)}}}},progressValues,progressContexts,resolveContexts;if(length>1){progressValues=new Array(length);progressContexts=new Array(length);resolveContexts=new Array(length);for(;i<length;i++){if(resolveValues[i]&&jQuery.isFunction(resolveValues[i].promise)){resolveValues[i].promise().done(updateFunc(i,resolveContexts,resolveValues)).fail(deferred.reject).progress(updateFunc(i,progressContexts,progressValues))}else{--remaining}}}if(!remaining){deferred.resolveWith(resolveContexts,resolveValues)}return deferred.promise()}});jQuery.support=(function(support){var input=document.createElement("input"),fragment=document.createDocumentFragment(),div=document.createElement("div"),select=document.createElement("select"),opt=select.appendChild(document.createElement("option"));if(!input.type){return support}input.type="checkbox";support.checkOn=input.value!=="";support.optSelected=opt.selected;support.reliableMarginRight=true;support.boxSizingReliable=true;support.pixelPosition=false;input.checked=true;support.noCloneChecked=input.cloneNode(true).checked;select.disabled=true;support.optDisabled=!opt.disabled;input=document.createElement("input");input.value="t";input.type="radio";support.radioValue=input.value==="t";input.setAttribute("checked","t");input.setAttribute("name","t");fragment.appendChild(input);support.checkClone=fragment.cloneNode(true).cloneNode(true).lastChild.checked;support.focusinBubbles="onfocusin" in window;div.style.backgroundClip="content-box";div.cloneNode(true).style.backgroundClip="";support.clearCloneStyle=div.style.backgroundClip==="content-box";jQuery(function(){var container,marginDiv,divReset="padding:0;margin:0;border:0;display:block;-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box",body=document.getElementsByTagName("body")[0];if(!body){return}container=document.createElement("div");container.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px";body.appendChild(container).appendChild(div);div.innerHTML="";div.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%";jQuery.swap(body,body.style.zoom!=null?{zoom:1}:{},function(){support.boxSizing=div.offsetWidth===4});if(window.getComputedStyle){support.pixelPosition=(window.getComputedStyle(div,null)||{}).top!=="1%";support.boxSizingReliable=(window.getComputedStyle(div,null)||{width:"4px"}).width==="4px";marginDiv=div.appendChild(document.createElement("div"));marginDiv.style.cssText=div.style.cssText=divReset;marginDiv.style.marginRight=marginDiv.style.width="0";div.style.width="1px";support.reliableMarginRight=!parseFloat((window.getComputedStyle(marginDiv,null)||{}).marginRight)}body.removeChild(container)});return support})({});var data_user,data_priv,rbrace=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,rmultiDash=/([A-Z])/g;function Data(){Object.defineProperty(this.cache={},0,{get:function(){return{}}});this.expando=jQuery.expando+Math.random()}Data.uid=1;Data.accepts=function(owner){return owner.nodeType?owner.nodeType===1||owner.nodeType===9:true};Data.prototype={key:function(owner){if(!Data.accepts(owner)){return 0}var descriptor={},unlock=owner[this.expando];if(!unlock){unlock=Data.uid++;try{descriptor[this.expando]={value:unlock};Object.defineProperties(owner,descriptor)}catch(e){descriptor[this.expando]=unlock;jQuery.extend(owner,descriptor)}}if(!this.cache[unlock]){this.cache[unlock]={}}return unlock},set:function(owner,data,value){var prop,unlock=this.key(owner),cache=this.cache[unlock];if(typeof data==="string"){cache[data]=value}else{if(jQuery.isEmptyObject(cache)){jQuery.extend(this.cache[unlock],data)}else{for(prop in data){cache[prop]=data[prop]}}}return cache},get:function(owner,key){var cache=this.cache[this.key(owner)];return key===undefined?cache:cache[key]},access:function(owner,key,value){if(key===undefined||((key&&typeof key==="string")&&value===undefined)){return this.get(owner,key)}this.set(owner,key,value);return value!==undefined?value:key},remove:function(owner,key){var i,name,camel,unlock=this.key(owner),cache=this.cache[unlock];if(key===undefined){this.cache[unlock]={}}else{if(jQuery.isArray(key)){name=key.concat(key.map(jQuery.camelCase))}else{camel=jQuery.camelCase(key);if(key in cache){name=[key,camel]}else{name=camel;name=name in cache?[name]:(name.match(core_rnotwhite)||[])}}i=name.length;while(i--){delete cache[name[i]]}}},hasData:function(owner){return !jQuery.isEmptyObject(this.cache[owner[this.expando]]||{})},discard:function(owner){if(owner[this.expando]){delete this.cache[owner[this.expando]]}}};data_user=new Data();data_priv=new Data();jQuery.extend({acceptData:Data.accepts,hasData:function(elem){return data_user.hasData(elem)||data_priv.hasData(elem)},data:function(elem,name,data){return data_user.access(elem,name,data)},removeData:function(elem,name){data_user.remove(elem,name)},_data:function(elem,name,data){return data_priv.access(elem,name,data)},_removeData:function(elem,name){data_priv.remove(elem,name)}});jQuery.fn.extend({data:function(key,value){var attrs,name,elem=this[0],i=0,data=null;if(key===undefined){if(this.length){data=data_user.get(elem);if(elem.nodeType===1&&!data_priv.get(elem,"hasDataAttrs")){attrs=elem.attributes;for(;i<attrs.length;i++){name=attrs[i].name;if(name.indexOf("data-")===0){name=jQuery.camelCase(name.slice(5));dataAttr(elem,name,data[name])}}data_priv.set(elem,"hasDataAttrs",true)}}return data}if(typeof key==="object"){return this.each(function(){data_user.set(this,key)})}return jQuery.access(this,function(value){var data,camelKey=jQuery.camelCase(key);if(elem&&value===undefined){data=data_user.get(elem,key);if(data!==undefined){return data}data=data_user.get(elem,camelKey);if(data!==undefined){return data}data=dataAttr(elem,camelKey,undefined);if(data!==undefined){return data}return}this.each(function(){var data=data_user.get(this,camelKey);data_user.set(this,camelKey,value);if(key.indexOf("-")!==-1&&data!==undefined){data_user.set(this,key,value)}})},null,value,arguments.length>1,null,true)},removeData:function(key){return this.each(function(){data_user.remove(this,key)})}});function dataAttr(elem,key,data){var name;if(data===undefined&&elem.nodeType===1){name="data-"+key.replace(rmultiDash,"-$1").toLowerCase();data=elem.getAttribute(name);if(typeof data==="string"){try{data=data==="true"?true:data==="false"?false:data==="null"?null:+data+""===data?+data:rbrace.test(data)?JSON.parse(data):data}catch(e){}data_user.set(elem,key,data)}else{data=undefined}}return data}jQuery.extend({queue:function(elem,type,data){var queue;if(elem){type=(type||"fx")+"queue";queue=data_priv.get(elem,type);if(data){if(!queue||jQuery.isArray(data)){queue=data_priv.access(elem,type,jQuery.makeArray(data))}else{queue.push(data)}}return queue||[]}},dequeue:function(elem,type){type=type||"fx";var queue=jQuery.queue(elem,type),startLength=queue.length,fn=queue.shift(),hooks=jQuery._queueHooks(elem,type),next=function(){jQuery.dequeue(elem,type)};if(fn==="inprogress"){fn=queue.shift();startLength--}if(fn){if(type==="fx"){queue.unshift("inprogress")}delete hooks.stop;fn.call(elem,next,hooks)}if(!startLength&&hooks){hooks.empty.fire()}},_queueHooks:function(elem,type){var key=type+"queueHooks";return data_priv.get(elem,key)||data_priv.access(elem,key,{empty:jQuery.Callbacks("once memory").add(function(){data_priv.remove(elem,[type+"queue",key])})})}});jQuery.fn.extend({queue:function(type,data){var setter=2;if(typeof type!=="string"){data=type;type="fx";setter--}if(arguments.length<setter){return jQuery.queue(this[0],type)}return data===undefined?this:this.each(function(){var queue=jQuery.queue(this,type,data);jQuery._queueHooks(this,type);if(type==="fx"&&queue[0]!=="inprogress"){jQuery.dequeue(this,type)}})},dequeue:function(type){return this.each(function(){jQuery.dequeue(this,type)})},delay:function(time,type){time=jQuery.fx?jQuery.fx.speeds[time]||time:time;type=type||"fx";return this.queue(type,function(next,hooks){var timeout=setTimeout(next,time);hooks.stop=function(){clearTimeout(timeout)}})},clearQueue:function(type){return this.queue(type||"fx",[])},promise:function(type,obj){var tmp,count=1,defer=jQuery.Deferred(),elements=this,i=this.length,resolve=function(){if(!(--count)){defer.resolveWith(elements,[elements])}};if(typeof type!=="string"){obj=type;type=undefined}type=type||"fx";while(i--){tmp=data_priv.get(elements[i],type+"queueHooks");if(tmp&&tmp.empty){count++;tmp.empty.add(resolve)}}resolve();return defer.promise(obj)}});var nodeHook,boolHook,rclass=/[\t\r\n\f]/g,rreturn=/\r/g,rfocusable=/^(?:input|select|textarea|button)$/i;jQuery.fn.extend({attr:function(name,value){return jQuery.access(this,jQuery.attr,name,value,arguments.length>1)},removeAttr:function(name){return this.each(function(){jQuery.removeAttr(this,name)})},prop:function(name,value){return jQuery.access(this,jQuery.prop,name,value,arguments.length>1)},removeProp:function(name){return this.each(function(){delete this[jQuery.propFix[name]||name]})},addClass:function(value){var classes,elem,cur,clazz,j,i=0,len=this.length,proceed=typeof value==="string"&&value;if(jQuery.isFunction(value)){return this.each(function(j){jQuery(this).addClass(value.call(this,j,this.className))})}if(proceed){classes=(value||"").match(core_rnotwhite)||[];for(;i<len;i++){elem=this[i];cur=elem.nodeType===1&&(elem.className?(" "+elem.className+" ").replace(rclass," "):" ");if(cur){j=0;while((clazz=classes[j++])){if(cur.indexOf(" "+clazz+" ")<0){cur+=clazz+" "}}elem.className=jQuery.trim(cur)}}}return this},removeClass:function(value){var classes,elem,cur,clazz,j,i=0,len=this.length,proceed=arguments.length===0||typeof value==="string"&&value;if(jQuery.isFunction(value)){return this.each(function(j){jQuery(this).removeClass(value.call(this,j,this.className))})}if(proceed){classes=(value||"").match(core_rnotwhite)||[];for(;i<len;i++){elem=this[i];cur=elem.nodeType===1&&(elem.className?(" "+elem.className+" ").replace(rclass," "):"");if(cur){j=0;while((clazz=classes[j++])){while(cur.indexOf(" "+clazz+" ")>=0){cur=cur.replace(" "+clazz+" "," ")}}elem.className=value?jQuery.trim(cur):""}}}return this},toggleClass:function(value,stateVal){var type=typeof value,isBool=typeof stateVal==="boolean";if(jQuery.isFunction(value)){return this.each(function(i){jQuery(this).toggleClass(value.call(this,i,this.className,stateVal),stateVal)})}return this.each(function(){if(type==="string"){var className,i=0,self=jQuery(this),state=stateVal,classNames=value.match(core_rnotwhite)||[];while((className=classNames[i++])){state=isBool?state:!self.hasClass(className);self[state?"addClass":"removeClass"](className)}}else{if(type===core_strundefined||type==="boolean"){if(this.className){data_priv.set(this,"__className__",this.className)}this.className=this.className||value===false?"":data_priv.get(this,"__className__")||""}}})},hasClass:function(selector){var className=" "+selector+" ",i=0,l=this.length;for(;i<l;i++){if(this[i].nodeType===1&&(" "+this[i].className+" ").replace(rclass," ").indexOf(className)>=0){return true}}return false},val:function(value){var hooks,ret,isFunction,elem=this[0];if(!arguments.length){if(elem){hooks=jQuery.valHooks[elem.type]||jQuery.valHooks[elem.nodeName.toLowerCase()];if(hooks&&"get" in hooks&&(ret=hooks.get(elem,"value"))!==undefined){return ret}ret=elem.value;return typeof ret==="string"?ret.replace(rreturn,""):ret==null?"":ret}return}isFunction=jQuery.isFunction(value);return this.each(function(i){var val;if(this.nodeType!==1){return}if(isFunction){val=value.call(this,i,jQuery(this).val())}else{val=value}if(val==null){val=""}else{if(typeof val==="number"){val+=""}else{if(jQuery.isArray(val)){val=jQuery.map(val,function(value){return value==null?"":value+""})}}}hooks=jQuery.valHooks[this.type]||jQuery.valHooks[this.nodeName.toLowerCase()];if(!hooks||!("set" in hooks)||hooks.set(this,val,"value")===undefined){this.value=val}})}});jQuery.extend({valHooks:{option:{get:function(elem){var val=elem.attributes.value;return !val||val.specified?elem.value:elem.text}},select:{get:function(elem){var value,option,options=elem.options,index=elem.selectedIndex,one=elem.type==="select-one"||index<0,values=one?null:[],max=one?index+1:options.length,i=index<0?max:one?index:0;for(;i<max;i++){option=options[i];if((option.selected||i===index)&&(jQuery.support.optDisabled?!option.disabled:option.getAttribute("disabled")===null)&&(!option.parentNode.disabled||!jQuery.nodeName(option.parentNode,"optgroup"))){value=jQuery(option).val();if(one){return value}values.push(value)}}return values},set:function(elem,value){var optionSet,option,options=elem.options,values=jQuery.makeArray(value),i=options.length;while(i--){option=options[i];if((option.selected=jQuery.inArray(jQuery(option).val(),values)>=0)){optionSet=true}}if(!optionSet){elem.selectedIndex=-1}return values}}},attr:function(elem,name,value){var hooks,ret,nType=elem.nodeType;if(!elem||nType===3||nType===8||nType===2){return}if(typeof elem.getAttribute===core_strundefined){return jQuery.prop(elem,name,value)}if(nType!==1||!jQuery.isXMLDoc(elem)){name=name.toLowerCase();hooks=jQuery.attrHooks[name]||(jQuery.expr.match.bool.test(name)?boolHook:nodeHook)}if(value!==undefined){if(value===null){jQuery.removeAttr(elem,name)}else{if(hooks&&"set" in hooks&&(ret=hooks.set(elem,value,name))!==undefined){return ret}else{elem.setAttribute(name,value+"");return value}}}else{if(hooks&&"get" in hooks&&(ret=hooks.get(elem,name))!==null){return ret}else{ret=jQuery.find.attr(elem,name);return ret==null?undefined:ret}}},removeAttr:function(elem,value){var name,propName,i=0,attrNames=value&&value.match(core_rnotwhite);if(attrNames&&elem.nodeType===1){while((name=attrNames[i++])){propName=jQuery.propFix[name]||name;if(jQuery.expr.match.bool.test(name)){elem[propName]=false}elem.removeAttribute(name)}}},attrHooks:{type:{set:function(elem,value){if(!jQuery.support.radioValue&&value==="radio"&&jQuery.nodeName(elem,"input")){var val=elem.value;elem.setAttribute("type",value);if(val){elem.value=val}return value}}}},propFix:{"for":"htmlFor","class":"className"},prop:function(elem,name,value){var ret,hooks,notxml,nType=elem.nodeType;if(!elem||nType===3||nType===8||nType===2){return}notxml=nType!==1||!jQuery.isXMLDoc(elem);if(notxml){name=jQuery.propFix[name]||name;hooks=jQuery.propHooks[name]}if(value!==undefined){return hooks&&"set" in hooks&&(ret=hooks.set(elem,value,name))!==undefined?ret:(elem[name]=value)}else{return hooks&&"get" in hooks&&(ret=hooks.get(elem,name))!==null?ret:elem[name]}},propHooks:{tabIndex:{get:function(elem){return elem.hasAttribute("tabindex")||rfocusable.test(elem.nodeName)||elem.href?elem.tabIndex:-1}}}});boolHook={set:function(elem,value,name){if(value===false){jQuery.removeAttr(elem,name)}else{elem.setAttribute(name,name)}return name}};jQuery.each(jQuery.expr.match.bool.source.match(/\w+/g),function(i,name){var getter=jQuery.expr.attrHandle[name]||jQuery.find.attr;jQuery.expr.attrHandle[name]=function(elem,name,isXML){var fn=jQuery.expr.attrHandle[name],ret=isXML?undefined:(jQuery.expr.attrHandle[name]=undefined)!=getter(elem,name,isXML)?name.toLowerCase():null;jQuery.expr.attrHandle[name]=fn;return ret}});if(!jQuery.support.optSelected){jQuery.propHooks.selected={get:function(elem){var parent=elem.parentNode;if(parent&&parent.parentNode){parent.parentNode.selectedIndex}return null}}}jQuery.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){jQuery.propFix[this.toLowerCase()]=this});jQuery.each(["radio","checkbox"],function(){jQuery.valHooks[this]={set:function(elem,value){if(jQuery.isArray(value)){return(elem.checked=jQuery.inArray(jQuery(elem).val(),value)>=0)}}};if(!jQuery.support.checkOn){jQuery.valHooks[this].get=function(elem){return elem.getAttribute("value")===null?"on":elem.value}}});var rkeyEvent=/^key/,rmouseEvent=/^(?:mouse|contextmenu)|click/,rfocusMorph=/^(?:focusinfocus|focusoutblur)$/,rtypenamespace=/^([^.]*)(?:\.(.+)|)$/;function returnTrue(){return true}function returnFalse(){return false}function safeActiveElement(){try{return document.activeElement}catch(err){}}jQuery.event={global:{},add:function(elem,types,handler,data,selector){var handleObjIn,eventHandle,tmp,events,t,handleObj,special,handlers,type,namespaces,origType,elemData=data_priv.get(elem);if(!elemData){return}if(handler.handler){handleObjIn=handler;handler=handleObjIn.handler;selector=handleObjIn.selector}if(!handler.guid){handler.guid=jQuery.guid++}if(!(events=elemData.events)){events=elemData.events={}}if(!(eventHandle=elemData.handle)){eventHandle=elemData.handle=function(e){return typeof jQuery!==core_strundefined&&(!e||jQuery.event.triggered!==e.type)?jQuery.event.dispatch.apply(eventHandle.elem,arguments):undefined};eventHandle.elem=elem}types=(types||"").match(core_rnotwhite)||[""];t=types.length;while(t--){tmp=rtypenamespace.exec(types[t])||[];type=origType=tmp[1];namespaces=(tmp[2]||"").split(".").sort();if(!type){continue}special=jQuery.event.special[type]||{};type=(selector?special.delegateType:special.bindType)||type;special=jQuery.event.special[type]||{};handleObj=jQuery.extend({type:type,origType:origType,data:data,handler:handler,guid:handler.guid,selector:selector,needsContext:selector&&jQuery.expr.match.needsContext.test(selector),namespace:namespaces.join(".")},handleObjIn);if(!(handlers=events[type])){handlers=events[type]=[];handlers.delegateCount=0;if(!special.setup||special.setup.call(elem,data,namespaces,eventHandle)===false){if(elem.addEventListener){elem.addEventListener(type,eventHandle,false)}}}if(special.add){special.add.call(elem,handleObj);if(!handleObj.handler.guid){handleObj.handler.guid=handler.guid}}if(selector){handlers.splice(handlers.delegateCount++,0,handleObj)}else{handlers.push(handleObj)}jQuery.event.global[type]=true}elem=null},remove:function(elem,types,handler,selector,mappedTypes){var j,origCount,tmp,events,t,handleObj,special,handlers,type,namespaces,origType,elemData=data_priv.hasData(elem)&&data_priv.get(elem);if(!elemData||!(events=elemData.events)){return}types=(types||"").match(core_rnotwhite)||[""];t=types.length;while(t--){tmp=rtypenamespace.exec(types[t])||[];type=origType=tmp[1];namespaces=(tmp[2]||"").split(".").sort();if(!type){for(type in events){jQuery.event.remove(elem,type+types[t],handler,selector,true)}continue}special=jQuery.event.special[type]||{};type=(selector?special.delegateType:special.bindType)||type;handlers=events[type]||[];tmp=tmp[2]&&new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)");origCount=j=handlers.length;while(j--){handleObj=handlers[j];if((mappedTypes||origType===handleObj.origType)&&(!handler||handler.guid===handleObj.guid)&&(!tmp||tmp.test(handleObj.namespace))&&(!selector||selector===handleObj.selector||selector==="**"&&handleObj.selector)){handlers.splice(j,1);if(handleObj.selector){handlers.delegateCount--}if(special.remove){special.remove.call(elem,handleObj)}}}if(origCount&&!handlers.length){if(!special.teardown||special.teardown.call(elem,namespaces,elemData.handle)===false){jQuery.removeEvent(elem,type,elemData.handle)}delete events[type]}}if(jQuery.isEmptyObject(events)){delete elemData.handle;data_priv.remove(elem,"events")}},trigger:function(event,data,elem,onlyHandlers){var i,cur,tmp,bubbleType,ontype,handle,special,eventPath=[elem||document],type=core_hasOwn.call(event,"type")?event.type:event,namespaces=core_hasOwn.call(event,"namespace")?event.namespace.split("."):[];cur=tmp=elem=elem||document;if(elem.nodeType===3||elem.nodeType===8){return}if(rfocusMorph.test(type+jQuery.event.triggered)){return}if(type.indexOf(".")>=0){namespaces=type.split(".");type=namespaces.shift();namespaces.sort()}ontype=type.indexOf(":")<0&&"on"+type;event=event[jQuery.expando]?event:new jQuery.Event(type,typeof event==="object"&&event);event.isTrigger=onlyHandlers?2:3;event.namespace=namespaces.join(".");event.namespace_re=event.namespace?new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)"):null;event.result=undefined;if(!event.target){event.target=elem}data=data==null?[event]:jQuery.makeArray(data,[event]);special=jQuery.event.special[type]||{};if(!onlyHandlers&&special.trigger&&special.trigger.apply(elem,data)===false){return}if(!onlyHandlers&&!special.noBubble&&!jQuery.isWindow(elem)){bubbleType=special.delegateType||type;if(!rfocusMorph.test(bubbleType+type)){cur=cur.parentNode}for(;cur;cur=cur.parentNode){eventPath.push(cur);tmp=cur}if(tmp===(elem.ownerDocument||document)){eventPath.push(tmp.defaultView||tmp.parentWindow||window)}}i=0;while((cur=eventPath[i++])&&!event.isPropagationStopped()){event.type=i>1?bubbleType:special.bindType||type;handle=(data_priv.get(cur,"events")||{})[event.type]&&data_priv.get(cur,"handle");if(handle){handle.apply(cur,data)}handle=ontype&&cur[ontype];if(handle&&jQuery.acceptData(cur)&&handle.apply&&handle.apply(cur,data)===false){event.preventDefault()}}event.type=type;if(!onlyHandlers&&!event.isDefaultPrevented()){if((!special._default||special._default.apply(eventPath.pop(),data)===false)&&jQuery.acceptData(elem)){if(ontype&&jQuery.isFunction(elem[type])&&!jQuery.isWindow(elem)){tmp=elem[ontype];if(tmp){elem[ontype]=null}jQuery.event.triggered=type;elem[type]();jQuery.event.triggered=undefined;if(tmp){elem[ontype]=tmp}}}}return event.result},dispatch:function(event){event=jQuery.event.fix(event);var i,j,ret,matched,handleObj,handlerQueue=[],args=core_slice.call(arguments),handlers=(data_priv.get(this,"events")||{})[event.type]||[],special=jQuery.event.special[event.type]||{};args[0]=event;event.delegateTarget=this;if(special.preDispatch&&special.preDispatch.call(this,event)===false){return}handlerQueue=jQuery.event.handlers.call(this,event,handlers);i=0;while((matched=handlerQueue[i++])&&!event.isPropagationStopped()){event.currentTarget=matched.elem;j=0;while((handleObj=matched.handlers[j++])&&!event.isImmediatePropagationStopped()){if(!event.namespace_re||event.namespace_re.test(handleObj.namespace)){event.handleObj=handleObj;event.data=handleObj.data;ret=((jQuery.event.special[handleObj.origType]||{}).handle||handleObj.handler).apply(matched.elem,args);if(ret!==undefined){if((event.result=ret)===false){event.preventDefault();event.stopPropagation()}}}}}if(special.postDispatch){special.postDispatch.call(this,event)}return event.result},handlers:function(event,handlers){var i,matches,sel,handleObj,handlerQueue=[],delegateCount=handlers.delegateCount,cur=event.target;if(delegateCount&&cur.nodeType&&(!event.button||event.type!=="click")){for(;cur!==this;cur=cur.parentNode||this){if(cur.disabled!==true||event.type!=="click"){matches=[];for(i=0;i<delegateCount;i++){handleObj=handlers[i];sel=handleObj.selector+" ";if(matches[sel]===undefined){matches[sel]=handleObj.needsContext?jQuery(sel,this).index(cur)>=0:jQuery.find(sel,this,null,[cur]).length}if(matches[sel]){matches.push(handleObj)}}if(matches.length){handlerQueue.push({elem:cur,handlers:matches})}}}}if(delegateCount<handlers.length){handlerQueue.push({elem:this,handlers:handlers.slice(delegateCount)})}return handlerQueue},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(event,original){if(event.which==null){event.which=original.charCode!=null?original.charCode:original.keyCode}return event}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(event,original){var eventDoc,doc,body,button=original.button;if(event.pageX==null&&original.clientX!=null){eventDoc=event.target.ownerDocument||document;doc=eventDoc.documentElement;body=eventDoc.body;event.pageX=original.clientX+(doc&&doc.scrollLeft||body&&body.scrollLeft||0)-(doc&&doc.clientLeft||body&&body.clientLeft||0);event.pageY=original.clientY+(doc&&doc.scrollTop||body&&body.scrollTop||0)-(doc&&doc.clientTop||body&&body.clientTop||0)}if(!event.which&&button!==undefined){event.which=(button&1?1:(button&2?3:(button&4?2:0)))}return event}},fix:function(event){if(event[jQuery.expando]){return event}var i,prop,copy,type=event.type,originalEvent=event,fixHook=this.fixHooks[type];if(!fixHook){this.fixHooks[type]=fixHook=rmouseEvent.test(type)?this.mouseHooks:rkeyEvent.test(type)?this.keyHooks:{}}copy=fixHook.props?this.props.concat(fixHook.props):this.props;event=new jQuery.Event(originalEvent);i=copy.length;while(i--){prop=copy[i];event[prop]=originalEvent[prop]}if(!event.target){event.target=document}if(event.target.nodeType===3){event.target=event.target.parentNode}return fixHook.filter?fixHook.filter(event,originalEvent):event},special:{load:{noBubble:true},focus:{trigger:function(){if(this!==safeActiveElement()&&this.focus){this.focus();return false}},delegateType:"focusin"},blur:{trigger:function(){if(this===safeActiveElement()&&this.blur){this.blur();return false}},delegateType:"focusout"},click:{trigger:function(){if(this.type==="checkbox"&&this.click&&jQuery.nodeName(this,"input")){this.click();return false}},_default:function(event){return jQuery.nodeName(event.target,"a")}},beforeunload:{postDispatch:function(event){if(event.result!==undefined){event.originalEvent.returnValue=event.result}}}},simulate:function(type,elem,event,bubble){var e=jQuery.extend(new jQuery.Event(),event,{type:type,isSimulated:true,originalEvent:{}});if(bubble){jQuery.event.trigger(e,null,elem)}else{jQuery.event.dispatch.call(elem,e)}if(e.isDefaultPrevented()){event.preventDefault()}}};jQuery.removeEvent=function(elem,type,handle){if(elem.removeEventListener){elem.removeEventListener(type,handle,false)}};jQuery.Event=function(src,props){if(!(this instanceof jQuery.Event)){return new jQuery.Event(src,props)}if(src&&src.type){this.originalEvent=src;this.type=src.type;this.isDefaultPrevented=(src.defaultPrevented||src.getPreventDefault&&src.getPreventDefault())?returnTrue:returnFalse}else{this.type=src}if(props){jQuery.extend(this,props)}this.timeStamp=src&&src.timeStamp||jQuery.now();this[jQuery.expando]=true};jQuery.Event.prototype={isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=returnTrue;if(e&&e.preventDefault){e.preventDefault()}},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=returnTrue;if(e&&e.stopPropagation){e.stopPropagation()}},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=returnTrue;this.stopPropagation()}};jQuery.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(orig,fix){jQuery.event.special[orig]={delegateType:fix,bindType:fix,handle:function(event){var ret,target=this,related=event.relatedTarget,handleObj=event.handleObj;if(!related||(related!==target&&!jQuery.contains(target,related))){event.type=handleObj.origType;ret=handleObj.handler.apply(this,arguments);event.type=fix}return ret}}});if(!jQuery.support.focusinBubbles){jQuery.each({focus:"focusin",blur:"focusout"},function(orig,fix){var attaches=0,handler=function(event){jQuery.event.simulate(fix,event.target,jQuery.event.fix(event),true)};jQuery.event.special[fix]={setup:function(){if(attaches++===0){document.addEventListener(orig,handler,true)}},teardown:function(){if(--attaches===0){document.removeEventListener(orig,handler,true)}}}})}jQuery.fn.extend({on:function(types,selector,data,fn,one){var origFn,type;if(typeof types==="object"){if(typeof selector!=="string"){data=data||selector;selector=undefined}for(type in types){this.on(type,selector,data,types[type],one)}return this}if(data==null&&fn==null){fn=selector;data=selector=undefined}else{if(fn==null){if(typeof selector==="string"){fn=data;data=undefined}else{fn=data;data=selector;selector=undefined}}}if(fn===false){fn=returnFalse}else{if(!fn){return this}}if(one===1){origFn=fn;fn=function(event){jQuery().off(event);return origFn.apply(this,arguments)};fn.guid=origFn.guid||(origFn.guid=jQuery.guid++)}return this.each(function(){jQuery.event.add(this,types,fn,data,selector)})},one:function(types,selector,data,fn){return this.on(types,selector,data,fn,1)},off:function(types,selector,fn){var handleObj,type;if(types&&types.preventDefault&&types.handleObj){handleObj=types.handleObj;jQuery(types.delegateTarget).off(handleObj.namespace?handleObj.origType+"."+handleObj.namespace:handleObj.origType,handleObj.selector,handleObj.handler);return this}if(typeof types==="object"){for(type in types){this.off(type,selector,types[type])}return this}if(selector===false||typeof selector==="function"){fn=selector;selector=undefined}if(fn===false){fn=returnFalse}return this.each(function(){jQuery.event.remove(this,types,fn,selector)})},trigger:function(type,data){return this.each(function(){jQuery.event.trigger(type,data,this)})},triggerHandler:function(type,data){var elem=this[0];if(elem){return jQuery.event.trigger(type,data,elem,true)}}});var isSimple=/^.[^:#\[\.,]*$/,rparentsprev=/^(?:parents|prev(?:Until|All))/,rneedsContext=jQuery.expr.match.needsContext,guaranteedUnique={children:true,contents:true,next:true,prev:true};jQuery.fn.extend({find:function(selector){var i,ret=[],self=this,len=self.length;if(typeof selector!=="string"){return this.pushStack(jQuery(selector).filter(function(){for(i=0;i<len;i++){if(jQuery.contains(self[i],this)){return true}}}))}for(i=0;i<len;i++){jQuery.find(selector,self[i],ret)}ret=this.pushStack(len>1?jQuery.unique(ret):ret);ret.selector=this.selector?this.selector+" "+selector:selector;return ret},has:function(target){var targets=jQuery(target,this),l=targets.length;return this.filter(function(){var i=0;for(;i<l;i++){if(jQuery.contains(this,targets[i])){return true}}})},not:function(selector){return this.pushStack(winnow(this,selector||[],true))},filter:function(selector){return this.pushStack(winnow(this,selector||[],false))},is:function(selector){return !!winnow(this,typeof selector==="string"&&rneedsContext.test(selector)?jQuery(selector):selector||[],false).length},closest:function(selectors,context){var cur,i=0,l=this.length,matched=[],pos=(rneedsContext.test(selectors)||typeof selectors!=="string")?jQuery(selectors,context||this.context):0;for(;i<l;i++){for(cur=this[i];cur&&cur!==context;cur=cur.parentNode){if(cur.nodeType<11&&(pos?pos.index(cur)>-1:cur.nodeType===1&&jQuery.find.matchesSelector(cur,selectors))){cur=matched.push(cur);break}}}return this.pushStack(matched.length>1?jQuery.unique(matched):matched)},index:function(elem){if(!elem){return(this[0]&&this[0].parentNode)?this.first().prevAll().length:-1}if(typeof elem==="string"){return core_indexOf.call(jQuery(elem),this[0])}return core_indexOf.call(this,elem.jquery?elem[0]:elem)},add:function(selector,context){var set=typeof selector==="string"?jQuery(selector,context):jQuery.makeArray(selector&&selector.nodeType?[selector]:selector),all=jQuery.merge(this.get(),set);return this.pushStack(jQuery.unique(all))},addBack:function(selector){return this.add(selector==null?this.prevObject:this.prevObject.filter(selector))}});function sibling(cur,dir){while((cur=cur[dir])&&cur.nodeType!==1){}return cur}jQuery.each({parent:function(elem){var parent=elem.parentNode;return parent&&parent.nodeType!==11?parent:null},parents:function(elem){return jQuery.dir(elem,"parentNode")},parentsUntil:function(elem,i,until){return jQuery.dir(elem,"parentNode",until)},next:function(elem){return sibling(elem,"nextSibling")},prev:function(elem){return sibling(elem,"previousSibling")},nextAll:function(elem){return jQuery.dir(elem,"nextSibling")},prevAll:function(elem){return jQuery.dir(elem,"previousSibling")},nextUntil:function(elem,i,until){return jQuery.dir(elem,"nextSibling",until)},prevUntil:function(elem,i,until){return jQuery.dir(elem,"previousSibling",until)},siblings:function(elem){return jQuery.sibling((elem.parentNode||{}).firstChild,elem)},children:function(elem){return jQuery.sibling(elem.firstChild)},contents:function(elem){return elem.contentDocument||jQuery.merge([],elem.childNodes)}},function(name,fn){jQuery.fn[name]=function(until,selector){var matched=jQuery.map(this,fn,until);if(name.slice(-5)!=="Until"){selector=until}if(selector&&typeof selector==="string"){matched=jQuery.filter(selector,matched)}if(this.length>1){if(!guaranteedUnique[name]){jQuery.unique(matched)}if(rparentsprev.test(name)){matched.reverse()}}return this.pushStack(matched)}});jQuery.extend({filter:function(expr,elems,not){var elem=elems[0];if(not){expr=":not("+expr+")"}return elems.length===1&&elem.nodeType===1?jQuery.find.matchesSelector(elem,expr)?[elem]:[]:jQuery.find.matches(expr,jQuery.grep(elems,function(elem){return elem.nodeType===1}))},dir:function(elem,dir,until){var matched=[],truncate=until!==undefined;while((elem=elem[dir])&&elem.nodeType!==9){if(elem.nodeType===1){if(truncate&&jQuery(elem).is(until)){break}matched.push(elem)}}return matched},sibling:function(n,elem){var matched=[];for(;n;n=n.nextSibling){if(n.nodeType===1&&n!==elem){matched.push(n)}}return matched}});function winnow(elements,qualifier,not){if(jQuery.isFunction(qualifier)){return jQuery.grep(elements,function(elem,i){return !!qualifier.call(elem,i,elem)!==not})}if(qualifier.nodeType){return jQuery.grep(elements,function(elem){return(elem===qualifier)!==not})}if(typeof qualifier==="string"){if(isSimple.test(qualifier)){return jQuery.filter(qualifier,elements,not)}qualifier=jQuery.filter(qualifier,elements)}return jQuery.grep(elements,function(elem){return(core_indexOf.call(qualifier,elem)>=0)!==not})}var rxhtmlTag=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,rtagName=/<([\w:]+)/,rhtml=/<|&#?\w+;/,rnoInnerhtml=/<(?:script|style|link)/i,manipulation_rcheckableType=/^(?:checkbox|radio)$/i,rchecked=/checked\s*(?:[^=]|=\s*.checked.)/i,rscriptType=/^$|\/(?:java|ecma)script/i,rscriptTypeMasked=/^true\/(.*)/,rcleanScript=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,wrapMap={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};wrapMap.optgroup=wrapMap.option;wrapMap.tbody=wrapMap.tfoot=wrapMap.colgroup=wrapMap.caption=wrapMap.thead;wrapMap.th=wrapMap.td;jQuery.fn.extend({text:function(value){return jQuery.access(this,function(value){return value===undefined?jQuery.text(this):this.empty().append((this[0]&&this[0].ownerDocument||document).createTextNode(value))},null,value,arguments.length)},append:function(){return this.domManip(arguments,function(elem){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var target=manipulationTarget(this,elem);target.appendChild(elem)}})},prepend:function(){return this.domManip(arguments,function(elem){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var target=manipulationTarget(this,elem);target.insertBefore(elem,target.firstChild)}})},before:function(){return this.domManip(arguments,function(elem){if(this.parentNode){this.parentNode.insertBefore(elem,this)}})},after:function(){return this.domManip(arguments,function(elem){if(this.parentNode){this.parentNode.insertBefore(elem,this.nextSibling)}})},remove:function(selector,keepData){var elem,elems=selector?jQuery.filter(selector,this):this,i=0;for(;(elem=elems[i])!=null;i++){if(!keepData&&elem.nodeType===1){jQuery.cleanData(getAll(elem))}if(elem.parentNode){if(keepData&&jQuery.contains(elem.ownerDocument,elem)){setGlobalEval(getAll(elem,"script"))}elem.parentNode.removeChild(elem)}}return this},empty:function(){var elem,i=0;for(;(elem=this[i])!=null;i++){if(elem.nodeType===1){jQuery.cleanData(getAll(elem,false));elem.textContent=""}}return this},clone:function(dataAndEvents,deepDataAndEvents){dataAndEvents=dataAndEvents==null?false:dataAndEvents;deepDataAndEvents=deepDataAndEvents==null?dataAndEvents:deepDataAndEvents;return this.map(function(){return jQuery.clone(this,dataAndEvents,deepDataAndEvents)})},html:function(value){return jQuery.access(this,function(value){var elem=this[0]||{},i=0,l=this.length;if(value===undefined&&elem.nodeType===1){return elem.innerHTML}if(typeof value==="string"&&!rnoInnerhtml.test(value)&&!wrapMap[(rtagName.exec(value)||["",""])[1].toLowerCase()]){value=value.replace(rxhtmlTag,"<$1></$2>");try{for(;i<l;i++){elem=this[i]||{};if(elem.nodeType===1){jQuery.cleanData(getAll(elem,false));elem.innerHTML=value}}elem=0}catch(e){}}if(elem){this.empty().append(value)}},null,value,arguments.length)},replaceWith:function(){var args=jQuery.map(this,function(elem){return[elem.nextSibling,elem.parentNode]}),i=0;this.domManip(arguments,function(elem){var next=args[i++],parent=args[i++];if(parent){if(next&&next.parentNode!==parent){next=this.nextSibling}jQuery(this).remove();parent.insertBefore(elem,next)}},true);return i?this:this.remove()},detach:function(selector){return this.remove(selector,true)},domManip:function(args,callback,allowIntersection){args=core_concat.apply([],args);var fragment,first,scripts,hasScripts,node,doc,i=0,l=this.length,set=this,iNoClone=l-1,value=args[0],isFunction=jQuery.isFunction(value);if(isFunction||!(l<=1||typeof value!=="string"||jQuery.support.checkClone||!rchecked.test(value))){return this.each(function(index){var self=set.eq(index);if(isFunction){args[0]=value.call(this,index,self.html())}self.domManip(args,callback,allowIntersection)})}if(l){fragment=jQuery.buildFragment(args,this[0].ownerDocument,false,!allowIntersection&&this);first=fragment.firstChild;if(fragment.childNodes.length===1){fragment=first}if(first){scripts=jQuery.map(getAll(fragment,"script"),disableScript);hasScripts=scripts.length;for(;i<l;i++){node=fragment;if(i!==iNoClone){node=jQuery.clone(node,true,true);if(hasScripts){jQuery.merge(scripts,getAll(node,"script"))}}callback.call(this[i],node,i)}if(hasScripts){doc=scripts[scripts.length-1].ownerDocument;jQuery.map(scripts,restoreScript);for(i=0;i<hasScripts;i++){node=scripts[i];if(rscriptType.test(node.type||"")&&!data_priv.access(node,"globalEval")&&jQuery.contains(doc,node)){if(node.src){jQuery._evalUrl(node.src)}else{jQuery.globalEval(node.textContent.replace(rcleanScript,""))}}}}}}return this}});jQuery.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(name,original){jQuery.fn[name]=function(selector){var elems,ret=[],insert=jQuery(selector),last=insert.length-1,i=0;for(;i<=last;i++){elems=i===last?this:this.clone(true);jQuery(insert[i])[original](elems);core_push.apply(ret,elems.get())}return this.pushStack(ret)}});jQuery.extend({clone:function(elem,dataAndEvents,deepDataAndEvents){var i,l,srcElements,destElements,clone=elem.cloneNode(true),inPage=jQuery.contains(elem.ownerDocument,elem);if(!jQuery.support.noCloneChecked&&(elem.nodeType===1||elem.nodeType===11)&&!jQuery.isXMLDoc(elem)){destElements=getAll(clone);srcElements=getAll(elem);for(i=0,l=srcElements.length;i<l;i++){fixInput(srcElements[i],destElements[i])}}if(dataAndEvents){if(deepDataAndEvents){srcElements=srcElements||getAll(elem);destElements=destElements||getAll(clone);for(i=0,l=srcElements.length;i<l;i++){cloneCopyEvent(srcElements[i],destElements[i])}}else{cloneCopyEvent(elem,clone)}}destElements=getAll(clone,"script");if(destElements.length>0){setGlobalEval(destElements,!inPage&&getAll(elem,"script"))}return clone},buildFragment:function(elems,context,scripts,selection){var elem,tmp,tag,wrap,contains,j,i=0,l=elems.length,fragment=context.createDocumentFragment(),nodes=[];for(;i<l;i++){elem=elems[i];if(elem||elem===0){if(jQuery.type(elem)==="object"){jQuery.merge(nodes,elem.nodeType?[elem]:elem)}else{if(!rhtml.test(elem)){nodes.push(context.createTextNode(elem))}else{tmp=tmp||fragment.appendChild(context.createElement("div"));tag=(rtagName.exec(elem)||["",""])[1].toLowerCase();wrap=wrapMap[tag]||wrapMap._default;tmp.innerHTML=wrap[1]+elem.replace(rxhtmlTag,"<$1></$2>")+wrap[2];j=wrap[0];while(j--){tmp=tmp.firstChild}jQuery.merge(nodes,tmp.childNodes);tmp=fragment.firstChild;tmp.textContent=""}}}}fragment.textContent="";i=0;while((elem=nodes[i++])){if(selection&&jQuery.inArray(elem,selection)!==-1){continue}contains=jQuery.contains(elem.ownerDocument,elem);tmp=getAll(fragment.appendChild(elem),"script");if(contains){setGlobalEval(tmp)}if(scripts){j=0;while((elem=tmp[j++])){if(rscriptType.test(elem.type||"")){scripts.push(elem)}}}}return fragment},cleanData:function(elems){var data,elem,events,type,key,j,special=jQuery.event.special,i=0;for(;(elem=elems[i])!==undefined;i++){if(Data.accepts(elem)){key=elem[data_priv.expando];if(key&&(data=data_priv.cache[key])){events=Object.keys(data.events||{});if(events.length){for(j=0;(type=events[j])!==undefined;j++){if(special[type]){jQuery.event.remove(elem,type)}else{jQuery.removeEvent(elem,type,data.handle)}}}if(data_priv.cache[key]){delete data_priv.cache[key]}}}delete data_user.cache[elem[data_user.expando]]}},_evalUrl:function(url){return jQuery.ajax({url:url,type:"GET",dataType:"script",async:false,global:false,"throws":true})}});function manipulationTarget(elem,content){return jQuery.nodeName(elem,"table")&&jQuery.nodeName(content.nodeType===1?content:content.firstChild,"tr")?elem.getElementsByTagName("tbody")[0]||elem.appendChild(elem.ownerDocument.createElement("tbody")):elem}function disableScript(elem){elem.type=(elem.getAttribute("type")!==null)+"/"+elem.type;return elem}function restoreScript(elem){var match=rscriptTypeMasked.exec(elem.type);if(match){elem.type=match[1]}else{elem.removeAttribute("type")}return elem}function setGlobalEval(elems,refElements){var l=elems.length,i=0;for(;i<l;i++){data_priv.set(elems[i],"globalEval",!refElements||data_priv.get(refElements[i],"globalEval"))}}function cloneCopyEvent(src,dest){var i,l,type,pdataOld,pdataCur,udataOld,udataCur,events;if(dest.nodeType!==1){return}if(data_priv.hasData(src)){pdataOld=data_priv.access(src);pdataCur=data_priv.set(dest,pdataOld);events=pdataOld.events;if(events){delete pdataCur.handle;pdataCur.events={};for(type in events){for(i=0,l=events[type].length;i<l;i++){jQuery.event.add(dest,type,events[type][i])}}}}if(data_user.hasData(src)){udataOld=data_user.access(src);udataCur=jQuery.extend({},udataOld);data_user.set(dest,udataCur)}}function getAll(context,tag){var ret=context.getElementsByTagName?context.getElementsByTagName(tag||"*"):context.querySelectorAll?context.querySelectorAll(tag||"*"):[];return tag===undefined||tag&&jQuery.nodeName(context,tag)?jQuery.merge([context],ret):ret}function fixInput(src,dest){var nodeName=dest.nodeName.toLowerCase();if(nodeName==="input"&&manipulation_rcheckableType.test(src.type)){dest.checked=src.checked}else{if(nodeName==="input"||nodeName==="textarea"){dest.defaultValue=src.defaultValue}}}jQuery.fn.extend({wrapAll:function(html){var wrap;if(jQuery.isFunction(html)){return this.each(function(i){jQuery(this).wrapAll(html.call(this,i))})}if(this[0]){wrap=jQuery(html,this[0].ownerDocument).eq(0).clone(true);if(this[0].parentNode){wrap.insertBefore(this[0])}wrap.map(function(){var elem=this;while(elem.firstElementChild){elem=elem.firstElementChild}return elem}).append(this)}return this},wrapInner:function(html){if(jQuery.isFunction(html)){return this.each(function(i){jQuery(this).wrapInner(html.call(this,i))})}return this.each(function(){var self=jQuery(this),contents=self.contents();if(contents.length){contents.wrapAll(html)}else{self.append(html)}})},wrap:function(html){var isFunction=jQuery.isFunction(html);return this.each(function(i){jQuery(this).wrapAll(isFunction?html.call(this,i):html)})},unwrap:function(){return this.parent().each(function(){if(!jQuery.nodeName(this,"body")){jQuery(this).replaceWith(this.childNodes)}}).end()}});var curCSS,iframe,rdisplayswap=/^(none|table(?!-c[ea]).+)/,rmargin=/^margin/,rnumsplit=new RegExp("^("+core_pnum+")(.*)$","i"),rnumnonpx=new RegExp("^("+core_pnum+")(?!px)[a-z%]+$","i"),rrelNum=new RegExp("^([+-])=("+core_pnum+")","i"),elemdisplay={BODY:"block"},cssShow={position:"absolute",visibility:"hidden",display:"block"},cssNormalTransform={letterSpacing:0,fontWeight:400},cssExpand=["Top","Right","Bottom","Left"],cssPrefixes=["Webkit","O","Moz","ms"];function vendorPropName(style,name){if(name in style){return name}var capName=name.charAt(0).toUpperCase()+name.slice(1),origName=name,i=cssPrefixes.length;while(i--){name=cssPrefixes[i]+capName;if(name in style){return name}}return origName}function isHidden(elem,el){elem=el||elem;return jQuery.css(elem,"display")==="none"||!jQuery.contains(elem.ownerDocument,elem)}function getStyles(elem){return window.getComputedStyle(elem,null)}function showHide(elements,show){var display,elem,hidden,values=[],index=0,length=elements.length;for(;index<length;index++){elem=elements[index];if(!elem.style){continue}values[index]=data_priv.get(elem,"olddisplay");display=elem.style.display;if(show){if(!values[index]&&display==="none"){elem.style.display=""}if(elem.style.display===""&&isHidden(elem)){values[index]=data_priv.access(elem,"olddisplay",css_defaultDisplay(elem.nodeName))}}else{if(!values[index]){hidden=isHidden(elem);if(display&&display!=="none"||!hidden){data_priv.set(elem,"olddisplay",hidden?display:jQuery.css(elem,"display"))}}}}for(index=0;index<length;index++){elem=elements[index];if(!elem.style){continue}if(!show||elem.style.display==="none"||elem.style.display===""){elem.style.display=show?values[index]||"":"none"}}return elements}jQuery.fn.extend({css:function(name,value){return jQuery.access(this,function(elem,name,value){var styles,len,map={},i=0;if(jQuery.isArray(name)){styles=getStyles(elem);len=name.length;for(;i<len;i++){map[name[i]]=jQuery.css(elem,name[i],false,styles)}return map}return value!==undefined?jQuery.style(elem,name,value):jQuery.css(elem,name)},name,value,arguments.length>1)},show:function(){return showHide(this,true)},hide:function(){return showHide(this)},toggle:function(state){var bool=typeof state==="boolean";return this.each(function(){if(bool?state:isHidden(this)){jQuery(this).show()}else{jQuery(this).hide()}})}});jQuery.extend({cssHooks:{opacity:{get:function(elem,computed){if(computed){var ret=curCSS(elem,"opacity");return ret===""?"1":ret}}}},cssNumber:{columnCount:true,fillOpacity:true,fontWeight:true,lineHeight:true,opacity:true,orphans:true,widows:true,zIndex:true,zoom:true},cssProps:{"float":"cssFloat"},style:function(elem,name,value,extra){if(!elem||elem.nodeType===3||elem.nodeType===8||!elem.style){return}var ret,type,hooks,origName=jQuery.camelCase(name),style=elem.style;name=jQuery.cssProps[origName]||(jQuery.cssProps[origName]=vendorPropName(style,origName));hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName];if(value!==undefined){type=typeof value;if(type==="string"&&(ret=rrelNum.exec(value))){value=(ret[1]+1)*ret[2]+parseFloat(jQuery.css(elem,name));type="number"}if(value==null||type==="number"&&isNaN(value)){return}if(type==="number"&&!jQuery.cssNumber[origName]){value+="px"}if(!jQuery.support.clearCloneStyle&&value===""&&name.indexOf("background")===0){style[name]="inherit"}if(!hooks||!("set" in hooks)||(value=hooks.set(elem,value,extra))!==undefined){style[name]=value}}else{if(hooks&&"get" in hooks&&(ret=hooks.get(elem,false,extra))!==undefined){return ret}return style[name]}},css:function(elem,name,extra,styles){var val,num,hooks,origName=jQuery.camelCase(name);name=jQuery.cssProps[origName]||(jQuery.cssProps[origName]=vendorPropName(elem.style,origName));hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName];if(hooks&&"get" in hooks){val=hooks.get(elem,true,extra)}if(val===undefined){val=curCSS(elem,name,styles)}if(val==="normal"&&name in cssNormalTransform){val=cssNormalTransform[name]}if(extra===""||extra){num=parseFloat(val);return extra===true||jQuery.isNumeric(num)?num||0:val}return val}});curCSS=function(elem,name,_computed){var width,minWidth,maxWidth,computed=_computed||getStyles(elem),ret=computed?computed.getPropertyValue(name)||computed[name]:undefined,style=elem.style;if(computed){if(ret===""&&!jQuery.contains(elem.ownerDocument,elem)){ret=jQuery.style(elem,name)}if(rnumnonpx.test(ret)&&rmargin.test(name)){width=style.width;minWidth=style.minWidth;maxWidth=style.maxWidth;style.minWidth=style.maxWidth=style.width=ret;ret=computed.width;style.width=width;style.minWidth=minWidth;style.maxWidth=maxWidth}}return ret};function setPositiveNumber(elem,value,subtract){var matches=rnumsplit.exec(value);return matches?Math.max(0,matches[1]-(subtract||0))+(matches[2]||"px"):value}function augmentWidthOrHeight(elem,name,extra,isBorderBox,styles){var i=extra===(isBorderBox?"border":"content")?4:name==="width"?1:0,val=0;for(;i<4;i+=2){if(extra==="margin"){val+=jQuery.css(elem,extra+cssExpand[i],true,styles)}if(isBorderBox){if(extra==="content"){val-=jQuery.css(elem,"padding"+cssExpand[i],true,styles)}if(extra!=="margin"){val-=jQuery.css(elem,"border"+cssExpand[i]+"Width",true,styles)}}else{val+=jQuery.css(elem,"padding"+cssExpand[i],true,styles);if(extra!=="padding"){val+=jQuery.css(elem,"border"+cssExpand[i]+"Width",true,styles)}}}return val}function getWidthOrHeight(elem,name,extra){var valueIsBorderBox=true,val=name==="width"?elem.offsetWidth:elem.offsetHeight,styles=getStyles(elem),isBorderBox=jQuery.support.boxSizing&&jQuery.css(elem,"boxSizing",false,styles)==="border-box";if(val<=0||val==null){val=curCSS(elem,name,styles);if(val<0||val==null){val=elem.style[name]}if(rnumnonpx.test(val)){return val}valueIsBorderBox=isBorderBox&&(jQuery.support.boxSizingReliable||val===elem.style[name]);val=parseFloat(val)||0}return(val+augmentWidthOrHeight(elem,name,extra||(isBorderBox?"border":"content"),valueIsBorderBox,styles))+"px"}function css_defaultDisplay(nodeName){var doc=document,display=elemdisplay[nodeName];if(!display){display=actualDisplay(nodeName,doc);if(display==="none"||!display){iframe=(iframe||jQuery("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(doc.documentElement);doc=(iframe[0].contentWindow||iframe[0].contentDocument).document;doc.write("<!doctype html><html><body>");doc.close();display=actualDisplay(nodeName,doc);iframe.detach()}elemdisplay[nodeName]=display}return display}function actualDisplay(name,doc){var elem=jQuery(doc.createElement(name)).appendTo(doc.body),display=jQuery.css(elem[0],"display");elem.remove();return display}jQuery.each(["height","width"],function(i,name){jQuery.cssHooks[name]={get:function(elem,computed,extra){if(computed){return elem.offsetWidth===0&&rdisplayswap.test(jQuery.css(elem,"display"))?jQuery.swap(elem,cssShow,function(){return getWidthOrHeight(elem,name,extra)}):getWidthOrHeight(elem,name,extra)}},set:function(elem,value,extra){var styles=extra&&getStyles(elem);return setPositiveNumber(elem,value,extra?augmentWidthOrHeight(elem,name,extra,jQuery.support.boxSizing&&jQuery.css(elem,"boxSizing",false,styles)==="border-box",styles):0)}}});jQuery(function(){if(!jQuery.support.reliableMarginRight){jQuery.cssHooks.marginRight={get:function(elem,computed){if(computed){return jQuery.swap(elem,{display:"inline-block"},curCSS,[elem,"marginRight"])}}}}if(!jQuery.support.pixelPosition&&jQuery.fn.position){jQuery.each(["top","left"],function(i,prop){jQuery.cssHooks[prop]={get:function(elem,computed){if(computed){computed=curCSS(elem,prop);return rnumnonpx.test(computed)?jQuery(elem).position()[prop]+"px":computed}}}})}});if(jQuery.expr&&jQuery.expr.filters){jQuery.expr.filters.hidden=function(elem){return elem.offsetWidth<=0&&elem.offsetHeight<=0};jQuery.expr.filters.visible=function(elem){return !jQuery.expr.filters.hidden(elem)}}jQuery.each({margin:"",padding:"",border:"Width"},function(prefix,suffix){jQuery.cssHooks[prefix+suffix]={expand:function(value){var i=0,expanded={},parts=typeof value==="string"?value.split(" "):[value];for(;i<4;i++){expanded[prefix+cssExpand[i]+suffix]=parts[i]||parts[i-2]||parts[0]}return expanded}};if(!rmargin.test(prefix)){jQuery.cssHooks[prefix+suffix].set=setPositiveNumber}});var r20=/%20/g,rbracket=/\[\]$/,rCRLF=/\r?\n/g,rsubmitterTypes=/^(?:submit|button|image|reset|file)$/i,rsubmittable=/^(?:input|select|textarea|keygen)/i;jQuery.fn.extend({serialize:function(){return jQuery.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var elements=jQuery.prop(this,"elements");return elements?jQuery.makeArray(elements):this}).filter(function(){var type=this.type;return this.name&&!jQuery(this).is(":disabled")&&rsubmittable.test(this.nodeName)&&!rsubmitterTypes.test(type)&&(this.checked||!manipulation_rcheckableType.test(type))}).map(function(i,elem){var val=jQuery(this).val();return val==null?null:jQuery.isArray(val)?jQuery.map(val,function(val){return{name:elem.name,value:val.replace(rCRLF,"\r\n")}}):{name:elem.name,value:val.replace(rCRLF,"\r\n")}}).get()}});jQuery.param=function(a,traditional){var prefix,s=[],add=function(key,value){value=jQuery.isFunction(value)?value():(value==null?"":value);s[s.length]=encodeURIComponent(key)+"="+encodeURIComponent(value)};if(traditional===undefined){traditional=jQuery.ajaxSettings&&jQuery.ajaxSettings.traditional}if(jQuery.isArray(a)||(a.jquery&&!jQuery.isPlainObject(a))){jQuery.each(a,function(){add(this.name,this.value)})}else{for(prefix in a){buildParams(prefix,a[prefix],traditional,add)}}return s.join("&").replace(r20,"+")};function buildParams(prefix,obj,traditional,add){var name;if(jQuery.isArray(obj)){jQuery.each(obj,function(i,v){if(traditional||rbracket.test(prefix)){add(prefix,v)}else{buildParams(prefix+"["+(typeof v==="object"?i:"")+"]",v,traditional,add)}})}else{if(!traditional&&jQuery.type(obj)==="object"){for(name in obj){buildParams(prefix+"["+name+"]",obj[name],traditional,add)}}else{add(prefix,obj)}}}jQuery.each(("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu").split(" "),function(i,name){jQuery.fn[name]=function(data,fn){return arguments.length>0?this.on(name,null,data,fn):this.trigger(name)}});jQuery.fn.extend({hover:function(fnOver,fnOut){return this.mouseenter(fnOver).mouseleave(fnOut||fnOver)},bind:function(types,data,fn){return this.on(types,null,data,fn)},unbind:function(types,fn){return this.off(types,null,fn)},delegate:function(selector,types,data,fn){return this.on(types,selector,data,fn)},undelegate:function(selector,types,fn){return arguments.length===1?this.off(selector,"**"):this.off(types,selector||"**",fn)}});var ajaxLocParts,ajaxLocation,ajax_nonce=jQuery.now(),ajax_rquery=/\?/,rhash=/#.*$/,rts=/([?&])_=[^&]*/,rheaders=/^(.*?):[ \t]*([^\r\n]*)$/mg,rlocalProtocol=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,rnoContent=/^(?:GET|HEAD)$/,rprotocol=/^\/\//,rurl=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,_load=jQuery.fn.load,prefilters={},transports={},allTypes="*/".concat("*");try{ajaxLocation=location.href}catch(e){ajaxLocation=document.createElement("a");ajaxLocation.href="";ajaxLocation=ajaxLocation.href}ajaxLocParts=rurl.exec(ajaxLocation.toLowerCase())||[];function addToPrefiltersOrTransports(structure){return function(dataTypeExpression,func){if(typeof dataTypeExpression!=="string"){func=dataTypeExpression;dataTypeExpression="*"}var dataType,i=0,dataTypes=dataTypeExpression.toLowerCase().match(core_rnotwhite)||[];if(jQuery.isFunction(func)){while((dataType=dataTypes[i++])){if(dataType[0]==="+"){dataType=dataType.slice(1)||"*";(structure[dataType]=structure[dataType]||[]).unshift(func)}else{(structure[dataType]=structure[dataType]||[]).push(func)}}}}}function inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR){var inspected={},seekingTransport=(structure===transports);function inspect(dataType){var selected;inspected[dataType]=true;jQuery.each(structure[dataType]||[],function(_,prefilterOrFactory){var dataTypeOrTransport=prefilterOrFactory(options,originalOptions,jqXHR);if(typeof dataTypeOrTransport==="string"&&!seekingTransport&&!inspected[dataTypeOrTransport]){options.dataTypes.unshift(dataTypeOrTransport);inspect(dataTypeOrTransport);return false}else{if(seekingTransport){return !(selected=dataTypeOrTransport)}}});return selected}return inspect(options.dataTypes[0])||!inspected["*"]&&inspect("*")}function ajaxExtend(target,src){var key,deep,flatOptions=jQuery.ajaxSettings.flatOptions||{};for(key in src){if(src[key]!==undefined){(flatOptions[key]?target:(deep||(deep={})))[key]=src[key]}}if(deep){jQuery.extend(true,target,deep)}return target}jQuery.fn.load=function(url,params,callback){if(typeof url!=="string"&&_load){return _load.apply(this,arguments)}var selector,type,response,self=this,off=url.indexOf(" ");if(off>=0){selector=url.slice(off);url=url.slice(0,off)}if(jQuery.isFunction(params)){callback=params;params=undefined}else{if(params&&typeof params==="object"){type="POST"}}if(self.length>0){jQuery.ajax({url:url,type:type,dataType:"html",data:params}).done(function(responseText){response=arguments;self.html(selector?jQuery("<div>").append(jQuery.parseHTML(responseText)).find(selector):responseText)}).complete(callback&&function(jqXHR,status){self.each(callback,response||[jqXHR.responseText,status,jqXHR])})}return this};jQuery.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(i,type){jQuery.fn[type]=function(fn){return this.on(type,fn)}});jQuery.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:ajaxLocation,type:"GET",isLocal:rlocalProtocol.test(ajaxLocParts[1]),global:true,processData:true,async:true,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":allTypes,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":true,"text json":jQuery.parseJSON,"text xml":jQuery.parseXML},flatOptions:{url:true,context:true}},ajaxSetup:function(target,settings){return settings?ajaxExtend(ajaxExtend(target,jQuery.ajaxSettings),settings):ajaxExtend(jQuery.ajaxSettings,target)},ajaxPrefilter:addToPrefiltersOrTransports(prefilters),ajaxTransport:addToPrefiltersOrTransports(transports),ajax:function(url,options){if(typeof url==="object"){options=url;url=undefined}options=options||{};var transport,cacheURL,responseHeadersString,responseHeaders,timeoutTimer,parts,fireGlobals,i,s=jQuery.ajaxSetup({},options),callbackContext=s.context||s,globalEventContext=s.context&&(callbackContext.nodeType||callbackContext.jquery)?jQuery(callbackContext):jQuery.event,deferred=jQuery.Deferred(),completeDeferred=jQuery.Callbacks("once memory"),statusCode=s.statusCode||{},requestHeaders={},requestHeadersNames={},state=0,strAbort="canceled",jqXHR={readyState:0,getResponseHeader:function(key){var match;if(state===2){if(!responseHeaders){responseHeaders={};while((match=rheaders.exec(responseHeadersString))){responseHeaders[match[1].toLowerCase()]=match[2]}}match=responseHeaders[key.toLowerCase()]}return match==null?null:match},getAllResponseHeaders:function(){return state===2?responseHeadersString:null},setRequestHeader:function(name,value){var lname=name.toLowerCase();if(!state){name=requestHeadersNames[lname]=requestHeadersNames[lname]||name;requestHeaders[name]=value}return this},overrideMimeType:function(type){if(!state){s.mimeType=type}return this},statusCode:function(map){var code;if(map){if(state<2){for(code in map){statusCode[code]=[statusCode[code],map[code]]}}else{jqXHR.always(map[jqXHR.status])}}return this},abort:function(statusText){var finalText=statusText||strAbort;if(transport){transport.abort(finalText)}done(0,finalText);return this}};deferred.promise(jqXHR).complete=completeDeferred.add;jqXHR.success=jqXHR.done;jqXHR.error=jqXHR.fail;s.url=((url||s.url||ajaxLocation)+"").replace(rhash,"").replace(rprotocol,ajaxLocParts[1]+"//");s.type=options.method||options.type||s.method||s.type;s.dataTypes=jQuery.trim(s.dataType||"*").toLowerCase().match(core_rnotwhite)||[""];if(s.crossDomain==null){parts=rurl.exec(s.url.toLowerCase());s.crossDomain=!!(parts&&(parts[1]!==ajaxLocParts[1]||parts[2]!==ajaxLocParts[2]||(parts[3]||(parts[1]==="http:"?"80":"443"))!==(ajaxLocParts[3]||(ajaxLocParts[1]==="http:"?"80":"443"))))}if(s.data&&s.processData&&typeof s.data!=="string"){s.data=jQuery.param(s.data,s.traditional)}inspectPrefiltersOrTransports(prefilters,s,options,jqXHR);if(state===2){return jqXHR}fireGlobals=s.global;if(fireGlobals&&jQuery.active++===0){jQuery.event.trigger("ajaxStart")}s.type=s.type.toUpperCase();s.hasContent=!rnoContent.test(s.type);cacheURL=s.url;if(!s.hasContent){if(s.data){cacheURL=(s.url+=(ajax_rquery.test(cacheURL)?"&":"?")+s.data);delete s.data}if(s.cache===false){s.url=rts.test(cacheURL)?cacheURL.replace(rts,"$1_="+ajax_nonce++):cacheURL+(ajax_rquery.test(cacheURL)?"&":"?")+"_="+ajax_nonce++}}if(s.ifModified){if(jQuery.lastModified[cacheURL]){jqXHR.setRequestHeader("If-Modified-Since",jQuery.lastModified[cacheURL])}if(jQuery.etag[cacheURL]){jqXHR.setRequestHeader("If-None-Match",jQuery.etag[cacheURL])}}if(s.data&&s.hasContent&&s.contentType!==false||options.contentType){jqXHR.setRequestHeader("Content-Type",s.contentType)}jqXHR.setRequestHeader("Accept",s.dataTypes[0]&&s.accepts[s.dataTypes[0]]?s.accepts[s.dataTypes[0]]+(s.dataTypes[0]!=="*"?", "+allTypes+"; q=0.01":""):s.accepts["*"]);for(i in s.headers){jqXHR.setRequestHeader(i,s.headers[i])}if(s.beforeSend&&(s.beforeSend.call(callbackContext,jqXHR,s)===false||state===2)){return jqXHR.abort()}strAbort="abort";for(i in {success:1,error:1,complete:1}){jqXHR[i](s[i])}transport=inspectPrefiltersOrTransports(transports,s,options,jqXHR);if(!transport){done(-1,"No Transport")}else{jqXHR.readyState=1;if(fireGlobals){globalEventContext.trigger("ajaxSend",[jqXHR,s])}if(s.async&&s.timeout>0){timeoutTimer=setTimeout(function(){jqXHR.abort("timeout")},s.timeout)}try{state=1;transport.send(requestHeaders,done)}catch(e){if(state<2){done(-1,e)}else{throw e}}}function done(status,nativeStatusText,responses,headers){var isSuccess,success,error,response,modified,statusText=nativeStatusText;if(state===2){return}state=2;if(timeoutTimer){clearTimeout(timeoutTimer)}transport=undefined;responseHeadersString=headers||"";jqXHR.readyState=status>0?4:0;isSuccess=status>=200&&status<300||status===304;if(responses){response=ajaxHandleResponses(s,jqXHR,responses)}response=ajaxConvert(s,response,jqXHR,isSuccess);if(isSuccess){if(s.ifModified){modified=jqXHR.getResponseHeader("Last-Modified");if(modified){jQuery.lastModified[cacheURL]=modified}modified=jqXHR.getResponseHeader("etag");if(modified){jQuery.etag[cacheURL]=modified}}if(status===204||s.type==="HEAD"){statusText="nocontent"}else{if(status===304){statusText="notmodified"}else{statusText=response.state;success=response.data;error=response.error;isSuccess=!error}}}else{error=statusText;if(status||!statusText){statusText="error";if(status<0){status=0}}}jqXHR.status=status;jqXHR.statusText=(nativeStatusText||statusText)+"";if(isSuccess){deferred.resolveWith(callbackContext,[success,statusText,jqXHR])}else{deferred.rejectWith(callbackContext,[jqXHR,statusText,error])}jqXHR.statusCode(statusCode);statusCode=undefined;if(fireGlobals){globalEventContext.trigger(isSuccess?"ajaxSuccess":"ajaxError",[jqXHR,s,isSuccess?success:error])}completeDeferred.fireWith(callbackContext,[jqXHR,statusText]);if(fireGlobals){globalEventContext.trigger("ajaxComplete",[jqXHR,s]);if(!(--jQuery.active)){jQuery.event.trigger("ajaxStop")}}}return jqXHR},getJSON:function(url,data,callback){return jQuery.get(url,data,callback,"json")},getScript:function(url,callback){return jQuery.get(url,undefined,callback,"script")}});jQuery.each(["get","post"],function(i,method){jQuery[method]=function(url,data,callback,type){if(jQuery.isFunction(data)){type=type||callback;callback=data;data=undefined}return jQuery.ajax({url:url,type:method,dataType:type,data:data,success:callback})}});function ajaxHandleResponses(s,jqXHR,responses){var ct,type,finalDataType,firstDataType,contents=s.contents,dataTypes=s.dataTypes;while(dataTypes[0]==="*"){dataTypes.shift();if(ct===undefined){ct=s.mimeType||jqXHR.getResponseHeader("Content-Type")}}if(ct){for(type in contents){if(contents[type]&&contents[type].test(ct)){dataTypes.unshift(type);break}}}if(dataTypes[0] in responses){finalDataType=dataTypes[0]}else{for(type in responses){if(!dataTypes[0]||s.converters[type+" "+dataTypes[0]]){finalDataType=type;break}if(!firstDataType){firstDataType=type}}finalDataType=finalDataType||firstDataType}if(finalDataType){if(finalDataType!==dataTypes[0]){dataTypes.unshift(finalDataType)}return responses[finalDataType]}}function ajaxConvert(s,response,jqXHR,isSuccess){var conv2,current,conv,tmp,prev,converters={},dataTypes=s.dataTypes.slice();if(dataTypes[1]){for(conv in s.converters){converters[conv.toLowerCase()]=s.converters[conv]}}current=dataTypes.shift();while(current){if(s.responseFields[current]){jqXHR[s.responseFields[current]]=response}if(!prev&&isSuccess&&s.dataFilter){response=s.dataFilter(response,s.dataType)}prev=current;current=dataTypes.shift();if(current){if(current==="*"){current=prev}else{if(prev!=="*"&&prev!==current){conv=converters[prev+" "+current]||converters["* "+current];if(!conv){for(conv2 in converters){tmp=conv2.split(" ");if(tmp[1]===current){conv=converters[prev+" "+tmp[0]]||converters["* "+tmp[0]];if(conv){if(conv===true){conv=converters[conv2]}else{if(converters[conv2]!==true){current=tmp[0];dataTypes.unshift(tmp[1])}}break}}}}if(conv!==true){if(conv&&s["throws"]){response=conv(response)}else{try{response=conv(response)}catch(e){return{state:"parsererror",error:conv?e:"No conversion from "+prev+" to "+current}}}}}}}}return{state:"success",data:response}}jQuery.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(text){jQuery.globalEval(text);return text}}});jQuery.ajaxPrefilter("script",function(s){if(s.cache===undefined){s.cache=false}if(s.crossDomain){s.type="GET"}});jQuery.ajaxTransport("script",function(s){if(s.crossDomain){var script,callback;return{send:function(_,complete){script=jQuery("<script>").prop({async:true,charset:s.scriptCharset,src:s.url}).on("load error",callback=function(evt){script.remove();callback=null;if(evt){complete(evt.type==="error"?404:200,evt.type)}});document.head.appendChild(script[0])},abort:function(){if(callback){callback()}}}}});var oldCallbacks=[],rjsonp=/(=)\?(?=&|$)|\?\?/;jQuery.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var callback=oldCallbacks.pop()||(jQuery.expando+"_"+(ajax_nonce++));this[callback]=true;return callback}});jQuery.ajaxPrefilter("json jsonp",function(s,originalSettings,jqXHR){var callbackName,overwritten,responseContainer,jsonProp=s.jsonp!==false&&(rjsonp.test(s.url)?"url":typeof s.data==="string"&&!(s.contentType||"").indexOf("application/x-www-form-urlencoded")&&rjsonp.test(s.data)&&"data");if(jsonProp||s.dataTypes[0]==="jsonp"){callbackName=s.jsonpCallback=jQuery.isFunction(s.jsonpCallback)?s.jsonpCallback():s.jsonpCallback;if(jsonProp){s[jsonProp]=s[jsonProp].replace(rjsonp,"$1"+callbackName)}else{if(s.jsonp!==false){s.url+=(ajax_rquery.test(s.url)?"&":"?")+s.jsonp+"="+callbackName}}s.converters["script json"]=function(){if(!responseContainer){jQuery.error(callbackName+" was not called")}return responseContainer[0]};s.dataTypes[0]="json";overwritten=window[callbackName];window[callbackName]=function(){responseContainer=arguments};jqXHR.always(function(){window[callbackName]=overwritten;if(s[callbackName]){s.jsonpCallback=originalSettings.jsonpCallback;oldCallbacks.push(callbackName)}if(responseContainer&&jQuery.isFunction(overwritten)){overwritten(responseContainer[0])}responseContainer=overwritten=undefined});return"script"}});jQuery.ajaxSettings.xhr=function(){try{return new XMLHttpRequest()}catch(e){}};var xhrSupported=jQuery.ajaxSettings.xhr(),xhrSuccessStatus={0:200,1223:204},xhrId=0,xhrCallbacks={};if(window.ActiveXObject){jQuery(window).on("unload",function(){for(var key in xhrCallbacks){xhrCallbacks[key]()}xhrCallbacks=undefined})}jQuery.support.cors=!!xhrSupported&&("withCredentials" in xhrSupported);jQuery.support.ajax=xhrSupported=!!xhrSupported;jQuery.ajaxTransport(function(options){var callback;if(jQuery.support.cors||xhrSupported&&!options.crossDomain){return{send:function(headers,complete){var i,id,xhr=options.xhr();xhr.open(options.type,options.url,options.async,options.username,options.password);if(options.xhrFields){for(i in options.xhrFields){xhr[i]=options.xhrFields[i]}}if(options.mimeType&&xhr.overrideMimeType){xhr.overrideMimeType(options.mimeType)}if(!options.crossDomain&&!headers["X-Requested-With"]){headers["X-Requested-With"]="XMLHttpRequest"}for(i in headers){xhr.setRequestHeader(i,headers[i])}callback=function(type){return function(){if(callback){delete xhrCallbacks[id];callback=xhr.onload=xhr.onerror=null;if(type==="abort"){xhr.abort()}else{if(type==="error"){complete(xhr.status||404,xhr.statusText)}else{complete(xhrSuccessStatus[xhr.status]||xhr.status,xhr.statusText,typeof xhr.responseText==="string"?{text:xhr.responseText}:undefined,xhr.getAllResponseHeaders())}}}}};xhr.onload=callback();xhr.onerror=callback("error");callback=xhrCallbacks[(id=xhrId++)]=callback("abort");xhr.send(options.hasContent&&options.data||null)},abort:function(){if(callback){callback()}}}}});var fxNow,timerId,rfxtypes=/^(?:toggle|show|hide)$/,rfxnum=new RegExp("^(?:([+-])=|)("+core_pnum+")([a-z%]*)$","i"),rrun=/queueHooks$/,animationPrefilters=[defaultPrefilter],tweeners={"*":[function(prop,value){var tween=this.createTween(prop,value),target=tween.cur(),parts=rfxnum.exec(value),unit=parts&&parts[3]||(jQuery.cssNumber[prop]?"":"px"),start=(jQuery.cssNumber[prop]||unit!=="px"&&+target)&&rfxnum.exec(jQuery.css(tween.elem,prop)),scale=1,maxIterations=20;if(start&&start[3]!==unit){unit=unit||start[3];parts=parts||[];start=+target||1;do{scale=scale||".5";start=start/scale;jQuery.style(tween.elem,prop,start+unit)}while(scale!==(scale=tween.cur()/target)&&scale!==1&&--maxIterations)}if(parts){start=tween.start=+start||+target||0;tween.unit=unit;tween.end=parts[1]?start+(parts[1]+1)*parts[2]:+parts[2]}return tween}]};function createFxNow(){setTimeout(function(){fxNow=undefined});return(fxNow=jQuery.now())}function createTween(value,prop,animation){var tween,collection=(tweeners[prop]||[]).concat(tweeners["*"]),index=0,length=collection.length;for(;index<length;index++){if((tween=collection[index].call(animation,prop,value))){return tween}}}function Animation(elem,properties,options){var result,stopped,index=0,length=animationPrefilters.length,deferred=jQuery.Deferred().always(function(){delete tick.elem}),tick=function(){if(stopped){return false}var currentTime=fxNow||createFxNow(),remaining=Math.max(0,animation.startTime+animation.duration-currentTime),temp=remaining/animation.duration||0,percent=1-temp,index=0,length=animation.tweens.length;for(;index<length;index++){animation.tweens[index].run(percent)}deferred.notifyWith(elem,[animation,percent,remaining]);if(percent<1&&length){return remaining}else{deferred.resolveWith(elem,[animation]);return false}},animation=deferred.promise({elem:elem,props:jQuery.extend({},properties),opts:jQuery.extend(true,{specialEasing:{}},options),originalProperties:properties,originalOptions:options,startTime:fxNow||createFxNow(),duration:options.duration,tweens:[],createTween:function(prop,end){var tween=jQuery.Tween(elem,animation.opts,prop,end,animation.opts.specialEasing[prop]||animation.opts.easing);animation.tweens.push(tween);return tween},stop:function(gotoEnd){var index=0,length=gotoEnd?animation.tweens.length:0;if(stopped){return this}stopped=true;for(;index<length;index++){animation.tweens[index].run(1)}if(gotoEnd){deferred.resolveWith(elem,[animation,gotoEnd])}else{deferred.rejectWith(elem,[animation,gotoEnd])}return this}}),props=animation.props;propFilter(props,animation.opts.specialEasing);for(;index<length;index++){result=animationPrefilters[index].call(animation,elem,props,animation.opts);if(result){return result}}jQuery.map(props,createTween,animation);if(jQuery.isFunction(animation.opts.start)){animation.opts.start.call(elem,animation)}jQuery.fx.timer(jQuery.extend(tick,{elem:elem,anim:animation,queue:animation.opts.queue}));return animation.progress(animation.opts.progress).done(animation.opts.done,animation.opts.complete).fail(animation.opts.fail).always(animation.opts.always)}function propFilter(props,specialEasing){var index,name,easing,value,hooks;for(index in props){name=jQuery.camelCase(index);easing=specialEasing[name];value=props[index];if(jQuery.isArray(value)){easing=value[1];value=props[index]=value[0]}if(index!==name){props[name]=value;delete props[index]}hooks=jQuery.cssHooks[name];if(hooks&&"expand" in hooks){value=hooks.expand(value);delete props[name];for(index in value){if(!(index in props)){props[index]=value[index];specialEasing[index]=easing}}}else{specialEasing[name]=easing}}}jQuery.Animation=jQuery.extend(Animation,{tweener:function(props,callback){if(jQuery.isFunction(props)){callback=props;props=["*"]}else{props=props.split(" ")}var prop,index=0,length=props.length;for(;index<length;index++){prop=props[index];tweeners[prop]=tweeners[prop]||[];tweeners[prop].unshift(callback)}},prefilter:function(callback,prepend){if(prepend){animationPrefilters.unshift(callback)}else{animationPrefilters.push(callback)}}});function defaultPrefilter(elem,props,opts){var prop,value,toggle,tween,hooks,oldfire,anim=this,orig={},style=elem.style,hidden=elem.nodeType&&isHidden(elem),dataShow=data_priv.get(elem,"fxshow");if(!opts.queue){hooks=jQuery._queueHooks(elem,"fx");if(hooks.unqueued==null){hooks.unqueued=0;oldfire=hooks.empty.fire;hooks.empty.fire=function(){if(!hooks.unqueued){oldfire()}}}hooks.unqueued++;anim.always(function(){anim.always(function(){hooks.unqueued--;if(!jQuery.queue(elem,"fx").length){hooks.empty.fire()}})})}if(elem.nodeType===1&&("height" in props||"width" in props)){opts.overflow=[style.overflow,style.overflowX,style.overflowY];if(jQuery.css(elem,"display")==="inline"&&jQuery.css(elem,"float")==="none"){style.display="inline-block"}}if(opts.overflow){style.overflow="hidden";anim.always(function(){style.overflow=opts.overflow[0];style.overflowX=opts.overflow[1];style.overflowY=opts.overflow[2]})}for(prop in props){value=props[prop];if(rfxtypes.exec(value)){delete props[prop];toggle=toggle||value==="toggle";if(value===(hidden?"hide":"show")){if(value==="show"&&dataShow&&dataShow[prop]!==undefined){hidden=true}else{continue}}orig[prop]=dataShow&&dataShow[prop]||jQuery.style(elem,prop)}}if(!jQuery.isEmptyObject(orig)){if(dataShow){if("hidden" in dataShow){hidden=dataShow.hidden}}else{dataShow=data_priv.access(elem,"fxshow",{})}if(toggle){dataShow.hidden=!hidden}if(hidden){jQuery(elem).show()}else{anim.done(function(){jQuery(elem).hide()})}anim.done(function(){var prop;data_priv.remove(elem,"fxshow");for(prop in orig){jQuery.style(elem,prop,orig[prop])}});for(prop in orig){tween=createTween(hidden?dataShow[prop]:0,prop,anim);if(!(prop in dataShow)){dataShow[prop]=tween.start;if(hidden){tween.end=tween.start;tween.start=prop==="width"||prop==="height"?1:0}}}}}function Tween(elem,options,prop,end,easing){return new Tween.prototype.init(elem,options,prop,end,easing)}jQuery.Tween=Tween;Tween.prototype={constructor:Tween,init:function(elem,options,prop,end,easing,unit){this.elem=elem;this.prop=prop;this.easing=easing||"swing";this.options=options;this.start=this.now=this.cur();this.end=end;this.unit=unit||(jQuery.cssNumber[prop]?"":"px")},cur:function(){var hooks=Tween.propHooks[this.prop];return hooks&&hooks.get?hooks.get(this):Tween.propHooks._default.get(this)},run:function(percent){var eased,hooks=Tween.propHooks[this.prop];if(this.options.duration){this.pos=eased=jQuery.easing[this.easing](percent,this.options.duration*percent,0,1,this.options.duration)}else{this.pos=eased=percent}this.now=(this.end-this.start)*eased+this.start;if(this.options.step){this.options.step.call(this.elem,this.now,this)}if(hooks&&hooks.set){hooks.set(this)}else{Tween.propHooks._default.set(this)}return this}};Tween.prototype.init.prototype=Tween.prototype;Tween.propHooks={_default:{get:function(tween){var result;if(tween.elem[tween.prop]!=null&&(!tween.elem.style||tween.elem.style[tween.prop]==null)){return tween.elem[tween.prop]}result=jQuery.css(tween.elem,tween.prop,"");return !result||result==="auto"?0:result},set:function(tween){if(jQuery.fx.step[tween.prop]){jQuery.fx.step[tween.prop](tween)}else{if(tween.elem.style&&(tween.elem.style[jQuery.cssProps[tween.prop]]!=null||jQuery.cssHooks[tween.prop])){jQuery.style(tween.elem,tween.prop,tween.now+tween.unit)}else{tween.elem[tween.prop]=tween.now}}}}};Tween.propHooks.scrollTop=Tween.propHooks.scrollLeft={set:function(tween){if(tween.elem.nodeType&&tween.elem.parentNode){tween.elem[tween.prop]=tween.now}}};jQuery.each(["toggle","show","hide"],function(i,name){var cssFn=jQuery.fn[name];jQuery.fn[name]=function(speed,easing,callback){return speed==null||typeof speed==="boolean"?cssFn.apply(this,arguments):this.animate(genFx(name,true),speed,easing,callback)}});jQuery.fn.extend({fadeTo:function(speed,to,easing,callback){return this.filter(isHidden).css("opacity",0).show().end().animate({opacity:to},speed,easing,callback)},animate:function(prop,speed,easing,callback){var empty=jQuery.isEmptyObject(prop),optall=jQuery.speed(speed,easing,callback),doAnimation=function(){var anim=Animation(this,jQuery.extend({},prop),optall);if(empty||data_priv.get(this,"finish")){anim.stop(true)}};doAnimation.finish=doAnimation;return empty||optall.queue===false?this.each(doAnimation):this.queue(optall.queue,doAnimation)},stop:function(type,clearQueue,gotoEnd){var stopQueue=function(hooks){var stop=hooks.stop;delete hooks.stop;stop(gotoEnd)};if(typeof type!=="string"){gotoEnd=clearQueue;clearQueue=type;type=undefined}if(clearQueue&&type!==false){this.queue(type||"fx",[])}return this.each(function(){var dequeue=true,index=type!=null&&type+"queueHooks",timers=jQuery.timers,data=data_priv.get(this);if(index){if(data[index]&&data[index].stop){stopQueue(data[index])}}else{for(index in data){if(data[index]&&data[index].stop&&rrun.test(index)){stopQueue(data[index])}}}for(index=timers.length;index--;){if(timers[index].elem===this&&(type==null||timers[index].queue===type)){timers[index].anim.stop(gotoEnd);dequeue=false;timers.splice(index,1)}}if(dequeue||!gotoEnd){jQuery.dequeue(this,type)}})},finish:function(type){if(type!==false){type=type||"fx"}return this.each(function(){var index,data=data_priv.get(this),queue=data[type+"queue"],hooks=data[type+"queueHooks"],timers=jQuery.timers,length=queue?queue.length:0;data.finish=true;jQuery.queue(this,type,[]);if(hooks&&hooks.stop){hooks.stop.call(this,true)}for(index=timers.length;index--;){if(timers[index].elem===this&&timers[index].queue===type){timers[index].anim.stop(true);timers.splice(index,1)}}for(index=0;index<length;index++){if(queue[index]&&queue[index].finish){queue[index].finish.call(this)}}delete data.finish})}});function genFx(type,includeWidth){var which,attrs={height:type},i=0;includeWidth=includeWidth?1:0;for(;i<4;i+=2-includeWidth){which=cssExpand[i];attrs["margin"+which]=attrs["padding"+which]=type}if(includeWidth){attrs.opacity=attrs.width=type}return attrs}jQuery.each({slideDown:genFx("show"),slideUp:genFx("hide"),slideToggle:genFx("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(name,props){jQuery.fn[name]=function(speed,easing,callback){return this.animate(props,speed,easing,callback)}});jQuery.speed=function(speed,easing,fn){var opt=speed&&typeof speed==="object"?jQuery.extend({},speed):{complete:fn||!fn&&easing||jQuery.isFunction(speed)&&speed,duration:speed,easing:fn&&easing||easing&&!jQuery.isFunction(easing)&&easing};opt.duration=jQuery.fx.off?0:typeof opt.duration==="number"?opt.duration:opt.duration in jQuery.fx.speeds?jQuery.fx.speeds[opt.duration]:jQuery.fx.speeds._default;if(opt.queue==null||opt.queue===true){opt.queue="fx"}opt.old=opt.complete;opt.complete=function(){if(jQuery.isFunction(opt.old)){opt.old.call(this)}if(opt.queue){jQuery.dequeue(this,opt.queue)}};return opt};jQuery.easing={linear:function(p){return p},swing:function(p){return 0.5-Math.cos(p*Math.PI)/2}};jQuery.timers=[];jQuery.fx=Tween.prototype.init;jQuery.fx.tick=function(){var timer,timers=jQuery.timers,i=0;fxNow=jQuery.now();for(;i<timers.length;i++){timer=timers[i];if(!timer()&&timers[i]===timer){timers.splice(i--,1)}}if(!timers.length){jQuery.fx.stop()}fxNow=undefined};jQuery.fx.timer=function(timer){if(timer()&&jQuery.timers.push(timer)){jQuery.fx.start()}};jQuery.fx.interval=13;jQuery.fx.start=function(){if(!timerId){timerId=setInterval(jQuery.fx.tick,jQuery.fx.interval)}};jQuery.fx.stop=function(){clearInterval(timerId);timerId=null};jQuery.fx.speeds={slow:600,fast:200,_default:400};jQuery.fx.step={};if(jQuery.expr&&jQuery.expr.filters){jQuery.expr.filters.animated=function(elem){return jQuery.grep(jQuery.timers,function(fn){return elem===fn.elem}).length}}jQuery.fn.offset=function(options){if(arguments.length){return options===undefined?this:this.each(function(i){jQuery.offset.setOffset(this,options,i)})}var docElem,win,elem=this[0],box={top:0,left:0},doc=elem&&elem.ownerDocument;if(!doc){return}docElem=doc.documentElement;if(!jQuery.contains(docElem,elem)){return box}if(typeof elem.getBoundingClientRect!==core_strundefined){box=elem.getBoundingClientRect()}win=getWindow(doc);return{top:box.top+win.pageYOffset-docElem.clientTop,left:box.left+win.pageXOffset-docElem.clientLeft}};jQuery.offset={setOffset:function(elem,options,i){var curPosition,curLeft,curCSSTop,curTop,curOffset,curCSSLeft,calculatePosition,position=jQuery.css(elem,"position"),curElem=jQuery(elem),props={};if(position==="static"){elem.style.position="relative"}curOffset=curElem.offset();curCSSTop=jQuery.css(elem,"top");curCSSLeft=jQuery.css(elem,"left");calculatePosition=(position==="absolute"||position==="fixed")&&(curCSSTop+curCSSLeft).indexOf("auto")>-1;if(calculatePosition){curPosition=curElem.position();curTop=curPosition.top;curLeft=curPosition.left}else{curTop=parseFloat(curCSSTop)||0;curLeft=parseFloat(curCSSLeft)||0}if(jQuery.isFunction(options)){options=options.call(elem,i,curOffset)}if(options.top!=null){props.top=(options.top-curOffset.top)+curTop}if(options.left!=null){props.left=(options.left-curOffset.left)+curLeft}if("using" in options){options.using.call(elem,props)}else{curElem.css(props)}}};jQuery.fn.extend({position:function(){if(!this[0]){return}var offsetParent,offset,elem=this[0],parentOffset={top:0,left:0};if(jQuery.css(elem,"position")==="fixed"){offset=elem.getBoundingClientRect()}else{offsetParent=this.offsetParent();offset=this.offset();if(!jQuery.nodeName(offsetParent[0],"html")){parentOffset=offsetParent.offset()}parentOffset.top+=jQuery.css(offsetParent[0],"borderTopWidth",true);parentOffset.left+=jQuery.css(offsetParent[0],"borderLeftWidth",true)}return{top:offset.top-parentOffset.top-jQuery.css(elem,"marginTop",true),left:offset.left-parentOffset.left-jQuery.css(elem,"marginLeft",true)}},offsetParent:function(){return this.map(function(){var offsetParent=this.offsetParent||docElem;while(offsetParent&&(!jQuery.nodeName(offsetParent,"html")&&jQuery.css(offsetParent,"position")==="static")){offsetParent=offsetParent.offsetParent}return offsetParent||docElem})}});jQuery.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(method,prop){var top="pageYOffset"===prop;jQuery.fn[method]=function(val){return jQuery.access(this,function(elem,method,val){var win=getWindow(elem);if(val===undefined){return win?win[prop]:elem[method]}if(win){win.scrollTo(!top?val:window.pageXOffset,top?val:window.pageYOffset)}else{elem[method]=val}},method,val,arguments.length,null)}});function getWindow(elem){return jQuery.isWindow(elem)?elem:elem.nodeType===9&&elem.defaultView}jQuery.each({Height:"height",Width:"width"},function(name,type){jQuery.each({padding:"inner"+name,content:type,"":"outer"+name},function(defaultExtra,funcName){jQuery.fn[funcName]=function(margin,value){var chainable=arguments.length&&(defaultExtra||typeof margin!=="boolean"),extra=defaultExtra||(margin===true||value===true?"margin":"border");return jQuery.access(this,function(elem,type,value){var doc;if(jQuery.isWindow(elem)){return elem.document.documentElement["client"+name]}if(elem.nodeType===9){doc=elem.documentElement;return Math.max(elem.body["scroll"+name],doc["scroll"+name],elem.body["offset"+name],doc["offset"+name],doc["client"+name])}return value===undefined?jQuery.css(elem,type,extra):jQuery.style(elem,type,value,extra)},type,chainable?margin:undefined,chainable,null)}})});jQuery.fn.size=function(){return this.length};jQuery.fn.andSelf=jQuery.fn.addBack;if(typeof module==="object"&&module&&typeof module.exports==="object"){module.exports=jQuery}else{if(typeof define==="function"&&define.amd){define("jquery",[],function(){return jQuery})}}if(typeof window==="object"&&typeof window.document==="object"){window.jQuery=window.$=jQuery}})(window);var PAPAYA_VIEWER_ID="papayaViewer",PAPAYA_DISPLAY_ID="papayaDisplay",PAPAYA_TOOLBAR_ID="papayaToolbar",PAPAYA_CONTAINER_ID="papayaContainer",PAPAYA_SPACING=3,PAPAYA_SECTION_HEIGHT=50,PAPAYA_CONTAINER_PADDING_TOP=20,PAPAYA_MINIMUM_SIZE=500;var Base64Binary={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",decodeArrayBuffer:function(b){var d=this._keyStr.indexOf(b.charAt(b.length-1));var c=this._keyStr.indexOf(b.charAt(b.length-2));var a=(b.length/4)*3;if(d==64){a--}if(c==64){a--}var e=new ArrayBuffer(a);this.decode(b,e,a);return e},decode:function(e,d,o){var c;var n,l,h;var m,k,g,f;var b=0;var a=0;if(d){c=new Uint8Array(d)}else{c=new Uint8Array(o)}e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(b=0;b<o;b+=3){m=this._keyStr.indexOf(e.charAt(a++));k=this._keyStr.indexOf(e.charAt(a++));g=this._keyStr.indexOf(e.charAt(a++));f=this._keyStr.indexOf(e.charAt(a++));n=(m<<2)|(k>>4);l=((k&15)<<4)|(g>>2);h=((g&3)<<6)|f;c[b]=n;if(g!=64){c[b+1]=l}if(f!=64){c[b+2]=h}}return c}};var BrowserDetect={init:function(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser";this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version";this.OS=this.searchString(this.dataOS)||"an unknown OS"},searchString:function(d){for(var a=0;a<d.length;a++){var b=d[a].string;var c=d[a].prop;this.versionSearchString=d[a].versionSearch||d[a].identity;if(b){if(b.indexOf(d[a].subString)!=-1){return d[a].identity}}else{if(c){return d[a].identity}}}},searchVersion:function(b){var a=b.indexOf(this.versionSearchString);if(a==-1){return}return parseFloat(b.substring(a+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera",versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};BrowserDetect.init();var GUNZIP_MAGIC_COOKIE1=31;var GUNZIP_MAGIC_COOKIE2=139;var Gunzip=function(){var X="GZIP flag not supported!";var n="Not a GZIP file!";var k=10;var i=8;var h=1000*1024;var L=null;var H=null;var J=null;var D=null;var I=0;var ad=0;var ab=0;var Z=0;var U=0;var Q=null;var r=32768;var A=0;var S=1;var m=2;var ai=9;var j=6;var x=32768;var a=64;var K;var o;var ag=null;var b;var aa,M;var w;var v;var ak;var ac;var aj;var C;var q,s;var f,l;var G;var O;var af=new Array(0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535);var c=new Array(3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0);var Y=new Array(0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99);var V=new Array(1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577);var E=new Array(0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13);var u=new Array(16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15);var B=function(){this.next=null;this.list=null};var R=function(){this.e=0;this.b=0;this.n=0;this.t=null};var p=function(aO,aD,ay,aM,aL,aI){this.BMAX=16;this.N_MAX=288;this.status=0;this.root=null;this.m=0;var aP;var aN=new Array(this.BMAX+1);var al;var aK;var aJ;var aH;var aG;var aF;var aE;var am=new Array(this.BMAX+1);var aB;var an;var aA;var az=new R();var ax=new Array(this.BMAX);var aw=new Array(this.N_MAX);var av;var ar=new Array(this.BMAX+1);var au;var aq;var ap;var aC;var ao;ao=this.root=null;for(aG=0;aG<aN.length;aG++){aN[aG]=0}for(aG=0;aG<am.length;aG++){am[aG]=0}for(aG=0;aG<ax.length;aG++){ax[aG]=null}for(aG=0;aG<aw.length;aG++){aw[aG]=0}for(aG=0;aG<ar.length;aG++){ar[aG]=0}al=aD>256?aO[256]:this.BMAX;aB=aO;an=0;aG=aD;do{aN[aB[an]]++;an++}while(--aG>0);if(aN[0]==aD){this.root=null;this.m=0;this.status=0;return}for(aF=1;aF<=this.BMAX;aF++){if(aN[aF]!=0){break}}aE=aF;if(aI<aF){aI=aF}for(aG=this.BMAX;aG!=0;aG--){if(aN[aG]!=0){break}}aJ=aG;if(aI>aG){aI=aG}for(aq=1<<aF;aF<aG;aF++,aq<<=1){if((aq-=aN[aF])<0){this.status=2;this.m=aI;return}}if((aq-=aN[aG])<0){this.status=2;this.m=aI;return}aN[aG]+=aq;ar[1]=aF=0;aB=aN;an=1;au=2;while(--aG>0){ar[au++]=(aF+=aB[an++])}aB=aO;an=0;aG=0;do{if((aF=aB[an++])!=0){aw[ar[aF]++]=aG}}while(++aG<aD);aD=ar[aJ];ar[0]=aG=0;aB=aw;an=0;aH=-1;av=am[0]=0;aA=null;ap=0;for(;aE<=aJ;aE++){aP=aN[aE];while(aP-->0){while(aE>av+am[1+aH]){av+=am[1+aH];aH++;ap=(ap=aJ-av)>aI?aI:ap;if((aK=1<<(aF=aE-av))>aP+1){aK-=aP+1;au=aE;while(++aF<ap){if((aK<<=1)<=aN[++au]){break}aK-=aN[au]}}if(av+aF>al&&av<al){aF=al-av}ap=1<<aF;am[1+aH]=aF;aA=new Array(ap);for(aC=0;aC<ap;aC++){aA[aC]=new R()}if(ao==null){ao=this.root=new B()}else{ao=ao.next=new B()}ao.next=null;ao.list=aA;ax[aH]=aA;if(aH>0){ar[aH]=aG;az.b=am[aH];az.e=16+aF;az.t=aA;aF=(aG&((1<<av)-1))>>(av-am[aH]);ax[aH-1][aF].e=az.e;ax[aH-1][aF].b=az.b;ax[aH-1][aF].n=az.n;ax[aH-1][aF].t=az.t}}az.b=aE-av;if(an>=aD){az.e=99}else{if(aB[an]<ay){az.e=(aB[an]<256?16:15);az.n=aB[an++]}else{az.e=aL[aB[an]-ay];az.n=aM[aB[an++]-ay]}}aK=1<<(aE-av);for(aF=aG>>av;aF<ap;aF+=aK){aA[aF].e=az.e;aA[aF].b=az.b;aA[aF].n=az.n;aA[aF].t=az.t}for(aF=1<<(aE-1);(aG&aF)!=0;aF>>=1){aG^=aF}aG^=aF;while((aG&((1<<av)-1))!=ar[aH]){av-=am[aH];aH--}}}this.m=am[1];this.status=((aq!=0&&aJ!=1)?1:0)};var e=function(){if(ad==O){return -1}return G.getUint8(O++)&255};var ah=function(al){while(v<al){w|=e()<<v;v+=8}};var y=function(al){return w&af[al]};var d=function(al){w>>=al;v-=al};var g=function(aq,ao,am){var an;var al;var ap;if(am==0){return 0}ap=0;for(;;){ah(f);al=q.list[y(f)];an=al.e;while(an>16){if(an==99){return -1}d(al.b);an-=16;ah(an);al=al.t[y(an)];an=al.e}d(al.b);if(an==16){o&=r-1;aq[ao+ap++]=K[o++]=al.n;if(ap==am){return am}continue}if(an==15){break}ah(an);aj=al.n+y(an);d(an);ah(l);al=s.list[y(l)];an=al.e;while(an>16){if(an==99){return -1}d(al.b);an-=16;ah(an);al=al.t[y(an)];an=al.e}d(al.b);ah(an);C=o-al.n-y(an);d(an);while(aj>0&&ap<am){aj--;C&=r-1;o&=r-1;aq[ao+ap++]=K[o++]=K[C++]}if(ap==am){return am}}ak=-1;return ap};var z=function(ao,am,al){var an;an=v&7;d(an);ah(16);an=y(16);d(16);ah(16);if(an!=((~w)&65535)){return -1}d(16);aj=an;an=0;while(aj>0&&an<al){aj--;o&=r-1;ah(8);ao[am+an++]=K[o++]=y(8);d(8)}if(aj==0){ak=-1}return an};var W=function(aq,ap,an){if(ag==null){var am;var al=new Array(288);var ao;for(am=0;am<144;am++){al[am]=8}for(;am<256;am++){al[am]=9}for(;am<280;am++){al[am]=7}for(;am<288;am++){al[am]=8}aa=7;ao=new p(al,288,257,c,Y,aa);if(ao.status!=0){alert("HufBuild error: "+ao.status);return -1}ag=ao.root;aa=ao.m;for(am=0;am<30;am++){al[am]=5}zip_fixed_bd=5;ao=new p(al,30,0,V,E,zip_fixed_bd);if(ao.status>1){ag=null;alert("HufBuild error: "+ao.status);return -1}b=ao.root;zip_fixed_bd=ao.m}q=ag;s=b;f=aa;l=zip_fixed_bd;return g(aq,ap,an)};var F=function(ax,an,az){var ar;var aq;var ao;var am;var ay;var av;var al;var ap;var aw=new Array(286+30);var au;for(ar=0;ar<aw.length;ar++){aw[ar]=0}ah(5);al=257+y(5);d(5);ah(5);ap=1+y(5);d(5);ah(4);av=4+y(4);d(4);if(al>286||ap>30){return -1}for(aq=0;aq<av;aq++){ah(3);aw[u[aq]]=y(3);d(3)}for(;aq<19;aq++){aw[u[aq]]=0}f=7;au=new p(aw,19,19,null,null,f);if(au.status!=0){return -1}q=au.root;f=au.m;am=al+ap;ar=ao=0;while(ar<am){ah(f);ay=q.list[y(f)];aq=ay.b;d(aq);aq=ay.n;if(aq<16){aw[ar++]=ao=aq}else{if(aq==16){ah(2);aq=3+y(2);d(2);if(ar+aq>am){return -1}while(aq-->0){aw[ar++]=ao}}else{if(aq==17){ah(3);aq=3+y(3);d(3);if(ar+aq>am){return -1}while(aq-->0){aw[ar++]=0}ao=0}else{ah(7);aq=11+y(7);d(7);if(ar+aq>am){return -1}while(aq-->0){aw[ar++]=0}ao=0}}}}f=ai;au=new p(aw,al,257,c,Y,f);if(f==0){au.status=1}if(au.status!=0){if(au.status==1){}return -1}q=au.root;f=au.m;for(ar=0;ar<ap;ar++){aw[ar]=aw[ar+al]}l=j;au=new p(aw,ap,0,V,E,l);s=au.root;l=au.m;if(l==0&&al>257){return -1}if(au.status==1){}if(au.status!=0){return -1}return g(ax,an,az)};var ae=function(){var al;if(K==null){K=new Array(2*r)}o=0;w=0;v=0;ak=-1;ac=false;aj=C=0;q=null};var P=function(ap,an,am){var ao,al;ao=0;while(ao<am){if(ac&&ak==-1){return ao}if(aj>0){if(ak!=A){while(aj>0&&ao<am){aj--;C&=r-1;o&=r-1;ap[an+ao++]=K[o++]=K[C++]}}else{while(aj>0&&ao<am){aj--;o&=r-1;ah(8);ap[an+ao++]=K[o++]=y(8);d(8)}if(aj==0){ak=-1}}if(ao==am){return ao}}if(ak==-1){if(ac){break}ah(1);if(y(1)!=0){ac=true}d(1);ah(2);ak=y(2);d(2);q=null;aj=0}switch(ak){case 0:al=z(ap,an+ao,am-ao);break;case 1:if(q!=null){al=g(ap,an+ao,am-ao)}else{al=W(ap,an+ao,am-ao)}break;case 2:if(q!=null){al=g(ap,an+ao,am-ao)}else{al=F(ap,an+ao,am-ao)}break;default:al=-1;break}if(al==-1){if(ac){return 0}return -1}ao+=al}return ao};var N=function(){var an,am,ap=0;var ao=false;var aq=new Array(1024);while((an=P(aq,0,aq.length))>0){var al=new Array(an);for(am=0;am<an;am++){Q.setUint8(U+am,aq[am])}U+=an;ap+=an;if(papayaMain){if(papayaMain.papayaDisplay){papayaMain.papayaDisplay.drawProgress(U/I)}}if(ap>h){ao=true;break}}if(ao){setTimeout(N,0)}else{G=null;J=null;H(D)}};this.gunzip=function(ar,au){H=au;ad=ar.byteLength;J=new DataView(ar);var aq=J.getUint8(0);var ap=J.getUint8(1);if(aq!=GUNZIP_MAGIC_COOKIE1){L=n;return null}else{if(ap!=GUNZIP_MAGIC_COOKIE2){L=n;return null}}var an=J.getUint8(3);var ax=((an&1)!=0);var av=((an&2)!=0);var ao=((an&4)!=0);var aw=((an&8)!=0);var al=((an&16)!=0);if(ax||av||ao||al){L=X;return null}ab=k;if(aw){for(var am=ab;am<ad;am++){if(J.getUint8(am)==0){ab=am+1;break}}}Z=ad-ab-i;I=J.getUint32(ad-4,true);J=new DataView(ar,ab,Z);D=new ArrayBuffer(I);Q=new DataView(D);ae();G=J;O=0;N()};this.hasError=function(){return(L!=null)};this.getError=function(){return L}};"use strict";var numeric=(typeof exports==="undefined")?(function numeric(){}):(exports);if(typeof global!=="undefined"){global.numeric=numeric}numeric.version="1.2.6";numeric.bench=function bench(e,a){var d,c,g,b;if(typeof a==="undefined"){a=15}g=0.5;d=new Date();while(1){g*=2;for(b=g;b>3;b-=4){e();e();e();e()}while(b>0){e();b--}c=new Date();if(c-d>a){break}}for(b=g;b>3;b-=4){e();e();e();e()}while(b>0){e();b--}c=new Date();return 1000*(3*g-1)/(c-d)};numeric._myIndexOf=(function _myIndexOf(a){var c=this.length,b;for(b=0;b<c;++b){if(this[b]===a){return b}}return -1});numeric.myIndexOf=(Array.prototype.indexOf)?Array.prototype.indexOf:numeric._myIndexOf;numeric.Function=Function;numeric.precision=4;numeric.largeArray=50;numeric.prettyPrint=function prettyPrint(b){function a(e){if(e===0){return"0"}if(isNaN(e)){return"NaN"}if(e<0){return"-"+a(-e)}if(isFinite(e)){var h=Math.floor(Math.log(e)/Math.log(10));var g=e/Math.pow(10,h);var f=g.toPrecision(numeric.precision);if(parseFloat(f)===10){h++;g=1;f=g.toPrecision(numeric.precision)}return parseFloat(f).toString()+"e"+h.toString()}return"Infinity"}var c=[];function d(f){var i;if(typeof f==="undefined"){c.push(Array(numeric.precision+8).join(" "));return false}if(typeof f==="string"){c.push('"'+f+'"');return false}if(typeof f==="boolean"){c.push(f.toString());return false}if(typeof f==="number"){var h=a(f);var e=f.toPrecision(numeric.precision);var l=parseFloat(f.toString()).toString();var j=[h,e,l,parseFloat(e).toString(),parseFloat(l).toString()];for(i=1;i<j.length;i++){if(j[i].length<h.length){h=j[i]}}c.push(Array(numeric.precision+8-h.length).join(" ")+h);return false}if(f===null){c.push("null");return false}if(typeof f==="function"){c.push(f.toString());var g=false;for(i in f){if(f.hasOwnProperty(i)){if(g){c.push(",\n")}else{c.push("\n{")}g=true;c.push(i);c.push(": \n");d(f[i])}}if(g){c.push("}\n")}return true}if(f instanceof Array){if(f.length>numeric.largeArray){c.push("...Large Array...");return true}var g=false;c.push("[");for(i=0;i<f.length;i++){if(i>0){c.push(",");if(g){c.push("\n ")}}g=d(f[i])}c.push("]");return true}c.push("{");var g=false;for(i in f){if(f.hasOwnProperty(i)){if(g){c.push(",\n")}g=true;c.push(i);c.push(": \n");d(f[i])}}c.push("}");return true}d(b);return c.join("")};numeric.parseDate=function parseDate(a){function b(f){if(typeof f==="string"){return Date.parse(f.replace(/-/g,"/"))}if(!(f instanceof Array)){throw new Error("parseDate: parameter must be arrays of strings")}var e=[],c;for(c=0;c<f.length;c++){e[c]=b(f[c])}return e}return b(a)};numeric.parseFloat=function parseFloat_(a){function b(f){if(typeof f==="string"){return parseFloat(f)}if(!(f instanceof Array)){throw new Error("parseFloat: parameter must be arrays of strings")}var e=[],c;for(c=0;c<f.length;c++){e[c]=b(f[c])}return e}return b(a)};numeric.parseCSV=function parseCSV(m){var l=m.split("\n");var e,d;var i=[];var g=/(([^'",]*)|('[^']*')|("[^"]*")),/g;var b=/^\s*(([+-]?[0-9]+(\.[0-9]*)?(e[+-]?[0-9]+)?)|([+-]?[0-9]*(\.[0-9]+)?(e[+-]?[0-9]+)?))\s*$/;var a=function(j){return j.substr(0,j.length-1)};var f=0;for(d=0;d<l.length;d++){var h=(l[d]+",").match(g),c;if(h.length>0){i[f]=[];for(e=0;e<h.length;e++){c=a(h[e]);if(b.test(c)){i[f][e]=parseFloat(c)}else{i[f][e]=c}}f++}}return i};numeric.toCSV=function toCSV(b){var f=numeric.dim(b);var e,d,a,h,g,c;a=f[0];h=f[1];c=[];for(e=0;e<a;e++){g=[];for(d=0;d<a;d++){g[d]=b[e][d].toString()}c[e]=g.join(", ")}return c.join("\n")+"\n"};numeric.getURL=function getURL(b){var a=new XMLHttpRequest();a.open("GET",b,false);a.send();return a};numeric.imageURL=function imageURL(m){function p(j){var k=j.length,w,E,D,C,h,b,a,G;var F="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var B="";for(w=0;w<k;w+=3){E=j[w];D=j[w+1];C=j[w+2];h=E>>2;b=((E&3)<<4)+(D>>4);a=((D&15)<<2)+(C>>6);G=C&63;if(w+1>=k){a=G=64}else{if(w+2>=k){G=64}}B+=F.charAt(h)+F.charAt(b)+F.charAt(a)+F.charAt(G)}return B}function q(b,B,A){if(typeof B==="undefined"){B=0}if(typeof A==="undefined"){A=b.length}var j=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918000,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];var k=-1,z=0,w=b.length,h;for(h=B;h<A;h++){z=(k^b[h])&255;k=(k>>>8)^j[z]}return k^(-1)}var n=m[0].length,v=m[0][0].length,x,u,o,e,c,s,r,l,f,g,d;var y=[137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,(v>>24)&255,(v>>16)&255,(v>>8)&255,v&255,(n>>24)&255,(n>>16)&255,(n>>8)&255,n&255,8,2,0,0,0,-1,-2,-3,-4,-5,-6,-7,-8,73,68,65,84,8,29];d=q(y,12,29);y[29]=(d>>24)&255;y[30]=(d>>16)&255;y[31]=(d>>8)&255;y[32]=(d)&255;x=1;u=0;for(l=0;l<n;l++){if(l<n-1){y.push(0)}else{y.push(1)}s=(3*v+1+(l===0))&255;r=((3*v+1+(l===0))>>8)&255;y.push(s);y.push(r);y.push((~s)&255);y.push((~r)&255);if(l===0){y.push(0)}for(f=0;f<v;f++){for(e=0;e<3;e++){s=m[e][l][f];if(s>255){s=255}else{if(s<0){s=0}else{s=Math.round(s)}}x=(x+s)%65521;u=(u+x)%65521;y.push(s)}}y.push(0)}g=(u<<16)+x;y.push((g>>24)&255);y.push((g>>16)&255);y.push((g>>8)&255);y.push((g)&255);c=y.length-41;y[33]=(c>>24)&255;y[34]=(c>>16)&255;y[35]=(c>>8)&255;y[36]=(c)&255;d=q(y,37);y.push((d>>24)&255);y.push((d>>16)&255);y.push((d>>8)&255);y.push((d)&255);y.push(0);y.push(0);y.push(0);y.push(0);y.push(73);y.push(69);y.push(78);y.push(68);y.push(174);y.push(66);y.push(96);y.push(130);return"data:image/png;base64,"+p(y)};numeric._dim=function _dim(a){var b=[];while(typeof a==="object"){b.push(a.length);a=a[0]}return b};numeric.dim=function dim(a){var c,b;if(typeof a==="object"){c=a[0];if(typeof c==="object"){b=c[0];if(typeof b==="object"){return numeric._dim(a)}return[a.length,c.length]}return[a.length]}return[]};numeric.mapreduce=function mapreduce(a,b){return Function("x","accum","_s","_k",'if(typeof accum === "undefined") accum = '+b+';\nif(typeof x === "number") { var xi = x; '+a+'; return accum; }\nif(typeof _s === "undefined") _s = numeric.dim(x);\nif(typeof _k === "undefined") _k = 0;\nvar _n = _s[_k];\nvar i,xi;\nif(_k < _s.length-1) {\n    for(i=_n-1;i>=0;i--) {\n        accum = arguments.callee(x[i],accum,_s,_k+1);\n    }    return accum;\n}\nfor(i=_n-1;i>=1;i-=2) { \n    xi = x[i];\n    '+a+";\n    xi = x[i-1];\n    "+a+";\n}\nif(i === 0) {\n    xi = x[i];\n    "+a+"\n}\nreturn accum;")};numeric.mapreduce2=function mapreduce2(b,a){return Function("x","var n = x.length;\nvar i,xi;\n"+a+";\nfor(i=n-1;i!==-1;--i) { \n    xi = x[i];\n    "+b+";\n}\nreturn accum;")};numeric.same=function same(a,d){var b,c;if(!(a instanceof Array)||!(d instanceof Array)){return false}c=a.length;if(c!==d.length){return false}for(b=0;b<c;b++){if(a[b]===d[b]){continue}if(typeof a[b]==="object"){if(!same(a[b],d[b])){return false}}else{return false}}return true};numeric.rep=function rep(e,b,a){if(typeof a==="undefined"){a=0}var f=e[a],c=Array(f),d;if(a===e.length-1){for(d=f-2;d>=0;d-=2){c[d+1]=b;c[d]=b}if(d===-1){c[0]=b}return c}for(d=f-1;d>=0;d--){c[d]=numeric.rep(e,b,a+1)}return c};numeric.dotMMsmall=function dotMMsmall(v,u){var l,g,e,c,b,a,n,s,m,h,f,o,w,d;c=v.length;b=u.length;a=u[0].length;n=Array(c);for(l=c-1;l>=0;l--){s=Array(a);m=v[l];for(e=a-1;e>=0;e--){h=m[b-1]*u[b-1][e];for(g=b-2;g>=1;g-=2){f=g-1;h+=m[g]*u[g][e]+m[f]*u[f][e]}if(g===0){h+=m[0]*u[0][e]}s[e]=h}n[l]=s}return n};numeric._getCol=function _getCol(b,c,a){var e=b.length,d;for(d=e-1;d>0;--d){a[d]=b[d][c];--d;a[d]=b[d][c]}if(d===0){a[0]=b[0][c]}};numeric.dotMMbig=function dotMMbig(r,q){var s=numeric._getCol,a=q.length,u=Array(a);var d=r.length,c=q[0].length,b=new Array(d),l;var f=numeric.dotVV;var h,g,e,o;--a;--d;for(h=d;h!==-1;--h){b[h]=Array(c)}--c;for(h=c;h!==-1;--h){s(q,h,u);for(g=d;g!==-1;--g){o=0;l=r[g];b[g][h]=f(l,u)}}return b};numeric.dotMV=function dotMV(a,g){var e=a.length,d=g.length,c;var b=Array(e),f=numeric.dotVV;for(c=e-1;c>=0;c--){b[c]=f(a[c],g)}return b};numeric.dotVM=function dotVM(h,g){var w,v,u,n,m,l,D,B,A,e,s,f,c,z,d,b,a,o,C;n=h.length;m=g[0].length;D=Array(m);for(u=m-1;u>=0;u--){e=h[n-1]*g[n-1][u];for(v=n-2;v>=1;v-=2){s=v-1;e+=h[v]*g[v][u]+h[s]*g[s][u]}if(v===0){e+=h[0]*g[0][u]}D[u]=e}return D};numeric.dotVV=function dotVV(a,f){var c,e=a.length,d,b=a[e-1]*f[e-1];for(c=e-2;c>=1;c-=2){d=c-1;b+=a[c]*f[c]+a[d]*f[d]}if(c===0){b+=a[0]*f[0]}return b};numeric.dot=function dot(a,c){var b=numeric.dim;switch(b(a).length*1000+b(c).length){case 2002:if(c.length<10){return numeric.dotMMsmall(a,c)}else{return numeric.dotMMbig(a,c)}case 2001:return numeric.dotMV(a,c);case 1002:return numeric.dotVM(a,c);case 1001:return numeric.dotVV(a,c);case 1000:return numeric.mulVS(a,c);case 1:return numeric.mulSV(a,c);case 0:return a*c;default:throw new Error("numeric.dot only works on vectors and matrices")}};numeric.diag=function diag(g){var e,f,c,h=g.length,a=Array(h),b;for(e=h-1;e>=0;e--){b=Array(h);f=e+2;for(c=h-1;c>=f;c-=2){b[c]=0;b[c-1]=0}if(c>e){b[c]=0}b[e]=g[e];for(c=e-1;c>=1;c-=2){b[c]=0;b[c-1]=0}if(c===0){b[0]=0}a[e]=b}return a};numeric.getDiag=function(a){var d=Math.min(a.length,a[0].length),c,b=Array(d);for(c=d-1;c>=1;--c){b[c]=a[c][c];--c;b[c]=a[c][c]}if(c===0){b[0]=a[0][0]}return b};numeric.identity=function identity(a){return numeric.diag(numeric.rep([a],1))};numeric.pointwise=function pointwise(d,g,c){if(typeof c==="undefined"){c=""}var h=[];var e;var i=/\[i\]$/,a,f="";var b=false;for(e=0;e<d.length;e++){if(i.test(d[e])){a=d[e].substring(0,d[e].length-3);f=a}else{a=d[e]}if(a==="ret"){b=true}h.push(a)}h[d.length]="_s";h[d.length+1]="_k";h[d.length+2]=('if(typeof _s === "undefined") _s = numeric.dim('+f+');\nif(typeof _k === "undefined") _k = 0;\nvar _n = _s[_k];\nvar i'+(b?"":", ret = Array(_n)")+";\nif(_k < _s.length-1) {\n    for(i=_n-1;i>=0;i--) ret[i] = arguments.callee("+d.join(",")+",_s,_k+1);\n    return ret;\n}\n"+c+"\nfor(i=_n-1;i!==-1;--i) {\n    "+g+"\n}\nreturn ret;");return Function.apply(null,h)};numeric.pointwise2=function pointwise2(d,g,c){if(typeof c==="undefined"){c=""}var h=[];var e;var i=/\[i\]$/,a,f="";var b=false;for(e=0;e<d.length;e++){if(i.test(d[e])){a=d[e].substring(0,d[e].length-3);f=a}else{a=d[e]}if(a==="ret"){b=true}h.push(a)}h[d.length]=("var _n = "+f+".length;\nvar i"+(b?"":", ret = Array(_n)")+";\n"+c+"\nfor(i=_n-1;i!==-1;--i) {\n"+g+"\n}\nreturn ret;");return Function.apply(null,h)};numeric._biforeach=(function _biforeach(a,h,d,b,e){if(b===d.length-1){e(a,h);return}var c,g=d[b];for(c=g-1;c>=0;c--){_biforeach(typeof a==="object"?a[c]:a,typeof h==="object"?h[c]:h,d,b+1,e)}});numeric._biforeach2=(function _biforeach2(a,j,e,b,g){if(b===e.length-1){return g(a,j)}var d,h=e[b],c=Array(h);for(d=h-1;d>=0;--d){c[d]=_biforeach2(typeof a==="object"?a[d]:a,typeof j==="object"?j[d]:j,e,b+1,g)}return c});numeric._foreach=(function _foreach(a,d,b,e){if(b===d.length-1){e(a);return}var c,g=d[b];for(c=g-1;c>=0;c--){_foreach(a[c],d,b+1,e)}});numeric._foreach2=(function _foreach2(a,e,b,g){if(b===e.length-1){return g(a)}var d,h=e[b],c=Array(h);for(d=h-1;d>=0;d--){c[d]=_foreach2(a[d],e,b+1,g)}return c});numeric.ops2={add:"+",sub:"-",mul:"*",div:"/",mod:"%",and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">=",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"};numeric.opseq={addeq:"+=",subeq:"-=",muleq:"*=",diveq:"/=",modeq:"%=",lshifteq:"<<=",rshifteq:">>=",rrshifteq:">>>=",bandeq:"&=",boreq:"|=",bxoreq:"^="};numeric.mathfuns=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan","isNaN","isFinite"];numeric.mathfuns2=["atan2","pow","max","min"];numeric.ops1={neg:"-",not:"!",bnot:"~",clone:""};numeric.mapreducers={any:["if(xi) return true;","var accum = false;"],all:["if(!xi) return false;","var accum = true;"],sum:["accum += xi;","var accum = 0;"],prod:["accum *= xi;","var accum = 1;"],norm2Squared:["accum += xi*xi;","var accum = 0;"],norminf:["accum = max(accum,abs(xi));","var accum = 0, max = Math.max, abs = Math.abs;"],norm1:["accum += abs(xi)","var accum = 0, abs = Math.abs;"],sup:["accum = max(accum,xi);","var accum = -Infinity, max = Math.max;"],inf:["accum = min(accum,xi);","var accum = Infinity, min = Math.min;"]};(function(){var b,e;for(b=0;b<numeric.mathfuns2.length;++b){e=numeric.mathfuns2[b];numeric.ops2[e]=e}for(b in numeric.ops2){if(numeric.ops2.hasOwnProperty(b)){e=numeric.ops2[b];var c,d,a="";if(numeric.myIndexOf.call(numeric.mathfuns2,b)!==-1){a="var "+e+" = Math."+e+";\n";c=function(g,f,h){return g+" = "+e+"("+f+","+h+")"};d=function(f,g){return f+" = "+e+"("+f+","+g+")"}}else{c=function(g,f,h){return g+" = "+f+" "+e+" "+h};if(numeric.opseq.hasOwnProperty(b+"eq")){d=function(f,g){return f+" "+e+"= "+g}}else{d=function(f,g){return f+" = "+f+" "+e+" "+g}}}numeric[b+"VV"]=numeric.pointwise2(["x[i]","y[i]"],c("ret[i]","x[i]","y[i]"),a);numeric[b+"SV"]=numeric.pointwise2(["x","y[i]"],c("ret[i]","x","y[i]"),a);numeric[b+"VS"]=numeric.pointwise2(["x[i]","y"],c("ret[i]","x[i]","y"),a);numeric[b]=Function("var n = arguments.length, i, x = arguments[0], y;\nvar VV = numeric."+b+"VV, VS = numeric."+b+"VS, SV = numeric."+b+'SV;\nvar dim = numeric.dim;\nfor(i=1;i!==n;++i) { \n  y = arguments[i];\n  if(typeof x === "object") {\n      if(typeof y === "object") x = numeric._biforeach2(x,y,dim(x),0,VV);\n      else x = numeric._biforeach2(x,y,dim(x),0,VS);\n  } else if(typeof y === "object") x = numeric._biforeach2(x,y,dim(y),0,SV);\n  else '+d("x","y")+"\n}\nreturn x;\n");numeric[e]=numeric[b];numeric[b+"eqV"]=numeric.pointwise2(["ret[i]","x[i]"],d("ret[i]","x[i]"),a);numeric[b+"eqS"]=numeric.pointwise2(["ret[i]","x"],d("ret[i]","x"),a);numeric[b+"eq"]=Function("var n = arguments.length, i, x = arguments[0], y;\nvar V = numeric."+b+"eqV, S = numeric."+b+'eqS\nvar s = numeric.dim(x);\nfor(i=1;i!==n;++i) { \n  y = arguments[i];\n  if(typeof y === "object") numeric._biforeach(x,y,s,0,V);\n  else numeric._biforeach(x,y,s,0,S);\n}\nreturn x;\n')}}for(b=0;b<numeric.mathfuns2.length;++b){e=numeric.mathfuns2[b];delete numeric.ops2[e]}for(b=0;b<numeric.mathfuns.length;++b){e=numeric.mathfuns[b];numeric.ops1[e]=e}for(b in numeric.ops1){if(numeric.ops1.hasOwnProperty(b)){a="";e=numeric.ops1[b];if(numeric.myIndexOf.call(numeric.mathfuns,b)!==-1){if(Math.hasOwnProperty(e)){a="var "+e+" = Math."+e+";\n"}}numeric[b+"eqV"]=numeric.pointwise2(["ret[i]"],"ret[i] = "+e+"(ret[i]);",a);numeric[b+"eq"]=Function("x",'if(typeof x !== "object") return '+e+"x\nvar i;\nvar V = numeric."+b+"eqV;\nvar s = numeric.dim(x);\nnumeric._foreach(x,s,0,V);\nreturn x;\n");numeric[b+"V"]=numeric.pointwise2(["x[i]"],"ret[i] = "+e+"(x[i]);",a);numeric[b]=Function("x",'if(typeof x !== "object") return '+e+"(x)\nvar i;\nvar V = numeric."+b+"V;\nvar s = numeric.dim(x);\nreturn numeric._foreach2(x,s,0,V);\n")}}for(b=0;b<numeric.mathfuns.length;++b){e=numeric.mathfuns[b];delete numeric.ops1[e]}for(b in numeric.mapreducers){if(numeric.mapreducers.hasOwnProperty(b)){e=numeric.mapreducers[b];numeric[b+"V"]=numeric.mapreduce2(e[0],e[1]);numeric[b]=Function("x","s","k",e[1]+'if(typeof x !== "object") {    xi = x;\n'+e[0]+';\n    return accum;\n}if(typeof s === "undefined") s = numeric.dim(x);\nif(typeof k === "undefined") k = 0;\nif(k === s.length-1) return numeric.'+b+"V(x);\nvar xi;\nvar n = x.length, i;\nfor(i=n-1;i!==-1;--i) {\n   xi = arguments.callee(x[i]);\n"+e[0]+";\n}\nreturn accum;\n")}}}());numeric.truncVV=numeric.pointwise(["x[i]","y[i]"],"ret[i] = round(x[i]/y[i])*y[i];","var round = Math.round;");numeric.truncVS=numeric.pointwise(["x[i]","y"],"ret[i] = round(x[i]/y)*y;","var round = Math.round;");numeric.truncSV=numeric.pointwise(["x","y[i]"],"ret[i] = round(x/y[i])*y[i];","var round = Math.round;");numeric.trunc=function trunc(a,b){if(typeof a==="object"){if(typeof b==="object"){return numeric.truncVV(a,b)}return numeric.truncVS(a,b)}if(typeof b==="object"){return numeric.truncSV(a,b)}return Math.round(a/b)*b};numeric.inv=function inv(o){var v=numeric.dim(o),w=Math.abs,d=v[0],c=v[1];var b=numeric.clone(o),q,l;var p=numeric.identity(d),a,u;var h,g,e,o;for(g=0;g<c;++g){var f=-1;var r=-1;for(h=g;h!==d;++h){e=w(b[h][g]);if(e>r){f=h;r=e}}l=b[f];b[f]=b[g];b[g]=l;u=p[f];p[f]=p[g];p[g]=u;o=l[g];for(e=g;e!==c;++e){l[e]/=o}for(e=c-1;e!==-1;--e){u[e]/=o}for(h=d-1;h!==-1;--h){if(h!==g){q=b[h];a=p[h];o=q[g];for(e=g+1;e!==c;++e){q[e]-=l[e]*o}for(e=c-1;e>0;--e){a[e]-=u[e]*o;--e;a[e]-=u[e]*o}if(e===0){a[0]-=u[0]*o}}}}return p};numeric.det=function det(p){var u=numeric.dim(p);if(u.length!==2||u[0]!==u[1]){throw new Error("numeric: det() only works on square matrices")}var b=u[0],l=1,f,e,d,a=numeric.clone(p),o,q,c,r,m,h,g;for(e=0;e<b-1;e++){d=e;for(f=e+1;f<b;f++){if(Math.abs(a[f][e])>Math.abs(a[d][e])){d=f}}if(d!==e){r=a[d];a[d]=a[e];a[e]=r;l*=-1}o=a[e];for(f=e+1;f<b;f++){q=a[f];c=q[e]/o[e];for(d=e+1;d<b-1;d+=2){m=d+1;q[d]-=o[d]*c;q[m]-=o[m]*c}if(d!==b){q[d]-=o[d]*c}}if(o[e]===0){return 0}l*=o[e]}return l*a[e][e]};numeric.transpose=function transpose(k){var g,e,c=k.length,a=k[0].length,h=Array(a),d,b,f;for(e=0;e<a;e++){h[e]=Array(c)}for(g=c-1;g>=1;g-=2){b=k[g];d=k[g-1];for(e=a-1;e>=1;--e){f=h[e];f[g]=b[e];f[g-1]=d[e];--e;f=h[e];f[g]=b[e];f[g-1]=d[e]}if(e===0){f=h[0];f[g]=b[0];f[g-1]=d[0]}}if(g===0){d=k[0];for(e=a-1;e>=1;--e){h[e][0]=d[e];--e;h[e][0]=d[e]}if(e===0){h[0][0]=d[0]}}return h};numeric.negtranspose=function negtranspose(k){var g,e,c=k.length,a=k[0].length,h=Array(a),d,b,f;for(e=0;e<a;e++){h[e]=Array(c)}for(g=c-1;g>=1;g-=2){b=k[g];d=k[g-1];for(e=a-1;e>=1;--e){f=h[e];f[g]=-b[e];f[g-1]=-d[e];--e;f=h[e];f[g]=-b[e];f[g-1]=-d[e]}if(e===0){f=h[0];f[g]=-b[0];f[g-1]=-d[0]}}if(g===0){d=k[0];for(e=a-1;e>=1;--e){h[e][0]=-d[e];--e;h[e][0]=-d[e]}if(e===0){h[0][0]=-d[0]}}return h};numeric._random=function _random(e,a){var d,f=e[a],b=Array(f),c;if(a===e.length-1){c=Math.random;for(d=f-1;d>=1;d-=2){b[d]=c();b[d-1]=c()}if(d===0){b[0]=c()}return b}for(d=f-1;d>=0;d--){b[d]=_random(e,a+1)}return b};numeric.random=function random(a){return numeric._random(a,0)};numeric.norm2=function norm2(a){return Math.sqrt(numeric.norm2Squared(a))};numeric.linspace=function linspace(d,c,g){if(typeof g==="undefined"){g=Math.max(Math.round(c-d)+1,1)}if(g<2){return g===1?[d]:[]}var f,e=Array(g);g--;for(f=g;f>=0;f--){e[f]=(f*c+(g-f)*d)/g}return e};numeric.getBlock=function getBlock(a,e,d){var b=numeric.dim(a);function c(f,h){var l,g=e[h],m=d[h]-g,j=Array(m);if(h===b.length-1){for(l=m;l>=0;l--){j[l]=f[l+g]}return j}for(l=m;l>=0;l--){j[l]=c(f[l+g],h+1)}return j}return c(a,0)};numeric.setBlock=function setBlock(a,f,e,d){var b=numeric.dim(a);function c(g,o,j){var l,h=f[j],m=e[j]-h;if(j===b.length-1){for(l=m;l>=0;l--){g[l+h]=o[l]}}for(l=m;l>=0;l--){c(g[l+h],o[l],j+1)}}c(a,d,0);return a};numeric.getRange=function getRange(b,l,k){var e=l.length,d=k.length;var g,f;var a=Array(e),h,c;for(g=e-1;g!==-1;--g){a[g]=Array(d);h=a[g];c=b[l[g]];for(f=d-1;f!==-1;--f){h[f]=c[k[f]]}}return a};numeric.blockMatrix=function blockMatrix(b){var x=numeric.dim(b);if(x.length<4){return numeric.blockMatrix([b])}var d=x[0],c=x[1],r,q,o,h,w;r=0;q=0;for(o=0;o<d;++o){r+=b[o][0].length}for(h=0;h<c;++h){q+=b[0][h][0].length}var a=Array(r);for(o=0;o<r;++o){a[o]=Array(q)}var v=0,u,p,g,e,f;for(o=0;o<d;++o){u=q;for(h=c-1;h!==-1;--h){w=b[o][h];u-=w[0].length;for(g=w.length-1;g!==-1;--g){f=w[g];p=a[v+g];for(e=f.length-1;e!==-1;--e){p[u+e]=f[e]}}}v+=b[o][0].length}return a};numeric.tensor=function tensor(h,g){if(typeof h==="number"||typeof g==="number"){return numeric.mul(h,g)}var o=numeric.dim(h),k=numeric.dim(g);if(o.length!==1||k.length!==1){throw new Error("numeric: tensor product is only defined for vectors")}var c=o[0],b=k[0],a=Array(c),l,e,d,f;for(e=c-1;e>=0;e--){l=Array(b);f=h[e];for(d=b-1;d>=3;--d){l[d]=f*g[d];--d;l[d]=f*g[d];--d;l[d]=f*g[d];--d;l[d]=f*g[d]}while(d>=0){l[d]=f*g[d];--d}a[e]=l}return a};numeric.T=function T(a,b){this.x=a;this.y=b};numeric.t=function t(a,b){return new numeric.T(a,b)};numeric.Tbinop=function Tbinop(c,e,d,g,a){var f=numeric.indexOf;if(typeof a!=="string"){var b;a="";for(b in numeric){if(numeric.hasOwnProperty(b)&&(c.indexOf(b)>=0||e.indexOf(b)>=0||d.indexOf(b)>=0||g.indexOf(b)>=0)&&b.length>1){a+="var "+b+" = numeric."+b+";\n"}}}return Function(["y"],"var x = this;\nif(!(y instanceof numeric.T)) { y = new numeric.T(y); }\n"+a+"\nif(x.y) {  if(y.y) {    return new numeric.T("+g+");\n  }\n  return new numeric.T("+d+");\n}\nif(y.y) {\n  return new numeric.T("+e+");\n}\nreturn new numeric.T("+c+");\n")};numeric.T.prototype.add=numeric.Tbinop("add(x.x,y.x)","add(x.x,y.x),y.y","add(x.x,y.x),x.y","add(x.x,y.x),add(x.y,y.y)");numeric.T.prototype.sub=numeric.Tbinop("sub(x.x,y.x)","sub(x.x,y.x),neg(y.y)","sub(x.x,y.x),x.y","sub(x.x,y.x),sub(x.y,y.y)");numeric.T.prototype.mul=numeric.Tbinop("mul(x.x,y.x)","mul(x.x,y.x),mul(x.x,y.y)","mul(x.x,y.x),mul(x.y,y.x)","sub(mul(x.x,y.x),mul(x.y,y.y)),add(mul(x.x,y.y),mul(x.y,y.x))");numeric.T.prototype.reciprocal=function reciprocal(){var a=numeric.mul,c=numeric.div;if(this.y){var b=numeric.add(a(this.x,this.x),a(this.y,this.y));return new numeric.T(c(this.x,b),c(numeric.neg(this.y),b))}return new T(c(1,this.x))};numeric.T.prototype.div=function div(b){if(!(b instanceof numeric.T)){b=new numeric.T(b)}if(b.y){return this.mul(b.reciprocal())}var a=numeric.div;if(this.y){return new numeric.T(a(this.x,b.x),a(this.y,b.x))}return new numeric.T(a(this.x,b.x))};numeric.T.prototype.dot=numeric.Tbinop("dot(x.x,y.x)","dot(x.x,y.x),dot(x.x,y.y)","dot(x.x,y.x),dot(x.y,y.x)","sub(dot(x.x,y.x),dot(x.y,y.y)),add(dot(x.x,y.y),dot(x.y,y.x))");numeric.T.prototype.transpose=function transpose(){var b=numeric.transpose,a=this.x,c=this.y;if(c){return new numeric.T(b(a),b(c))}return new numeric.T(b(a))};numeric.T.prototype.transjugate=function transjugate(){var b=numeric.transpose,a=this.x,c=this.y;if(c){return new numeric.T(b(a),numeric.negtranspose(c))}return new numeric.T(b(a))};numeric.Tunop=function Tunop(b,d,a){if(typeof a!=="string"){a=""}return Function("var x = this;\n"+a+"\nif(x.y) {  "+d+";\n}\n"+b+";\n")};numeric.T.prototype.exp=numeric.Tunop("return new numeric.T(ex)","return new numeric.T(mul(cos(x.y),ex),mul(sin(x.y),ex))","var ex = numeric.exp(x.x), cos = numeric.cos, sin = numeric.sin, mul = numeric.mul;");numeric.T.prototype.conj=numeric.Tunop("return new numeric.T(x.x);","return new numeric.T(x.x,numeric.neg(x.y));");numeric.T.prototype.neg=numeric.Tunop("return new numeric.T(neg(x.x));","return new numeric.T(neg(x.x),neg(x.y));","var neg = numeric.neg;");numeric.T.prototype.sin=numeric.Tunop("return new numeric.T(numeric.sin(x.x))","return x.exp().sub(x.neg().exp()).div(new numeric.T(0,2));");numeric.T.prototype.cos=numeric.Tunop("return new numeric.T(numeric.cos(x.x))","return x.exp().add(x.neg().exp()).div(2);");numeric.T.prototype.abs=numeric.Tunop("return new numeric.T(numeric.abs(x.x));","return new numeric.T(numeric.sqrt(numeric.add(mul(x.x,x.x),mul(x.y,x.y))));","var mul = numeric.mul;");numeric.T.prototype.log=numeric.Tunop("return new numeric.T(numeric.log(x.x));","var theta = new numeric.T(numeric.atan2(x.y,x.x)), r = x.abs();\nreturn new numeric.T(numeric.log(r.x),theta.x);");numeric.T.prototype.norm2=numeric.Tunop("return numeric.norm2(x.x);","var f = numeric.norm2Squared;\nreturn Math.sqrt(f(x.x)+f(x.y));");numeric.T.prototype.inv=function inv(){var r=this;if(typeof r.y==="undefined"){return new numeric.T(numeric.inv(r.x))}var s=r.x.length,w,v,u;var e=numeric.identity(s),c=numeric.rep([s,s],0);var q=numeric.clone(r.x),o=numeric.clone(r.y);var b,a,l,h,p,m,D,C;var w,v,u,B,E,g,f,y,x,z;for(w=0;w<s;w++){g=q[w][w];f=o[w][w];B=g*g+f*f;u=w;for(v=w+1;v<s;v++){g=q[v][w];f=o[v][w];E=g*g+f*f;if(E>B){u=v;B=E}}if(u!==w){z=q[w];q[w]=q[u];q[u]=z;z=o[w];o[w]=o[u];o[u]=z;z=e[w];e[w]=e[u];e[u]=z;z=c[w];c[w]=c[u];c[u]=z}b=q[w];a=o[w];p=e[w];m=c[w];g=b[w];f=a[w];for(v=w+1;v<s;v++){y=b[v];x=a[v];b[v]=(y*g+x*f)/B;a[v]=(x*g-y*f)/B}for(v=0;v<s;v++){y=p[v];x=m[v];p[v]=(y*g+x*f)/B;m[v]=(x*g-y*f)/B}for(v=w+1;v<s;v++){l=q[v];h=o[v];D=e[v];C=c[v];g=l[w];f=h[w];for(u=w+1;u<s;u++){y=b[u];x=a[u];l[u]-=y*g-x*f;h[u]-=x*g+y*f}for(u=0;u<s;u++){y=p[u];x=m[u];D[u]-=y*g-x*f;C[u]-=x*g+y*f}}}for(w=s-1;w>0;w--){p=e[w];m=c[w];for(v=w-1;v>=0;v--){D=e[v];C=c[v];g=q[v][w];f=o[v][w];for(u=s-1;u>=0;u--){y=p[u];x=m[u];D[u]-=g*y-f*x;C[u]-=g*x+f*y}}}return new numeric.T(e,c)};numeric.T.prototype.get=function get(d){var a=this.x,f=this.y,b=0,c,e=d.length;if(f){while(b<e){c=d[b];a=a[c];f=f[c];b++}return new numeric.T(a,f)}while(b<e){c=d[b];a=a[c];b++}return new numeric.T(a)};numeric.T.prototype.set=function set(c,j){var g=this.x,e=this.y,b=0,h,a=c.length,f=j.x,d=j.y;if(a===0){if(d){this.y=d}else{if(e){this.y=undefined}}this.x=g;return this}if(d){if(e){}else{e=numeric.rep(numeric.dim(g),0);this.y=e}while(b<a-1){h=c[b];g=g[h];e=e[h];b++}h=c[b];g[h]=f;e[h]=d;return this}if(e){while(b<a-1){h=c[b];g=g[h];e=e[h];b++}h=c[b];g[h]=f;if(f instanceof Array){e[h]=numeric.rep(numeric.dim(f),0)}else{e[h]=0}return this}while(b<a-1){h=c[b];g=g[h];b++}h=c[b];g[h]=f;return this};numeric.T.prototype.getRows=function getRows(e,c){var h=c-e+1,b;var f=Array(h),d,a=this.x,g=this.y;for(b=e;b<=c;b++){f[b-e]=a[b]}if(g){d=Array(h);for(b=e;b<=c;b++){d[b-e]=g[b]}return new numeric.T(f,d)}return new numeric.T(f)};numeric.T.prototype.setRows=function setRows(f,d,b){var c;var g=this.x,e=this.y,a=b.x,h=b.y;for(c=f;c<=d;c++){g[c]=a[c-f]}if(h){if(!e){e=numeric.rep(numeric.dim(g),0);this.y=e}for(c=f;c<=d;c++){e[c]=h[c-f]}}else{if(e){for(c=f;c<=d;c++){e[c]=numeric.rep([a[c-f].length],0)}}}return this};numeric.T.prototype.getRow=function getRow(b){var a=this.x,c=this.y;if(c){return new numeric.T(a[b],c[b])}return new numeric.T(a[b])};numeric.T.prototype.setRow=function setRow(c,b){var e=this.x,d=this.y,a=b.x,f=b.y;e[c]=a;if(f){if(!d){d=numeric.rep(numeric.dim(e),0);this.y=d}d[c]=f}else{if(d){d=numeric.rep([a.length],0)}}return this};numeric.T.prototype.getBlock=function getBlock(f,e){var c=this.x,d=this.y,a=numeric.getBlock;if(d){return new numeric.T(a(c,f,e),a(d,f,e))}return new numeric.T(a(c,f,e))};numeric.T.prototype.setBlock=function setBlock(i,h,d){if(!(d instanceof numeric.T)){d=new numeric.T(d)}var c=this.x,g=this.y,a=numeric.setBlock,f=d.x,e=d.y;if(e){if(!g){this.y=numeric.rep(numeric.dim(this),0);g=this.y}a(c,i,h,f);a(g,i,h,e);return this}a(c,i,h,f);if(g){a(g,i,h,numeric.rep(numeric.dim(f),0))}};numeric.T.rep=function rep(d,b){var c=numeric.T;if(!(b instanceof c)){b=new c(b)}var a=b.x,f=b.y,e=numeric.rep;if(f){return new c(e(d,a),e(d,f))}return new c(e(d,a))};numeric.T.diag=function diag(c){if(!(c instanceof numeric.T)){c=new numeric.T(c)}var a=c.x,e=c.y,b=numeric.diag;if(e){return new numeric.T(b(a),b(e))}return new numeric.T(b(a))};numeric.T.eig=function eig(){if(this.y){throw new Error("eig: not implemented for complex matrices.")}return numeric.eig(this.x)};numeric.T.identity=function identity(a){return new numeric.T(numeric.identity(a))};numeric.T.prototype.getDiag=function getDiag(){var c=numeric;var a=this.x,b=this.y;if(b){return new c.T(c.getDiag(a),c.getDiag(b))}return new c.T(c.getDiag(a))};numeric.house=function house(a){var b=numeric.clone(a);var c=a[0]>=0?1:-1;var d=c*numeric.norm2(a);b[0]+=d;var e=numeric.norm2(b);if(e===0){throw new Error("eig: internal error")}return numeric.div(b,e)};numeric.toUpperHessenberg=function toUpperHessenberg(o){var u=numeric.dim(o);if(u.length!==2||u[0]!==u[1]){throw new Error("numeric: toUpperHessenberg() only works on square matrices")}var f=u[0],l,h,g,p,r,d=numeric.clone(o),c,a,q,b,n=numeric.identity(f),e;for(h=0;h<f-2;h++){p=Array(f-h-1);for(l=h+1;l<f;l++){p[l-h-1]=d[l][h]}if(numeric.norm2(p)>0){r=numeric.house(p);c=numeric.getBlock(d,[h+1,h],[f-1,f-1]);a=numeric.tensor(r,numeric.dot(r,c));for(l=h+1;l<f;l++){q=d[l];b=a[l-h-1];for(g=h;g<f;g++){q[g]-=2*b[g-h]}}c=numeric.getBlock(d,[0,h+1],[f-1,f-1]);a=numeric.tensor(numeric.dot(c,r),r);for(l=0;l<f;l++){q=d[l];b=a[l];for(g=h+1;g<f;g++){q[g]-=2*b[g-h-1]}}c=Array(f-h-1);for(l=h+1;l<f;l++){c[l-h-1]=n[l]}a=numeric.tensor(r,numeric.dot(r,c));for(l=h+1;l<f;l++){e=n[l];b=a[l-h-1];for(g=0;g<f;g++){e[g]-=2*b[g]}}}}return{H:d,Q:n}};numeric.epsilon=2.220446049250313e-16;numeric.QRFrancis=function(z,h){if(typeof h==="undefined"){h=10000}z=numeric.clone(z);var D=numeric.clone(z);var E=numeric.dim(z),K=E[0],y,A,U,S,R,P,n,e,l,q=numeric.identity(K),u,r,I,G,F,O,M,L,N;if(K<3){return{Q:q,B:[[0,K-1]]}}var V=numeric.epsilon;for(N=0;N<h;N++){for(M=0;M<K-1;M++){if(Math.abs(z[M+1][M])<V*(Math.abs(z[M][M])+Math.abs(z[M+1][M+1]))){var p=numeric.QRFrancis(numeric.getBlock(z,[0,0],[M,M]),h);var o=numeric.QRFrancis(numeric.getBlock(z,[M+1,M+1],[K-1,K-1]),h);I=Array(M+1);for(O=0;O<=M;O++){I[O]=q[O]}G=numeric.dot(p.Q,I);for(O=0;O<=M;O++){q[O]=G[O]}I=Array(K-M-1);for(O=M+1;O<K;O++){I[O-M-1]=q[O]}G=numeric.dot(o.Q,I);for(O=M+1;O<K;O++){q[O]=G[O-M-1]}return{Q:q,B:p.B.concat(numeric.add(o.B,M+1))}}}U=z[K-2][K-2];S=z[K-2][K-1];R=z[K-1][K-2];P=z[K-1][K-1];e=U+P;n=(U*P-S*R);l=numeric.getBlock(z,[0,0],[2,2]);if(e*e>=4*n){var g,f;g=0.5*(e+Math.sqrt(e*e-4*n));f=0.5*(e-Math.sqrt(e*e-4*n));l=numeric.add(numeric.sub(numeric.dot(l,l),numeric.mul(l,g+f)),numeric.diag(numeric.rep([3],g*f)))}else{l=numeric.add(numeric.sub(numeric.dot(l,l),numeric.mul(l,e)),numeric.diag(numeric.rep([3],n)))}y=[l[0][0],l[1][0],l[2][0]];A=numeric.house(y);I=[z[0],z[1],z[2]];G=numeric.tensor(A,numeric.dot(A,I));for(O=0;O<3;O++){r=z[O];F=G[O];for(L=0;L<K;L++){r[L]-=2*F[L]}}I=numeric.getBlock(z,[0,0],[K-1,2]);G=numeric.tensor(numeric.dot(I,A),A);for(O=0;O<K;O++){r=z[O];F=G[O];for(L=0;L<3;L++){r[L]-=2*F[L]}}I=[q[0],q[1],q[2]];G=numeric.tensor(A,numeric.dot(A,I));for(O=0;O<3;O++){u=q[O];F=G[O];for(L=0;L<K;L++){u[L]-=2*F[L]}}var w;for(M=0;M<K-2;M++){for(L=M;L<=M+1;L++){if(Math.abs(z[L+1][L])<V*(Math.abs(z[L][L])+Math.abs(z[L+1][L+1]))){var p=numeric.QRFrancis(numeric.getBlock(z,[0,0],[L,L]),h);var o=numeric.QRFrancis(numeric.getBlock(z,[L+1,L+1],[K-1,K-1]),h);I=Array(L+1);for(O=0;O<=L;O++){I[O]=q[O]}G=numeric.dot(p.Q,I);for(O=0;O<=L;O++){q[O]=G[O]}I=Array(K-L-1);for(O=L+1;O<K;O++){I[O-L-1]=q[O]}G=numeric.dot(o.Q,I);for(O=L+1;O<K;O++){q[O]=G[O-L-1]}return{Q:q,B:p.B.concat(numeric.add(o.B,L+1))}}}w=Math.min(K-1,M+3);y=Array(w-M);for(O=M+1;O<=w;O++){y[O-M-1]=z[O][M]}A=numeric.house(y);I=numeric.getBlock(z,[M+1,M],[w,K-1]);G=numeric.tensor(A,numeric.dot(A,I));for(O=M+1;O<=w;O++){r=z[O];F=G[O-M-1];for(L=M;L<K;L++){r[L]-=2*F[L-M]}}I=numeric.getBlock(z,[0,M+1],[K-1,w]);G=numeric.tensor(numeric.dot(I,A),A);for(O=0;O<K;O++){r=z[O];F=G[O];for(L=M+1;L<=w;L++){r[L]-=2*F[L-M-1]}}I=Array(w-M);for(O=M+1;O<=w;O++){I[O-M-1]=q[O]}G=numeric.tensor(A,numeric.dot(A,I));for(O=M+1;O<=w;O++){u=q[O];F=G[O-M-1];for(L=0;L<K;L++){u[L]-=2*F[L]}}}}throw new Error("numeric: eigenvalue iteration does not converge -- increase maxiter?")};numeric.eig=function eig(L,l){var f=numeric.toUpperHessenberg(L);var o=numeric.QRFrancis(f.H,l);var r=numeric.T;var O=L.length,W,S,V=false,J=o.B,D=numeric.dot(o.Q,numeric.dot(f.H,numeric.transpose(o.Q)));var u=new r(numeric.dot(o.Q,f.Q)),G;var P=J.length,U;var aa,Z,Y,X,h,g,e,C,z,K,I,w,v;var ab=Math.sqrt;for(S=0;S<P;S++){W=J[S][0];if(W===J[S][1]){}else{U=W+1;aa=D[W][W];Z=D[W][U];Y=D[U][W];X=D[U][U];if(Z===0&&Y===0){continue}h=-aa-X;g=aa*X-Z*Y;e=h*h-4*g;if(e>=0){if(h<0){C=-0.5*(h-ab(e))}else{C=-0.5*(h+ab(e))}w=(aa-C)*(aa-C)+Z*Z;v=Y*Y+(X-C)*(X-C);if(w>v){w=ab(w);K=(aa-C)/w;I=Z/w}else{v=ab(v);K=Y/v;I=(X-C)/v}G=new r([[I,-K],[K,I]]);u.setRows(W,U,G.dot(u.getRows(W,U)))}else{C=-0.5*h;z=0.5*ab(-e);w=(aa-C)*(aa-C)+Z*Z;v=Y*Y+(X-C)*(X-C);if(w>v){w=ab(w+z*z);K=(aa-C)/w;I=Z/w;C=0;z/=w}else{v=ab(v+z*z);K=Y/v;I=(X-C)/v;C=z/v;z=0}G=new r([[I,-K],[K,I]],[[C,z],[z,-C]]);u.setRows(W,U,G.dot(u.getRows(W,U)))}}}var s=u.dot(L).dot(u.transjugate()),O=L.length,F=numeric.T.identity(O);for(U=0;U<O;U++){if(U>0){for(S=U-1;S>=0;S--){var M=s.get([S,S]),N=s.get([U,U]);if(numeric.neq(M.x,N.x)||numeric.neq(M.y,N.y)){C=s.getRow(S).getBlock([S],[U-1]);z=F.getRow(U).getBlock([S],[U-1]);F.set([U,S],(s.get([S,U]).neg().sub(C.dot(z))).div(M.sub(N)))}else{F.setRow(U,F.getRow(S));continue}}}}for(U=0;U<O;U++){C=F.getRow(U);F.setRow(U,C.div(C.norm2()))}F=F.transpose();F=u.transjugate().dot(F);return{lambda:s.getDiag(),E:F}};numeric.ccsSparse=function ccsSparse(a){var d=a.length,b,g,f,e,k=[];for(f=d-1;f!==-1;--f){g=a[f];for(e in g){e=parseInt(e);while(e>=k.length){k[k.length]=0}if(g[e]!==0){k[e]++}}}var b=k.length;var l=Array(b+1);l[0]=0;for(f=0;f<b;++f){l[f+1]=l[f]+k[f]}var h=Array(l[b]),c=Array(l[b]);for(f=d-1;f!==-1;--f){g=a[f];for(e in g){if(g[e]!==0){k[e]--;h[l[e]+k[e]]=f;c[l[e]+k[e]]=g[e]}}}return[l,h,c]};numeric.ccsFull=function ccsFull(c){var p=c[0],o=c[1],e=c[2],r=numeric.ccsDim(c),f=r[0],d=r[1],l,h,a,q,g;var b=numeric.rep([f,d],0);for(l=0;l<d;l++){a=p[l];q=p[l+1];for(h=a;h<q;++h){b[o[h]][l]=e[h]}}return b};numeric.ccsTSolve=function ccsTSolve(p,E,f,e,g){var D=p[0],C=p[1],o=p[2],r=D.length-1,z=Math.max,q=0;if(typeof e==="undefined"){f=numeric.rep([r],0)}if(typeof e==="undefined"){e=numeric.linspace(0,f.length-1)}if(typeof g==="undefined"){g=[]}function h(b){var a;if(f[b]!==0){return}f[b]=1;for(a=D[b];a<D[b+1];++a){h(C[a])}g[q]=b;++q}var B,y,d,c,v,s,w,u,F;for(B=e.length-1;B!==-1;--B){h(e[B])}g.length=q;for(B=g.length-1;B!==-1;--B){f[g[B]]=0}for(B=e.length-1;B!==-1;--B){y=e[B];f[y]=E[y]}for(B=g.length-1;B!==-1;--B){y=g[B];d=D[y];c=z(D[y+1],d);for(v=d;v!==c;++v){if(C[v]===y){f[y]/=o[v];break}}F=f[y];for(v=d;v!==c;++v){s=C[v];if(s!==y){f[s]-=F*o[v]}}}return f};numeric.ccsDFS=function ccsDFS(a){this.k=Array(a);this.k1=Array(a);this.j=Array(a)};numeric.ccsDFS.prototype.dfs=function dfs(o,r,p,q,i,g){var d=0,l,c=i.length;var e=this.k,h=this.k1,f=this.j,a,b;if(q[o]!==0){return}q[o]=1;f[0]=o;e[0]=a=r[o];h[0]=b=r[o+1];while(1){if(a>=b){i[c]=f[d];if(d===0){return}++c;--d;a=e[d];b=h[d]}else{l=g[p[a]];if(q[l]===0){q[l]=1;e[d]=a;++d;f[d]=l;a=r[l];h[d]=b=r[l+1]}else{++a}}}};numeric.ccsLPSolve=function ccsLPSolve(s,q,h,o,g,M,p){var K=s[0],H=s[1],r=s[2],v=K.length-1,u=0;var e=q[0],d=q[1],N=q[2];var G,D,y,F,f,c,b,C,w,E,z,L;D=e[g];y=e[g+1];o.length=0;for(G=D;G<y;++G){p.dfs(M[d[G]],K,H,h,o,M)}for(G=o.length-1;G!==-1;--G){h[o[G]]=0}for(G=D;G!==y;++G){F=M[d[G]];h[F]=N[G]}for(G=o.length-1;G!==-1;--G){F=o[G];c=K[F];b=K[F+1];for(C=c;C<b;++C){if(M[H[C]]===F){h[F]/=r[C];break}}L=h[F];for(C=c;C<b;++C){w=M[H[C]];if(w!==F){h[w]-=L*r[C]}}}return h};numeric.ccsLUP1=function ccsLUP1(z,h){var D=z[0].length-1;var p=[numeric.rep([D+1],0),[],[]],l=[numeric.rep([D+1],0),[],[]];var B=p[0],y=p[1],o=p[2],E=l[0],C=l[1],r=l[2];var s=numeric.rep([D],0),w=numeric.rep([D],0);var I,G,F,f,b,Q,J,N,M,q;var g=numeric.ccsLPSolve,H=Math.max,u=Math.abs;var n=numeric.linspace(0,D-1),O=numeric.linspace(0,D-1);var v=new numeric.ccsDFS(D);if(typeof h==="undefined"){h=1}for(I=0;I<D;++I){g(p,z,s,w,I,O,v);Q=-1;J=-1;for(G=w.length-1;G!==-1;--G){F=w[G];if(F<=I){continue}N=u(s[F]);if(N>Q){J=F;Q=N}}if(u(s[I])<h*Q){G=n[I];Q=n[J];n[I]=Q;O[Q]=I;n[J]=G;O[G]=J;Q=s[I];s[I]=s[J];s[J]=Q}Q=B[I];J=E[I];M=s[I];y[Q]=n[I];o[Q]=1;++Q;for(G=w.length-1;G!==-1;--G){F=w[G];N=s[F];w[G]=0;s[F]=0;if(F<=I){C[J]=F;r[J]=N;++J}else{y[Q]=n[F];o[Q]=N/M;++Q}}B[I+1]=Q;E[I+1]=J}for(G=y.length-1;G!==-1;--G){y[G]=O[y[G]]}return{L:p,U:l,P:n,Pinv:O}};numeric.ccsDFS0=function ccsDFS0(a){this.k=Array(a);this.k1=Array(a);this.j=Array(a)};numeric.ccsDFS0.prototype.dfs=function dfs(p,s,q,r,l,h,g){var d=0,o,c=l.length;var e=this.k,i=this.k1,f=this.j,a,b;if(r[p]!==0){return}r[p]=1;f[0]=p;e[0]=a=s[h[p]];i[0]=b=s[h[p]+1];while(1){if(isNaN(a)){throw new Error("Ow!")}if(a>=b){l[c]=h[f[d]];if(d===0){return}++c;--d;a=e[d];b=i[d]}else{o=q[a];if(r[o]===0){r[o]=1;e[d]=a;++d;f[d]=o;o=h[o];a=s[o];i[d]=b=s[o+1]}else{++a}}}};numeric.ccsLPSolve0=function ccsLPSolve0(u,r,h,p,o,N,f,q){var L=u[0],K=u[1],s=u[2],w=L.length-1,v=0;var e=r[0],d=r[1],O=r[2];var H,E,z,G,g,c,b,D,x,F,C,M;E=e[o];z=e[o+1];p.length=0;for(H=E;H<z;++H){q.dfs(d[H],L,K,h,p,N,f)}for(H=p.length-1;H!==-1;--H){G=p[H];h[f[G]]=0}for(H=E;H!==z;++H){G=d[H];h[G]=O[H]}for(H=p.length-1;H!==-1;--H){G=p[H];x=f[G];c=L[G];b=L[G+1];for(D=c;D<b;++D){if(K[D]===x){h[x]/=s[D];break}}M=h[x];for(D=c;D<b;++D){h[K[D]]-=M*s[D]}h[x]=M}};numeric.ccsLUP0=function ccsLUP0(z,h){var D=z[0].length-1;var p=[numeric.rep([D+1],0),[],[]],l=[numeric.rep([D+1],0),[],[]];var B=p[0],x=p[1],o=p[2],E=l[0],C=l[1],s=l[2];var r=numeric.rep([D],0),w=numeric.rep([D],0);var I,G,F,f,b,Q,J,N,M,q;var g=numeric.ccsLPSolve0,H=Math.max,u=Math.abs;var n=numeric.linspace(0,D-1),O=numeric.linspace(0,D-1);var v=new numeric.ccsDFS0(D);if(typeof h==="undefined"){h=1}for(I=0;I<D;++I){g(p,z,r,w,I,O,n,v);Q=-1;J=-1;for(G=w.length-1;G!==-1;--G){F=w[G];if(F<=I){continue}N=u(r[n[F]]);if(N>Q){J=F;Q=N}}if(u(r[n[I]])<h*Q){G=n[I];Q=n[J];n[I]=Q;O[Q]=I;n[J]=G;O[G]=J}Q=B[I];J=E[I];M=r[n[I]];x[Q]=n[I];o[Q]=1;++Q;for(G=w.length-1;G!==-1;--G){F=w[G];N=r[n[F]];w[G]=0;r[n[F]]=0;if(F<=I){C[J]=F;s[J]=N;++J}else{x[Q]=n[F];o[Q]=N/M;++Q}}B[I+1]=Q;E[I+1]=J}for(G=x.length-1;G!==-1;--G){x[G]=O[x[G]]}return{L:p,U:l,P:n,Pinv:O}};numeric.ccsLUP=numeric.ccsLUP0;numeric.ccsDim=function ccsDim(a){return[numeric.sup(a[1])+1,a[0].length-1]};numeric.ccsGetBlock=function ccsGetBlock(D,J,I){var v=numeric.ccsDim(D),G=v[0],F=v[1];if(typeof J==="undefined"){J=numeric.linspace(0,G-1)}else{if(typeof J==="number"){J=[J]}}if(typeof I==="undefined"){I=numeric.linspace(0,F-1)}else{if(typeof I==="number"){I=[I]}}var E,b,a,g=J.length,z,e=I.length,w,H,k;var d=numeric.rep([F],0),c=[],M=[],y=[d,c,M];var L=D[0],K=D[1],C=D[2];var u=numeric.rep([G],0),h=0,f=numeric.rep([G],0);for(z=0;z<e;++z){H=I[z];var o=L[H];var l=L[H+1];for(E=o;E<l;++E){w=K[E];f[w]=1;u[w]=C[E]}for(E=0;E<g;++E){k=J[E];if(f[k]){c[h]=E;M[h]=u[J[E]];++h}}for(E=o;E<l;++E){w=K[E];f[w]=0}d[z+1]=h}return y};numeric.ccsDot=function ccsDot(D,w){var Q=D[0],P=D[1],z=D[2];var f=w[0],e=w[1],U=w[2];var O=numeric.ccsDim(D),M=numeric.ccsDim(w);var G=O[0],F=O[1],E=M[1];var q=numeric.rep([G],0),h=numeric.rep([G],0),v=Array(G);var u=numeric.rep([E],0),r=[],g=[],s=[u,r,g];var N,L,K,d,c,J,I,H,y,S,R;for(K=0;K!==E;++K){d=f[K];c=f[K+1];y=0;for(L=d;L<c;++L){S=e[L];R=U[L];J=Q[S];I=Q[S+1];for(N=J;N<I;++N){H=P[N];if(h[H]===0){v[y]=H;h[H]=1;y=y+1}q[H]=q[H]+z[N]*R}}d=u[K];c=d+y;u[K+1]=c;for(L=y-1;L!==-1;--L){R=d+L;N=v[L];r[R]=N;g[R]=q[N];h[N]=0;q[N]=0}u[K+1]=u[K]+y}return s};numeric.ccsLUPSolve=function ccsLUPSolve(l,w){var q=l.L,f=l.U,o=l.P;var h=w[0];var G=false;if(typeof h!=="object"){w=[[0,w.length],numeric.linspace(0,w.length-1),w];h=w[0];G=true}var g=w[1],I=w[2];var y=q[0].length-1,z=h.length-1;var u=numeric.rep([y],0),v=Array(y);var H=numeric.rep([y],0),e=Array(y);var D=numeric.rep([z+1],0),A=[],s=[];var d=numeric.ccsTSolve;var F,E,c,a,C,r,p=0;for(F=0;F<z;++F){C=0;c=h[F];a=h[F+1];for(E=c;E<a;++E){r=l.Pinv[g[E]];e[C]=r;H[r]=I[E];++C}e.length=C;d(q,H,u,e,v);for(E=e.length-1;E!==-1;--E){H[e[E]]=0}d(f,u,H,v,e);if(G){return H}for(E=v.length-1;E!==-1;--E){u[v[E]]=0}for(E=e.length-1;E!==-1;--E){r=e[E];A[p]=r;s[p]=H[r];H[r]=0;++p}D[F+1]=p}return[D,A,s]};numeric.ccsbinop=function ccsbinop(b,a){if(typeof a==="undefined"){a=""}return Function("X","Y","var Xi = X[0], Xj = X[1], Xv = X[2];\nvar Yi = Y[0], Yj = Y[1], Yv = Y[2];\nvar n = Xi.length-1,m = Math.max(numeric.sup(Xj),numeric.sup(Yj))+1;\nvar Zi = numeric.rep([n+1],0), Zj = [], Zv = [];\nvar x = numeric.rep([m],0),y = numeric.rep([m],0);\nvar xk,yk,zk;\nvar i,j,j0,j1,k,p=0;\n"+a+"for(i=0;i<n;++i) {\n  j0 = Xi[i]; j1 = Xi[i+1];\n  for(j=j0;j!==j1;++j) {\n    k = Xj[j];\n    x[k] = 1;\n    Zj[p] = k;\n    ++p;\n  }\n  j0 = Yi[i]; j1 = Yi[i+1];\n  for(j=j0;j!==j1;++j) {\n    k = Yj[j];\n    y[k] = Yv[j];\n    if(x[k] === 0) {\n      Zj[p] = k;\n      ++p;\n    }\n  }\n  Zi[i+1] = p;\n  j0 = Xi[i]; j1 = Xi[i+1];\n  for(j=j0;j!==j1;++j) x[Xj[j]] = Xv[j];\n  j0 = Zi[i]; j1 = Zi[i+1];\n  for(j=j0;j!==j1;++j) {\n    k = Zj[j];\n    xk = x[k];\n    yk = y[k];\n"+b+"\n    Zv[j] = zk;\n  }\n  j0 = Xi[i]; j1 = Xi[i+1];\n  for(j=j0;j!==j1;++j) x[Xj[j]] = 0;\n  j0 = Yi[i]; j1 = Yi[i+1];\n  for(j=j0;j!==j1;++j) y[Yj[j]] = 0;\n}\nreturn [Zi,Zj,Zv];")};(function(){var k,A,B,C;for(k in numeric.ops2){if(isFinite(eval("1"+numeric.ops2[k]+"0"))){A="[Y[0],Y[1],numeric."+k+"(X,Y[2])]"}else{A="NaN"}if(isFinite(eval("0"+numeric.ops2[k]+"1"))){B="[X[0],X[1],numeric."+k+"(X[2],Y)]"}else{B="NaN"}if(isFinite(eval("1"+numeric.ops2[k]+"0"))&&isFinite(eval("0"+numeric.ops2[k]+"1"))){C="numeric.ccs"+k+"MM(X,Y)"}else{C="NaN"}numeric["ccs"+k+"MM"]=numeric.ccsbinop("zk = xk "+numeric.ops2[k]+"yk;");numeric["ccs"+k]=Function("X","Y",'if(typeof X === "number") return '+A+';\nif(typeof Y === "number") return '+B+";\nreturn "+C+";\n")}}());numeric.ccsScatter=function ccsScatter(c){var p=c[0],o=c[1],e=c[2];var d=numeric.sup(o)+1,f=p.length;var r=numeric.rep([d],0),q=Array(f),h=Array(f);var l=numeric.rep([d],0),j;for(j=0;j<f;++j){l[o[j]]++}for(j=0;j<d;++j){r[j+1]=r[j]+l[j]}var b=r.slice(0),g,a;for(j=0;j<f;++j){a=o[j];g=b[a];q[g]=p[j];h[g]=e[j];b[a]=b[a]+1}return[r,q,h]};numeric.ccsGather=function ccsGather(c){var o=c[0],l=c[1],e=c[2];var d=o.length-1,f=l.length;var r=Array(f),q=Array(f),g=Array(f);var k,h,a,s,b;b=0;for(k=0;k<d;++k){a=o[k];s=o[k+1];for(h=a;h!==s;++h){q[b]=k;r[b]=l[h];g[b]=e[h];++b}}return[r,q,g]};numeric.sdim=function dim(a,c,b){if(typeof c==="undefined"){c=[]}if(typeof a!=="object"){return c}if(typeof b==="undefined"){b=0}if(!(b in c)){c[b]=0}if(a.length>c[b]){c[b]=a.length}var d;for(d in a){if(a.hasOwnProperty(d)){dim(a[d],c,b+1)}}return c};numeric.sclone=function clone(a,b,e){if(typeof b==="undefined"){b=0}if(typeof e==="undefined"){e=numeric.sdim(a).length}var d,c=Array(a.length);if(b===e-1){for(d in a){if(a.hasOwnProperty(d)){c[d]=a[d]}}return c}for(d in a){if(a.hasOwnProperty(d)){c[d]=clone(a[d],b+1,e)}}return c};numeric.sdiag=function diag(g){var h=g.length,c,a=Array(h),f,e,b;for(c=h-1;c>=1;c-=2){f=c-1;a[c]=[];a[c][c]=g[c];a[f]=[];a[f][f]=g[f]}if(c===0){a[0]=[];a[0][0]=g[c]}return a};numeric.sidentity=function identity(a){return numeric.sdiag(numeric.rep([a],1))};numeric.stranspose=function transpose(a){var d=[],f=a.length,e,c,b;for(e in a){if(!(a.hasOwnProperty(e))){continue}b=a[e];for(c in b){if(!(b.hasOwnProperty(c))){continue}if(typeof d[c]!=="object"){d[c]=[]}d[c][e]=b[c]}}return d};numeric.sLUP=function LUP(a,b){throw new Error("The function numeric.sLUP had a bug in it and has been removed. Please use the new numeric.ccsLUP function instead.")};numeric.sdotMM=function dotMM(e,c){var d=e.length,b=c.length,l=numeric.stranspose(c),a=l.length,u,n;var m,h,g,s;var o=Array(d),f;for(m=d-1;m>=0;m--){f=[];u=e[m];for(g=a-1;g>=0;g--){s=0;n=l[g];for(h in u){if(!(u.hasOwnProperty(h))){continue}if(h in n){s+=u[h]*n[h]}}if(s){f[g]=s}}o[m]=f}return o};numeric.sdotMV=function dotMV(b,a){var h=b.length,d,g,f;var e=Array(h),c;for(g=h-1;g>=0;g--){d=b[g];c=0;for(f in d){if(!(d.hasOwnProperty(f))){continue}if(a[f]){c+=d[f]*a[f]}}if(c){e[g]=c}}return e};numeric.sdotVM=function dotMV(b,a){var g,f,d,h;var e=[],c;for(g in b){if(!b.hasOwnProperty(g)){continue}d=a[g];h=b[g];for(f in d){if(!d.hasOwnProperty(f)){continue}if(!e[f]){e[f]=0}e[f]+=h*d[f]}}return e};numeric.sdotVV=function dotVV(a,d){var c,b=0;for(c in a){if(a[c]&&d[c]){b+=a[c]*d[c]}}return b};numeric.sdot=function dot(b,e){var a=numeric.sdim(b).length,d=numeric.sdim(e).length;var c=a*1000+d;switch(c){case 0:return b*e;case 1001:return numeric.sdotVV(b,e);case 2001:return numeric.sdotMV(b,e);case 1002:return numeric.sdotVM(b,e);case 2002:return numeric.sdotMM(b,e);default:throw new Error("numeric.sdot not implemented for tensors of order "+a+" and "+d)}};numeric.sscatter=function scatter(e){var h=e[0].length,d,g,f,b=e.length,a=[],c;for(g=h-1;g>=0;--g){if(!e[b-1][g]){continue}c=a;for(f=0;f<b-2;f++){d=e[f][g];if(!c[d]){c[d]=[]}c=c[d]}c[e[f][g]]=e[f+1][g]}return a};numeric.sgather=function gather(a,d,c){if(typeof d==="undefined"){d=[]}if(typeof c==="undefined"){c=[]}var f,e,b;f=c.length;for(e in a){if(a.hasOwnProperty(e)){c[f]=parseInt(e);b=a[e];if(typeof b==="number"){if(b){if(d.length===0){for(e=f+1;e>=0;--e){d[e]=[]}}for(e=f;e>=0;--e){d[e].push(c[e])}d[f+1].push(b)}}else{gather(b,d,c)}}}if(c.length>f){c.pop()}return d};numeric.cLU=function LU(w){var r=w[0],o=w[1],d=w[2];var x=r.length,B=0,G,F,E,O,N,M;for(G=0;G<x;G++){if(r[G]>B){B=r[G]}}B++;var l=Array(B),e=Array(B),f=numeric.rep([B],Infinity),K=numeric.rep([B],-Infinity);var C,z,g;for(E=0;E<x;E++){G=r[E];F=o[E];if(F<f[G]){f[G]=F}if(F>K[G]){K[G]=F}}for(G=0;G<B-1;G++){if(K[G]>K[G+1]){K[G+1]=K[G]}}for(G=B-1;G>=1;G--){if(f[G]<f[G-1]){f[G-1]=f[G]}}var D=0,s=0;for(G=0;G<B;G++){e[G]=numeric.rep([K[G]-f[G]+1],0);l[G]=numeric.rep([G-f[G]],0);D+=G-f[G]+1;s+=K[G]-G+1}for(E=0;E<x;E++){G=r[E];e[G][o[E]-f[G]]=d[E]}for(G=0;G<B-1;G++){O=G-f[G];C=e[G];for(F=G+1;f[F]<=G&&F<B;F++){N=G-f[F];M=K[G]-G;z=e[F];g=z[N]/C[O];if(g){for(E=1;E<=M;E++){z[E+N]-=g*C[E+O]}l[F][G-f[F]]=g}}}var C=[],z=[],n=[],y=[],v=[],h=[];var x,u,H;x=0;u=0;for(G=0;G<B;G++){O=f[G];N=K[G];H=e[G];for(F=G;F<=N;F++){if(H[F-O]){C[x]=G;z[x]=F;n[x]=H[F-O];x++}}H=l[G];for(F=O;F<G;F++){if(H[F-O]){y[u]=G;v[u]=F;h[u]=H[F-O];u++}}y[u]=G;v[u]=G;h[u]=1;u++}return{U:[C,z,n],L:[y,v,h]}};numeric.cLUsolve=function LUsolve(h,u){var s=h.L,f=h.U,r=numeric.clone(u);var y=s[0],x=s[1],o=s[2];var w=f[0],v=f[1],e=f[2];var c=w.length,a=y.length;var d=r.length,n,l,g;g=0;for(n=0;n<d;n++){while(x[g]<n){r[n]-=o[g]*r[x[g]];g++}g++}g=c-1;for(n=d-1;n>=0;n--){while(v[g]>n){r[n]-=e[g]*r[v[g]];g--}r[n]/=e[g];g--}return r};numeric.cgrid=function grid(f,a){if(typeof f==="number"){f=[f,f]}var c=numeric.rep(f,-1);var d,b,e;if(typeof a!=="function"){switch(a){case"L":a=function(h,g){return(h>=f[0]/2||g<f[1]/2)};break;default:a=function(h,g){return true};break}}e=0;for(d=1;d<f[0]-1;d++){for(b=1;b<f[1]-1;b++){if(a(d,b)){c[d][b]=e;e++}}}return c};numeric.cdelsq=function delsq(r){var d=[[-1,0],[0,-1],[0,1],[1,0]];var w=numeric.dim(r),e=w[0],c=w[1],o,h,f,b,a;var v=[],u=[],l=[];for(o=1;o<e-1;o++){for(h=1;h<c-1;h++){if(r[o][h]<0){continue}for(f=0;f<4;f++){b=o+d[f][0];a=h+d[f][1];if(r[b][a]<0){continue}v.push(r[o][h]);u.push(r[b][a]);l.push(-1)}v.push(r[o][h]);u.push(r[o][h]);l.push(4)}}return[v,u,l]};numeric.cdotMV=function dotMV(b,h){var f,i=b[0],g=b[1],c=b[2],d,a=i.length,e;e=0;for(d=0;d<a;d++){if(i[d]>e){e=i[d]}}e++;f=numeric.rep([e],0);for(d=0;d<a;d++){f[i[d]]+=c[d]*h[g[d]]}return f};numeric.Spline=function Spline(b,c,e,d,a){this.x=b;this.yl=c;this.yr=e;this.kl=d;this.kr=a};numeric.Spline.prototype._at=function _at(f,e){var k=this.x;var g=this.yl;var o=this.yr;var d=this.kl;var l=this.kr;var f,j,i,n;var m=numeric.add,c=numeric.sub,h=numeric.mul;j=c(h(d[e],k[e+1]-k[e]),c(o[e+1],g[e]));i=m(h(l[e+1],k[e]-k[e+1]),c(o[e+1],g[e]));n=(f-k[e])/(k[e+1]-k[e]);var q=n*(1-n);return m(m(m(h(1-n,g[e]),h(n,o[e+1])),h(j,q*(1-n))),h(i,q*n))};numeric.Spline.prototype.at=function at(e){if(typeof e==="number"){var m=this.x;var f=m.length;var d,c,o,h=Math.floor,l,k,r;d=0;c=f-1;while(c-d>1){o=h((d+c)/2);if(m[o]<=e){d=o}else{c=o}}return this._at(e,d)}var f=e.length,g,j=Array(f);for(g=f-1;g!==-1;--g){j[g]=this.at(e[g])}return j};numeric.Spline.prototype.diff=function diff(){var l=this.x;var f=this.yl;var r=this.yr;var d=this.kl;var m=this.kr;var e=f.length;var j,s,q;var o=d,k=m,h=Array(e),c=Array(e);var p=numeric.add,g=numeric.mul,b=numeric.div,a=numeric.sub;for(j=e-1;j!==-1;--j){s=l[j+1]-l[j];q=a(r[j+1],f[j]);h[j]=b(p(g(q,6),g(d[j],-4*s),g(m[j+1],-2*s)),s*s);c[j+1]=b(p(g(q,-6),g(d[j],2*s),g(m[j+1],4*s)),s*s)}return new numeric.Spline(l,o,k,h,c)};numeric.Spline.prototype.roots=function roots(){function C(i){return i*i}function u(D,n,m,k,y){var j=m*2-(n-D);var i=-k*2+(n-D);var aa=(y+1)*0.5;var ab=aa*(1-aa);return(1-aa)*D+aa*n+j*ab*(1-aa)+i*ab*aa}var E=[];var M=this.x,p=this.yl,h=this.yr,X=this.kl,S=this.kr;if(typeof p[0]==="number"){p=[p];h=[h];X=[X];S=[S]}var Q=p.length,P=M.length-1,V,U,R,L,O,N;var d,W,z,e,E=Array(Q),J,w,v,a,Z,l,g,f,c,q,r,I,H,b,G,F,Y;var K=Math.sqrt;for(V=0;V!==Q;++V){d=p[V];W=h[V];z=X[V];e=S[V];J=[];for(U=0;U!==P;U++){if(U>0&&W[U]*d[U]<0){J.push(M[U])}c=(M[U+1]-M[U]);q=M[U];a=d[U];Z=W[U+1];w=z[U]/c;v=e[U+1]/c;f=C(w-v+3*(a-Z))+12*v*a;l=v+3*a+2*w-3*Z;g=3*(v+w+2*(a-Z));if(f<=0){I=l/g;if(I>M[U]&&I<M[U+1]){r=[M[U],I,M[U+1]]}else{r=[M[U],M[U+1]]}}else{I=(l-K(f))/g;H=(l+K(f))/g;r=[M[U]];if(I>M[U]&&I<M[U+1]){r.push(I)}if(H>M[U]&&H<M[U+1]){r.push(H)}r.push(M[U+1])}G=r[0];I=this._at(G,U);for(R=0;R<r.length-1;R++){F=r[R+1];H=this._at(F,U);if(I===0){J.push(G);G=F;I=H;continue}if(H===0||I*H>0){G=F;I=H;continue}var o=0;while(1){Y=(I*F-H*G)/(I-H);if(Y<=G||Y>=F){break}b=this._at(Y,U);if(b*H>0){F=Y;H=b;if(o===-1){I*=0.5}o=-1}else{if(b*I>0){G=Y;I=b;if(o===1){H*=0.5}o=1}else{break}}}J.push(Y);G=r[R+1];I=this._at(G,U)}if(H===0){J.push(F)}}E[V]=J}if(typeof this.yl[0]==="number"){return E[0]}return E};numeric.spline=function spline(m,j,h,q){var c=m.length,l=[],r=[],p=[];var g;var a=numeric.sub,d=numeric.mul,o=numeric.add;for(g=c-2;g>=0;g--){r[g]=m[g+1]-m[g];p[g]=a(j[g+1],j[g])}if(typeof h==="string"||typeof q==="string"){h=q="periodic"}var f=[[],[],[]];switch(typeof h){case"undefined":l[0]=d(3/(r[0]*r[0]),p[0]);f[0].push(0,0);f[1].push(0,1);f[2].push(2/r[0],1/r[0]);break;case"string":l[0]=o(d(3/(r[c-2]*r[c-2]),p[c-2]),d(3/(r[0]*r[0]),p[0]));f[0].push(0,0,0);f[1].push(c-2,0,1);f[2].push(1/r[c-2],2/r[c-2]+2/r[0],1/r[0]);break;default:l[0]=h;f[0].push(0);f[1].push(0);f[2].push(1);break}for(g=1;g<c-1;g++){l[g]=o(d(3/(r[g-1]*r[g-1]),p[g-1]),d(3/(r[g]*r[g]),p[g]));f[0].push(g,g,g);f[1].push(g-1,g,g+1);f[2].push(1/r[g-1],2/r[g-1]+2/r[g],1/r[g])}switch(typeof q){case"undefined":l[c-1]=d(3/(r[c-2]*r[c-2]),p[c-2]);f[0].push(c-1,c-1);f[1].push(c-2,c-1);f[2].push(1/r[c-2],2/r[c-2]);break;case"string":f[1][f[1].length-1]=0;break;default:l[c-1]=q;f[0].push(c-1);f[1].push(c-1);f[2].push(1);break}if(typeof l[0]!=="number"){l=numeric.transpose(l)}else{l=[l]}var e=Array(l.length);if(typeof h==="string"){for(g=e.length-1;g!==-1;--g){e[g]=numeric.ccsLUPSolve(numeric.ccsLUP(numeric.ccsScatter(f)),l[g]);e[g][c-1]=e[g][0]}}else{for(g=e.length-1;g!==-1;--g){e[g]=numeric.cLUsolve(numeric.cLU(f),l[g])}}if(typeof j[0]==="number"){e=e[0]}else{e=numeric.transpose(e)}return new numeric.Spline(m,j,j,e,e)};numeric.fftpow2=function fftpow2(o,m){var b=o.length;if(b===1){return}var q=Math.cos,l=Math.sin,g,d;var p=Array(b/2),h=Array(b/2),f=Array(b/2),a=Array(b/2);d=b/2;for(g=b-1;g!==-1;--g){--d;f[d]=o[g];a[d]=m[g];--g;p[d]=o[g];h[d]=m[g]}fftpow2(p,h);fftpow2(f,a);d=b/2;var r,c=(-6.283185307179586/b),s,e;for(g=b-1;g!==-1;--g){--d;if(d===-1){d=b/2-1}r=c*g;s=q(r);e=l(r);o[g]=p[d]+s*f[d]-e*a[d];m[g]=h[d]+s*a[d]+e*f[d]}};numeric._ifftpow2=function _ifftpow2(o,m){var b=o.length;if(b===1){return}var q=Math.cos,l=Math.sin,g,d;var p=Array(b/2),h=Array(b/2),f=Array(b/2),a=Array(b/2);d=b/2;for(g=b-1;g!==-1;--g){--d;f[d]=o[g];a[d]=m[g];--g;p[d]=o[g];h[d]=m[g]}_ifftpow2(p,h);_ifftpow2(f,a);d=b/2;var r,c=(6.283185307179586/b),s,e;for(g=b-1;g!==-1;--g){--d;if(d===-1){d=b/2-1}r=c*g;s=q(r);e=l(r);o[g]=p[d]+s*f[d]-e*a[d];m[g]=h[d]+s*a[d]+e*f[d]}};numeric.ifftpow2=function ifftpow2(a,b){numeric._ifftpow2(a,b);numeric.diveq(a,a.length);numeric.diveq(b,b.length)};numeric.convpow2=function convpow2(a,j,g,f){numeric.fftpow2(a,j);numeric.fftpow2(g,f);var d,b=a.length,h,k,c,e;for(d=b-1;d!==-1;--d){h=a[d];c=j[d];k=g[d];e=f[d];a[d]=h*k-c*e;j[d]=h*e+c*k}numeric.ifftpow2(a,j)};numeric.T.prototype.fft=function fft(){var o=this.x,l=this.y;var v=o.length,j=Math.log,q=j(2),u=Math.ceil(j(2*v-1)/q),w=Math.pow(2,u);var i=numeric.rep([w],0),h=numeric.rep([w],0),f=Math.cos,d=Math.sin;var z,A=(-3.141592653589793/v),r;var C=numeric.rep([w],0),B=numeric.rep([w],0),s=Math.floor(v/2);for(z=0;z<v;z++){C[z]=o[z]}if(typeof l!=="undefined"){for(z=0;z<v;z++){B[z]=l[z]}}i[0]=1;for(z=1;z<=w/2;z++){r=A*z*z;i[z]=f(r);h[z]=d(r);i[w-z]=f(r);h[w-z]=d(r)}var g=new numeric.T(C,B),e=new numeric.T(i,h);g=g.mul(e);numeric.convpow2(g.x,g.y,numeric.clone(e.x),numeric.neg(e.y));g=g.mul(e);g.x.length=v;g.y.length=v;return g};numeric.T.prototype.ifft=function ifft(){var o=this.x,l=this.y;var v=o.length,j=Math.log,q=j(2),u=Math.ceil(j(2*v-1)/q),w=Math.pow(2,u);var i=numeric.rep([w],0),h=numeric.rep([w],0),f=Math.cos,d=Math.sin;var z,A=(3.141592653589793/v),r;var C=numeric.rep([w],0),B=numeric.rep([w],0),s=Math.floor(v/2);for(z=0;z<v;z++){C[z]=o[z]}if(typeof l!=="undefined"){for(z=0;z<v;z++){B[z]=l[z]}}i[0]=1;for(z=1;z<=w/2;z++){r=A*z*z;i[z]=f(r);h[z]=d(r);i[w-z]=f(r);h[w-z]=d(r)}var g=new numeric.T(C,B),e=new numeric.T(i,h);g=g.mul(e);numeric.convpow2(g.x,g.y,numeric.clone(e.x),numeric.neg(e.y));g=g.mul(e);g.x.length=v;g.y.length=v;return g.div(v)};numeric.gradient=function gradient(A,k){var r=k.length;var u=A(k);if(isNaN(u)){throw new Error("gradient: f(x) is a NaN!")}var w=Math.max;var y,B=numeric.clone(k),s,q,g=Array(r);var o=numeric.div,d=numeric.sub,a,C,w=Math.max,m=0.001,p=Math.abs,v=Math.min;var l,j,e,b=0,E,D,c;for(y=0;y<r;y++){var z=w(0.000001*u,1e-8);while(1){++b;if(b>20){throw new Error("Numerical gradient fails")}B[y]=k[y]+z;s=A(B);B[y]=k[y]-z;q=A(B);B[y]=k[y];if(isNaN(s)||isNaN(q)){z/=16;continue}g[y]=(s-q)/(2*z);l=k[y]-z;j=k[y];e=k[y]+z;E=(s-u)/z;D=(u-q)/z;c=w(p(g[y]),p(u),p(s),p(q),p(l),p(j),p(e),1e-8);a=v(w(p(E-g[y]),p(D-g[y]),p(E-D))/c,z/c);if(a>m){z/=16}else{break}}}return g};numeric.uncmin=function uncmin(U,p,g,q,D,K,z){var r=numeric.gradient;if(typeof z==="undefined"){z={}}if(typeof g==="undefined"){g=1e-8}if(typeof q==="undefined"){q=function(f){return r(U,f)}}if(typeof D==="undefined"){D=1000}p=numeric.clone(p);var O=p.length;var e=U(p),d,G;if(isNaN(e)){throw new Error("uncmin: f(x0) is a NaN!")}var w=Math.max,c=numeric.norm2;g=w(g,numeric.epsilon);var H,Q,P,W=z.Hinv||numeric.identity(O);var V=numeric.dot,I=numeric.inv,x=numeric.sub,b=numeric.add,v=numeric.tensor,S=numeric.div,a=numeric.mul;var u=numeric.all,A=numeric.isFinite,h=numeric.neg;var B=0,R,N,o,J,k,l,m,j,M,C,F,E;var L="";Q=q(p);while(B<D){if(typeof K==="function"){if(K(B,p,e,Q,W)){L="Callback returned true";break}}if(!u(A(Q))){L="Gradient has Infinity or NaN";break}H=h(V(W,Q));if(!u(A(H))){L="Search direction has Infinity or NaN";break}C=c(H);if(C<g){L="Newton step smaller than tol";break}M=1;G=V(Q,H);o=p;while(B<D){if(M*C<g){break}N=a(H,M);o=b(p,N);d=U(o);if(d-e>=0.1*M*G||isNaN(d)){M*=0.5;++B;continue}break}if(M*C<g){L="Line search step size smaller than tol";break}if(B===D){L="maxit reached during line search";break}P=q(o);J=x(P,Q);m=V(J,N);k=V(W,J);W=x(b(W,a((m+V(J,k))/(m*m),v(N,N))),S(b(v(k,N),v(N,k)),m));p=o;e=d;Q=P;++B}return{solution:p,f:e,gradient:Q,invHessian:W,iterations:B,message:L}};numeric.Dopri=function Dopri(a,h,e,b,d,g,c){this.x=a;this.y=h;this.f=e;this.ymid=b;this.iterations=d;this.events=c;this.message=g};numeric.Dopri.prototype._at=function _at(o,x){function s(c){return c*c}var a=this;var g=a.x;var v=a.y;var f=a.f;var E=a.ymid;var u=g.length;var C,A,r,d,b,F,o;var y=Math.floor,z;var D=0.5;var k=numeric.add,B=numeric.mul,e=numeric.sub,m,l,i;C=g[x];A=g[x+1];d=v[x];b=v[x+1];z=A-C;r=C+D*z;F=E[x];m=e(f[x],B(d,1/(C-r)+2/(C-A)));l=e(f[x+1],B(b,1/(A-r)+2/(A-C)));i=[s(o-A)*(o-r)/s(C-A)/(C-r),s(o-C)*s(o-A)/s(C-r)/s(A-r),s(o-C)*(o-r)/s(A-C)/(A-r),(o-C)*s(o-A)*(o-r)/s(C-A)/(C-r),(o-A)*s(o-C)*(o-r)/s(C-A)/(A-r)];return k(k(k(k(B(d,i[0]),B(F,i[1])),B(b,i[2])),B(m,i[3])),B(l,i[4]))};numeric.Dopri.prototype.at=function at(a){var f,d,b,g=Math.floor;if(typeof a!=="number"){var h=a.length,c=Array(h);for(f=h-1;f!==-1;--f){c[f]=this.at(a[f])}return c}var e=this.x;f=0;d=e.length-1;while(d-f>1){b=g(0.5*(f+d));if(e[b]<=a){f=b}else{d=b}}return this._at(a,f)};numeric.dopri=function dopri(w,u,a,ah,l,Q,ao){if(typeof l==="undefined"){l=0.000001}if(typeof Q==="undefined"){Q=1000}var S=[w],s=[a],N=[ah(w,a)],M,K,J,G,D,C,X=[];var q=1/5;var p=[3/40,9/40];var o=[44/45,-56/15,32/9];var n=[19372/6561,-25360/2187,64448/6561,-212/729];var m=[9017/3168,-355/33,46732/5247,49/176,-5103/18656];var an=[35/384,0,500/1113,125/192,-2187/6784,11/84];var ac=[0.5*6025192743/30085553152,0,0.5*51252292925/65400821598,0.5*-2691868925/45128329728,0.5*187940372067/1594534317056,0.5*-1776094331/19743644256,0.5*11237099/235043384];var al=[1/5,3/10,4/5,8/9,1,1];var aj=[-71/57600,0,71/16695,-71/1920,17253/339200,-22/525,1/40];var af=0,ab,ae;var ag=(u-w)/10;var E=0;var k=numeric.add,g=numeric.mul,ap,d;var z=Math.max,ak=Math.min,O=Math.abs,am=numeric.norminf,L=Math.pow;var P=numeric.any,I=numeric.lt,aa=numeric.and,B=numeric.sub;var H,F,Z;var R=new numeric.Dopri(S,s,N,X,-1,"");if(typeof ao==="function"){H=ao(w,a)}while(w<u&&E<Q){++E;if(w+ag>u){ag=u-w}M=ah(w+al[0]*ag,k(a,g(q*ag,N[af])));K=ah(w+al[1]*ag,k(k(a,g(p[0]*ag,N[af])),g(p[1]*ag,M)));J=ah(w+al[2]*ag,k(k(k(a,g(o[0]*ag,N[af])),g(o[1]*ag,M)),g(o[2]*ag,K)));G=ah(w+al[3]*ag,k(k(k(k(a,g(n[0]*ag,N[af])),g(n[1]*ag,M)),g(n[2]*ag,K)),g(n[3]*ag,J)));D=ah(w+al[4]*ag,k(k(k(k(k(a,g(m[0]*ag,N[af])),g(m[1]*ag,M)),g(m[2]*ag,K)),g(m[3]*ag,J)),g(m[4]*ag,G)));ap=k(k(k(k(k(a,g(N[af],ag*an[0])),g(K,ag*an[2])),g(J,ag*an[3])),g(G,ag*an[4])),g(D,ag*an[5]));C=ah(w+ag,ap);ab=k(k(k(k(k(g(N[af],ag*aj[0]),g(K,ag*aj[2])),g(J,ag*aj[3])),g(G,ag*aj[4])),g(D,ag*aj[5])),g(C,ag*aj[6]));if(typeof ab==="number"){d=O(ab)}else{d=am(ab)}if(d>l){ag=0.2*ag*L(l/d,0.25);if(w+ag===w){R.msg="Step size became too small";break}continue}X[af]=k(k(k(k(k(k(a,g(N[af],ag*ac[0])),g(K,ag*ac[2])),g(J,ag*ac[3])),g(G,ag*ac[4])),g(D,ag*ac[5])),g(C,ag*ac[6]));++af;S[af]=w+ag;s[af]=ap;N[af]=C;if(typeof ao==="function"){var y,V=w,U=w+0.5*ag,W;F=ao(U,X[af-1]);Z=aa(I(H,0),I(0,F));if(!P(Z)){V=U;U=w+ag;H=F;F=ao(U,ap);Z=aa(I(H,0),I(0,F))}if(P(Z)){var Y,A,ad,ai;var x=0,v=1,r=1;while(1){if(typeof H==="number"){W=(r*F*V-v*H*U)/(r*F-v*H)}else{W=U;for(ae=H.length-1;ae!==-1;--ae){if(H[ae]<0&&F[ae]>0){W=ak(W,(r*F[ae]*V-v*H[ae]*U)/(r*F[ae]-v*H[ae]))}}}if(W<=V||W>=U){break}y=R._at(W,af-1);ai=ao(W,y);ad=aa(I(H,0),I(0,ai));if(P(ad)){U=W;F=ai;Z=ad;r=1;if(x===-1){v*=0.5}else{v=1}x=-1}else{V=W;H=ai;v=1;if(x===1){r*=0.5}else{r=1}x=1}}ap=R._at(0.5*(w+W),af-1);R.f[af]=ah(W,y);R.x[af]=W;R.y[af]=y;R.ymid[af-1]=ap;R.events=Z;R.iterations=E;return R}}w+=ag;a=ap;H=F;ag=ak(0.8*ag*L(l/d,0.25),4*ag)}R.iterations=E;return R};numeric.LU=function(a,g){g=g||false;var s=Math.abs;var f,e,d,r,c,p,l,q;var o;var b=a.length,m=b-1;var h=new Array(b);if(!g){a=numeric.clone(a)}for(d=0;d<b;++d){l=d;p=a[d];o=s(p[d]);for(e=d+1;e<b;++e){r=s(a[e][d]);if(o<r){o=r;l=e}}h[d]=l;if(l!=d){a[d]=a[l];a[l]=p;p=a[d]}c=p[d];for(f=d+1;f<b;++f){a[f][d]/=c}for(f=d+1;f<b;++f){q=a[f];for(e=d+1;e<m;++e){q[e]-=q[d]*p[e];++e;q[e]-=q[d]*p[e]}if(e===m){q[e]-=q[d]*p[e]}}}return{LU:a,P:h}};numeric.LUsolve=function LUsolve(g,m){var f,d;var p=g.LU;var a=p.length;var o=numeric.clone(m);var h=g.P;var l,c,k,e;for(f=a-1;f!==-1;--f){o[f]=m[f]}for(f=0;f<a;++f){l=h[f];if(h[f]!==f){e=o[f];o[f]=o[l];o[l]=e}c=p[f];for(d=0;d<f;++d){o[f]-=o[d]*c[d]}}for(f=a-1;f>=0;--f){c=p[f];for(d=f+1;d<a;++d){o[f]-=o[d]*c[d]}o[f]/=c[f]}return o};numeric.solve=function solve(c,a,d){return numeric.LUsolve(numeric.LU(c,d),a)};numeric.echelonize=function echelonize(d){var y=numeric.dim(d),f=y[0],e=y[1];var w=numeric.identity(f);var r=Array(f);var p,o,h,g,v,b,c,u;var x=Math.abs;var q=numeric.diveq;d=numeric.clone(d);for(p=0;p<f;++p){h=0;v=d[p];b=w[p];for(o=1;o<e;++o){if(x(v[h])<x(v[o])){h=o}}r[p]=h;q(b,v[h]);q(v,v[h]);for(o=0;o<f;++o){if(o!==p){c=d[o];u=c[h];for(g=e-1;g!==-1;--g){c[g]-=v[g]*u}c=w[o];for(g=f-1;g!==-1;--g){c[g]-=b[g]*u}}}}return{I:w,A:d,P:r}};numeric.__solveLP=function __solveLP(ao,C,ar,r,O,Y,P){var E=numeric.sum,o=numeric.log,f=numeric.mul,J=numeric.sub,au=numeric.dot,al=numeric.div,h=numeric.add;var af=ao.length,ae=ar.length,X;var K=false,S,u=0;var ag=1;var q,Q,aj=numeric.transpose(C),k=numeric.svd,I=numeric.transpose,D=numeric.leq,V=Math.sqrt,M=Math.abs;var L=numeric.muleq;var aq=numeric.norminf,N=numeric.any,ap=Math.min;var F=numeric.all,l=numeric.gt;var ac=Array(af),B=Array(ae),am=numeric.rep([ae],1),v;var a=numeric.solve,W=J(ar,au(C,Y)),ab;var G=au(ao,ao);var ak;for(ab=u;ab<O;++ab){var ai,ah,an;for(ai=ae-1;ai!==-1;--ai){B[ai]=al(C[ai],W[ai])}var w=I(B);for(ai=af-1;ai!==-1;--ai){ac[ai]=(E(w[ai]))}ag=0.25*M(G/au(ao,ac));var ad=100*V(G/au(ac,ac));if(!isFinite(ag)||ag>ad){ag=ad}ak=h(ao,f(ag,ac));v=au(w,B);for(ai=af-1;ai!==-1;--ai){v[ai][ai]+=1}an=a(v,al(ak,ag),true);var R=al(W,au(C,an));var Z=1;for(ai=ae-1;ai!==-1;--ai){if(R[ai]<0){Z=ap(Z,-0.999*R[ai])}}X=J(Y,f(an,Z));W=J(ar,au(C,X));if(!F(l(W,0))){return{solution:Y,message:"",iterations:ab}}Y=X;if(ag<r){return{solution:X,message:"",iterations:ab}}if(P){var aa=au(ao,ak),U=au(C,ak);K=true;for(ai=ae-1;ai!==-1;--ai){if(aa*U[ai]<0){K=false;break}}}else{if(Y[af-1]>=0){K=false}else{K=true}}if(K){return{solution:X,message:"Unbounded",iterations:ab}}}return{solution:Y,message:"maximum iteration count exceeded",iterations:ab}};numeric._solveLP=function _solveLP(C,p,D,r,g){var v=C.length,s=D.length,j;var d=numeric.sum,f=numeric.log,z=numeric.mul,h=numeric.sub,q=numeric.dot,l=numeric.div,o=numeric.add;var u=numeric.rep([v],0).concat([1]);var i=numeric.rep([s,1],-1);var a=numeric.blockMatrix([[p,i]]);var e=D;var j=numeric.rep([v],0).concat(Math.max(0,numeric.sup(numeric.neg(D)))+1);var w=numeric.__solveLP(u,a,e,r,g,j,false);var k=numeric.clone(w.solution);k.length=v;var B=numeric.inf(h(D,q(p,k)));if(B<0){return{solution:NaN,message:"Infeasible",iterations:w.iterations}}var E=numeric.__solveLP(C,p,D,r,g-w.iterations,k,true);E.iterations+=w.iterations;return E};numeric.solveLP=function solveLP(U,C,V,W,h,H,s){if(typeof s==="undefined"){s=1000}if(typeof H==="undefined"){H=numeric.epsilon}if(typeof W==="undefined"){return numeric._solveLP(U,C,V,H,s)}var L=W.length,K=W[0].length,F=C.length;var z=numeric.echelonize(W);var q=numeric.rep([K],0);var p=z.P;var l=[];var M;for(M=p.length-1;M!==-1;--M){q[p[M]]=1}for(M=K-1;M!==-1;--M){if(q[M]===0){l.push(M)}}var R=numeric.getRange;var w=numeric.linspace(0,L-1),u=numeric.linspace(0,F-1);var X=R(W,w,l),f=R(C,u,p),e=R(C,u,l),E=numeric.dot,r=numeric.sub;var d=E(f,z.I);var a=r(e,E(d,X)),k=r(V,E(d,h));var G=Array(p.length),D=Array(l.length);for(M=p.length-1;M!==-1;--M){G[M]=U[p[M]]}for(M=l.length-1;M!==-1;--M){D[M]=U[l[M]]}var y=r(D,E(G,E(z.I,X)));var j=numeric._solveLP(y,a,k,H,s);var N=j.solution;if(N!==N){return j}var O=E(z.I,r(h,E(X,N)));var v=Array(U.length);for(M=p.length-1;M!==-1;--M){v[p[M]]=O[M]}for(M=l.length-1;M!==-1;--M){v[l[M]]=N[M]}return{solution:v,message:j.message,iterations:j.iterations}};numeric.MPStoLP=function MPStoLP(a){if(a instanceof String){a.split("\n")}var d=0;var f=["Initial state","NAME","ROWS","COLUMNS","RHS","BOUNDS","ENDATA"];var x=a.length;var B,y,h,g=0,k={},F=[],o=0,s={},E=0;var G;var C=[],v=[],D=[];function e(b){throw new Error("MPStoLP: "+b+"\nLine "+B+": "+a[B]+"\nCurrent state: "+f[d]+"\n")}for(B=0;B<x;++B){h=a[B];var m=h.match(/\S*/g);var l=[];for(y=0;y<m.length;++y){if(m[y]!==""){l.push(m[y])}}if(l.length===0){continue}for(y=0;y<f.length;++y){if(h.substr(0,f[y].length)===f[y]){break}}if(y<f.length){d=y;if(y===1){G=l[1]}if(y===6){return{name:G,c:C,A:numeric.transpose(v),b:D,rows:k,vars:s}}continue}switch(d){case 0:case 1:e("Unexpected line");case 2:switch(l[0]){case"N":if(g===0){g=l[1]}else{e("Two or more N rows")}break;case"L":k[l[1]]=o;F[o]=1;D[o]=0;++o;break;case"G":k[l[1]]=o;F[o]=-1;D[o]=0;++o;break;case"E":k[l[1]]=o;F[o]=0;D[o]=0;++o;break;default:e("Parse error "+numeric.prettyPrint(l))}break;case 3:if(!s.hasOwnProperty(l[0])){s[l[0]]=E;C[E]=0;v[E]=numeric.rep([o],0);++E}var u=s[l[0]];for(y=1;y<l.length;y+=2){if(l[y]===g){C[u]=parseFloat(l[y+1]);continue}var r=k[l[y]];v[u][r]=(F[r]<0?-1:1)*parseFloat(l[y+1])}break;case 4:for(y=1;y<l.length;y+=2){D[k[l[y]]]=(F[k[l[y]]]<0?-1:1)*parseFloat(l[y+1])}break;case 5:break;case 6:e("Internal error")}}e("Reached end of file without ENDATA")};numeric.seedrandom={pow:Math.pow,random:Math.random};(function(i,j,c,h,l,f,b){j.seedrandom=function g(m,q){var o=[];var n;m=k(a(q?[m,i]:arguments.length?m:[new Date().getTime(),i,window],3),o);n=new e(o);k(n.S,i);j.random=function p(){var u=n.g(h);var s=b;var r=0;while(u<l){u=(u+r)*c;s*=c;r=n.g(1)}while(u>=f){u/=2;s/=2;r>>>=1}return(u+r)/s};return m};function e(r){var q,o,v=this,s=r.length;var p=0,n=v.i=v.j=v.m=0;v.S=[];v.c=[];if(!s){r=[s++]}while(p<c){v.S[p]=p++}for(p=0;p<c;p++){q=v.S[p];n=d(n+q+r[p%s]);o=v.S[n];v.S[p]=o;v.S[n]=q}v.g=function m(C){var A=v.S;var z=d(v.i+1);var y=A[z];var x=d(v.j+y);var w=A[x];A[z]=w;A[x]=y;var B=A[d(y+w)];while(--C){z=d(z+1);y=A[z];x=d(x+y);w=A[x];A[z]=w;A[x]=y;B=B*c+A[d(y+w)]}v.i=z;v.j=x;return B};v.g(c)}function a(p,q,m,r,n){m=[];n=typeof(p);if(q&&n=="object"){for(r in p){if(r.indexOf("S")<5){try{m.push(a(p[r],q-1))}catch(o){}}}}return(m.length?m:p+(n!="string"?"\0":""))}function k(m,o,p,n){m+="";p=0;for(n=0;n<m.length;n++){o[d(n)]=d((p^=o[d(n)]*19)+m.charCodeAt(n))}m="";for(n in o){m+=String.fromCharCode(o[n])}return m}function d(m){return m&(c-1)}b=j.pow(c,h);l=j.pow(2,l);f=l*2;k(j.random(),i)}([],numeric.seedrandom,256,6,52));(function(b){function h(j){if(typeof j!=="object"){return j}var k=[],l,m=j.length;for(l=0;l<m;l++){k[l+1]=h(j[l])}return k}function f(j){if(typeof j!=="object"){return j}var k=[],l,m=j.length;for(l=1;l<m;l++){k[l-1]=f(j[l])}return k}function g(m,l,u){var r,p,o,s,q;for(o=1;o<=u;o=o+1){m[o][o]=1/m[o][o];q=-m[o][o];for(r=1;r<o;r=r+1){m[r][o]=q*m[r][o]}s=o+1;if(u<s){break}for(p=s;p<=u;p=p+1){q=m[o][p];m[o][p]=0;for(r=1;r<=o;r=r+1){m[r][p]=m[r][p]+(q*m[r][o])}}}}function e(m,l,s,j){var q,o,r,p;for(o=1;o<=s;o=o+1){p=0;for(q=1;q<o;q=q+1){p=p+(m[q][o]*j[q])}j[o]=(j[o]-p)/m[o][o]}for(r=1;r<=s;r=r+1){o=s+1-r;j[o]=j[o]/m[o][o];p=-j[o];for(q=1;q<o;q=q+1){j[q]=j[q]+(p*m[q][o])}}}function c(u,r,l,m){var q,p,x,o,v,w;for(p=1;p<=l;p=p+1){m[1]=p;w=0;x=p-1;if(x<1){w=u[p][p]-w;if(w<=0){break}u[p][p]=Math.sqrt(w)}else{for(o=1;o<=x;o=o+1){v=u[o][p];for(q=1;q<o;q=q+1){v=v-(u[q][p]*u[q][o])}v=v/u[o][o];u[o][p]=v;w=w+v*v}w=u[p][p]-w;if(w<=0){break}u[p][p]=Math.sqrt(w)}m[1]=0}}function d(P,I,aa,ab,E,B,D,R,S,Z,y,G,J,N,W,k){var ag,af,ac,A,ai,M,C,ae,ak,Q,ah,U,Y,u,w,H,V,aj,F,v,ad,z,X,O,L,K,x;Y=Math.min(ab,Z);ac=2*ab+(Y*(Y+5))/2+2*Z+1;O=1e-60;do{O=O+O;L=1+0.1*O;K=1+0.2*O}while(L<=1||K<=1);for(ag=1;ag<=ab;ag=ag+1){W[ag]=I[ag]}for(ag=ab+1;ag<=ac;ag=ag+1){W[ag]=0}for(ag=1;ag<=Z;ag=ag+1){G[ag]=0}ai=[];if(k[1]===0){c(P,aa,ab,ai);if(ai[1]!==0){k[1]=2;return}e(P,aa,ab,I);g(P,aa,ab)}else{for(af=1;af<=ab;af=af+1){E[af]=0;for(ag=1;ag<=af;ag=ag+1){E[af]=E[af]+P[ag][af]*I[ag]}}for(af=1;af<=ab;af=af+1){I[af]=0;for(ag=af;ag<=ab;ag=ag+1){I[af]=I[af]+P[af][ag]*E[ag]}}}B[1]=0;for(af=1;af<=ab;af=af+1){E[af]=I[af];B[1]=B[1]+W[af]*E[af];W[af]=0;for(ag=af+1;ag<=ab;ag=ag+1){P[ag][af]=0}}B[1]=-B[1]/2;k[1]=0;C=ab;ae=C+ab;ah=ae+Y;ak=ah+Y+1;Q=ak+(Y*(Y+1))/2;u=Q+Z;for(ag=1;ag<=Z;ag=ag+1){H=0;for(af=1;af<=ab;af=af+1){H=H+D[af][ag]*D[af][ag]}W[u+ag]=Math.sqrt(H)}J=0;N[1]=0;N[2]=0;function m(){N[1]=N[1]+1;ac=Q;for(ag=1;ag<=Z;ag=ag+1){ac=ac+1;H=-R[ag];for(af=1;af<=ab;af=af+1){H=H+D[af][ag]*E[af]}if(Math.abs(H)<O){H=0}if(ag>y){W[ac]=H}else{W[ac]=-Math.abs(H);if(H>0){for(af=1;af<=ab;af=af+1){D[af][ag]=-D[af][ag]}R[ag]=-R[ag]}}}for(ag=1;ag<=J;ag=ag+1){W[Q+G[ag]]=0}U=0;w=0;for(ag=1;ag<=Z;ag=ag+1){if(W[Q+ag]<w*W[u+ag]){U=ag;w=W[Q+ag]/W[u+ag]}}if(U===0){return 999}return 0}function al(){for(ag=1;ag<=ab;ag=ag+1){H=0;for(af=1;af<=ab;af=af+1){H=H+P[af][ag]*D[af][U]}W[ag]=H}A=C;for(ag=1;ag<=ab;ag=ag+1){W[A+ag]=0}for(af=J+1;af<=ab;af=af+1){for(ag=1;ag<=ab;ag=ag+1){W[A+ag]=W[A+ag]+P[ag][af]*W[af]}}z=true;for(ag=J;ag>=1;ag=ag-1){H=W[ag];ac=ak+(ag*(ag+3))/2;A=ac-ag;for(af=ag+1;af<=J;af=af+1){H=H-W[ac]*W[ae+af];ac=ac+af}H=H/W[A];W[ae+ag]=H;if(G[ag]<y){break}if(H<0){break}z=false;M=ag}if(!z){V=W[ah+M]/W[ae+M];for(ag=1;ag<=J;ag=ag+1){if(G[ag]<y){break}if(W[ae+ag]<0){break}w=W[ah+ag]/W[ae+ag];if(w<V){V=w;M=ag}}}H=0;for(ag=C+1;ag<=C+ab;ag=ag+1){H=H+W[ag]*W[ag]}if(Math.abs(H)<=O){if(z){k[1]=1;return 999}else{for(ag=1;ag<=J;ag=ag+1){W[ah+ag]=W[ah+ag]-V*W[ae+ag]}W[ah+J+1]=W[ah+J+1]+V;return 700}}else{H=0;for(ag=1;ag<=ab;ag=ag+1){H=H+W[C+ag]*D[ag][U]}aj=-W[Q+U]/H;X=true;if(!z){if(V<aj){aj=V;X=false}}for(ag=1;ag<=ab;ag=ag+1){E[ag]=E[ag]+aj*W[C+ag];if(Math.abs(E[ag])<O){E[ag]=0}}B[1]=B[1]+aj*H*(aj/2+W[ah+J+1]);for(ag=1;ag<=J;ag=ag+1){W[ah+ag]=W[ah+ag]-aj*W[ae+ag]}W[ah+J+1]=W[ah+J+1]+aj;if(X){J=J+1;G[J]=U;ac=ak+((J-1)*J)/2+1;for(ag=1;ag<=J-1;ag=ag+1){W[ac]=W[ag];ac=ac+1}if(J===ab){W[ac]=W[ab]}else{for(ag=ab;ag>=J+1;ag=ag-1){if(W[ag]===0){break}F=Math.max(Math.abs(W[ag-1]),Math.abs(W[ag]));v=Math.min(Math.abs(W[ag-1]),Math.abs(W[ag]));if(W[ag-1]>=0){w=Math.abs(F*Math.sqrt(1+v*v/(F*F)))}else{w=-Math.abs(F*Math.sqrt(1+v*v/(F*F)))}F=W[ag-1]/w;v=W[ag]/w;if(F===1){break}if(F===0){W[ag-1]=v*w;for(af=1;af<=ab;af=af+1){w=P[af][ag-1];P[af][ag-1]=P[af][ag];P[af][ag]=w}}else{W[ag-1]=w;ad=v/(1+F);for(af=1;af<=ab;af=af+1){w=F*P[af][ag-1]+v*P[af][ag];P[af][ag]=ad*(P[af][ag-1]+w)-P[af][ag];P[af][ag-1]=w}}}W[ac]=W[J]}}else{H=-R[U];for(af=1;af<=ab;af=af+1){H=H+E[af]*D[af][U]}if(U>y){W[Q+U]=H}else{W[Q+U]=-Math.abs(H);if(H>0){for(af=1;af<=ab;af=af+1){D[af][U]=-D[af][U]}R[U]=-R[U]}}return 700}}return 0}function s(){ac=ak+(M*(M+1))/2+1;A=ac+M;if(W[A]===0){return 798}F=Math.max(Math.abs(W[A-1]),Math.abs(W[A]));v=Math.min(Math.abs(W[A-1]),Math.abs(W[A]));if(W[A-1]>=0){w=Math.abs(F*Math.sqrt(1+v*v/(F*F)))}else{w=-Math.abs(F*Math.sqrt(1+v*v/(F*F)))}F=W[A-1]/w;v=W[A]/w;if(F===1){return 798}if(F===0){for(ag=M+1;ag<=J;ag=ag+1){w=W[A-1];W[A-1]=W[A];W[A]=w;A=A+ag}for(ag=1;ag<=ab;ag=ag+1){w=P[ag][M];P[ag][M]=P[ag][M+1];P[ag][M+1]=w}}else{ad=v/(1+F);for(ag=M+1;ag<=J;ag=ag+1){w=F*W[A-1]+v*W[A];W[A]=ad*(W[A-1]+w)-W[A];W[A-1]=w;A=A+ag}for(ag=1;ag<=ab;ag=ag+1){w=F*P[ag][M]+v*P[ag][M+1];P[ag][M+1]=ad*(P[ag][M]+w)-P[ag][M+1];P[ag][M]=w}}return 0}function p(){A=ac-M;for(ag=1;ag<=M;ag=ag+1){W[A]=W[ac];ac=ac+1;A=A+1}W[ah+M]=W[ah+M+1];G[M]=G[M+1];M=M+1;if(M<J){return 797}return 0}function o(){W[ah+J]=W[ah+J+1];W[ah+J+1]=0;G[J]=0;J=J-1;N[2]=N[2]+1;return 0}x=0;while(true){x=m();if(x===999){return}while(true){x=al();if(x===0){break}if(x===999){return}if(x===700){if(M===J){o()}else{while(true){s();x=p();if(x!==797){break}}o()}}}}}function a(m,l,C,u,v,y){m=h(m);l=h(l);C=h(C);var s,p,k,B,j,A=[],o=[],w=[],z=[],x=[],D;v=v||0;y=y?h(y):[undefined,0];u=u?h(u):[];p=m.length-1;k=C[1].length-1;if(!u){for(s=1;s<=k;s=s+1){u[s]=0}}for(s=1;s<=k;s=s+1){o[s]=0}B=0;j=Math.min(p,k);for(s=1;s<=p;s=s+1){w[s]=0}A[1]=0;for(s=1;s<=(2*p+(j*(j+5))/2+2*k+1);s=s+1){z[s]=0}for(s=1;s<=2;s=s+1){x[s]=0}d(m,l,p,p,w,A,C,u,p,k,v,o,B,x,z,y);D="";if(y[1]===1){D="constraints are inconsistent, no solution!"}if(y[1]===2){D="matrix D in quadratic function is not positive definite!"}return{solution:f(w),value:f(A),unconstrained_solution:f(l),iterations:f(x),iact:f(o),message:D}}b.solveQP=a}(numeric));numeric.svd=function svd(E){var S;var a=numeric.epsilon;var N=1e-64/a;var Q=50;var U=0;var L=0;var K=0;var J=0;var H=0;var B=numeric.clone(E);var G=B.length;var F=B[0].length;if(G<F){throw"Need more rows than columns"}var R=new Array(F);var D=new Array(F);for(L=0;L<F;L++){R[L]=D[L]=0}var w=numeric.rep([F,F],0);function d(e,c){e=Math.abs(e);c=Math.abs(c);if(e>c){return e*Math.sqrt(1+(c*c/e/e))}else{if(c==0){return e}}return c*Math.sqrt(1+(e*e/c/c))}var P=0;var O=0;var M=0;var r=0;var p=0;var o=0;var C=0;for(L=0;L<F;L++){R[L]=O;C=0;H=L+1;for(K=L;K<G;K++){C+=(B[K][L]*B[K][L])}if(C<=N){O=0}else{P=B[L][L];O=Math.sqrt(C);if(P>=0){O=-O}M=P*O-C;B[L][L]=P-O;for(K=H;K<F;K++){C=0;for(J=L;J<G;J++){C+=B[J][L]*B[J][K]}P=C/M;for(J=L;J<G;J++){B[J][K]+=P*B[J][L]}}}D[L]=O;C=0;for(K=H;K<F;K++){C=C+B[L][K]*B[L][K]}if(C<=N){O=0}else{P=B[L][L+1];O=Math.sqrt(C);if(P>=0){O=-O}M=P*O-C;B[L][L+1]=P-O;for(K=H;K<F;K++){R[K]=B[L][K]/M}for(K=H;K<G;K++){C=0;for(J=H;J<F;J++){C+=(B[K][J]*B[L][J])}for(J=H;J<F;J++){B[K][J]+=C*R[J]}}}p=Math.abs(D[L])+Math.abs(R[L]);if(p>r){r=p}}for(L=F-1;L!=-1;L+=-1){if(O!=0){M=O*B[L][L+1];for(K=H;K<F;K++){w[K][L]=B[L][K]/M}for(K=H;K<F;K++){C=0;for(J=H;J<F;J++){C+=B[L][J]*w[J][K]}for(J=H;J<F;J++){w[J][K]+=(C*w[J][L])}}}for(K=H;K<F;K++){w[L][K]=0;w[K][L]=0}w[L][L]=1;O=R[L];H=L}for(L=F-1;L!=-1;L+=-1){H=L+1;O=D[L];for(K=H;K<F;K++){B[L][K]=0}if(O!=0){M=B[L][L]*O;for(K=H;K<F;K++){C=0;for(J=H;J<G;J++){C+=B[J][L]*B[J][K]}P=C/M;for(J=L;J<G;J++){B[J][K]+=P*B[J][L]}}for(K=L;K<G;K++){B[K][L]=B[K][L]/O}}else{for(K=L;K<G;K++){B[K][L]=0}}B[L][L]+=1}a=a*r;for(J=F-1;J!=-1;J+=-1){for(var b=0;b<Q;b++){var V=false;for(H=J;H!=-1;H+=-1){if(Math.abs(R[H])<=a){V=true;break}if(Math.abs(D[H-1])<=a){break}}if(!V){U=0;C=1;var I=H-1;for(L=H;L<J+1;L++){P=C*R[L];R[L]=U*R[L];if(Math.abs(P)<=a){break}O=D[L];M=d(P,O);D[L]=M;U=O/M;C=-P/M;for(K=0;K<G;K++){p=B[K][I];o=B[K][L];B[K][I]=p*U+(o*C);B[K][L]=-p*C+(o*U)}}}o=D[J];if(H==J){if(o<0){D[J]=-o;for(K=0;K<F;K++){w[K][J]=-w[K][J]}}break}if(b>=Q-1){throw"Error: no convergence."}r=D[H];p=D[J-1];O=R[J-1];M=R[J];P=((p-o)*(p+o)+(O-M)*(O+M))/(2*M*p);O=d(P,1);if(P<0){P=((r-o)*(r+o)+M*(p/(P-O)-M))/r}else{P=((r-o)*(r+o)+M*(p/(P+O)-M))/r}U=1;C=1;for(L=H+1;L<J+1;L++){O=R[L];p=D[L];M=C*O;O=U*O;o=d(P,M);R[L-1]=o;U=P/o;C=M/o;P=r*U+O*C;O=-r*C+O*U;M=p*C;p=p*U;for(K=0;K<F;K++){r=w[K][L-1];o=w[K][L];w[K][L-1]=r*U+o*C;w[K][L]=-r*C+o*U}o=d(P,M);D[L-1]=o;U=P/o;C=M/o;P=U*O+C*p;r=-C*O+U*p;for(K=0;K<G;K++){p=B[K][L-1];o=B[K][L];B[K][L-1]=p*U+o*C;B[K][L]=-p*C+o*U}}R[H]=0;R[J]=P;D[J]=r}}for(L=0;L<D.length;L++){if(D[L]<a){D[L]=0}}for(L=0;L<F;L++){for(K=L-1;K>=0;K--){if(D[K]<D[L]){U=D[K];D[K]=D[L];D[L]=U;for(J=0;J<B.length;J++){S=B[J][L];B[J][L]=B[J][K];B[J][K]=S}for(J=0;J<w.length;J++){S=w[J][L];w[J][L]=w[J][K];w[J][K]=S}L=K}}}return{U:B,S:D,V:w}};"use strict";var BROWSER_MIN_FIREFOX=7;var BROWSER_MIN_CHROME=7;var BROWSER_MIN_SAFARI=6;var BROWSER_MIN_IE=10;var BROWSER_MIN_OPERA=12;var console=console||{};console.log=console.log||function(){};console.warn=console.warn||function(){};console.error=console.error||function(){};console.info=console.info||function(){};var OSName="Unknown OS";if(navigator.appVersion.indexOf("Win")!==-1){OSName="Windows"}if(navigator.appVersion.indexOf("Mac")!==-1){OSName="MacOS"}if(navigator.appVersion.indexOf("X11")!==-1){OSName="Linux"}if(navigator.appVersion.indexOf("Linux")!==-1){OSName="Linux"}function checkForBrowserCompatibility(){if(BrowserDetect.browser==="Firefox"){if(BrowserDetect.version<BROWSER_MIN_FIREFOX){return("Papaya requires Firefox version "+BROWSER_MIN_FIREFOX+" or higher.")}}else{if(BrowserDetect.browser==="Chrome"){if(BrowserDetect.version<BROWSER_MIN_CHROME){return("Papaya requires Chrome version "+BROWSER_MIN_CHROME+" or higher.")}}else{if(BrowserDetect.browser==="Explorer"){if(BrowserDetect.version<BROWSER_MIN_IE){return("Papaya requires Internet Explorer version "+BROWSER_MIN_IE+" or higher.")}}else{if(BrowserDetect.browser==="Safari"){if(BrowserDetect.version<BROWSER_MIN_SAFARI){return("Papaya requires Safari version "+BROWSER_MIN_SAFARI+" or higher.")}}else{if(BrowserDetect.browser==="Opera"){if(BrowserDetect.version<BROWSER_MIN_OPERA){return("Papaya requires Opera version "+BROWSER_MIN_OPERA+" or higher.")}}}}}}return null}function getKeyCode(a){return(a.keyCode||a.charCode)}function getMousePositionX(a){var b;if(a.targetTouches){if(a.targetTouches.length===1){b=a.targetTouches[0];if(b){return b.pageX}}}else{if(a.changedTouches){if(a.changedTouches.length===1){b=a.changedTouches[0];if(b){return b.pageX}}}}return a.pageX}function getMousePositionY(a){var b;if(a.targetTouches){if(a.targetTouches.length===1){b=a.targetTouches[0];if(b){return b.pageY}}}else{if(a.changedTouches){if(a.changedTouches.length===1){b=a.changedTouches[0];if(b){return b.pageY}}}}return a.pageY}var makeSlice=function(b,d,c){var a=(typeof File);if(a==="undefined"){return function(){}}if(File.prototype.slice){return b.slice(d,d+c)}if(File.prototype.mozSlice){return b.mozSlice(d,c)}if(File.prototype.webkitSlice){return b.webkitSlice(d,c)}return null};function isPlatformLittleEndian(){var a=new ArrayBuffer(2);new DataView(a).setInt16(0,256,true);return new Int16Array(a)[0]===256}"use strict";function bind(d,c,b,a){if(arguments.length===2){return function(){return c.apply(d,arguments)}}var f=c,e=Array.prototype.slice;return function(){var g=b||arguments;if(a===true){g=e.call(arguments,0);g=g.concat(b)}else{if(typeof a==="number"){g=e.call(arguments,0);Ext.Array.insert(g,a,b)}}return f.apply(d||window,g)}}function round(a){return(0.5+a)|0}function floor(a){return a|0}function isString(a){return(typeof a==="string"||a instanceof String)}function isStringBlank(a){return($.trim(a).length===0)}function signum(a){return a?a<0?-1:1:0}Array.prototype.clone=function(){var a,b;a=this.slice(0);for(b=0;b<this.length;b+=1){if(this[b].clone){a[b]=this[b].clone()}}return a};if(typeof String.prototype.startsWith!=="function"){String.prototype.startsWith=function(a){return this.indexOf(a)===0}}var showMenu=function(f,b,a,i){var c,h,j,e,d,g;c=$(f.canvas).offset();h=$(b).offset();j=$(b).outerWidth();e=$(a).outerWidth();d=h.left+(i?((-1*e)+j):5)+"px";g=(c.top)+"px";$(a).css({position:"absolute",zIndex:100,left:d,top:g});$(a).hide().fadeIn(200)};var showModalDialog=function(e,g){var c,a,f,d,i,b,h;c=$(e.canvas).offset();a=$(e.canvas).outerWidth();f=$(e.canvas).outerHeight();d=$(g).outerWidth();i=$(g).outerHeight();b=c.left+(a/2)-(d/2)+"px";h=c.top+(f/2)-(i/2)+"px";$(g).css({position:"absolute",zIndex:100,left:b,top:h});$(g).hide().fadeIn(200)};function isControlKey(a){var b=getKeyCode(a);if((OSName==="MacOS")&&((b===91)||(b===93)||(b===224))){return true}return((OSName!=="MacOS")&&(b===17))}function fullyQualifiedVariableExists(b){var c,a;c=window[b[0]];for(a=1;a<b.length;a+=1){if(c===undefined){return false}c=c[b[a]]}return(!(c===undefined)&&!(c===null))}function createCookie(c,d,e){var b,a;if(e){b=new Date();b.setTime(b.getTime()+(e*24*60*60*1000));a="; expires="+b.toGMTString()}else{a=""}document.cookie=c+"="+d+a+"; path=/"}function readCookie(b){var e,a,d,f;e=b+"=";a=document.cookie.split(";");for(d=0;d<a.length;d+=1){f=a[d];while(f.charAt(0)===" "){f=f.substring(1,f.length)}if(f.indexOf(e)===0){return f.substring(e.length,f.length)}}return null}function formatNumber(b,a){var c=0;if(isString(b)){c=parseFloat(b)}else{c=b}if(a){c=c.toPrecision(5)}else{c=c.toPrecision(7)}return parseFloat(c)}function getSizeString(b){var a=null;if(b>1048576){a=formatNumber(b/1048576,true)+" Mb"}else{if(b>1024){a=formatNumber(b/1024,true)+" Kb"}else{a=b+" Bytes"}}return a}function wordwrap(e,b,a,d){a=a||"\n";b=b||75;d=d||false;if(!e){return e}var c=".{1,"+b+"}(\\s|$)"+(d?"|.{"+b+"}|.+$":"|\\S+?(\\s|$)");return e.match(new RegExp(c,"g")).join(a)}function getQueryParams(d){var c,a,b=/[?&]?([^=]+)=([^&]*)/g;if(document.location.href.indexOf("?")!==-1){a=document.location.href.substring(document.location.href.indexOf("?")+1);a=a.split("+").join(" ");while(c=b.exec(a)){d[decodeURIComponent(c[1])]=decodeURIComponent(c[2])}}}function deref(a){var b,c;if(!isString(a)){return null}c=a.replace(/(^[' "]+|[" ']+$)/g,"").match(/(^[\w\$]+(\.[\w\$]+)*)/);if(c){c=c[1].split(".");b=window[c.shift()];while(b&&c.length){b=b[c.shift()]}}return b||null}"use strict";var papaya=papaya||{};papaya.core=papaya.core||{};papaya.core.Coordinate=papaya.core.Coordinate||function(c,b,a){this.x=c;this.y=b;this.z=a};papaya.core.Coordinate.prototype.setCoordinate=function(d,c,b,a){if(a){this.x=Math.round(d);this.y=Math.round(c);this.z=Math.round(b)}else{this.x=d;this.y=c;this.z=b}};papaya.core.Coordinate.prototype.isAllZeros=function(){return((this.x===0)&&(this.y===0)&&(this.z===0))};"use strict";var papaya=papaya||{};papaya.core=papaya.core||{};papaya.core.Dimensions=papaya.core.Dimensions||function(b,a){this.width=b;this.height=a;this.widthPadding=0;this.heightPadding=0};"use strict";var papaya=papaya||{};papaya.core=papaya.core||{};papaya.core.Point=papaya.core.Point||function(b,a){this.x=b;this.y=a};"use strict";var papaya=papaya||{};papaya.volume=papaya.volume||{};papaya.volume.Header=papaya.volume.Header||function(){this.fileFormat=null;this.imageDimensions=null;this.voxelDimensions=null;this.imageDescription=null;this.imageType=null;this.orientation=null;this.imageRange=null;this.errorMessage=null;this.origin=null;this.orientationCertainty=papaya.volume.Header.ORIENTATION_CERTAINTY_UNKNOWN};papaya.volume.Header.ERROR_UNRECOGNIZED_FORMAT="This format is not recognized!";papaya.volume.Header.INVALID_IMAGE_DIMENSIONS="Image dimensions are not valid!";papaya.volume.Header.INVALID_VOXEL_DIMENSIONS="Voxel dimensions are not valid!";papaya.volume.Header.INVALID_DATATYPE="Datatype is not valid or not supported!";papaya.volume.Header.INVALID_IMAGE_RANGE="Image range is not valid!";papaya.volume.Header.ORIENTATION_CERTAINTY_UNKNOWN=0;papaya.volume.Header.ORIENTATION_CERTAINTY_LOW=1;papaya.volume.Header.ORIENTATION_CERTAINTY_HIGH=2;papaya.volume.Header.prototype.readData=function(a,c,b){if(a===papaya.volume.Volume.TYPE_NIFTI){this.fileFormat=new papaya.volume.nifti.HeaderNIFTI();this.fileFormat.readData(c,b);if(this.fileFormat.hasError()){this.errorMessage=this.fileFormat.errorMessage}}else{this.errorMessage=papaya.volume.Header.ERROR_UNRECOGNIZED_FORMAT}if(!this.hasError()){this.imageDimensions=this.fileFormat.getImageDimensions();if(!this.imageDimensions.isValid()){this.errorMessage=papaya.volume.Header.INVALID_IMAGE_DIMENSIONS}this.voxelDimensions=this.fileFormat.getVoxelDimensions();if(!this.voxelDimensions.isValid()){this.errorMessage=papaya.volume.Header.INVALID_VOXEL_DIMENSIONS}this.imageType=this.fileFormat.getImageType();if(!this.imageType.isValid()){this.errorMessage=papaya.volume.Header.INVALID_DATATYPE}this.orientation=this.fileFormat.getOrientation();if(!this.orientation.isValid()){this.orientation=new papaya.volume.Orientation(papaya.volume.Orientation.DEFAULT);this.orientationCertainty=papaya.volume.Header.ORIENTATION_CERTAINTY_UNKNOWN}else{this.orientationCertainty=this.fileFormat.getOrientationCertainty()}this.orientation.createInfo(this.imageDimensions,this.voxelDimensions);this.origin=this.orientation.convertCoordinate(this.fileFormat.getOrigin(),new papaya.core.Coordinate(0,0,0));this.imageRange=this.fileFormat.getImageRange();if(!this.imageRange.isValid()){this.errorMessage=papaya.volume.Header.INVALID_IMAGE_RANGE}this.imageDescription=this.fileFormat.getImageDescription()}};papaya.volume.Header.prototype.hasError=function(){return(this.errorMessage!==null)};"use strict";var papaya=papaya||{};papaya.volume=papaya.volume||{};papaya.volume.ImageData=papaya.volume.ImageData||function(){this.data=null};papaya.volume.ImageData.prototype.readData=function(f,e,a){var d,b,c;if((f.imageType.datatype===papaya.volume.ImageType.DATATYPE_INTEGER_SIGNED)&&(f.imageType.numBytes===1)){this.data=new Int8Array(e,f.imageDimensions.offset,f.imageDimensions.getNumVoxelsVolume())}else{if((f.imageType.datatype===papaya.volume.ImageType.DATATYPE_INTEGER_UNSIGNED)&&(f.imageType.numBytes===1)){this.data=new Uint8Array(e,f.imageDimensions.offset,f.imageDimensions.getNumVoxelsVolume())}else{if((f.imageType.datatype===papaya.volume.ImageType.DATATYPE_INTEGER_SIGNED)&&(f.imageType.numBytes===2)){this.data=new Int16Array(e,f.imageDimensions.offset,f.imageDimensions.getNumVoxelsVolume())}else{if((f.imageType.datatype===papaya.volume.ImageType.DATATYPE_INTEGER_UNSIGNED)&&(f.imageType.numBytes===2)){this.data=new Uint16Array(e,f.imageDimensions.offset,f.imageDimensions.getNumVoxelsVolume())}else{if((f.imageType.datatype===papaya.volume.ImageType.DATATYPE_INTEGER_SIGNED)&&(f.imageType.numBytes===4)){this.data=new Int32Array(e,f.imageDimensions.offset,f.imageDimensions.getNumVoxelsVolume())}else{if((f.imageType.datatype===papaya.volume.ImageType.DATATYPE_INTEGER_UNSIGNED)&&(f.imageType.numBytes===4)){this.data=new Uint32Array(e,f.imageDimensions.offset,f.imageDimensions.getNumVoxelsVolume())}else{if((f.imageType.datatype===papaya.volume.ImageType.DATATYPE_FLOAT)&&(f.imageType.numBytes===4)){if(f.imageType.swapped){d=f.imageDimensions.getNumVoxelsVolume();b=new DataView(e,f.imageDimensions.offset);this.data=new Float32Array(d);for(c=0;c<d;c+=1){this.data[c]=b.getFloat32(c*Float32Array.BYTES_PER_ELEMENT)}}else{this.data=new Float32Array(e,f.imageDimensions.offset,f.imageDimensions.getNumVoxelsVolume())}}}}}}}}a()};"use strict";var papaya=papaya||{};papaya.volume=papaya.volume||{};papaya.volume.ImageDescription=papaya.volume.ImageDescription||function(a){this.notes="(none)";if(!isStringBlank(a)){this.notes=a}};"use strict";var papaya=papaya||{};papaya.volume=papaya.volume||{};papaya.volume.ImageDimensions=papaya.volume.ImageDimensions||function(c,a,d,b){this.cols=c;this.rows=a;this.slices=d;this.xDim=-1;this.yDim=-1;this.zDim=-1;this.timepoints=b;this.offset=0};papaya.volume.ImageDimensions.prototype.getNumVoxelsVolume=function(){return this.cols*this.rows*this.slices};papaya.volume.ImageDimensions.prototype.getNumVoxelsSlice=function(){return this.rows*this.cols};papaya.volume.ImageDimensions.prototype.isValid=function(){return((this.cols>0)&&(this.rows>0)&&(this.slices>0)&&(this.timepoints>0)&&(this.offset>=0))};"use strict";var papaya=papaya||{};papaya.volume=papaya.volume||{};papaya.volume.ImageRange=papaya.volume.ImageRange||function(b,a){this.displayMin=b;this.displayMax=a;this.imageMin=b;this.imageMax=a;this.globalScale=papaya.volume.ImageRange.DEFAULT_SCALE;this.globalIntercept=papaya.volume.ImageRange.DEFAULT_INTERCEPT};papaya.volume.ImageRange.DEFAULT_SCALE=1;papaya.volume.ImageRange.DEFAULT_INTERCEPT=0;papaya.volume.ImageRange.prototype.isValid=function(){return true};papaya.volume.ImageRange.prototype.setGlobalDataScale=function(b,a){this.globalScale=b;this.globalIntercept=a};"use strict";var papaya=papaya||{};papaya.volume=papaya.volume||{};papaya.volume.ImageType=papaya.volume.ImageType||function(c,a,d,b){this.datatype=c;this.numBytes=a;this.littleEndian=d;this.swapped=false;this.compressed=b};papaya.volume.ImageType.DATATYPE_UNKNOWN=0;papaya.volume.ImageType.DATATYPE_INTEGER_SIGNED=1;papaya.volume.ImageType.DATATYPE_INTEGER_UNSIGNED=2;papaya.volume.ImageType.DATATYPE_FLOAT=3;papaya.volume.ImageType.MAX_NUM_BYTES_SUPPORTED=4;papaya.volume.ImageType.prototype.isValid=function(){return((this.datatype<=papaya.volume.ImageType.DATATYPE_FLOAT)&&(this.datatype>papaya.volume.ImageType.DATATYPE_UNKNOWN)&&(this.numBytes>0)&&(this.numBytes<=papaya.volume.ImageType.MAX_NUM_BYTES_SUPPORTED))};papaya.volume.ImageType.prototype.getTypeDescription=function(){if(this.datatype===papaya.volume.ImageType.DATATYPE_INTEGER_SIGNED){return"Signed Integer"}if(this.datatype===papaya.volume.ImageType.DATATYPE_INTEGER_UNSIGNED){return"Unsigned Integer"}if(this.datatype===papaya.volume.ImageType.DATATYPE_FLOAT){return"Float"}return"Unknown"};papaya.volume.ImageType.prototype.getOrderDescription=function(){if(this.numBytes>1){if(this.littleEndian){return"Little Endian"}return"Big Endian"}return null};"use strict";var papaya=papaya||{};papaya.volume=papaya.volume||{};papaya.volume.Orientation=papaya.volume.Orientation||function(a){this.orientation=a;this.orientMat=null;this.xIncrement=-1;this.yIncrement=-1;this.zIncrement=-1};papaya.volume.Orientation.DEFAULT="XYZ+--";papaya.volume.Orientation.prototype.convertIndexToOffset=function(e,d,c){var b,a,f;b=round((e*this.orientMat[0][0])+(d*this.orientMat[0][1])+(c*this.orientMat[0][2])+(this.orientMat[0][3]));a=round((e*this.orientMat[1][0])+(d*this.orientMat[1][1])+(c*this.orientMat[1][2])+(this.orientMat[1][3]));f=round((e*this.orientMat[2][0])+(d*this.orientMat[2][1])+(c*this.orientMat[2][2])+(this.orientMat[2][3]));return(b*this.xIncrement)+(a*this.yIncrement)+(f*this.zIncrement)};papaya.volume.Orientation.prototype.convertCoordinate=function(b,a){a.x=round((b.x*this.orientMat[0][0])+(b.y*this.orientMat[0][1])+(b.z*this.orientMat[0][2])+(this.orientMat[0][3]));a.y=round((b.x*this.orientMat[1][0])+(b.y*this.orientMat[1][1])+(b.z*this.orientMat[1][2])+(this.orientMat[1][3]));a.z=round((b.x*this.orientMat[2][0])+(b.y*this.orientMat[2][1])+(b.z*this.orientMat[2][2])+(this.orientMat[2][3]));return a};papaya.volume.Orientation.prototype.createInfo=function(k,g){var n,e,m,r,l,q,i,b,p,h,d,j,o,c,a,f;h=k.cols;d=k.rows;j=k.slices;o=k.getNumVoxelsSlice();c=g.colSize;a=g.rowSize;f=g.sliceSize;i=(this.orientation.charAt(3)==="+");b=(this.orientation.charAt(4)==="+");p=(this.orientation.charAt(5)==="+");if(this.orientation.toUpperCase().indexOf("XYZ")!==-1){k.xDim=h;k.yDim=d;k.zDim=j;g.xSize=c;g.ySize=a;g.zSize=f;this.xIncrement=1;this.yIncrement=h;this.zIncrement=o;if(i){n=1;r=0}else{n=-1;r=h-1}if(b){e=-1;l=d-1}else{e=1;l=0}if(p){m=-1;q=j-1}else{m=1;q=0}}else{if(this.orientation.toUpperCase().indexOf("XZY")!==-1){k.xDim=h;k.yDim=j;k.zDim=d;g.xSize=c;g.ySize=f;g.zSize=a;this.xIncrement=1;this.yIncrement=o;this.zIncrement=h;if(i){n=1;r=0}else{n=-1;r=h-1}if(b){m=-1;q=d-1}else{m=1;q=0}if(p){e=-1;l=j-1}else{e=1;l=0}}else{if(this.orientation.toUpperCase().indexOf("YXZ")!==-1){k.xDim=d;k.yDim=h;k.zDim=j;g.xSize=a;g.ySize=c;g.zSize=f;this.xIncrement=h;this.yIncrement=1;this.zIncrement=o;if(i){e=-1;l=h-1}else{e=1;l=0}if(b){n=1;r=0}else{n=-1;r=d-1}if(p){m=-1;q=j-1}else{m=1;q=0}}else{if(this.orientation.toUpperCase().indexOf("YZX")!==-1){k.xDim=j;k.yDim=h;k.zDim=d;g.xSize=f;g.ySize=c;g.zSize=a;this.xIncrement=o;this.yIncrement=1;this.zIncrement=h;if(i){e=-1;l=h-1}else{e=1;l=0}if(b){m=-1;q=d-1}else{m=1;q=0}if(p){n=1;r=0}else{n=-1;r=j-1}}else{if(this.orientation.toUpperCase().indexOf("ZXY")!==-1){k.xDim=d;k.yDim=j;k.zDim=h;g.xSize=a;g.ySize=f;g.zSize=c;this.xIncrement=h;this.yIncrement=o;this.zIncrement=1;if(i){m=-1;q=h-1}else{m=1;q=0}if(b){n=1;r=0}else{n=-1;r=d-1}if(p){e=-1;l=j-1}else{e=1;l=0}}else{if(this.orientation.toUpperCase().indexOf("ZYX")!==-1){k.xDim=j;k.yDim=d;k.zDim=h;g.xSize=f;g.ySize=a;g.zSize=c;this.xIncrement=o;this.yIncrement=h;this.zIncrement=1;if(i){m=-1;q=h-1}else{m=1;q=0}if(b){e=-1;l=d-1}else{e=1;l=0}if(p){n=1;r=0}else{n=-1;r=j-1}}}}}}}this.orientMat=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];this.orientMat[0][0]=n;this.orientMat[0][1]=0;this.orientMat[0][2]=0;this.orientMat[0][3]=r;this.orientMat[1][0]=0;this.orientMat[1][1]=e;this.orientMat[1][2]=0;this.orientMat[1][3]=l;this.orientMat[2][0]=0;this.orientMat[2][1]=0;this.orientMat[2][2]=m;this.orientMat[2][3]=q;this.orientMat[3][0]=0;this.orientMat[3][1]=0;this.orientMat[3][2]=0;this.orientMat[3][3]=1};papaya.volume.Orientation.prototype.isValid=function(){return papaya.volume.Orientation.prototype.isValidOrientationString(this.orientation)};papaya.volume.Orientation.prototype.isValidOrientationString=function(c){var a,b=true;if(c===null||(c.length!==6)){b=false}a=c.toUpperCase().indexOf("X");if(a===-1||a>2||(c.toUpperCase().lastIndexOf("X")!==a)){b=false}a=c.toUpperCase().indexOf("Y");if(a===-1||a>2||(c.toUpperCase().lastIndexOf("Y")!==a)){b=false}a=c.toUpperCase().indexOf("Z");if(a===-1||a>2||(c.toUpperCase().lastIndexOf("Z")!==a)){b=false}if((c.charAt(3)!=="+")&&(c.charAt(3)!=="-")){b=false}if((c.charAt(4)!=="+")&&(c.charAt(4)!=="-")){b=false}if((c.charAt(5)!=="+")&&(c.charAt(5)!=="-")){b=false}return b};papaya.volume.Orientation.prototype.getOrientationDescription=function(){var a=this.orientation;return("Cols ("+a.charAt(0)+a.charAt(3)+"), Rows ("+a.charAt(1)+a.charAt(4)+"), Slices ("+a.charAt(2)+a.charAt(5)+")")};"use strict";var papaya=papaya||{};papaya.volume=papaya.volume||{};papaya.volume.Transform=papaya.volume.Transform||function(a,b){this.voxelValue=new papaya.volume.VoxelValue(b.imageData,b.header.imageType,b.header.imageDimensions,b.header.imageRange,b.header.orientation);this.voxelDimensions=b.header.voxelDimensions;this.imageDimensions=b.header.imageDimensions;this.volume=b;this.mat=papaya.volume.Transform.IDENTITY.clone();this.indexMat=papaya.volume.Transform.IDENTITY.clone();this.sizeMat=papaya.volume.Transform.IDENTITY.clone();this.sizeMatInverse=papaya.volume.Transform.IDENTITY.clone();this.mmMat=papaya.volume.Transform.IDENTITY.clone();this.worldMat=papaya.volume.Transform.IDENTITY.clone();this.originMat=papaya.volume.Transform.IDENTITY.clone();this.tempMat=papaya.volume.Transform.IDENTITY.clone();this.orientMat=papaya.volume.Transform.IDENTITY.clone();this.updateTransforms(a)};papaya.volume.Transform.IDENTITY=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];papaya.volume.Transform.prototype.updateSizeMat=function(){this.sizeMat[0][0]=this.voxelDimensions.xSize;this.sizeMat[1][1]=this.voxelDimensions.ySize;this.sizeMat[2][2]=this.voxelDimensions.zSize;this.sizeMat[3][3]=1;this.sizeMatInverse[0][0]=1/this.voxelDimensions.xSize;this.sizeMatInverse[1][1]=1/this.voxelDimensions.ySize;this.sizeMatInverse[2][2]=1/this.voxelDimensions.zSize;this.sizeMatInverse[3][3]=1};papaya.volume.Transform.prototype.updateOrientMat=function(){};papaya.volume.Transform.prototype.updateIndexTransform=function(){var b,a;for(b=0;b<4;b+=1){for(a=0;a<4;a+=1){this.indexMat[b][a]=(this.orientMat[b][0]*this.mat[0][a])+(this.orientMat[b][1]*this.mat[1][a])+(this.orientMat[b][2]*this.mat[2][a])+(this.orientMat[b][3]*this.mat[3][a])}}};papaya.volume.Transform.prototype.updateMmTransform=function(){var b,a;for(b=0;b<4;b+=1){for(a=0;a<4;a+=1){this.mmMat[b][a]=(this.indexMat[b][0]*this.sizeMatInverse[0][a])+(this.indexMat[b][1]*this.sizeMatInverse[1][a])+(this.indexMat[b][2]*this.sizeMatInverse[2][a])+(this.indexMat[b][3]*this.sizeMatInverse[3][a])}}};papaya.volume.Transform.prototype.updateOriginMat=function(){this.originMat[0][0]=1;this.originMat[1][1]=-1;this.originMat[2][2]=-1;this.originMat[3][3]=1;this.originMat[0][3]=this.volume.header.origin.x;this.originMat[1][3]=this.volume.header.origin.y;this.originMat[2][3]=this.volume.header.origin.z};papaya.volume.Transform.prototype.updateWorldMat=function(){var b,a;for(b=0;b<4;b+=1){for(a=0;a<4;a+=1){this.tempMat[b][a]=(this.indexMat[b][0]*this.originMat[0][a])+(this.indexMat[b][1]*this.originMat[1][a])+(this.indexMat[b][2]*this.originMat[2][a])+(this.indexMat[b][3]*this.originMat[3][a])}}for(b=0;b<4;b+=1){for(a=0;a<4;a+=1){this.worldMat[b][a]=(this.tempMat[b][0]*this.sizeMatInverse[0][a])+(this.tempMat[b][1]*this.sizeMatInverse[1][a])+(this.tempMat[b][2]*this.sizeMatInverse[2][a])+(this.tempMat[b][3]*this.sizeMatInverse[3][a])}}};papaya.volume.Transform.prototype.updateTransforms=function(a){this.mat=a;this.updateSizeMat();this.updateOrientMat();this.updateOriginMat();this.updateIndexTransform();this.updateMmTransform();this.updateWorldMat()};papaya.volume.Transform.prototype.getVoxelAtIndex=function(c,b,a,d){return this.voxelValue.getVoxelAtIndex(c,b,a,d)};papaya.volume.Transform.prototype.getVoxelAtCoordinate=function(g,e,d,f){var c,b,a;c=((g*this.worldMat[0][0])+(e*this.worldMat[0][1])+(d*this.worldMat[0][2])+(this.worldMat[0][3]));b=((g*this.worldMat[1][0])+(e*this.worldMat[1][1])+(d*this.worldMat[1][2])+(this.worldMat[1][3]));a=((g*this.worldMat[2][0])+(e*this.worldMat[2][1])+(d*this.worldMat[2][2])+(this.worldMat[2][3]));if((c<0)||(c>=this.imageDimensions.xDim)||(b<0)||(b>=this.imageDimensions.yDim)||(a<0)||(a>=this.imageDimensions.zDim)){return 0}return this.voxelValue.getVoxelAtIndex(c,b,a,f)};papaya.volume.Transform.prototype.getVoxelAtMM=function(g,e,d,f){var c,b,a;c=((g*this.mmMat[0][0])+(e*this.mmMat[0][1])+(d*this.mmMat[0][2])+(this.mmMat[0][3]));b=((g*this.mmMat[1][0])+(e*this.mmMat[1][1])+(d*this.mmMat[1][2])+(this.mmMat[1][3]));a=((g*this.mmMat[2][0])+(e*this.mmMat[2][1])+(d*this.mmMat[2][2])+(this.mmMat[2][3]));if((c<0)||(c>=this.imageDimensions.xDim)||(b<0)||(b>=this.imageDimensions.yDim)||(a<0)||(a>=this.imageDimensions.zDim)){return 0}return this.voxelValue.getVoxelAtIndex(c,b,a,f)};"use strict";var papaya=papaya||{};papaya.volume=papaya.volume||{};papaya.volume.Volume=papaya.volume.Volume||function(){this.file=null;this.fileLength=0;this.url=null;this.fileName=null;this.compressed=false;this.headerType=papaya.volume.Volume.TYPE_UNKNOWN;this.header=new papaya.volume.Header();this.imageData=new papaya.volume.ImageData();this.rawData=null;this.onFinishedRead=null;this.errorMessage=null;this.transform=null;this.isLoaded=false};papaya.volume.Volume.TYPE_UNKNOWN=0;papaya.volume.Volume.TYPE_NIFTI=1;papaya.volume.Volume.prototype.findFileType=function(a){if(a.indexOf(".nii")!==-1){return papaya.volume.Volume.TYPE_NIFTI}return papaya.volume.Volume.TYPE_UNKNOWN};papaya.volume.Volume.prototype.findFileTypeByMagicNumber=function(e){var d,c,b,a;d=new DataView(e);c=d.getUint8(papaya.volume.nifti.MAGIC_NUMBER_LOCATION);b=d.getUint8(papaya.volume.nifti.MAGIC_NUMBER_LOCATION+1);a=d.getUint8(papaya.volume.nifti.MAGIC_NUMBER_LOCATION+2);if((c===papaya.volume.nifti.MAGIC_NUMBER[0])&&(b===papaya.volume.nifti.MAGIC_NUMBER[1])&&(a===papaya.volume.nifti.MAGIC_NUMBER[2])){return papaya.volume.Volume.TYPE_NIFTI}return papaya.volume.Volume.TYPE_UNKNOWN};papaya.volume.Volume.prototype.fileIsCompressed=function(b,e){var d,c,a;if(b.indexOf(".gz")!==-1){return true}if(e){d=new DataView(e);c=d.getUint8(0);a=d.getUint8(1);if(c===GUNZIP_MAGIC_COOKIE1){return true}if(a===GUNZIP_MAGIC_COOKIE2){return true}}return false};papaya.volume.Volume.prototype.readFile=function(b,c){this.file=b;this.fileName=b.name;this.onFinishedRead=c;this.headerType=this.findFileType(this.fileName);if(this.headerType===papaya.volume.Volume.TYPE_UNKNOWN){this.errorMessage="File type is not recognized!";this.finishedLoad()}else{this.compressed=this.fileIsCompressed(this.fileName);this.fileLength=this.file.size;var a=makeSlice(this.file,0,this.file.size);this.readData(this,a)}};papaya.volume.Volume.prototype.readURL=function(b,f){var c=null,a,e;try{this.url=b;this.fileName=b.substr(b.lastIndexOf("/")+1,b.length);this.onFinishedRead=f;this.headerType=this.findFileType(this.fileName);this.compressed=this.fileIsCompressed(this.fileName);c=this;a=typeof new XMLHttpRequest().responseType==="string";if(a){e=new XMLHttpRequest();e.open("GET",b,true);e.responseType="arraybuffer";e.onreadystatechange=function(){if(e.readyState===4){if(e.status===200){c.rawData=e.response;c.fileLength=c.rawData.byteLength;c.decompress(c)}else{c.errorMessage="There was a problem reading that file:\n\nResponse status = "+e.status;c.finishedLoad()}}};e.send(null)}else{c.errorMessage="There was a problem reading that file:\n\nResponse type is not supported.";c.finishedLoad()}}catch(d){if(c!==null){c.errorMessage="There was a problem reading that file:\n\n"+d.message;c.finishedLoad()}}};papaya.volume.Volume.prototype.readEncodedData=function(a,d){var b=null;try{this.fileName=a;this.onFinishedRead=d;b=this;b.rawData=Base64Binary.decodeArrayBuffer(deref(a));this.headerType=this.findFileType(this.fileName);this.compressed=this.fileIsCompressed(this.fileName,b.rawData);this.fileLength=b.rawData.byteLength;b.decompress(b)}catch(c){if(b){b.errorMessage="There was a problem reading that file:\n\n"+c.message;b.finishedLoad()}}};papaya.volume.Volume.prototype.getVoxelAtIndex=function(c,b,a,d){return this.transform.getVoxelAtIndex(c,b,a,d)};papaya.volume.Volume.prototype.getVoxelAtCoordinate=function(d,b,a,c){return this.transform.getVoxelAtCoordinate(d,b,a,c)};papaya.volume.Volume.prototype.getVoxelAtMM=function(d,b,a,c){return this.transform.getVoxelAtMM(d,b,a,c)};papaya.volume.Volume.prototype.hasError=function(){return(this.errorMessage!==null)};papaya.volume.Volume.prototype.getXDim=function(){return this.header.imageDimensions.xDim};papaya.volume.Volume.prototype.getYDim=function(){return this.header.imageDimensions.yDim};papaya.volume.Volume.prototype.getZDim=function(){return this.header.imageDimensions.zDim};papaya.volume.Volume.prototype.getXSize=function(){return this.header.voxelDimensions.xSize};papaya.volume.Volume.prototype.getYSize=function(){return this.header.voxelDimensions.ySize};papaya.volume.Volume.prototype.getZSize=function(){return this.header.voxelDimensions.zSize};papaya.volume.Volume.prototype.readData=function(c,b){try{var a=new FileReader();a.onloadend=bind(c,function(e){if(e.target.readyState===FileReader.DONE){c.rawData=e.target.result;setTimeout(function(){c.decompress(c)},0)}});a.onerror=bind(c,function(e){c.errorMessage="There was a problem reading that file:\n\n"+e.getMessage();c.finishedLoad()});a.readAsArrayBuffer(b)}catch(d){c.errorMessage="There was a problem reading that file:\n\n"+d.message;c.finishedLoad()}};papaya.volume.Volume.prototype.decompress=function(b){if(b.compressed){var a=new Gunzip();a.gunzip(b.rawData,function(c){b.finishedDecompress(b,c)});if(a.hasError()){b.errorMessage=a.getError();b.finishedLoad()}}else{setTimeout(function(){b.finishedReadData(b)},0)}};papaya.volume.Volume.prototype.finishedDecompress=function(a,b){a.rawData=b;if(this.headerType===papaya.volume.Volume.TYPE_UNKNOWN){this.headerType=this.findFileTypeByMagicNumber(a.rawData)}setTimeout(function(){a.finishedReadData(a)},0)};papaya.volume.Volume.prototype.finishedReadData=function(a){a.header.readData(a.headerType,a.rawData,this.compressed);a.header.imageType.swapped=(a.header.imageType.littleEndian!==isPlatformLittleEndian());if(a.header.hasError()){a.errorMessage=a.header.errorMessage;a.onFinishedRead(a);return}a.imageData.readData(a.header,a.rawData,bind(a,a.finishedLoad))};papaya.volume.Volume.prototype.finishedLoad=function(){if(this.onFinishedRead){if(!this.hasError()){this.transform=new papaya.volume.Transform(papaya.volume.Transform.IDENTITY.clone(),this)}this.isLoaded=true;this.rawData=null;this.onFinishedRead(this)}};"use strict";var papaya=papaya||{};papaya.volume=papaya.volume||{};papaya.volume.VoxelDimensions=papaya.volume.VoxelDimensions||function(d,a,b,c){this.colSize=Math.abs(d);this.rowSize=Math.abs(a);this.sliceSize=Math.abs(b);this.xSize=0;this.ySize=0;this.zSize=0;this.timeSize=c};papaya.volume.VoxelDimensions.prototype.isValid=function(){return((this.colSize>0)&&(this.rowSize>0)&&(this.sliceSize>0)&&(this.timeSize>=0))};"use strict";var papaya=papaya||{};papaya.volume=papaya.volume||{};papaya.volume.VoxelValue=papaya.volume.VoxelValue||function(e,c,b,d,a){this.imageData=e;this.imageType=c;this.imageRange=d;this.orientation=a;this.swap16=((this.imageType.numBytes===2)&&this.imageType.swapped)&&(this.imageType.datatype!==papaya.volume.ImageType.DATATYPE_FLOAT);this.swap32=((this.imageType.numBytes===4)&&this.imageType.swapped)&&(this.imageType.datatype!==papaya.volume.ImageType.DATATYPE_FLOAT);this.xIncrement=a.xIncrement;this.yIncrement=a.yIncrement;this.zIncrement=a.zIncrement;this.xDim=b.xDim;this.yDim=b.yDim;this.zDim=b.zDim;this.dataScaleSlope=d.globalScale;this.dataScaleIntercept=d.globalIntercept;this.interpFirstPass=[[0,0],[0,0]];this.interpSecondPass=[0,0]};papaya.volume.VoxelValue.prototype.getVoxelAtIndex=function(c,b,a,d){if(d){c=Math.round(c);b=Math.round(b);a=Math.round(a);return(this.getVoxelAtOffset(this.orientation.convertIndexToOffset(c,b,a))*this.imageRange.globalScale)+this.imageRange.globalIntercept}return(this.getVoxelAtIndexLinear(c,b,a)*this.imageRange.globalScale)+this.imageRange.globalIntercept};papaya.volume.VoxelValue.prototype.getVoxelAtOffset=function(a){return this.checkSwap(this.imageData.data[a])};papaya.volume.VoxelValue.prototype.getVoxelAtIndexLinear=function(j,m,r){var k,h,g,e,b,a,d,c,f,i,o,n,l,q,p;k=b=a=0;c=Math.floor(j);f=Math.floor(m);i=Math.floor(r);h=j-c;g=m-f;e=r-i;o=(h!==0);n=(g!==0);l=(e!==0);if(o&&n&&l){for(q=0;q<2;q+=1){for(p=0;p<2;p+=1){if(((q===1)&&(c===(this.xDim-1)))||((p===1)&&(f===(this.yDim-1)))){d=-1}else{d=this.orientation.convertIndexToOffset(c+q,f+p,i)}if(d!==-1){b=(((this.checkSwap(this.imageData.data[d]))*this.dataScaleSlope)+this.dataScaleIntercept)*(1-e);if(i===(this.zDim-1)){a=0}else{d=this.orientation.convertIndexToOffset(c+q,f+p,i+1);a=(((this.checkSwap(this.imageData.data[d]))*this.dataScaleSlope)+this.dataScaleIntercept)*e}this.interpFirstPass[q][p]=b+a}else{this.interpFirstPass[q][p]=0}}}this.interpSecondPass[0]=(this.interpFirstPass[0][0]*(1-g))+(this.interpFirstPass[0][1]*g);this.interpSecondPass[1]=(this.interpFirstPass[1][0]*(1-g))+(this.interpFirstPass[1][1]*g);k=(this.interpSecondPass[0]*(1-h))+(this.interpSecondPass[1]*h)}else{if(o&&n&&!l){for(q=0;q<2;q+=1){if((q===1)&&(c===(this.xDim-1))){d=-1}else{d=this.orientation.convertIndexToOffset(c+q,f,i)}if(d!==-1){b=(((this.checkSwap(this.imageData.data[d]))*this.dataScaleSlope)+this.dataScaleIntercept)*(1-g);if(f===(this.yDim-1)){a=0}else{d=this.orientation.convertIndexToOffset(c+q,f+1,i);a=(((this.checkSwap(this.imageData.data[d]))*this.dataScaleSlope)+this.dataScaleIntercept)*g}this.interpSecondPass[q]=b+a}else{this.interpSecondPass[q]=0}}k=(this.interpSecondPass[0]*(1-h))+(this.interpSecondPass[1]*h)}else{if(o&&!n&&l){for(q=0;q<2;q+=1){if((q===1)&&(c===(this.xDim-1))){d=-1}else{d=this.orientation.convertIndexToOffset(c+q,f,i)}if(d!==-1){b=(((this.checkSwap(this.imageData.data[d]))*this.dataScaleSlope)+this.dataScaleIntercept)*(1-e);if(i===(this.zDim-1)){a=0}else{d=this.orientation.convertIndexToOffset(c+q,f,i+1);a=(((this.checkSwap(this.imageData.data[d]))*this.dataScaleSlope)+this.dataScaleIntercept)*e}this.interpSecondPass[q]=b+a}else{this.interpSecondPass[q]=0}}k=(this.interpSecondPass[0]*(1-h))+(this.interpSecondPass[1]*h)}else{if(!o&&n&&l){for(p=0;p<2;p+=1){if((p===1)&&(f===(this.yDim-1))){d=-1}else{d=this.orientation.convertIndexToOffset(c,f+p,i)}if(d!==-1){b=(((this.checkSwap(this.imageData.data[d]))*this.dataScaleSlope)+this.dataScaleIntercept)*(1-e);if(i===(this.zDim-1)){a=0}else{d=this.orientation.convertIndexToOffset(c,f+p,i+1);a=(((this.checkSwap(this.imageData.data[d]))*this.dataScaleSlope)+this.dataScaleIntercept)*e}this.interpSecondPass[p]=b+a}else{this.interpSecondPass[p]=0}}k=(this.interpSecondPass[0]*(1-g))+(this.interpSecondPass[1]*g)}else{if(!o&&!n&&l){d=this.orientation.convertIndexToOffset(c,f,i);b=(((this.checkSwap(this.imageData.data[d]))*this.dataScaleSlope)+this.dataScaleIntercept)*(1-e);if(i===(this.zDim-1)){a=0}else{d=this.orientation.convertIndexToOffset(c,f,i+1);a=(((this.checkSwap(this.imageData.data[d]))*this.dataScaleSlope)+this.dataScaleIntercept)*e}k=b+a}else{if(!o&&n&&!l){d=this.orientation.convertIndexToOffset(c,f,i);b=(((this.checkSwap(this.imageData.data[d]))*this.dataScaleSlope)+this.dataScaleIntercept)*(1-g);if(f===(this.yDim-1)){a=0}else{d=this.orientation.convertIndexToOffset(c,f+1,i);a=(((this.checkSwap(this.imageData.data[d]))*this.dataScaleSlope)+this.dataScaleIntercept)*g}k=b+a}else{if(o&&!n&&!l){d=this.orientation.convertIndexToOffset(c,f,i);b=(((this.checkSwap(this.imageData.data[d]))*this.dataScaleSlope)+this.dataScaleIntercept)*(1-h);if(c===(this.xDim-1)){a=0}else{d=this.orientation.convertIndexToOffset(c+1,f,i);a=(((this.checkSwap(this.imageData.data[d]))*this.dataScaleSlope)+this.dataScaleIntercept)*h}k=b+a}else{k=this.getVoxelAtOffset(this.orientation.convertIndexToOffset(j,m,r))}}}}}}}return k};papaya.volume.VoxelValue.prototype.checkSwap=function(a){if(this.swap16){return((a&255)<<8)|((a>>8)&255)}if(this.swap32){return((a&255)<<24)|((a&65280)<<8)|((a>>8)&65280)|((a>>24)&255)}return a};"use strict";var papaya=papaya||{};papaya.volume=papaya.volume||{};papaya.volume.nifti=papaya.volume.nifti||{};papaya.volume.nifti.HeaderNIFTI=papaya.volume.nifti.HeaderNIFTI||function(){this.nifti=null;this.compressed=false};papaya.volume.nifti.HeaderNIFTI.ORIENTATION_DEFAULT="XYZ-++";papaya.volume.nifti.HeaderNIFTI.prototype.readData=function(b,a){this.nifti=new papaya.volume.nifti.NIFTI();this.compressed=a;this.nifti.readData(b)};papaya.volume.nifti.HeaderNIFTI.prototype.getImageDimensions=function(){var a=new papaya.volume.ImageDimensions(this.nifti.dims[1],this.nifti.dims[2],this.nifti.dims[3],this.nifti.dims[4]);a.offset=this.nifti.vox_offset;return a};papaya.volume.nifti.HeaderNIFTI.prototype.getVoxelDimensions=function(){return new papaya.volume.VoxelDimensions(this.nifti.pixDims[1],this.nifti.pixDims[2],this.nifti.pixDims[3],this.nifti.pixDims[4])};papaya.volume.nifti.HeaderNIFTI.prototype.getImageType=function(){var a=papaya.volume.ImageType.DATATYPE_UNKNOWN;if((this.nifti.datatypeCode===papaya.volume.nifti.NIFTI_TYPE_UINT8)||(this.nifti.datatypeCode===papaya.volume.nifti.NIFTI_TYPE_UINT16)||(this.nifti.datatypeCode===papaya.volume.nifti.NIFTI_TYPE_UINT32)||(this.nifti.datatypeCode===papaya.volume.nifti.NIFTI_TYPE_UINT64)){a=papaya.volume.ImageType.DATATYPE_INTEGER_UNSIGNED}else{if((this.nifti.datatypeCode===papaya.volume.nifti.NIFTI_TYPE_INT8)||(this.nifti.datatypeCode===papaya.volume.nifti.NIFTI_TYPE_INT16)||(this.nifti.datatypeCode===papaya.volume.nifti.NIFTI_TYPE_INT32)||(this.nifti.datatypeCode===papaya.volume.nifti.NIFTI_TYPE_INT64)){a=papaya.volume.ImageType.DATATYPE_INTEGER_SIGNED}else{if((this.nifti.datatypeCode===papaya.volume.nifti.NIFTI_TYPE_FLOAT32)||(this.nifti.datatypeCode===papaya.volume.nifti.NIFTI_TYPE_FLOAT64)){a=papaya.volume.ImageType.DATATYPE_FLOAT}}}return new papaya.volume.ImageType(a,this.nifti.numBitsPerVoxel/8,this.nifti.littleEndian,this.compressed)};papaya.volume.nifti.HeaderNIFTI.prototype.getOrientation=function(){var a=null;if(this.nifti.qform_code>0){a=this.getOrientationQform()}if(this.nifti.sform_code>this.nifti.qform_code){a=this.getOrientationSform()}if(a===null){a=papaya.volume.nifti.HeaderNIFTI.ORIENTATION_DEFAULT}return new papaya.volume.Orientation(a)};papaya.volume.nifti.HeaderNIFTI.prototype.getOrientationQform=function(){var a=papaya.volume.nifti.HeaderNIFTI.ORIENTATION_DEFAULT,b=this.nifti.convertNiftiQFormToNiftiSForm(this.nifti.quatern_b,this.nifti.quatern_c,this.nifti.quatern_d,this.nifti.qoffset_x,this.nifti.qoffset_y,this.nifti.qoffset_z,this.nifti.pixDims[1],this.nifti.pixDims[2],this.nifti.pixDims[3],this.nifti.pixDims[0]);if(this.nifti.qform_code>0){a=this.nifti.convertNiftiSFormToNEMA(b);if(!papaya.volume.Orientation.prototype.isValidOrientationString(a)){a=papaya.volume.nifti.HeaderNIFTI.ORIENTATION_DEFAULT}}else{a=papaya.volume.nifti.HeaderNIFTI.ORIENTATION_DEFAULT}return a};papaya.volume.nifti.HeaderNIFTI.prototype.getOrientationSform=function(){var a=this.nifti.convertNiftiSFormToNEMA(this.nifti.affine);if(!papaya.volume.Orientation.prototype.isValidOrientationString(a)){a=papaya.volume.nifti.HeaderNIFTI.ORIENTATION_DEFAULT}return a};papaya.volume.nifti.HeaderNIFTI.prototype.getOrigin=function(){var d=new papaya.core.Coordinate(0,0,0),f,c,e,g,b,a;if(this.nifti.qform_code>0){f=this.nifti.convertNiftiQFormToNiftiSForm(this.nifti.quatern_b,this.nifti.quatern_c,this.nifti.quatern_d,this.nifti.qoffset_x,this.nifti.qoffset_y,this.nifti.qoffset_z,this.nifti.pixDims[1],this.nifti.pixDims[2],this.nifti.pixDims[3],this.nifti.pixDims[0]);c=this.nifti.convertNiftiSFormToNEMA(f);if(!papaya.volume.Orientation.prototype.isValidOrientationString(c)){c=papaya.volume.nifti.HeaderNIFTI.ORIENTATION_DEFAULT}e=this.nifti.qoffset_x*((c.charAt(c.indexOf("X")+3)==="+")?-1:1);g=this.nifti.qoffset_y*((c.charAt(c.indexOf("Y")+3)==="+")?1:-1);b=this.nifti.qoffset_z*((c.charAt(c.indexOf("Z")+3)==="+")?1:-1);a=new Array(3);a[0]=e<0?(this.nifti.dims[1]+(e/this.nifti.pixDims[1])):(e/Math.abs(this.nifti.pixDims[1]));a[1]=g>0?(this.nifti.dims[2]-(g/this.nifti.pixDims[2])):(g/Math.abs(this.nifti.pixDims[2]))*-1;a[2]=b>0?(this.nifti.dims[3]-(b/this.nifti.pixDims[3])):(b/Math.abs(this.nifti.pixDims[3]))*-1;d.setCoordinate(a[0],a[1],a[2],true)}else{if(this.nifti.sform_code>0){c=this.nifti.convertNiftiSFormToNEMA(this.nifti.affine);if(!papaya.volume.Orientation.prototype.isValidOrientationString(c)){c=papaya.volume.nifti.HeaderNIFTI.ORIENTATION_DEFAULT}e=this.nifti.affine[0][3]*((c.charAt(c.indexOf("X")+3)==="+")?-1:1);g=this.nifti.affine[1][3]*((c.charAt(c.indexOf("Y")+3)==="+")?1:-1);b=this.nifti.affine[2][3]*((c.charAt(c.indexOf("Z")+3)==="+")?1:-1);a=new Array(3);a[0]=e<0?(this.nifti.dims[1]+(e/this.nifti.pixDims[1])):(e/Math.abs(this.nifti.pixDims[1]));a[1]=g>0?(this.nifti.dims[2]-(g/this.nifti.pixDims[2])):(g/Math.abs(this.nifti.pixDims[2]))*-1;a[2]=b>0?(this.nifti.dims[3]-(b/this.nifti.pixDims[3])):(b/Math.abs(this.nifti.pixDims[3]))*-1;d.setCoordinate(a[0],a[1],a[2],true)}}if(d.isAllZeros()){d.setCoordinate(this.nifti.dims[1]/2,this.nifti.dims[2]/2,this.nifti.dims[3]/2)}return d};papaya.volume.nifti.HeaderNIFTI.prototype.getImageRange=function(){var b=new papaya.volume.ImageRange(this.nifti.cal_min,this.nifti.cal_max),a=this.nifti.scl_slope;if(a===0){a=1}b.setGlobalDataScale(a,this.nifti.scl_inter);return b};papaya.volume.nifti.HeaderNIFTI.prototype.hasError=function(){return this.nifti.hasError()};papaya.volume.nifti.HeaderNIFTI.prototype.getImageDescription=function(){return new papaya.volume.ImageDescription(this.nifti.description)};papaya.volume.nifti.HeaderNIFTI.prototype.getOrientationCertainty=function(){var b,a;b=papaya.volume.Header.ORIENTATION_CERTAINTY_UNKNOWN;if((this.nifti.qform_code>0)||(this.nifti.sform_code>0)){b=papaya.volume.Header.ORIENTATION_CERTAINTY_LOW;a=this.getOrigin();if((a!==null)&&!a.isAllZeros()){b=papaya.volume.Header.ORIENTATION_CERTAINTY_HIGH}}return b};"use strict";var papaya=papaya||{};papaya.volume=papaya.volume||{};papaya.volume.nifti=papaya.volume.nifti||{};papaya.volume.nifti.NIFTI=papaya.volume.nifti.NIFTI||function(){this.errorMessage=null;this.littleEndian=false;this.dim_info=0;this.dims=[];this.intent_p1=0;this.intent_p2=0;this.intent_p3=0;this.intent_code=0;this.datatypeCode=0;this.numBitsPerVoxel=0;this.slice_start=0;this.slice_end=0;this.slice_code=0;this.pixDims=[];this.vox_offset=0;this.scl_slope=1;this.scl_inter=0;this.xyzt_units=0;this.cal_max=0;this.cal_min=0;this.slice_duration=0;this.toffset=0;this.description="";this.aux_file="";this.intent_name="";this.qform_code=0;this.sform_code=0;this.quatern_b=0;this.quatern_c=0;this.quatern_d=0;this.qoffset_x=0;this.qoffset_y=0;this.qoffset_z=0;this.affine=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];this.magic=0};papaya.volume.nifti.MAGIC_COOKIE=348;papaya.volume.nifti.NII_HDR_SIZE=352;papaya.volume.nifti.DT_NONE=0;papaya.volume.nifti.DT_BINARY=1;papaya.volume.nifti.NIFTI_TYPE_UINT8=2;papaya.volume.nifti.NIFTI_TYPE_INT16=4;papaya.volume.nifti.NIFTI_TYPE_INT32=8;papaya.volume.nifti.NIFTI_TYPE_FLOAT32=16;papaya.volume.nifti.NIFTI_TYPE_COMPLEX64=32;papaya.volume.nifti.NIFTI_TYPE_FLOAT64=64;papaya.volume.nifti.NIFTI_TYPE_RGB24=128;papaya.volume.nifti.DT_ALL=255;papaya.volume.nifti.NIFTI_TYPE_INT8=256;papaya.volume.nifti.NIFTI_TYPE_UINT16=512;papaya.volume.nifti.NIFTI_TYPE_UINT32=768;papaya.volume.nifti.NIFTI_TYPE_INT64=1024;papaya.volume.nifti.NIFTI_TYPE_UINT64=1280;papaya.volume.nifti.NIFTI_TYPE_FLOAT128=1536;papaya.volume.nifti.NIFTI_TYPE_COMPLEX128=1792;papaya.volume.nifti.NIFTI_TYPE_COMPLEX256=2048;papaya.volume.nifti.MAGIC_NUMBER_LOCATION=344;papaya.volume.nifti.MAGIC_NUMBER=[110,43,49];papaya.volume.nifti.NIFTI.prototype.readData=function(f){var g=new DataView(f),d=this.getIntAt(g,0,this.littleEndian),e,c,a,b;if(d!==papaya.volume.nifti.MAGIC_COOKIE){this.littleEndian=true;d=this.getIntAt(g,0,this.littleEndian)}if(d!==papaya.volume.nifti.MAGIC_COOKIE){this.errorMessage="This does not appear to be a NIFTI file!";return}this.dim_info=this.getByteAt(g,39);for(e=0;e<8;e+=1){b=40+(e*2);this.dims[e]=this.getShortAt(g,b,this.littleEndian)}this.intent_p1=this.getFloatAt(g,56,this.littleEndian);this.intent_p2=this.getFloatAt(g,60,this.littleEndian);this.intent_p3=this.getFloatAt(g,64,this.littleEndian);this.intent_code=this.getFloatAt(g,68,this.littleEndian);this.datatypeCode=this.getShortAt(g,70,this.littleEndian);this.numBitsPerVoxel=this.getShortAt(g,72,this.littleEndian);this.slice_start=this.getShortAt(g,74,this.littleEndian);for(e=0;e<8;e+=1){b=76+(e*4);this.pixDims[e]=this.getFloatAt(g,b,this.littleEndian)}this.vox_offset=this.getFloatAt(g,108,this.littleEndian);this.scl_slope=this.getFloatAt(g,112,this.littleEndian);this.scl_inter=this.getFloatAt(g,116,this.littleEndian);this.slice_end=this.getShortAt(g,120,this.littleEndian);this.slice_code=this.getByteAt(g,122);this.xyzt_units=this.getByteAt(g,123);this.cal_max=this.getFloatAt(g,124,this.littleEndian);this.cal_min=this.getFloatAt(g,128,this.littleEndian);this.slice_duration=this.getFloatAt(g,132,this.littleEndian);this.toffset=this.getFloatAt(g,136,this.littleEndian);this.description=this.getStringAt(g,148,228);this.qform_code=this.getShortAt(g,252,this.littleEndian);this.sform_code=this.getShortAt(g,254,this.littleEndian);this.quatern_b=this.getFloatAt(g,256,this.littleEndian);this.quatern_c=this.getFloatAt(g,260,this.littleEndian);this.quatern_d=this.getFloatAt(g,264,this.littleEndian);this.qoffset_x=this.getFloatAt(g,268,this.littleEndian);this.qoffset_y=this.getFloatAt(g,272,this.littleEndian);this.qoffset_z=this.getFloatAt(g,276,this.littleEndian);for(c=0;c<3;c+=1){for(a=0;a<4;a+=1){b=280+(((c*4)+a)*4);this.affine[c][a]=this.getFloatAt(g,b,this.littleEndian)}}this.affine[3][0]=0;this.affine[3][1]=0;this.affine[3][2]=0;this.affine[3][3]=1;this.intent_name=this.getStringAt(g,328,344);this.magic=this.getStringAt(g,344,348)};papaya.volume.nifti.NIFTI.prototype.convertNiftiQFormToNiftiSForm=function(j,i,h,v,s,q,n,m,l,f){var g=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],w,u=j,r=i,p=h,o,e,k;g[3][0]=g[3][1]=g[3][2]=0;g[3][3]=1;w=1-(u*u+r*r+p*p);if(w<1e-7){w=1/Math.sqrt(u*u+r*r+p*p);u*=w;r*=w;p*=w;w=0}else{w=Math.sqrt(w)}o=(n>0)?n:1;e=(m>0)?m:1;k=(l>0)?l:1;if(f<0){k=-k}g[0][0]=(w*w+u*u-r*r-p*p)*o;g[0][1]=2*(u*r-w*p)*e;g[0][2]=2*(u*p+w*r)*k;g[1][0]=2*(u*r+w*p)*o;g[1][1]=(w*w+r*r-u*u-p*p)*e;g[1][2]=2*(r*p-w*u)*k;g[2][0]=2*(u*p-w*r)*o;g[2][1]=2*(r*p+w*u)*e;g[2][2]=(w*w+p*p-r*r-u*u)*k;g[0][3]=v;g[1][3]=s;g[2][3]=q;return g};papaya.volume.nifti.NIFTI.prototype.convertNiftiSFormToNEMA=function(g){var C,B,z,S,L,J,n,l,f,U,v,x,G,F,E,D,A,y,K,w,c,e,H,s,o,O,h,m,I,u,b,N,a,d;E=0;h=[[0,0,0],[0,0,0],[0,0,0]];m=[[0,0,0],[0,0,0],[0,0,0]];C=g[0][0];B=g[0][1];z=g[0][2];S=g[1][0];L=g[1][1];J=g[1][2];n=g[2][0];l=g[2][1];f=g[2][2];U=Math.sqrt(C*C+S*S+n*n);if(U===0){return null}C/=U;S/=U;n/=U;U=Math.sqrt(B*B+L*L+l*l);if(U===0){return null}B/=U;L/=U;l/=U;U=C*B+S*L+n*l;if(Math.abs(U)>0.0001){B-=U*C;L-=U*S;l-=U*n;U=Math.sqrt(B*B+L*L+l*l);if(U===0){return null}B/=U;L/=U;l/=U}U=Math.sqrt(z*z+J*J+f*f);if(U===0){z=S*l-n*L;J=n*B-l*C;f=C*L-S*B}else{z/=U;J/=U;f/=U}U=C*z+S*J+n*f;if(Math.abs(U)>0.0001){z-=U*C;J-=U*S;f-=U*n;U=Math.sqrt(z*z+J*J+f*f);if(U===0){return null}z/=U;J/=U;f/=U}U=B*z+L*J+l*f;if(Math.abs(U)>0.0001){z-=U*B;J-=U*L;f-=U*l;U=Math.sqrt(z*z+J*J+f*f);if(U===0){return null}z/=U;J/=U;f/=U}h[0][0]=C;h[0][1]=B;h[0][2]=z;h[1][0]=S;h[1][1]=L;h[1][2]=J;h[2][0]=n;h[2][1]=l;h[2][2]=f;v=this.nifti_mat33_determ(h);if(v===0){return null}O=-666;K=e=H=s=1;w=2;c=3;for(G=1;G<=3;G+=1){for(F=1;F<=3;F+=1){if(!(G===F)){for(E=1;E<=3;E+=1){if(!(G===E||F===E)){m[0][0]=m[0][1]=m[0][2]=m[1][0]=m[1][1]=m[1][2]=m[2][0]=m[2][1]=m[2][2]=0;for(D=-1;D<=1;D+=2){for(A=-1;A<=1;A+=2){for(y=-1;y<=1;y+=2){m[0][G-1]=D;m[1][F-1]=A;m[2][E-1]=y;x=this.nifti_mat33_determ(m);if(!(x*v<=0)){o=this.nifti_mat33_mul(m,h);U=o[0][0]+o[1][1]+o[2][2];if(U>O){O=U;K=G;w=F;c=E;e=D;H=A;s=y}}}}}}}}}}I=u=b=N=a=d=0;switch(K*e){case 1:I="X";N="+";break;case -1:I="X";N="-";break;case 2:I="Y";N="+";break;case -2:I="Y";N="-";break;case 3:I="Z";N="+";break;case -3:I="Z";N="-";break}switch(w*H){case 1:u="X";a="+";break;case -1:u="X";a="-";break;case 2:u="Y";a="+";break;case -2:u="Y";a="-";break;case 3:u="Z";a="+";break;case -3:u="Z";a="-";break}switch(c*s){case 1:b="X";d="+";break;case -1:b="X";d="-";break;case 2:b="Y";d="+";break;case -2:b="Y";d="-";break;case 3:b="Z";d="+";break;case -3:b="Z";d="-";break}return(I+u+b+N+a+d)};papaya.volume.nifti.NIFTI.prototype.nifti_mat33_mul=function(a,e){var d=[[0,0,0],[0,0,0],[0,0,0]],c,b;for(c=0;c<3;c+=1){for(b=0;b<3;b+=1){d[c][b]=a[c][0]*e[0][b]+a[c][1]*e[1][b]+a[c][2]*e[2][b]}}return d};papaya.volume.nifti.NIFTI.prototype.nifti_mat33_determ=function(d){var g,f,e,c,b,a,j,i,h;g=d[0][0];f=d[0][1];e=d[0][2];c=d[1][0];b=d[1][1];a=d[1][2];j=d[2][0];i=d[2][1];h=d[2][2];return(g*b*h-g*i*a-c*f*h+c*i*e+j*f*a-j*b*e)};papaya.volume.nifti.NIFTI.prototype.getStringAt=function(d,f,a){var e="",c,b;for(c=f;c<a;c+=1){b=d.getUint8(c);if(b!==0){e+=String.fromCharCode(b)}}return e};papaya.volume.nifti.NIFTI.prototype.getByteAt=function(a,b){return a.getInt8(b)};papaya.volume.nifti.NIFTI.prototype.getShortAt=function(a,c,b){return a.getInt16(c,b)};papaya.volume.nifti.NIFTI.prototype.getIntAt=function(a,c,b){return a.getInt32(c,b)};papaya.volume.nifti.NIFTI.prototype.getFloatAt=function(a,c,b){return a.getFloat32(c,b)};papaya.volume.nifti.NIFTI.prototype.hasError=function(){return(this.errorMessage!==null)};"use strict";var papaya=papaya||{};papaya.viewer=papaya.viewer||{};papaya.viewer.Atlas=papaya.viewer.Atlas||function(b){this.name=null;this.transformedname=null;this.labels=[];this.atlasLabelData=b.labels;this.volume=new papaya.volume.Volume();this.displayColumns=null;this.returnLabels=null;this.transform=null;this.currentAtlas=null;this.maxLabels=0;this.probabilistic=false;var a=papayaMain.findLoadableImage(b.labels.atlas.header.images.summaryimagefile);if((a!==null)&&(a.encode!==undefined)){this.volume.readEncodedData(a.encode,bind(this,this.readFinished))}else{if((a!==null)&&(a.url!==undefined)){this.volume.readURL(a.url,bind(this,this.readFinished))}}};papaya.viewer.Atlas.MAX_LABELS=4;papaya.viewer.Atlas.PROBABILISTIC=["probabalistic","probabilistic","statistic"];papaya.viewer.Atlas.LABEL_SPLIT_REGEX=/\.|:|,|\//;papaya.viewer.Atlas.prototype.getLabelAtCoordinate=function(f,e,d){var c,b,a,g;if(this.transform&&(this.currentAtlas===this.transformedname)){c=((f*this.transform[0][0])+(e*this.transform[0][1])+(d*this.transform[0][2])+(this.transform[0][3]));b=((f*this.transform[1][0])+(e*this.transform[1][1])+(d*this.transform[1][2])+(this.transform[1][3]));a=((f*this.transform[2][0])+(e*this.transform[2][1])+(d*this.transform[2][2])+(this.transform[2][3]))}else{c=f;b=e;a=d}g=(this.volume.getVoxelAtCoordinate(c,b,a,true));if(this.probabilistic){g-=1}return this.formatLabels(this.labels[g],this.returnLabels)};papaya.viewer.Atlas.prototype.readFinished=function(){this.parseTransform();this.parseLabels();this.parseDisplayColumns();this.maxLabels=this.findMaxLabelParts();this.currentAtlas=this.name;this.probabilistic=this.atlasLabelData.atlas.header.type&&((this.atlasLabelData.atlas.header.type.toLowerCase()===papaya.viewer.Atlas.PROBABILISTIC[0])||(this.atlasLabelData.atlas.header.type.toLowerCase()===papaya.viewer.Atlas.PROBABILISTIC[1])||(this.atlasLabelData.atlas.header.type.toLowerCase()===papaya.viewer.Atlas.PROBABILISTIC[2]));this.returnLabels=[];this.returnLabels.length=this.maxLabels;if(this.atlasLabelData.atlas.header.transformedname){this.transformedname=this.atlasLabelData.atlas.header.transformedname}this.name=this.atlasLabelData.atlas.header.name;var a=papayaParams.atlas;if(a){if(a===this.transformedname){this.currentAtlas=this.transformedname}}};papaya.viewer.Atlas.prototype.parseDisplayColumns=function(){var a,b,c;if(this.atlasLabelData.atlas.header.display){this.displayColumns=[];a=0;b=this.atlasLabelData.atlas.header.display.split(papaya.viewer.Atlas.LABEL_SPLIT_REGEX);for(c=0;c<b.length;c+=1){if(b[c]==="*"){this.displayColumns[a]=c;a+=1}}}};papaya.viewer.Atlas.prototype.parseTransform=function(){var c,b,a;if(this.atlasLabelData.atlas.header.transform){c=this.atlasLabelData.atlas.header.transform.split(" ");this.transform=papaya.volume.Transform.IDENTITY.clone();if(c.length===16){for(b=0;b<4;b+=1){for(a=0;a<4;a+=1){this.transform[b][a]=parseFloat(c[(b*4)+a])}}}}};papaya.viewer.Atlas.prototype.parseLabels=function(){var c,b,a;for(c=0;c<this.atlasLabelData.atlas.data.label.length;c+=1){a=this.atlasLabelData.atlas.data.label[c];if(a.index){b=parseInt(a.index,10)}else{b=c}if(a.content){this.labels[b]=a.content}else{this.labels[b]=a}}};papaya.viewer.Atlas.prototype.formatLabels=function(b,c){var d,f,a,e;if(b){a=b.split(papaya.viewer.Atlas.LABEL_SPLIT_REGEX);if(this.displayColumns){for(d=0;d<a.length;d+=1){if(d<this.displayColumns.length){c[d]=a[this.displayColumns[d]]}}}else{e=a.length;f=0;if(e>papaya.viewer.Atlas.MAX_LABELS){f=(e-papaya.viewer.Atlas.MAX_LABELS)}for(d=f;d<a.length;d+=1){c[d]=a[d].trim()}}}else{for(d=0;d<c.length;d+=1){c[d]=""}}return c};papaya.viewer.Atlas.prototype.findMaxLabelParts=function(){var a,b;if(this.displayColumns){return this.displayColumns.length}b=[];for(a=0;a<this.labels.length;a+=1){this.formatLabels(this.labels[a],b)}return b.length};"use strict";var papaya=papaya||{};papaya.viewer=papaya.viewer||{};papaya.viewer.ColorTable=papaya.viewer.ColorTable||function(b,a,c){this.lut=papaya.viewer.ColorTable.findLUT(b);this.maxLUT=0;this.minLUT=0;this.knotThresholds=[];this.knotRangeRatios=[];this.LUTarrayG=new Array(256);this.LUTarrayR=new Array(256);this.LUTarrayB=new Array(256);this.isBaseImage=a;this.knotMin=this.lut[0];this.knotMax=this.lut[this.lut.length-1];this.useGradation=c;this.canvas=document.createElement("canvas");this.canvas.width=papaya.viewer.ColorTable.ICON_SIZE;this.canvas.height=papaya.viewer.ColorTable.ICON_SIZE;this.context=this.canvas.getContext("2d");this.imageData=this.context.createImageData(papaya.viewer.ColorTable.ICON_SIZE,papaya.viewer.ColorTable.ICON_SIZE);this.icon=null;this.updateLUT(papaya.viewer.ColorTable.LUT_MAX,papaya.viewer.ColorTable.LUT_MIN);this.updateIcon()};papaya.viewer.ColorTable.TABLE_GRAYSCALE={name:"Grayscale",data:[[0,0,0,0],[1,1,1,1]]};papaya.viewer.ColorTable.TABLE_SPECTRUM={name:"Spectrum",data:[[0,0,0,0],[0.1,0,0,1],[0.33,0,1,1],[0.5,0,1,0],[0.66,1,1,0],[0.9,1,0,0],[1,1,1,1]]};papaya.viewer.ColorTable.TABLE_RED2YELLOW={name:"Red-to-Yellow",data:[[0,1,0,0],[1,1,1,0]]};papaya.viewer.ColorTable.TABLE_BLUE2GREEN={name:"Blue-to-Green",data:[[0,0,0,1],[1,0,1,0]]};papaya.viewer.ColorTable.TABLE_HOTANDCOLD={name:"Hot-and-Cold",data:[[0,0,0,1],[0.15,0,1,1],[0.3,0,1,0],[0.45,0,0,0],[0.5,0,0,0],[0.55,0,0,0],[0.7,1,1,0],[0.85,1,0,0],[1,1,1,1]]};papaya.viewer.ColorTable.TABLE_GOLD={name:"Gold",data:[[0,0,0,0],[0.13,0.19,0.03,0],[0.25,0.39,0.12,0],[0.38,0.59,0.26,0],[0.5,0.8,0.46,0.08],[0.63,0.99,0.71,0.21],[0.75,0.99,0.88,0.34],[0.88,0.99,0.99,0.48],[1,0.9,0.95,0.61]]};papaya.viewer.ColorTable.TABLE_RED2WHITE={name:"Red-to-White",data:[[0,1,0,0],[1,1,1,1]]};papaya.viewer.ColorTable.TABLE_GREEN2WHITE={name:"Green-to-White",data:[[0,0,1,0],[1,1,1,1]]};papaya.viewer.ColorTable.TABLE_BLUE2WHITE={name:"Blue-to-White",data:[[0,0,0,1],[1,1,1,1]]};papaya.viewer.ColorTable.TABLE_ORANGE2WHITE={name:"Orange-to-White",data:[[0,1,0.5,0],[1,1,1,1]]};papaya.viewer.ColorTable.TABLE_PURPLE2WHITE={name:"Purple-to-White",data:[[0,0.5,0,1],[1,1,1,1]]};papaya.viewer.ColorTable.DEFAULT_COLOR_TABLE=papaya.viewer.ColorTable.TABLE_GRAYSCALE;papaya.viewer.ColorTable.PARAMETRIC_COLOR_TABLES=[papaya.viewer.ColorTable.TABLE_RED2YELLOW,papaya.viewer.ColorTable.TABLE_BLUE2GREEN];papaya.viewer.ColorTable.OVERLAY_COLOR_TABLES=[papaya.viewer.ColorTable.TABLE_RED2WHITE,papaya.viewer.ColorTable.TABLE_GREEN2WHITE,papaya.viewer.ColorTable.TABLE_BLUE2WHITE,papaya.viewer.ColorTable.TABLE_ORANGE2WHITE,papaya.viewer.ColorTable.TABLE_PURPLE2WHITE];papaya.viewer.ColorTable.TABLE_ALL=[papaya.viewer.ColorTable.TABLE_GRAYSCALE,papaya.viewer.ColorTable.TABLE_SPECTRUM,papaya.viewer.ColorTable.TABLE_RED2YELLOW,papaya.viewer.ColorTable.TABLE_BLUE2GREEN,papaya.viewer.ColorTable.TABLE_HOTANDCOLD,papaya.viewer.ColorTable.TABLE_GOLD,papaya.viewer.ColorTable.TABLE_RED2WHITE,papaya.viewer.ColorTable.TABLE_GREEN2WHITE,papaya.viewer.ColorTable.TABLE_BLUE2WHITE,papaya.viewer.ColorTable.TABLE_ORANGE2WHITE,papaya.viewer.ColorTable.TABLE_PURPLE2WHITE];papaya.viewer.ColorTable.LUT_MIN=0;papaya.viewer.ColorTable.LUT_MAX=255;papaya.viewer.ColorTable.ICON_SIZE=18;papaya.viewer.ColorTable.findLUT=function(a){var b;for(b=0;b<papaya.viewer.ColorTable.TABLE_ALL.length;b+=1){if(papaya.viewer.ColorTable.TABLE_ALL[b].name===a){return papaya.viewer.ColorTable.TABLE_ALL[b].data}}return null};papaya.viewer.ColorTable.addCustomLUT=function(a){if(papaya.viewer.ColorTable.findLUT(a.name)===null){papaya.viewer.ColorTable.TABLE_ALL.push(a)}};papaya.viewer.ColorTable.prototype.updateLUT=function(e,f){var a,d,b,c;this.maxLUT=e;this.minLUT=f;a=this.maxLUT-this.minLUT;for(d=0;d<this.lut.length;d+=1){this.knotThresholds[d]=(this.lut[d][0]*a)+this.minLUT}for(d=0;d<(this.lut.length-1);d+=1){this.knotRangeRatios[d]=papaya.viewer.ColorTable.LUT_MAX/(this.knotThresholds[d+1]-this.knotThresholds[d])}for(d=0;d<256;d+=1){if(d<=this.minLUT){this.LUTarrayR[d]=this.knotMin[1]*papaya.viewer.ColorTable.LUT_MAX;this.LUTarrayG[d]=this.knotMin[2]*papaya.viewer.ColorTable.LUT_MAX;this.LUTarrayB[d]=this.knotMin[3]*papaya.viewer.ColorTable.LUT_MAX}else{if(d>this.maxLUT){this.LUTarrayR[d]=this.knotMax[1]*papaya.viewer.ColorTable.LUT_MAX;this.LUTarrayG[d]=this.knotMax[2]*papaya.viewer.ColorTable.LUT_MAX;this.LUTarrayB[d]=this.knotMax[3]*papaya.viewer.ColorTable.LUT_MAX}else{for(b=0;b<(this.lut.length-1);b+=1){if((d>this.knotThresholds[b])&&(d<=this.knotThresholds[b+1])){if(this.useGradation){c=(((d-this.knotThresholds[b])*this.knotRangeRatios[b])+0.5)/papaya.viewer.ColorTable.LUT_MAX;this.LUTarrayR[d]=(((1-c)*this.lut[b][1])+(c*this.lut[b+1][1]))*papaya.viewer.ColorTable.LUT_MAX;this.LUTarrayG[d]=(((1-c)*this.lut[b][2])+(c*this.lut[b+1][2]))*papaya.viewer.ColorTable.LUT_MAX;this.LUTarrayB[d]=(((1-c)*this.lut[b][3])+(c*this.lut[b+1][3]))*papaya.viewer.ColorTable.LUT_MAX}else{this.LUTarrayR[d]=(this.lut[b][1])*papaya.viewer.ColorTable.LUT_MAX;this.LUTarrayG[d]=(this.lut[b][2])*papaya.viewer.ColorTable.LUT_MAX;this.LUTarrayB[d]=(this.lut[b][3])*papaya.viewer.ColorTable.LUT_MAX}}}}}}};papaya.viewer.ColorTable.prototype.lookupRed=function(a){if((a>=0)&&(a<256)){return(this.LUTarrayR[a]&255)}return 0};papaya.viewer.ColorTable.prototype.lookupGreen=function(a){if((a>=0)&&(a<256)){return(this.LUTarrayG[a]&255)}return 0};papaya.viewer.ColorTable.prototype.lookupBlue=function(a){if((a>=0)&&(a<256)){return(this.LUTarrayB[a]&255)}return 0};papaya.viewer.ColorTable.prototype.updateIcon=function(){var d,b,c,a,e;d=papaya.viewer.ColorTable.LUT_MAX/papaya.viewer.ColorTable.ICON_SIZE;for(b=0;b<papaya.viewer.ColorTable.ICON_SIZE;b+=1){for(c=0;c<papaya.viewer.ColorTable.ICON_SIZE;c+=1){a=((b*papaya.viewer.ColorTable.ICON_SIZE)+c)*4;e=Math.round(c*d);this.imageData.data[a]=this.lookupRed(e);this.imageData.data[a+1]=this.lookupGreen(e);this.imageData.data[a+2]=this.lookupBlue(e);this.imageData.data[a+3]=255}}this.context.putImageData(this.imageData,0,0);this.icon=this.canvas.toDataURL()};"use strict";var papaya=papaya||{};papaya.viewer=papaya.viewer||{};papaya.viewer.Display=papaya.viewer.Display||function(a){this.canvas=document.createElement("canvas");this.canvas.width=a;this.canvas.height=PAPAYA_SECTION_HEIGHT;this.context=this.canvas.getContext("2d");this.canvas.style.padding=0;this.canvas.style.margin=0;this.canvas.style.border="none";this.canvas.style.cursor="default";this.tempCoord=new papaya.core.Coordinate(0,0,0);this.drawingError=false;this.progress=0;this.progressTimeout=null;this.drawingProgress=false;this.drawUninitializedDisplay()};papaya.viewer.Display.PROTOTYPE_TEXT="000.00";papaya.viewer.Display.MINI_LABELS_THRESH=700;papaya.viewer.Display.TEXT_SPACING=8;papaya.viewer.Display.TEXT_LABEL_SIZE=12;papaya.viewer.Display.TEXT_CORRD_VALUE_SIZE=16;papaya.viewer.Display.TEXT_VALUE_SIZE=18;papaya.viewer.Display.TEXT_MINI_VALUE_SIZE=13;papaya.viewer.Display.prototype.drawUninitializedDisplay=function(){this.context.fillStyle="#000000";this.context.fillRect(0,0,this.canvas.width,this.canvas.height)};papaya.viewer.Display.prototype.drawEmptyDisplay=function(){if(this.drawingError||this.drawingProgress){return}this.context.clearRect(0,0,this.canvas.width,this.canvas.height);this.context.fillStyle="#000000";this.context.fillRect(0,0,this.canvas.width,this.canvas.height)};papaya.viewer.Display.prototype.drawDisplay=function(k,n,u){var m,c,o,i,v,s,j,e,g,b,q,a,h,r,p,d,f,l;if(this.drawingError||this.drawingProgress){return}d=papayaMain.papayaViewer.canvas.width/400;this.context.clearRect(0,0,this.canvas.width,this.canvas.height);this.context.fillStyle="#000000";this.context.fillRect(0,0,this.canvas.width,this.canvas.height);if(papayaMain.preferences.atlasLocks!=="Mouse"){k=papayaMain.papayaViewer.currentCoord.x;n=papayaMain.papayaViewer.currentCoord.y;u=papayaMain.papayaViewer.currentCoord.z}this.context.fillStyle="white";this.context.font=papaya.viewer.Display.TEXT_CORRD_VALUE_SIZE+"px Arial";m=this.context.measureText(papaya.viewer.Display.PROTOTYPE_TEXT);c=m.width;o=papaya.viewer.Display.TEXT_LABEL_SIZE+papaya.viewer.Display.TEXT_SPACING;this.context.font=papaya.viewer.Display.TEXT_LABEL_SIZE+"px Arial";this.context.fillText("x",2*d*papaya.viewer.Display.TEXT_SPACING,o);this.context.fillText("y",3*d*papaya.viewer.Display.TEXT_SPACING+c,o);this.context.fillText("z",4*d*papaya.viewer.Display.TEXT_SPACING+2*c,o);i=o+papaya.viewer.Display.TEXT_CORRD_VALUE_SIZE+papaya.viewer.Display.TEXT_SPACING/2;this.context.fillStyle="rgb(182, 59, 0)";this.context.font="bold "+papaya.viewer.Display.TEXT_CORRD_VALUE_SIZE+"px Arial";if(papayaMain.papayaViewer.worldSpace){g=papayaMain.papayaViewer.screenVolumes[0].volume.header.origin;f=papayaMain.papayaViewer.screenVolumes[0].volume.header.voxelDimensions;this.context.fillText(Math.round((k-g.x)*f.xSize).toString(),2*d*papaya.viewer.Display.TEXT_SPACING,i);this.context.fillText(Math.round((g.y-n)*f.ySize).toString(),3*d*papaya.viewer.Display.TEXT_SPACING+c,i);this.context.fillText(Math.round((g.z-u)*f.zSize).toString(),4*d*papaya.viewer.Display.TEXT_SPACING+2*c,i)}else{this.context.fillText(Math.round(k).toString(),2*d*papaya.viewer.Display.TEXT_SPACING,i);this.context.fillText(Math.round(n).toString(),3*d*papaya.viewer.Display.TEXT_SPACING+c,i);this.context.fillText(Math.round(u).toString(),4*d*papaya.viewer.Display.TEXT_SPACING+2*c,i)}v=papayaMain.papayaViewer.getCurrentValueAt(k,n,u);s=o+1.5*papaya.viewer.Display.TEXT_SPACING;this.context.fillStyle="white";this.context.font=papaya.viewer.Display.TEXT_VALUE_SIZE+"px Arial";j=parseFloat(v.toPrecision(7));this.context.fillText(j.toString(),5*d*papaya.viewer.Display.TEXT_SPACING+3*c,s);e=7*d*papaya.viewer.Display.TEXT_SPACING+5*c;b=this.canvas.width-e;if(papayaMain.papayaViewer.atlas&&papayaMain.papayaViewer.atlas.volume.isLoaded){if(b<papaya.viewer.Display.MINI_LABELS_THRESH){papayaMain.papayaViewer.getWorldCoordinateAtIndex(k,n,u,this.tempCoord);h=papayaMain.papayaViewer.atlas.getLabelAtCoordinate(this.tempCoord.x,this.tempCoord.y,this.tempCoord.z);l=Math.ceil(papayaMain.papayaViewer.atlas.maxLabels/2);q=h.length;a=b/2;for(r=0;r<q;r+=1){if(r<l){this.context.fillStyle="rgb(182, 59, 0)";this.context.font="bold "+papaya.viewer.Display.TEXT_MINI_VALUE_SIZE+"px Arial"}else{this.context.fillStyle="white";this.context.font="bold "+papaya.viewer.Display.TEXT_MINI_VALUE_SIZE+"px Arial"}p=this.context.measureText(h[r]);if(p.width>a){h[r]=(h[r].substr(0,Math.round(h[r].length/3))+" ... "+h[r].substr(h[r].length-3,3))}if(r===0){this.context.fillText(h[r],e,o)}else{if(r===1){this.context.fillText(h[r],e,i)}else{if(r===2){this.context.fillText(h[r],e+a,o)}else{if(r===3){this.context.fillText(h[r],e+a,i)}}}}}}else{papayaMain.papayaViewer.getWorldCoordinateAtIndex(k,n,u,this.tempCoord);h=papayaMain.papayaViewer.atlas.getLabelAtCoordinate(this.tempCoord.x,this.tempCoord.y,this.tempCoord.z);l=Math.ceil(papayaMain.papayaViewer.atlas.maxLabels/2);q=h.length;a=b/q-papaya.viewer.Display.TEXT_SPACING;for(r=0;r<q;r+=1){if(r<l){this.context.fillStyle="rgb(182, 59, 0)";this.context.font="bold "+papaya.viewer.Display.TEXT_VALUE_SIZE+"px Arial"}else{this.context.fillStyle="white";this.context.font="bold "+papaya.viewer.Display.TEXT_VALUE_SIZE+"px Arial"}p=this.context.measureText(h[r]);if(p.width>a){h[r]=(h[r].substr(0,Math.round(h[r].length/3))+" ... "+h[r].substr(h[r].length-3,3))}this.context.fillText(h[r],e+(r*a),s)}}}};papaya.viewer.Display.prototype.drawError=function(b){var a,c;this.drawingError=true;c=this;window.setTimeout(bind(c,function(){c.drawingError=false}),3000);this.context.clearRect(0,0,this.canvas.width,this.canvas.height);this.context.fillStyle="#000000";this.context.fillRect(0,0,this.canvas.width,this.canvas.height);this.context.fillStyle="red";this.context.font=papaya.viewer.Display.TEXT_CORRD_VALUE_SIZE+"px Arial";a=papaya.viewer.Display.TEXT_LABEL_SIZE+papaya.viewer.Display.TEXT_SPACING+1.5*papaya.viewer.Display.TEXT_SPACING;this.context.fillText(b,papaya.viewer.Display.TEXT_SPACING,a)};papaya.viewer.Display.prototype.drawProgress=function(a){var d,c,b;d=Math.round(a*1000);if(d>this.progress){this.progress=d;if(this.progress>=990){this.drawingProgress=false;this.progress=0;this.drawEmptyDisplay()}else{if(this.progressTimeout){window.clearTimeout(this.progressTimeout)}b=this;this.progressTimeout=window.setTimeout(bind(b,function(){b.drawingProgress=false}),3000);this.context.clearRect(0,0,this.canvas.width,this.canvas.height);this.context.fillStyle="#000000";this.context.fillRect(0,0,this.canvas.width,this.canvas.height);c=Math.round(255*a);this.context.fillStyle="rgb("+c+", "+c+", "+c+")";this.context.fillRect(0,0,this.canvas.width*a,this.canvas.height)}}};"use strict";var papaya=papaya||{};papaya.volume=papaya.volume||{};papaya.viewer.Preferences=papaya.viewer.Preferences||function(){this.showCrosshairs=papaya.viewer.Preferences.DEFAULT_SHOW_CROSSHAIRS;this.atlasLocks=papaya.viewer.Preferences.DEFAULT_ATLAS_LOCKS;this.showOrientation=papaya.viewer.Preferences.DEFAULT_SHOW_ORIENTATION;this.readPreferences()};papaya.viewer.Preferences.COOKIE_PREFIX="papaya-";papaya.viewer.Preferences.COOKIE_EXPIRY_DAYS=365;papaya.viewer.Preferences.DEFAULT_SHOW_CROSSHAIRS="All";papaya.viewer.Preferences.DEFAULT_ATLAS_LOCKS="Mouse";papaya.viewer.Preferences.DEFAULT_SHOW_ORIENTATION="Yes";papaya.viewer.Preferences.prototype.updatePreference=function(b,a){this[b]=a;papayaMain.papayaViewer.drawViewer(true);createCookie(papaya.viewer.Preferences.COOKIE_PREFIX+b,a,papaya.viewer.Preferences.COOKIE_EXPIRY_DAYS)};papaya.viewer.Preferences.prototype.readPreferences=function(){var b,a;for(b=0;b<papaya.ui.Toolbar.PREFERENCES_DATA.items.length;b+=1){a=readCookie(papaya.viewer.Preferences.COOKIE_PREFIX+papaya.ui.Toolbar.PREFERENCES_DATA.items[b].field);if(a){this[papaya.ui.Toolbar.PREFERENCES_DATA.items[b].field]=a}}};"use strict";var papaya=papaya||{};papaya.viewer=papaya.viewer||{};papaya.viewer.ScreenSlice=papaya.viewer.ScreenSlice||function(e,c,f,a,b,d,g){this.screenVolumes=g;this.sliceDirection=c;this.currentSlice=0;this.xDim=f;this.yDim=a;this.xSize=b;this.ySize=d;this.canvasMain=document.createElement("canvas");this.canvasMain.width=this.xDim;this.canvasMain.height=this.yDim;this.contextMain=this.canvasMain.getContext("2d");this.imageDataDraw=this.contextMain.createImageData(this.xDim,this.yDim);this.screenOffsetX=0;this.screenOffsetY=0;this.screenDim=0;this.xformScaleX=1;this.xformScaleY=1;this.xformTransX=0;this.xformTransY=0};papaya.viewer.ScreenSlice.DIRECTION_UNKNOWN=0;papaya.viewer.ScreenSlice.DIRECTION_AXIAL=1;papaya.viewer.ScreenSlice.DIRECTION_CORONAL=2;papaya.viewer.ScreenSlice.DIRECTION_SAGITTAL=3;papaya.viewer.ScreenSlice.SCREEN_PIXEL_MAX=255;papaya.viewer.ScreenSlice.SCREEN_PIXEL_MIN=0;papaya.viewer.ScreenSlice.prototype.updateSlice=function(h,a,e){var i,l,b,j,k,g,f,d,c;h=round(h);if(a||(this.currentSlice!==h)){this.currentSlice=h;i=this.screenVolumes[0].volume.header.origin;l=this.screenVolumes[0].volume.header.voxelDimensions;this.contextMain.clearRect(0,0,this.canvasMain.width,this.canvasMain.height);for(b=0;b<this.screenVolumes.length;b+=1){for(j=0;j<this.yDim;j+=1){for(k=0;k<this.xDim;k+=1){g=0;f=255;c=this.screenVolumes[b].alpha;if(b===0){if(this.sliceDirection===papaya.viewer.ScreenSlice.DIRECTION_AXIAL){g=this.screenVolumes[b].volume.getVoxelAtIndex(k,j,h,true)}else{if(this.sliceDirection===papaya.viewer.ScreenSlice.DIRECTION_CORONAL){g=this.screenVolumes[b].volume.getVoxelAtIndex(k,h,j,true)}else{if(this.sliceDirection===papaya.viewer.ScreenSlice.DIRECTION_SAGITTAL){g=this.screenVolumes[b].volume.getVoxelAtIndex(h,k,j,true)}}}}else{if(e){if(this.sliceDirection===papaya.viewer.ScreenSlice.DIRECTION_AXIAL){g=this.screenVolumes[b].volume.getVoxelAtCoordinate((k-i.x)*l.xSize,(i.y-j)*l.ySize,(i.z-h)*l.zSize,false)}else{if(this.sliceDirection===papaya.viewer.ScreenSlice.DIRECTION_CORONAL){g=this.screenVolumes[b].volume.getVoxelAtCoordinate((k-i.x)*l.xSize,(i.y-h)*l.ySize,(i.z-j)*l.zSize,false)}else{if(this.sliceDirection===papaya.viewer.ScreenSlice.DIRECTION_SAGITTAL){g=this.screenVolumes[b].volume.getVoxelAtCoordinate((h-i.x)*l.xSize,(i.y-k)*l.ySize,(i.z-j)*l.zSize,false)}}}}else{if(this.sliceDirection===papaya.viewer.ScreenSlice.DIRECTION_AXIAL){g=this.screenVolumes[b].volume.getVoxelAtMM(k*l.xSize,j*l.ySize,h*l.zSize,false)}else{if(this.sliceDirection===papaya.viewer.ScreenSlice.DIRECTION_CORONAL){g=this.screenVolumes[b].volume.getVoxelAtMM(k*l.xSize,h*l.ySize,j*l.zSize,false)}else{if(this.sliceDirection===papaya.viewer.ScreenSlice.DIRECTION_SAGITTAL){g=this.screenVolumes[b].volume.getVoxelAtMM(h*l.xSize,k*l.ySize,j*l.zSize,false)}}}}}if((!this.screenVolumes[b].negative&&(g<=this.screenVolumes[b].screenMin))||(this.screenVolumes[b].negative&&(g>=this.screenVolumes[b].screenMin))||isNaN(g)){g=papaya.viewer.ScreenSlice.SCREEN_PIXEL_MIN;f=this.screenVolumes[b].isOverlay()?0:255}else{if((!this.screenVolumes[b].negative&&(g>=this.screenVolumes[b].screenMax))||(this.screenVolumes[b].negative&&(g<=this.screenVolumes[b].screenMax))){g=papaya.viewer.ScreenSlice.SCREEN_PIXEL_MAX}else{g=round(((g-this.screenVolumes[b].screenMin)*this.screenVolumes[b].screenRatio)+0.5)}}if((f>0)||(b===0)){d=((j*this.xDim)+k)*4;this.imageDataDraw.data[d]=(this.imageDataDraw.data[d]*(1-c)+this.screenVolumes[b].colorTable.lookupRed(g)*c);this.imageDataDraw.data[d+1]=(this.imageDataDraw.data[d+1]*(1-c)+this.screenVolumes[b].colorTable.lookupGreen(g)*c);this.imageDataDraw.data[d+2]=(this.imageDataDraw.data[d+2]*(1-c)+this.screenVolumes[b].colorTable.lookupBlue(g)*c);this.imageDataDraw.data[d+3]=f}}}}this.contextMain.putImageData(this.imageDataDraw,0,0)}};papaya.viewer.ScreenSlice.prototype.getRealWidth=function(){return this.xDim*this.xSize};papaya.viewer.ScreenSlice.prototype.getRealHeight=function(){return this.yDim*this.ySize};papaya.viewer.ScreenSlice.prototype.getXYratio=function(){return this.xSize/this.ySize};papaya.viewer.ScreenSlice.prototype.getYXratio=function(){return this.ySize/this.xSize};papaya.viewer.ScreenSlice.prototype.getXSize=function(){return this.xSize};papaya.viewer.ScreenSlice.prototype.getYSize=function(){return this.ySize};papaya.viewer.ScreenSlice.prototype.getXDim=function(){return this.xDim};papaya.viewer.ScreenSlice.prototype.getYDim=function(){return this.yDim};"use strict";var papaya=papaya||{};papaya.viewer=papaya.viewer||{};papaya.viewer.ScreenVolume=papaya.viewer.ScreenVolume||function(a,d,b,c){this.volume=a;this.lutName=d;this.colorTable=new papaya.viewer.ColorTable(this.lutName,b,true);this.screenMin=this.volume.header.imageRange.displayMin;this.screenMax=this.volume.header.imageRange.displayMax;this.imageMin=this.volume.header.imageRange.imageMin;this.imageMax=this.volume.header.imageRange.imageMax;this.alpha=1;this.imageRangeChecked=false;this.findImageRange();var e=papayaParams[this.volume.fileName];if(e){if((e.min!==undefined)&&(e.max!==undefined)){if(c){this.screenMin=-1*Math.abs(e.min);this.screenMax=-1*Math.abs(e.max)}else{this.screenMin=Math.abs(e.min);this.screenMax=Math.abs(e.max)}}else{this.findDisplayRange(c)}if(e.lut!==undefined){this.lutName=e.lut;this.colorTable=new papaya.viewer.ColorTable(this.lutName,b,true)}if((e.alpha!==undefined)&&!b){this.alpha=e.alpha}}else{this.findDisplayRange(c)}this.negative=(this.screenMax<this.screenMin);this.updateScreenRange()};papaya.viewer.ScreenVolume.prototype.setScreenRange=function(b,a){this.screenMin=b;this.screenMax=a;this.updateScreenRange()};papaya.viewer.ScreenVolume.prototype.updateScreenRange=function(){this.screenRatio=(papaya.viewer.ScreenSlice.SCREEN_PIXEL_MAX/(this.screenMax-this.screenMin))};papaya.viewer.ScreenVolume.prototype.isOverlay=function(){return !this.colorTable.isBaseImage};papaya.viewer.ScreenVolume.prototype.findImageRange=function(a){var d,c,f,b,k,e,h,i,j,g;d=(this.imageMin!==this.imageMax);if((!d||a)&&!this.imageRangeChecked){c=Number.MAX_VALUE;f=Number.MIN_VALUE;b=this.volume.header.imageDimensions.xDim;k=this.volume.header.imageDimensions.yDim;e=this.volume.header.imageDimensions.zDim;for(h=0;h<e;h+=1){for(i=0;i<k;i+=1){for(j=0;j<b;j+=1){g=this.volume.getVoxelAtIndex(j,i,h);if(g>f){f=g}if(g<c){c=g}}}}this.imageRangeChecked=true;this.imageMin=c;this.imageMax=f}};papaya.viewer.ScreenVolume.prototype.findDisplayRange=function(d){var c,a,b;c=this.screenMin;a=this.screenMax;if(d){if(Math.abs(c)>Math.abs(a)){b=a;a=c;c=b}}if(this.isOverlay()){if((c===a)||((c<0)&&(a>0))||((c>0)&&(a<0))||(d&&((c>0)||(a>0)))){this.findImageRange(true);if(d){c=this.imageMin-(this.imageMin*0.75);a=this.imageMin-(this.imageMin*0.25)}else{c=this.imageMax-(this.imageMax*0.75);a=this.imageMax-(this.imageMax*0.25)}}if(!((c<1)&&(c>-1)&&(a<1)&&(a>-1))){c=Math.round(c);a=Math.round(a)}}else{if(!((c<1)&&(c>-1)&&(a<1)&&(a>-1))){c=Math.round(c);a=Math.round(a)}if((c===0)&&(a===0)){this.findImageRange(true);c=this.imageMin;a=this.imageMax}if(!(a>c)){this.findImageRange(true);c=this.imageMin;a=this.imageMax}if(c<this.imageMin){this.findImageRange(true);c=this.imageMin}if(a>this.imageMax){this.findImageRange(true);a=this.imageMax}}this.screenMin=c;this.screenMax=a};papaya.viewer.ScreenVolume.prototype.isUsingColorTable=function(a){return(this.lutName===a)};papaya.viewer.ScreenVolume.prototype.changeColorTable=function(a){this.colorTable=new papaya.viewer.ColorTable(a,!this.isOverlay(),true);this.lutName=a;papayaMain.papayaViewer.drawViewer(true)};papaya.viewer.ScreenVolume.prototype.getRange=function(){var a=new Array(2);a[0]=this.screenMin;a[1]=this.screenMax;return a};"use strict";var papaya=papaya||{};papaya.viewer=papaya.viewer||{};var PAPAYA_VERSION_ID=PAPAYA_VERSION_ID||"0.0";var PAPAYA_BUILD_NUM=PAPAYA_BUILD_NUM||"0";papaya.viewer.Viewer=papaya.viewer.Viewer||function(b,a,c){this.canvas=document.createElement("canvas");this.canvas.width=b;this.canvas.height=a;this.context=this.canvas.getContext("2d");this.canvas.style.padding=0;this.canvas.style.margin=0;this.canvas.style.border="none";this.atlas=null;this.initialized=false;this.loadingVolume=null;this.volume=new papaya.volume.Volume();this.screenVolumes=[];this.currentScreenVolume=null;this.axialSlice=null;this.coronalSlice=null;this.sagittalSlice=null;this.mainImage=null;this.lowerImageBot=null;this.lowerImageTop=null;this.viewerDim=0;this.worldSpace=false;this.currentCoord=new papaya.core.Coordinate(0,0,0);this.longestDim=0;this.longestDimSize=0;this.draggingSliceDir=0;this.isDragging=false;this.isWindowControl=false;this.previousMousePosition=new papaya.core.Point();this.isControlKeyDown=false;this.toggleMainCrosshairs=true;this.listenerMouseMove=bind(this,this.mouseMoveEvent);this.listenerMouseDown=bind(this,this.mouseDownEvent);this.listenerMouseOut=bind(this,this.mouseOutEvent);this.listenerMouseUp=bind(this,this.mouseUpEvent);this.listenerKeyDown=bind(this,this.keyDownEvent);this.listenerKeyUp=bind(this,this.keyUpEvent);this.listenerTouchMove=bind(this,this.touchMoveEvent);this.updateTimer=null;this.updateTimerEvent=null;this.listenerContextMenu=function(d){d.preventDefault();return false};this.drawEmptyViewer();this.processParams(c)};papaya.viewer.Viewer.GAP=PAPAYA_SPACING;papaya.viewer.Viewer.BACKGROUND_COLOR="rgba(0, 0, 0, 255)";papaya.viewer.Viewer.CROSSHAIRS_COLOR="rgba(28, 134, 238, 255)";papaya.viewer.Viewer.KEYCODE_ROTATE_VIEWS=32;papaya.viewer.Viewer.KEYCODE_CENTER=67;papaya.viewer.Viewer.KEYCODE_ORIGIN=79;papaya.viewer.Viewer.KEYCODE_ARROW_UP=38;papaya.viewer.Viewer.KEYCODE_ARROW_DOWN=40;papaya.viewer.Viewer.KEYCODE_ARROW_RIGHT=39;papaya.viewer.Viewer.KEYCODE_ARROW_LEFT=37;papaya.viewer.Viewer.KEYCODE_PAGE_UP=33;papaya.viewer.Viewer.KEYCODE_PAGE_DOWN=34;papaya.viewer.Viewer.KEYCODE_SINGLE_QUOTE=222;papaya.viewer.Viewer.KEYCODE_FORWARD_SLASH=191;papaya.viewer.Viewer.KEYCODE_INCREMENT_MAIN=71;papaya.viewer.Viewer.KEYCODE_DECREMENT_MAIN=86;papaya.viewer.Viewer.KEYCODE_TOGGLE_CROSSHAIRS=65;papaya.viewer.Viewer.MAX_OVERLAYS=8;papaya.viewer.Viewer.ORIENTATION_MARKER_SUPERIOR="S";papaya.viewer.Viewer.ORIENTATION_MARKER_INFERIOR="I";papaya.viewer.Viewer.ORIENTATION_MARKER_ANTERIOR="A";papaya.viewer.Viewer.ORIENTATION_MARKER_POSTERIOR="P";papaya.viewer.Viewer.ORIENTATION_MARKER_LEFT="L";papaya.viewer.Viewer.ORIENTATION_MARKER_RIGHT="R";papaya.viewer.Viewer.ORIENTATION_MARKER_SIZE=16;papaya.viewer.Viewer.ORIENTATION_CERTAINTY_UNKNOWN_COLOR="red";papaya.viewer.Viewer.ORIENTATION_CERTAINTY_LOW_COLOR="yellow";papaya.viewer.Viewer.ORIENTATION_CERTAINTY_HIGH_COLOR="white";papaya.viewer.Viewer.UPDATE_TIMER_INTERVAL=250;papaya.viewer.Viewer.prototype.loadImage=function(b,a,c){if(this.screenVolumes.length===0){this.loadBaseImage(b,a,c)}else{this.loadOverlay(b,a,c)}};papaya.viewer.Viewer.prototype.loadBaseImage=function(c,b,d){var a=papayaMain.findLoadableImage(c,b,d);this.volume=new papaya.volume.Volume();if(d){this.volume.readEncodedData(c,bind(this,this.initializeViewer))}else{if((a!==null)&&(a.encode!==undefined)){this.volume.readEncodedData(a.encode,bind(this,this.initializeViewer))}else{if(b){this.volume.readURL(c,bind(this,this.initializeViewer))}else{if((a!==null)&&(a.url!==undefined)){this.volume.readURL(a.url,bind(this,this.initializeViewer))}else{this.volume.readFile(c,bind(this,this.initializeViewer))}}}}};papaya.viewer.Viewer.prototype.loadOverlay=function(c,b,d){var a=papayaMain.findLoadableImage(c);this.loadingVolume=new papaya.volume.Volume();if(this.screenVolumes.length>papaya.viewer.Viewer.MAX_OVERLAYS){this.loadingVolume.errorMessage="Maximum number of overlays ("+papaya.viewer.Viewer.MAX_OVERLAYS+") has been reached!";this.initializeOverlay()}else{if(d){this.loadingVolume.readEncodedData(c,bind(this,this.initializeOverlay))}else{if((a!==null)&&(a.encode!==undefined)){this.loadingVolume.readEncodedData(a.encode,bind(this,this.initializeOverlay))}else{if(b){this.loadingVolume.readURL(c,bind(this,this.initializeOverlay))}else{if((a!==null)&&(a.url!==undefined)){this.loadingVolume.readURL(a.url,bind(this,this.initializeOverlay))}else{this.loadingVolume.readFile(c,bind(this,this.initializeOverlay))}}}}}};papaya.viewer.Viewer.prototype.initializeViewer=function(){var a,b;if(this.volume.hasError()){console.error(this.volume.errorMessage);if(papayaMain.papayaDisplay){papayaMain.papayaDisplay.drawError(this.volume.errorMessage)}return}a=(typeof papaya.data);if(a!=="undefined"){b=(typeof papaya.data.Atlas);if(b!=="undefined"){this.atlas=new papaya.viewer.Atlas(papaya.data.Atlas)}}this.screenVolumes[0]=new papaya.viewer.ScreenVolume(this.volume,papaya.viewer.ColorTable.DEFAULT_COLOR_TABLE.name,true);this.setCurrentScreenVol(0);this.mainImage=this.axialSlice=new papaya.viewer.ScreenSlice(this.volume,papaya.viewer.ScreenSlice.DIRECTION_AXIAL,this.volume.getXDim(),this.volume.getYDim(),this.volume.getXSize(),this.volume.getYSize(),this.screenVolumes);this.lowerImageBot=this.coronalSlice=new papaya.viewer.ScreenSlice(this.volume,papaya.viewer.ScreenSlice.DIRECTION_CORONAL,this.volume.getXDim(),this.volume.getZDim(),this.volume.getXSize(),this.volume.getZSize(),this.screenVolumes);this.lowerImageTop=this.sagittalSlice=new papaya.viewer.ScreenSlice(this.volume,papaya.viewer.ScreenSlice.DIRECTION_SAGITTAL,this.volume.getYDim(),this.volume.getZDim(),this.volume.getYSize(),this.volume.getZSize(),this.screenVolumes);this.canvas.addEventListener("mousemove",this.listenerMouseMove,false);this.canvas.addEventListener("mousedown",this.listenerMouseDown,false);this.canvas.addEventListener("mouseout",this.listenerMouseOut,false);document.addEventListener("mouseup",this.listenerMouseUp,false);document.addEventListener("keydown",this.listenerKeyDown,true);document.addEventListener("keyup",this.listenerKeyUp,true);document.addEventListener("contextmenu",this.listenerContextMenu,false);this.canvas.addEventListener("touchmove",this.listenerTouchMove,false);this.canvas.addEventListener("touchstart",this.listenerMouseDown,false);this.canvas.addEventListener("touchend",this.listenerMouseUp,false);this.setLongestDim(this.volume);this.calculateScreenSliceTransforms(this);this.currentCoord.setCoordinate(this.volume.getXDim()/2,this.volume.getYDim()/2,this.volume.getZDim()/2);this.canvasRect=this.canvas.getBoundingClientRect();this.context.fillStyle="white";this.context.fillRect(0,0,this.canvasRect.right,this.canvasRect.bottom);this.initialized=true;this.drawViewer();papayaMain.papayaToolbar.buildToolbar();papayaMain.papayaToolbar.updateImageButtons();papayaMain.loadNext()};papaya.viewer.Viewer.prototype.initializeOverlay=function(){var b,a;if(this.loadingVolume.hasError()){papayaMain.papayaDisplay.drawError(this.loadingVolume.errorMessage);this.loadingVolume=null;return}b=papayaParams[this.loadingVolume.fileName];a=(b&&b.parametric);this.screenVolumes[this.screenVolumes.length]=new papaya.viewer.ScreenVolume(this.loadingVolume,(a?papaya.viewer.ColorTable.PARAMETRIC_COLOR_TABLES[0].name:this.getNextColorTable()),false);this.setCurrentScreenVol(this.screenVolumes.length-1);this.drawViewer(true);papayaMain.papayaToolbar.buildToolbar();papayaMain.papayaToolbar.updateImageButtons();if(a){this.screenVolumes[this.screenVolumes.length]=new papaya.viewer.ScreenVolume(this.loadingVolume,papaya.viewer.ColorTable.PARAMETRIC_COLOR_TABLES[1].name,false,true);this.setCurrentScreenVol(this.screenVolumes.length-1);this.drawViewer(true);papayaMain.papayaToolbar.buildToolbar();papayaMain.papayaToolbar.updateImageButtons()}this.loadingVolume=null;papayaMain.loadNext()};papaya.viewer.Viewer.prototype.updatePosition=function(g,f,e,b){var d,c,a;f=f-this.canvasRect.left;e=e-this.canvasRect.top;if(this.insideScreenSlice(g.axialSlice,f,e,g.volume.getXDim(),g.volume.getYDim())){if(!this.isDragging||(this.draggingSliceDir===papaya.viewer.ScreenSlice.DIRECTION_AXIAL)){d=(f-g.axialSlice.xformTransX)/g.axialSlice.xformScaleX;c=(e-g.axialSlice.xformTransY)/g.axialSlice.xformScaleY;if((d!==g.currentCoord.x)||(c!==g.currentCoord.y)){g.currentCoord.x=d;g.currentCoord.y=c;this.draggingSliceDir=papaya.viewer.ScreenSlice.DIRECTION_AXIAL}}}else{if(this.insideScreenSlice(g.coronalSlice,f,e,g.volume.getXDim(),g.volume.getZDim())){if(!this.isDragging||(this.draggingSliceDir===papaya.viewer.ScreenSlice.DIRECTION_CORONAL)){d=(f-g.coronalSlice.xformTransX)/g.coronalSlice.xformScaleX;c=(e-g.coronalSlice.xformTransY)/g.coronalSlice.xformScaleY;if((d!==g.currentCoord.x)||(c!==g.currentCoord.y)){g.currentCoord.x=d;g.currentCoord.z=c;this.draggingSliceDir=papaya.viewer.ScreenSlice.DIRECTION_CORONAL}}}else{if(this.insideScreenSlice(g.sagittalSlice,f,e,g.volume.getYDim(),g.volume.getZDim())){if(!this.isDragging||(this.draggingSliceDir===papaya.viewer.ScreenSlice.DIRECTION_SAGITTAL)){d=(f-g.sagittalSlice.xformTransX)/g.sagittalSlice.xformScaleX;c=(e-g.sagittalSlice.xformTransY)/g.sagittalSlice.xformScaleY;if((d!==g.currentCoord.x)||(c!==g.currentCoord.y)){a=d;g.currentCoord.y=a;g.currentCoord.z=c;this.draggingSliceDir=papaya.viewer.ScreenSlice.DIRECTION_SAGITTAL}}}}}g.drawViewer(false,b)};papaya.viewer.Viewer.prototype.updateCursorPosition=function(g,f,d){var c,b,a,e;if(papayaMain.papayaDisplay){f=f-this.canvasRect.left;d=d-this.canvasRect.top;if(this.insideScreenSlice(g.axialSlice,f,d,g.volume.getXDim(),g.volume.getYDim())){c=(f-g.axialSlice.xformTransX)/g.axialSlice.xformScaleX;b=(d-g.axialSlice.xformTransY)/g.axialSlice.xformScaleY;a=g.axialSlice.currentSlice;e=true}else{if(this.insideScreenSlice(g.coronalSlice,f,d,g.volume.getXDim(),g.volume.getZDim())){c=(f-g.coronalSlice.xformTransX)/g.coronalSlice.xformScaleX;a=(d-g.coronalSlice.xformTransY)/g.coronalSlice.xformScaleY;b=g.coronalSlice.currentSlice;e=true}else{if(this.insideScreenSlice(g.sagittalSlice,f,d,g.volume.getYDim(),g.volume.getZDim())){b=(f-g.sagittalSlice.xformTransX)/g.sagittalSlice.xformScaleX;a=(d-g.sagittalSlice.xformTransY)/g.sagittalSlice.xformScaleY;c=g.sagittalSlice.currentSlice;e=true}}}if(e){papayaMain.papayaDisplay.drawDisplay(c,b,a)}else{papayaMain.papayaDisplay.drawEmptyDisplay()}}};papaya.viewer.Viewer.prototype.insideScreenSlice=function(f,d,a,h,c){var e,b,i,g;e=round(f.xformTransX);b=round(f.xformTransX+h*f.xformScaleX);i=round(f.xformTransY);g=round(f.xformTransY+c*f.xformScaleY);return((d>=e)&&(d<b)&&(a>=i)&&(a<g))};papaya.viewer.Viewer.prototype.drawEmptyViewer=function(){var a,c,e,b,d;this.context.fillStyle="#000000";this.context.fillRect(0,0,this.canvas.width,this.canvas.height);this.context.fillStyle="#AAAAAA";c=18;this.context.font=c+"px Arial";a=this.canvas.height-22;e="Drop here or click the File menu";b=this.context.measureText(e);d=b.width;this.context.fillText(e,(this.canvas.width/2)-(d/2),a);if(this.canvas.width>900){c=14;this.context.font=c+"px Arial";a=this.canvas.height-20;e="Supported formats: NIFTI (.nii, .nii.gz)";this.context.fillText(e,20,a);c=14;this.context.font=c+"px Arial";a=this.canvas.height-20;e="Papaya v"+(PAPAYA_VERSION_ID||"Dev")+" (build "+(PAPAYA_BUILD_NUM!==undefined?PAPAYA_BUILD_NUM:"Dev")+")";b=this.context.measureText(e);d=b.width;this.context.fillText(e,this.canvas.width-d-20,a)}};papaya.viewer.Viewer.prototype.drawViewer=function(a,i){var e,q,l,h,r,k,g,p,f,m,b,j,d,c,o,n;if(!this.initialized){this.drawEmptyViewer();return}this.context.save();if(!i){if(a||(this.draggingSliceDir!==papaya.viewer.ScreenSlice.DIRECTION_AXIAL)){this.axialSlice.updateSlice(this.currentCoord.z,a,this.worldSpace)}if(a||(this.draggingSliceDir!==papaya.viewer.ScreenSlice.DIRECTION_CORONAL)){this.coronalSlice.updateSlice(this.currentCoord.y,a,this.worldSpace)}if(a||(this.draggingSliceDir!==papaya.viewer.ScreenSlice.DIRECTION_SAGITTAL)){this.sagittalSlice.updateSlice(this.currentCoord.x,a,this.worldSpace)}}this.context.fillStyle=papaya.viewer.Viewer.BACKGROUND_COLOR;this.context.setTransform(1,0,0,1,0,0);this.context.fillRect(this.mainImage.screenOffsetX,this.mainImage.screenOffsetY,this.mainImage.screenDim,this.mainImage.screenDim);this.context.setTransform(this.mainImage.xformScaleX,0,0,this.mainImage.xformScaleY,this.mainImage.xformTransX,this.mainImage.xformTransY);this.context.drawImage(this.mainImage.canvasMain,0,0);this.context.setTransform(1,0,0,1,0,0);this.context.fillRect(this.lowerImageBot.screenOffsetX,this.lowerImageBot.screenOffsetY,this.lowerImageBot.screenDim,this.lowerImageBot.screenDim);this.context.setTransform(this.lowerImageBot.xformScaleX,0,0,this.lowerImageBot.xformScaleY,this.lowerImageBot.xformTransX,this.lowerImageBot.xformTransY);this.context.drawImage(this.lowerImageBot.canvasMain,0,0);this.context.setTransform(1,0,0,1,0,0);this.context.fillRect(this.lowerImageTop.screenOffsetX,this.lowerImageTop.screenOffsetY,this.lowerImageTop.screenDim,this.lowerImageTop.screenDim);this.context.setTransform(this.lowerImageTop.xformScaleX,0,0,this.lowerImageTop.xformScaleY,this.lowerImageTop.xformTransX,this.lowerImageTop.xformTransY);this.context.drawImage(this.lowerImageTop.canvasMain,0,0);if(papayaMain.preferences.showOrientation==="Yes"){this.context.setTransform(1,0,0,1,0,0);this.context.fillStyle=this.getOrientationCertaintyColor();this.context.font=papaya.viewer.Viewer.ORIENTATION_MARKER_SIZE+"px Arial";m=this.context.measureText("X");b=m.width;if(this.mainImage===this.axialSlice){e=this.volume.header.imageDimensions.xDim;q=this.volume.header.imageDimensions.yDim;j=papaya.viewer.Viewer.ORIENTATION_MARKER_ANTERIOR;d=papaya.viewer.Viewer.ORIENTATION_MARKER_POSTERIOR;c=papaya.viewer.Viewer.ORIENTATION_MARKER_LEFT;o=papaya.viewer.Viewer.ORIENTATION_MARKER_RIGHT;f=this.axialSlice}else{if(this.mainImage===this.coronalSlice){e=this.volume.header.imageDimensions.xDim;q=this.volume.header.imageDimensions.zDim;j=papaya.viewer.Viewer.ORIENTATION_MARKER_SUPERIOR;d=papaya.viewer.Viewer.ORIENTATION_MARKER_INFERIOR;c=papaya.viewer.Viewer.ORIENTATION_MARKER_LEFT;o=papaya.viewer.Viewer.ORIENTATION_MARKER_RIGHT;f=this.coronalSlice}else{if(this.mainImage===this.sagittalSlice){n=this.volume.header.imageDimensions.yDim;e=n;q=this.volume.header.imageDimensions.zDim;j=papaya.viewer.Viewer.ORIENTATION_MARKER_SUPERIOR;d=papaya.viewer.Viewer.ORIENTATION_MARKER_INFERIOR;c=papaya.viewer.Viewer.ORIENTATION_MARKER_ANTERIOR;o=papaya.viewer.Viewer.ORIENTATION_MARKER_POSTERIOR;f=this.sagittalSlice}}}l=f.xformTransX;h=floor(f.xformTransX+e*f.xformScaleX);r=floor(f.xformTransX+(e/2)*f.xformScaleX);k=f.xformTransY;g=floor(f.xformTransY+q*f.xformScaleY);p=floor(f.xformTransY+(q/2)*f.xformScaleY);this.context.fillText(j,r-(b/2),k+papaya.viewer.Viewer.ORIENTATION_MARKER_SIZE*1.5);this.context.fillText(d,r-(b/2),g-papaya.viewer.Viewer.ORIENTATION_MARKER_SIZE);this.context.fillText(c,l+papaya.viewer.Viewer.ORIENTATION_MARKER_SIZE,p+(papaya.viewer.Viewer.ORIENTATION_MARKER_SIZE*0.5));this.context.fillText(o,h-1.5*papaya.viewer.Viewer.ORIENTATION_MARKER_SIZE,p+(papaya.viewer.Viewer.ORIENTATION_MARKER_SIZE*0.5))}if(papayaMain.preferences.showCrosshairs!=="None"){this.drawCrosshairs()}if(papayaMain.papayaDisplay){papayaMain.papayaDisplay.drawDisplay(this.currentCoord.x,this.currentCoord.y,this.currentCoord.z,this.getCurrentValueAt(this.currentCoord.x,this.currentCoord.y,this.currentCoord.z))}};papaya.viewer.Viewer.prototype.drawCrosshairs=function(){var f,c,e,b,d,a;this.context.setTransform(1,0,0,1,0,0);this.context.strokeStyle=papaya.viewer.Viewer.CROSSHAIRS_COLOR;this.context.lineWidth=1;this.context.beginPath();if(((this.mainImage!==this.axialSlice)&&(papayaMain.preferences.showCrosshairs!=="Main"))||((this.mainImage===this.axialSlice)&&(papayaMain.preferences.showCrosshairs!=="Lower")&&this.toggleMainCrosshairs)){f=floor(this.axialSlice.xformTransX+(this.currentCoord.x)*this.axialSlice.xformScaleX);c=floor(this.axialSlice.xformTransY);e=floor(this.axialSlice.xformTransY+this.axialSlice.yDim*this.axialSlice.xformScaleY);this.context.moveTo(f+0.5,c);this.context.lineTo(f+0.5,e);b=floor(this.axialSlice.xformTransY+(this.currentCoord.y)*this.axialSlice.xformScaleY);d=floor(this.axialSlice.xformTransX);a=floor(this.axialSlice.xformTransX+this.axialSlice.xDim*this.axialSlice.xformScaleX);this.context.moveTo(d,b+0.5);this.context.lineTo(a,b+0.5)}if(((this.mainImage!==this.coronalSlice)&&(papayaMain.preferences.showCrosshairs!=="Main"))||((this.mainImage===this.coronalSlice)&&(papayaMain.preferences.showCrosshairs!=="Lower")&&this.toggleMainCrosshairs)){f=floor(this.coronalSlice.xformTransX+this.currentCoord.x*this.coronalSlice.xformScaleX);c=floor(this.coronalSlice.xformTransY);e=floor(this.coronalSlice.xformTransY+this.coronalSlice.yDim*this.coronalSlice.xformScaleY);this.context.moveTo(f+0.5,c);this.context.lineTo(f+0.5,e);b=floor(this.coronalSlice.xformTransY+this.currentCoord.z*this.coronalSlice.xformScaleY);d=floor(this.coronalSlice.xformTransX);a=floor(this.coronalSlice.xformTransX+this.coronalSlice.xDim*this.coronalSlice.xformScaleX);this.context.moveTo(d,b+0.5);this.context.lineTo(a,b+0.5)}if(((this.mainImage!==this.sagittalSlice)&&(papayaMain.preferences.showCrosshairs!=="Main"))||((this.mainImage===this.sagittalSlice)&&(papayaMain.preferences.showCrosshairs!=="Lower")&&this.toggleMainCrosshairs)){f=floor(this.sagittalSlice.xformTransX+this.currentCoord.y*this.sagittalSlice.xformScaleX);c=floor(this.sagittalSlice.xformTransY);e=floor(this.sagittalSlice.xformTransY+this.sagittalSlice.yDim*this.sagittalSlice.xformScaleY);this.context.moveTo(f+0.5,c);this.context.lineTo(f+0.5,e);b=floor(this.sagittalSlice.xformTransY+this.currentCoord.z*this.sagittalSlice.xformScaleY);d=floor(this.sagittalSlice.xformTransX);a=floor(this.sagittalSlice.xformTransX+this.sagittalSlice.xDim*this.sagittalSlice.xformScaleX);this.context.moveTo(d,b+0.5);this.context.lineTo(a,b+0.5)}this.context.closePath();this.context.stroke();this.context.restore()};papaya.viewer.Viewer.prototype.calculateScreenSliceTransforms=function(a){a.viewerDim=a.canvas.height;this.getTransformParameters(a.mainImage,a.viewerDim,false);a.mainImage.xformTransX+=a.mainImage.screenOffsetX=0;a.mainImage.xformTransY+=a.mainImage.screenOffsetY=0;this.getTransformParameters(a.lowerImageBot,a.viewerDim,true);a.lowerImageBot.xformTransX+=a.lowerImageBot.screenOffsetX=(a.viewerDim+(papaya.viewer.Viewer.GAP));a.lowerImageBot.xformTransY+=a.lowerImageBot.screenOffsetY=(((a.viewerDim-papaya.viewer.Viewer.GAP)/2)+(papaya.viewer.Viewer.GAP));this.getTransformParameters(a.lowerImageTop,a.viewerDim,true);a.lowerImageTop.xformTransX+=a.lowerImageTop.screenOffsetX=(a.viewerDim+(papaya.viewer.Viewer.GAP));a.lowerImageTop.xformTransY+=a.lowerImageTop.screenOffsetY=0};papaya.viewer.Viewer.prototype.getTransformParameters=function(g,a,f){var h,e,d,c,b;h=f?2:1;if(g.getRealWidth()>g.getRealHeight()){e=(((f?a-papaya.viewer.Viewer.GAP:a)/this.longestDim)/h)*(g.getXSize()/this.longestDimSize);d=((((f?a-papaya.viewer.Viewer.GAP:a)/this.longestDim)*g.getYXratio())/h)*(g.getXSize()/this.longestDimSize)}else{e=((((f?a-papaya.viewer.Viewer.GAP:a)/this.longestDim)*g.getXYratio())/h)*(g.getYSize()/this.longestDimSize);d=(((f?a-papaya.viewer.Viewer.GAP:a)/this.longestDim)/h)*(g.getYSize()/this.longestDimSize)}c=(((f?a-papaya.viewer.Viewer.GAP:a)/h)-(g.getXDim()*e))/2;b=(((f?a-papaya.viewer.Viewer.GAP:a)/h)-(g.getYDim()*d))/2;g.screenDim=(f?(a-papaya.viewer.Viewer.GAP)/2:a);g.xformScaleX=e;g.xformScaleY=d;g.xformTransX=c;g.xformTransY=b};papaya.viewer.Viewer.prototype.setLongestDim=function(a){this.longestDim=a.getXDim();this.longestDimSize=a.getXSize();if((a.getYDim()*a.getYSize())>(this.longestDim*this.longestDimSize)){this.longestDim=a.getYDim();this.longestDimSize=a.getYSize()}if((a.getZDim()*a.getZSize())>(this.longestDim*this.longestDimSize)){this.longestDim=a.getZDim();this.longestDimSize=a.getZSize()}};papaya.viewer.Viewer.prototype.keyDownEvent=function(c){var d,b,a;if(papayaMain.papayaToolbar.isShowingMenus()){return}d=getKeyCode(c);if(isControlKey(c)){this.isControlKeyDown=true}else{if(d===papaya.viewer.Viewer.KEYCODE_ROTATE_VIEWS){b=this.lowerImageBot;this.lowerImageBot=this.lowerImageTop;this.lowerImageTop=this.mainImage;this.mainImage=b;this.calculateScreenSliceTransforms(this);this.drawViewer()}else{if(d===papaya.viewer.Viewer.KEYCODE_CENTER){a=new papaya.core.Coordinate(Math.floor(this.volume.header.imageDimensions.xDim/2),Math.floor(this.volume.header.imageDimensions.yDim/2),Math.floor(this.volume.header.imageDimensions.zDim/2));this.gotoCoordinate(a)}else{if(d===papaya.viewer.Viewer.KEYCODE_ORIGIN){this.gotoCoordinate(this.volume.header.origin)}else{if(d===papaya.viewer.Viewer.KEYCODE_ARROW_UP){this.currentCoord.y-=1;this.gotoCoordinate(this.currentCoord)}else{if(d===papaya.viewer.Viewer.KEYCODE_ARROW_DOWN){this.currentCoord.y+=1;this.gotoCoordinate(this.currentCoord)}else{if(d===papaya.viewer.Viewer.KEYCODE_ARROW_LEFT){this.currentCoord.x-=1;this.gotoCoordinate(this.currentCoord)}else{if(d===papaya.viewer.Viewer.KEYCODE_ARROW_RIGHT){this.currentCoord.x+=1;this.gotoCoordinate(this.currentCoord)}else{if((d===papaya.viewer.Viewer.KEYCODE_PAGE_DOWN)||(d===papaya.viewer.Viewer.KEYCODE_FORWARD_SLASH)){this.currentCoord.z+=1;this.gotoCoordinate(this.currentCoord)}else{if((d===papaya.viewer.Viewer.KEYCODE_PAGE_UP)||(d===papaya.viewer.Viewer.KEYCODE_SINGLE_QUOTE)){this.currentCoord.z-=1;this.gotoCoordinate(this.currentCoord)}else{if((d===papaya.viewer.Viewer.KEYCODE_PAGE_DOWN)||(d===papaya.viewer.Viewer.KEYCODE_FORWARD_SLASH)){this.currentCoord.z+=1;this.gotoCoordinate(this.currentCoord)}else{if(d===papaya.viewer.Viewer.KEYCODE_INCREMENT_MAIN){if(this.mainImage.sliceDirection===papaya.viewer.ScreenSlice.DIRECTION_AXIAL){this.currentCoord.z-=1}else{if(this.mainImage.sliceDirection===papaya.viewer.ScreenSlice.DIRECTION_CORONAL){this.currentCoord.y-=1}else{if(this.mainImage.sliceDirection===papaya.viewer.ScreenSlice.DIRECTION_SAGITTAL){this.currentCoord.x+=1}}}this.gotoCoordinate(this.currentCoord)}else{if(d===papaya.viewer.Viewer.KEYCODE_DECREMENT_MAIN){if(this.mainImage.sliceDirection===papaya.viewer.ScreenSlice.DIRECTION_AXIAL){this.currentCoord.z+=1}else{if(this.mainImage.sliceDirection===papaya.viewer.ScreenSlice.DIRECTION_CORONAL){this.currentCoord.y+=1}else{if(this.mainImage.sliceDirection===papaya.viewer.ScreenSlice.DIRECTION_SAGITTAL){this.currentCoord.x-=1}}}this.gotoCoordinate(this.currentCoord)}else{if(d===papaya.viewer.Viewer.KEYCODE_TOGGLE_CROSSHAIRS){if((papayaMain.preferences.showCrosshairs==="All")||(papayaMain.preferences.showCrosshairs==="Main")){this.toggleMainCrosshairs=!this.toggleMainCrosshairs;this.drawViewer(true)}}}}}}}}}}}}}}}};papaya.viewer.Viewer.prototype.keyUpEvent=function(a){if(isControlKey(a)){this.isControlKeyDown=false}};papaya.viewer.Viewer.prototype.resetUpdateTimer=function(a){var b=this;if(this.updateTimer!==null){window.clearTimeout(this.updateTimer);this.updateTimer=null;this.updateTimerEvent=null}if(a!==null){this.updateTimerEvent=a;this.updateTimer=window.setTimeout(bind(b,function(){this.updatePosition(this,getMousePositionX(b.updateTimerEvent),getMousePositionY(b.updateTimerEvent))}),papaya.viewer.Viewer.UPDATE_TIMER_INTERVAL)}};papaya.viewer.Viewer.prototype.mouseDownEvent=function(a){a.stopPropagation();a.preventDefault();if((a.target.nodeName==="IMG")||(a.target.nodeName==="CANVAS")){if(a.handled!==true){papayaMain.papayaToolbar.closeAllMenus();if((a.which===3)||this.isControlKeyDown){this.isWindowControl=true;this.previousMousePosition.x=getMousePositionX(a);this.previousMousePosition.y=getMousePositionY(a)}else{this.updatePosition(this,getMousePositionX(a),getMousePositionY(a),true);this.resetUpdateTimer(a)}this.isDragging=true;a.handled=true}}};papaya.viewer.Viewer.prototype.mouseUpEvent=function(a){a.stopPropagation();a.preventDefault();if((a.target.nodeName==="IMG")||(a.target.nodeName==="CANVAS")){if(a.handled!==true){if(!this.isWindowControl){this.updatePosition(this,getMousePositionX(a),getMousePositionY(a))}this.isDragging=false;this.isWindowControl=false;a.handled=true}}};papaya.viewer.Viewer.prototype.mouseMoveEvent=function(c){c.preventDefault();var b,a;if(this.isDragging){if(this.isWindowControl){b=getMousePositionX(c);a=getMousePositionY(c);this.windowLevelChanged(this.previousMousePosition.x-b,this.previousMousePosition.y-a);this.previousMousePosition.x=b;this.previousMousePosition.y=a}else{this.resetUpdateTimer(null);this.updatePosition(this,getMousePositionX(c),getMousePositionY(c))}}else{this.updateCursorPosition(this,getMousePositionX(c),getMousePositionY(c))}};papaya.viewer.Viewer.prototype.mouseOutEvent=function(){if(papayaMain.papayaDisplay){papayaMain.papayaDisplay.drawEmptyDisplay()}};papaya.viewer.Viewer.prototype.touchMoveEvent=function(a){this.updatePosition(this,getMousePositionX(a),getMousePositionY(a),true);this.resetUpdateTimer(a);a.preventDefault()};papaya.viewer.Viewer.prototype.windowLevelChanged=function(a,c){var b,d,e,f;b=this.currentScreenVolume.volume.header.imageRange.imageMax-this.currentScreenVolume.volume.header.imageRange.imageMin;d=b*0.025;if(Math.abs(a)>Math.abs(c)){e=this.currentScreenVolume.screenMin+(d*signum(a));f=this.currentScreenVolume.screenMax+(-1*d*signum(a));if(f<=e){e=this.currentScreenVolume.screenMin;f=this.currentScreenVolume.screenMin}}else{e=this.currentScreenVolume.screenMin+(d*signum(c));f=this.currentScreenVolume.screenMax+(d*signum(c))}this.currentScreenVolume.setScreenRange(e,f);this.drawViewer(true)};papaya.viewer.Viewer.prototype.gotoCoordinate=function(a){this.currentCoord.x=a.x;this.currentCoord.y=a.y;this.currentCoord.z=a.z;this.drawViewer(true)};papaya.viewer.Viewer.prototype.resizeViewer=function(a){this.canvas.width=a.width;this.canvas.height=a.height;if(this.initialized){this.calculateScreenSliceTransforms(this);this.canvasRect=this.canvas.getBoundingClientRect();this.drawViewer(true)}};papaya.viewer.Viewer.prototype.getWorldCoordinateAtIndex=function(c,b,a,d){d.setCoordinate((c-this.volume.header.origin.x)*this.volume.header.voxelDimensions.xSize,(this.volume.header.origin.y-b)*this.volume.header.voxelDimensions.ySize,(this.volume.header.origin.z-a)*this.volume.header.voxelDimensions.zSize);return d};papaya.viewer.Viewer.prototype.getNextColorTable=function(){var a=(this.screenVolumes.length-1)%5;return papaya.viewer.ColorTable.OVERLAY_COLOR_TABLES[a].name};papaya.viewer.Viewer.prototype.getCurrentValueAt=function(c,b,a){if(this.currentScreenVolume.isOverlay()){return this.currentScreenVolume.volume.getVoxelAtCoordinate((c-this.volume.header.origin.x)*this.volume.header.voxelDimensions.xSize,(this.volume.header.origin.y-b)*this.volume.header.voxelDimensions.ySize,(this.volume.header.origin.z-a)*this.volume.header.voxelDimensions.zSize,true)}return this.currentScreenVolume.volume.getVoxelAtIndex(c,b,a,true)};papaya.viewer.Viewer.prototype.resetViewer=function(){this.initialized=false;this.loadingVolume=null;this.volume=new papaya.volume.Volume();this.screenVolumes=[];this.currentScreenVolume=null;this.axialSlice=null;this.coronalSlice=null;this.sagittalSlice=null;this.mainImage=null;this.lowerImageBot=null;this.lowerImageTop=null;this.viewerDim=0;this.currentCoord=new papaya.core.Coordinate(0,0,0);this.longestDim=0;this.longestDimSize=0;this.draggingSliceDir=0;this.isDragging=false;this.isWindowControl=false;this.previousMousePosition=new papaya.core.Point();this.canvas.removeEventListener("mousemove",this.listenerMouseMove,false);this.canvas.removeEventListener("mousedown",this.listenerMouseDown,false);this.canvas.removeEventListener("mouseout",this.listenerMouseOut,false);document.removeEventListener("mouseup",this.listenerMouseUp,false);document.removeEventListener("keydown",this.listenerKeyDown,true);document.removeEventListener("keyup",this.listenerKeyUp,true);document.removeEventListener("contextmenu",this.listenerContextMenu,false);document.removeEventListener("touchmove",this.listenerTouchMove,false);document.removeEventListener("touchstart",this.listenerMouseDown,false);document.removeEventListener("touchend",this.listenerMouseUp,false);this.updateTimer=null;this.updateTimerEvent=null;this.drawEmptyViewer();if(papayaMain.papayaDisplay){papayaMain.papayaDisplay.drawEmptyDisplay()}papayaMain.papayaToolbar.buildToolbar()};papaya.viewer.Viewer.prototype.getImageDimensionsDescription=function(b){var c,a;c=this.screenVolumes[b].volume.header.orientation.orientation;a=this.screenVolumes[b].volume.header.imageDimensions;return("("+c.charAt(0)+", "+c.charAt(1)+", "+c.charAt(2)+") "+a.cols+" x "+a.rows+" x "+a.slices)};papaya.viewer.Viewer.prototype.getVoxelDimensionsDescription=function(b){var c,a;c=this.screenVolumes[b].volume.header.orientation.orientation;a=this.screenVolumes[b].volume.header.voxelDimensions;return("("+c.charAt(0)+", "+c.charAt(1)+", "+c.charAt(2)+") "+formatNumber(a.colSize,true)+" x "+formatNumber(a.rowSize,true)+" x "+formatNumber(a.sliceSize,true))};papaya.viewer.Viewer.prototype.getFilename=function(a){return wordwrap(this.screenVolumes[a].volume.fileName,25,"<br />",true)};papaya.viewer.Viewer.prototype.getNiceFilename=function(a){return this.screenVolumes[a].volume.fileName.replace(".nii","").replace(".gz","")};papaya.viewer.Viewer.prototype.getFileLength=function(a){return getSizeString(this.screenVolumes[a].volume.fileLength)};papaya.viewer.Viewer.prototype.getByteTypeDescription=function(a){return(this.screenVolumes[a].volume.header.imageType.numBytes+"-Byte "+this.screenVolumes[a].volume.header.imageType.getTypeDescription())};papaya.viewer.Viewer.prototype.getByteOrderDescription=function(a){return this.screenVolumes[a].volume.header.imageType.getOrderDescription()};papaya.viewer.Viewer.prototype.getCompressedDescription=function(a){if(this.screenVolumes[a].volume.header.imageType.compressed){return"Yes"}return"No"};papaya.viewer.Viewer.prototype.getOrientationDescription=function(a){return this.screenVolumes[a].volume.header.orientation.getOrientationDescription()};papaya.viewer.Viewer.prototype.getImageDescription=function(a){return wordwrap(this.screenVolumes[a].volume.header.imageDescription.notes,25,"<br />",true)};papaya.viewer.Viewer.prototype.setCurrentScreenVol=function(a){this.currentScreenVolume=this.screenVolumes[a];window.document.title=this.getNiceFilename(a)};papaya.viewer.Viewer.prototype.getCurrentScreenVolIndex=function(){var a;for(a=0;a<this.screenVolumes.length;a+=1){if(this.screenVolumes[a]===this.currentScreenVolume){return a}}return -1};papaya.viewer.Viewer.prototype.toggleWorldSpace=function(){this.worldSpace=!this.worldSpace};papaya.viewer.Viewer.prototype.isSelected=function(a){return(this.isSelectable()&&(a===this.getCurrentScreenVolIndex()))};papaya.viewer.Viewer.prototype.isSelectable=function(){return(this.screenVolumes.length>1)};papaya.viewer.Viewer.prototype.getIndex=function(a){if(a==="SPACE"){return(this.worldSpace?1:0)}return 0};papaya.viewer.Viewer.prototype.processParams=function(a){if(a.worldSpace){this.worldSpace=true}if(a.showOrientation){papayaMain.preferences.showOrientation="Yes"}};papaya.viewer.Viewer.prototype.getOrientationCertaintyColor=function(){var a=this.screenVolumes[0].volume.header.orientationCertainty;if(a===papaya.volume.Header.ORIENTATION_CERTAINTY_LOW){return papaya.viewer.Viewer.ORIENTATION_CERTAINTY_LOW_COLOR}if(a===papaya.volume.Header.ORIENTATION_CERTAINTY_HIGH){return papaya.viewer.Viewer.ORIENTATION_CERTAINTY_HIGH_COLOR}return papaya.viewer.Viewer.ORIENTATION_CERTAINTY_UNKNOWN_COLOR};papaya.viewer.Viewer.prototype.isUsingAtlas=function(a){return(a===this.atlas.currentAtlas)};"use strict";var papaya=papaya||{};papaya.ui=papaya.ui||{};papaya.ui.Dialog=papaya.ui.Dialog||function(d,b,c,e,a){this.title=d;this.modifier="";if(!isStringBlank(a)){this.modifier=a}this.id=this.title.replace(/ /g,"_");this.content=b;this.dataSource=c;this.callback=e};papaya.ui.Dialog.prototype.showDialog=function(){var f,d,c,g,e,b,a;a="#"+this.id;b=$(a);b.remove();c="<div id='"+this.id+"' class='modalDialog'><span class='modalTitle'>"+this.title+"</span>";if(this.content){c+="<div class='modalDialogContent'><table>";for(f=0;f<this.content.items.length;f+=1){if(this.content.items[f].spacer){c+="<tr><td class='modalDialogContentLabel'>&nbsp;</td><td class='modalDialogContentControl'>&nbsp;</td></tr>"}else{if(this.content.items[f].readonly){c+="<tr><td class='modalDialogContentLabel'>"+this.content.items[f].label+"</td><td class='modalDialogContentControl' id='"+this.content.items[f].field+"'></td></tr>"}else{c+="<tr><td class='modalDialogContentLabel'>"+this.content.items[f].label+"</td><td class='modalDialogContentControl'><select id='"+this.content.items[f].field+"'>";for(d=0;d<this.content.items[f].options.length;d+=1){c+="<option value='"+this.content.items[f].options[d]+"'>"+this.content.items[f].options[d]+"</option>"}c+="</select></td></tr>"}}}c+="</table></div>"}c+="<div class='modalDialogButtonToolbar'><button type='button' id='"+this.id+"-Ok'>Ok</button></div></div>";$("body").append(c);for(f=0;f<this.content.items.length;f+=1){if(this.content.items[f].readonly){g=this.dataSource[this.content.items[f].field](this.modifier);if(g!==null){$("#"+this.content.items[f].field).html(g)}else{$("#"+this.content.items[f].field).parent().remove()}}else{if(!this.content.items[f].spacer){e=$("#"+this.content.items[f].field);e.val(this.dataSource[this.content.items[f].field]);e.change(bind(this,this.doAction,[this.content.items[f].field]))}}}$("#"+this.id+"-Ok").click(bind(this,this.doOk));$("#"+PAPAYA_CONTAINER_ID).addClass("modalBackground");b=$(a);showModalDialog(papayaMain.papayaViewer,b[0])};papaya.ui.Dialog.prototype.doOk=function(){var a=$(".modalDialog");a.hide(100);a.remove();$("#"+PAPAYA_CONTAINER_ID).removeClass("modalBackground")};papaya.ui.Dialog.prototype.doAction=function(a){this.callback(a,$("#"+a).val())};"use strict";var papaya=papaya||{};papaya.ui=papaya.ui||{};papaya.ui.Menu=papaya.ui.Menu||function(c,d,f,e,a,b){this.label=c;this.icons=d;this.callback=f;this.dataSource=e;this.items=[];if((a===undefined)||(a===null)){this.modifier=""}else{this.modifier=a}this.buttonId=this.label.replace(/ /g,"_").replace("...","_")+a;this.menuId=(this.label+"Menu").replace(/ /g,"_").replace("...","_")+a;this.isRight=(d!==null);this.isImageButton=b};papaya.ui.Menu.prototype.buildMenuButton=function(){var d,e,b,f,a,c;f="#"+this.buttonId;b=$(f);b.remove();d=null;if(this.icons){d="<span id='"+this.buttonId+"' class='unselectable menuIcon"+(this.isImageButton?" imageButton'":"'")+(this.isRight?" style='float:right'":"")+"><img style='width:"+papaya.viewer.ColorTable.ICON_SIZE+"px; height:"+papaya.viewer.ColorTable.ICON_SIZE+"px; vertical-align:bottom; ";if(this.dataSource.isSelected(parseInt(this.modifier,10))){d+="border:2px outset #FF5A3D;background-color:#eeeeee;padding:1px;"}else{d+="border:2px outset lightgray;background-color:#eeeeee;padding:1px;"}d+="' src='"+this.icons[this.dataSource.getIndex(this.label)]+"' /></span>"}else{d="<span id='"+this.buttonId+"' class='unselectable menuLabel'>"+this.label+"</span>"}$("#"+PAPAYA_TOOLBAR_ID).append(d);b=$(f);b.click(bind(this,this.showMenu));e=this;if(this.icons){c="#"+this.buttonId+" > img";a=$(c);a.hover(function(){if(e.icons.length>1){$(this).css({"border-color":"gray"})}else{$(this).css({"border-color":"#FF5A3D"})}},bind(e,function(){if(e.dataSource.isSelected(parseInt(e.modifier,10))&&e.dataSource.isSelectable()){$("#"+e.buttonId+" > img").css({"border-color":"#FF5A3D"})}else{$("#"+e.buttonId+" > img").css({"border-color":"lightgray"})}}));a.mousedown(function(){$(this).css({border:"2px inset lightgray"})});a.mouseup(function(){$(this).css({border:"2px outset lightgray"})})}else{b.hover(function(){$(this).toggleClass("menuButtonHover")})}return this.buttonId};papaya.ui.Menu.prototype.setMenuButton=function(a){this.buttonId=a};papaya.ui.Menu.prototype.buildMenu=function(){var c,b,a;b="<ul id='"+this.menuId+"' class='menu'></ul>";$("#"+PAPAYA_TOOLBAR_ID).append(b);for(c=0;c<this.items.length;c+=1){a=this.items[c].buildHTML(this.menuId)}};papaya.ui.Menu.prototype.addMenuItem=function(a){this.items.push(a)};papaya.ui.Menu.prototype.showMenu=function(){var b,d,c,a;if(this.items.length>0){a="#"+this.menuId;c=$(a);b=c.is(":visible");c.remove();if(!b){this.callback(this.buttonId);if(this.icons){$("#"+this.buttonId+" > img").attr("src",this.icons[this.dataSource.getIndex(this.label)])}d=$("#"+this.buttonId);this.buildMenu();c=$(a);c.hide();showMenu(papayaMain.papayaViewer,d[0],c[0],this.isRight)}}else{this.callback(this.buttonId);$("#"+this.buttonId+" > img").attr("src",this.icons[this.dataSource.getIndex(this.label)])}};"use strict";var papaya=papaya||{};papaya.ui=papaya.ui||{};papaya.ui.MenuItem=papaya.ui.MenuItem||function(b,c,d,a){this.label=b;this.modifier="";if(!isStringBlank(a)){this.modifier="-"+a}this.action=c+this.modifier;this.id=this.action.replace(/ /g,"_");this.callback=d};papaya.ui.MenuItem.prototype.buildHTML=function(c){var b,a;b="<li id='"+this.id+"'><span class='unselectable'>"+this.label+"</span></li>";$("#"+c).append(b);a=$("#"+this.id);a.click(bind(this,function(d){this.doAction()}));a.hover(function(){$(this).toggleClass("menuHover")})};papaya.ui.MenuItem.prototype.doAction=function(){this.callback(this.action)};"use strict";var papaya=papaya||{};papaya.ui=papaya.ui||{};papaya.ui.MenuItemCheckBox=papaya.ui.MenuItemCheckBox||function(b,c,f,d,e,a){this.label=b;this.modifier="";if((a!==undefined)&&(a!==null)){this.modifier="-"+a}this.action=c+this.modifier;this.method=e;this.id=this.action.replace(/ /g,"_").replace(/\(/g,"").replace(/\)/g,"");this.callback=f;this.dataSource=d};papaya.ui.MenuItemCheckBox.CHECKBOX_UNSELECTED_CODE="&#9744;";papaya.ui.MenuItemCheckBox.CHECKBOX_SELECTED_CODE="&#9745;";papaya.ui.MenuItemCheckBox.prototype.buildHTML=function(e){var c,d,b,a;c=this.dataSource[this.method](this.label);d="";if(c){d="checked='checked'"}b="<li id='"+this.id+"'><input type='radio' class='ColorTableGroup' name='ColorTableGroup' id='"+this.id+"' value='"+this.id+"' "+d+"><span class='unselectable'>&nbsp;"+this.label+"</span></li>";$("#"+e).append(b);a=$("#"+this.id);a.click(bind(this,this.doAction));a.hover(function(){$(this).toggleClass("menuHover")})};papaya.ui.MenuItemCheckBox.prototype.doAction=function(){$(".ColorTableGroup").removeAttr("checked");$("#"+this.id+" > input")[0].checked=true;this.callback(this.action,null,true)};"use strict";var papaya=papaya||{};papaya.ui=papaya.ui||{};papaya.ui.MenuItemFileChooser=papaya.ui.MenuItemFileChooser||function(a,b,c){this.label=a;this.action=b;this.id=this.action.replace(/ /g,"_");this.callback=c};papaya.ui.MenuItemFileChooser.prototype.buildHTML=function(b){var a="<li id='"+this.id+"'><span class='unselectable'><label class='fileChooser' for='fileChooser'>"+this.label+"</label><input type='file' id='fileChooser' name='files' /></span></li>";$("#"+b).append(a);$("#fileChooser")[0].onchange=bind(this,function(){this.callback(this.action,document.getElementById("fileChooser").files[0])});$("#"+this.id).hover(function(){$(this).toggleClass("menuHover")})};"use strict";var papaya=papaya||{};papaya.ui=papaya.ui||{};papaya.ui.MenuItemRange=papaya.ui.MenuItemRange||function(b,c,f,d,e,a){this.label=b;this.modifier="";if(a!==undefined){this.modifier="-"+a}this.action=c+this.modifier;this.minId=this.action.replace(/ /g,"_")+"Min";this.maxId=this.action.replace(/ /g,"_")+"Max";this.callback=f;this.dataSource=d;this.method=e};papaya.ui.MenuItemRange.prototype.buildHTML=function(d){var a,b,c;a=this.dataSource[this.method]();b="<li id='"+this.id+"'><span class='unselectable'>"+this.label+": &nbsp;<input type='text' size='6' style='width:55px' id='"+this.minId+"' value='"+a[0]+"' /> to <input type='text' size='6' style='width:55px' id='"+this.maxId+"' value='"+a[1]+"' /></span></li>";$("#"+d).append(b);$("#"+this.id).hover(function(){$(this).toggleClass("menuHover")});c=this;$("#"+this.minId).change(bind(this,function(){c.updateDataSource(this);papayaMain.papayaViewer.drawViewer(true)}));$("#"+this.maxId).change(bind(this,function(){c.updateDataSource(this);papayaMain.papayaViewer.drawViewer(true)}))};papaya.ui.MenuItemRange.prototype.updateDataSource=function(e){var a,b,d,c;c=$("#"+e.minId);d=$("#"+e.maxId);b=parseFloat(c.val());if(isNaN(b)){b=e.dataSource.screenMin}a=parseFloat(d.val());if(isNaN(a)){a=e.dataSource.screenMax}c.val(b);d.val(a);e.dataSource.setScreenRange(b,a)};"use strict";var papaya=papaya||{};papaya.ui=papaya.ui||{};papaya.ui.MenuItemSpacer=papaya.ui.MenuItemSpacer||function(){};papaya.ui.MenuItemSpacer.prototype.buildHTML=function(c){var b,a;b="<div class='spacer unselectable'></div>";$("#"+c).append(b)};"use strict";var papaya=papaya||{};papaya.ui=papaya.ui||{};var papayaLoadableImages=papayaLoadableImages||[];papaya.ui.Toolbar=papaya.ui.Toolbar||function(){};papaya.ui.Toolbar.SIZE=22;papaya.ui.Toolbar.ICON_IMAGESPACE="data:image/gif;base64,R0lGODlhFAAUAPcAMf//////GP///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////2f/ZNbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1qWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpVpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAACoALAAAAAAUABQAAAipAFUIHEiwoMB/A1coXLiwisOHVf4hVLFCosWLGC9SzMgR48Z/VEJSUVjFj0mTESdWBCmS5EmU/6oIXCly5IqSLx/OlFjT5Us/DneybIkzp8yPDElChCjwj8Q/UKOqmkqVatOnUaGqmsaVq1UVTv+lGjv2z9SuXlVdFUs2ldmtaKeubev2bFy1YCXSfYt2mty8/6CS5XtXRcasVRMftJj1beK/hicanKwiIAA7";papaya.ui.Toolbar.ICON_WORLDSPACE="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAVCAYAAACpF6WWAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAplJREFUeNqM1H1ozVEcx/Hr3p+7O08jQzbzMErznEItK0+Fv0Ye/tki20ia//wn+YMSaXkoEiKkkCVKZhOipsnDstnFagzlrmGMNfeO6/Nd71unu2s59bq7O517ft/z/X7Pz+dLPUbLJrkqX+SbdEubfJZK2cC6PiOQYm61HJcpkintEpcmCcpryZV5spaHhvvbdJ9slsPyU67wgPlEli0X5aiMkMeyXSbKnVRRVxDRRtkm5czbZrv5vkgu8z1P9stWfleRHGkhT3xCLu1YzZIjpfKWnA6VEn43mwcWEaWlo1Ve2YZj5Jms53iP5BjFsFz9lg/yDj0U7JbslFpZQyBP2a83khoiLiWPA/h/OVGOk+GwnJ5y1iyRS5Im1VLm18cKOc+CYrlGjnxUuZPIOlAn0yWdNXdlrMyRE7LM00eBjBT7niFVTvHsKJ8k6sw1yC4ZIl0EUMOcRT/X44v14xEZSBWfk+d8NpzKujgPGiYrOXI+XTGeGtjpewtjm16Qh3JT3sgvickfNo4yF6V4PVyE2wQUZvP7FmmIa/iDIpwkHRPkrC2iEIlhEZ2mtarIsz3sOoX0PPrP7nAWPRYjj51E85JiJEYO0VsfR5hL5wZal3T7aZl10kLiEyNEHtOSbt4g/gaduRjzC+S9RwtZ332XBxQpzGZ+p72SR5BumUYHLaaDSiySUXKPig6Wj+SmjX5s4BQB0pFBQVo4dhenspfKC1kaYLKVa9pOAW5Q2Ww2qeU92kHbzZRDvK2sBSfLDLtNUp/82rOj7nDm9tJi7lhoeWNzG7Pkqxz8R5p8ByhcGVd0CzkOOWv28KBJvNGa+V2/Y5U08vQm8mgvmTNyjpxHSFUj6/9rZPKerGSTuCPCi7qIdX3GXwEGAPFYt+/OgAXDAAAAAElFTkSuQmCC";papaya.ui.Toolbar.MENU_DATA={menus:[{label:"File",icons:null,items:[{label:"Add Image...",action:"OpenImage",type:"button"},{type:"spacer"},{type:"spacer"},{label:"Close All",action:"CloseAllImages"}]},{label:"Options",icons:null,items:[{label:"Preferences",action:"Preferences"}]},{label:"SPACE",icons:[papaya.ui.Toolbar.ICON_IMAGESPACE,papaya.ui.Toolbar.ICON_WORLDSPACE],items:[]}]};papaya.ui.Toolbar.IMAGE_MENU_DATA={items:[{label:"Image Info",action:"ImageInfo"},{label:"Range",action:"ChangeRange",type:"range",method:"getRange"},{label:"Color Table...",action:"ColorTable",items:[]}]};papaya.ui.Toolbar.PREFERENCES_DATA={items:[{label:"Coordinate display of:",field:"atlasLocks",options:["Mouse","Crosshairs"]},{label:"Show crosshairs:",field:"showCrosshairs",options:["All","Main","Lower","None"]},{label:"Show orientation:",field:"showOrientation",options:["Yes","No"]}]};papaya.ui.Toolbar.IMAGE_INFO_DATA={items:[{label:"Filename:",field:"getFilename",readonly:"true"},{label:"File Length:",field:"getFileLength",readonly:"true"},{spacer:"true"},{label:"Image Dims:",field:"getImageDimensionsDescription",readonly:"true"},{label:"Voxel Dims:",field:"getVoxelDimensionsDescription",readonly:"true"},{spacer:"true"},{label:"Byte Type:",field:"getByteTypeDescription",readonly:"true"},{label:"Byte Order:",field:"getByteOrderDescription",readonly:"true"},{label:"Compressed:",field:"getCompressedDescription",readonly:"true"},{spacer:"true"},{label:"Orientation:",field:"getOrientationDescription",readonly:"true"},{spacer:"true"},{label:"Notes:",field:"getImageDescription",readonly:"true"}]};papaya.ui.Toolbar.prototype.buildToolbar=function(){var a;$(".menuIcon").remove();$(".menuLabel").remove();this.buildOpenMenuItems();for(a=0;a<papaya.ui.Toolbar.MENU_DATA.menus.length;a+=1){this.buildMenu(papaya.ui.Toolbar.MENU_DATA.menus[a],null,papayaMain.papayaViewer,null,false)}this.buildAtlasMenu();this.buildColorMenuItems()};papaya.ui.Toolbar.prototype.buildAtlasMenu=function(){if(papaya.data){if(papaya.data.Atlas){var a=papaya.ui.Toolbar.MENU_DATA.menus[2].items;a[0]={label:papaya.data.Atlas.labels.atlas.header.name,action:"AtlasChanged-"+papaya.data.Atlas.labels.atlas.header.name,type:"checkbox",method:"isUsingAtlas"};if(papaya.data.Atlas.labels.atlas.header.transformedname){a[1]={label:papaya.data.Atlas.labels.atlas.header.transformedname,action:"AtlasChanged-"+papaya.data.Atlas.labels.atlas.header.transformedname,type:"checkbox",method:"isUsingAtlas"}}}}};papaya.ui.Toolbar.prototype.buildColorMenuItems=function(){var a,c,e,b,d;d=papayaParams.luts;if(d){for(c=0;c<d.length;c+=1){papaya.viewer.ColorTable.addCustomLUT(d[c])}}e=papaya.viewer.ColorTable.TABLE_ALL;a=papaya.ui.Toolbar.IMAGE_MENU_DATA.items;for(c=0;c<a.length;c+=1){if(a[c].label==="Color Table..."){a=a[c].items;break}}for(c=0;c<e.length;c+=1){b={label:e[c].name,action:"ColorTable-"+e[c].name,type:"checkbox",method:"isUsingColorTable"};a[c]=b}};papaya.ui.Toolbar.prototype.buildOpenMenuItems=function(){var c,b,a;for(c=0;c<papaya.ui.Toolbar.MENU_DATA.menus.length;c+=1){if(papaya.ui.Toolbar.MENU_DATA.menus[c].label==="File"){b=papaya.ui.Toolbar.MENU_DATA.menus[c].items;break}}for(c=0;c<papayaLoadableImages.length;c+=1){if(!papayaLoadableImages[c].hide){a="Add "+papayaLoadableImages[c].nicename;if(!this.menuContains(b,a)){b.splice(2,0,{label:a,action:"Open-"+papayaLoadableImages[c].name})}}}};papaya.ui.Toolbar.prototype.menuContains=function(b,a){var c;for(c=0;c<b.length;c+=1){if(b[c].label===a){return true}}return false};papaya.ui.Toolbar.prototype.buildMenu=function(d,e,g,a,c){var f,b;f=new papaya.ui.Menu(d.label,d.icons,bind(this,this.doAction),papayaMain.papayaViewer,a,c);if(e){f.setMenuButton(e)}else{e=f.buildMenuButton()}b=d.items;if(b){this.buildMenuItems(f,b,e,g,a,c)}return f};papaya.ui.Toolbar.prototype.buildMenuItems=function(d,g,c,a,f,b){var h,i,e;if(f===undefined){f=""}for(h=0;h<g.length;h+=1){i=null;if(g[h].type==="spacer"){i=new papaya.ui.MenuItemSpacer()}else{if(g[h].type==="checkbox"){i=new papaya.ui.MenuItemCheckBox(g[h].label,g[h].action,bind(this,this.doAction),a,g[h].method,f)}else{if(g[h].type==="button"){i=new papaya.ui.MenuItemFileChooser(g[h].label,g[h].action,bind(this,this.doAction))}else{if(g[h].type==="range"){i=new papaya.ui.MenuItemRange(g[h].label,g[h].action,bind(this,this.doAction),a,g[h].method,f)}else{i=new papaya.ui.MenuItem(g[h].label,g[h].action,bind(this,this.doAction),f)}}}}d.addMenuItem(i);if(g[h].items){e=this.buildMenu(g[h],c,a,f,b);i.callback=bind(e,e.showMenu)}}};papaya.ui.Toolbar.prototype.updateImageButtons=function(){var b,d,c,a;$(".imageButton").remove();for(b=papayaMain.papayaViewer.screenVolumes.length-1;b>=0;b-=1){d=papayaMain.papayaViewer.screenVolumes[b];c=d.colorTable.icon;a={menus:[{label:"ImageButton",icons:[c],items:null}]};a.menus[0].items=papaya.ui.Toolbar.IMAGE_MENU_DATA.items;this.buildMenu(a.menus[0],null,d,b.toString(),true)}};papaya.ui.Toolbar.prototype.closeAllMenus=function(){var b,a;b=$(".menu");b.hide(100);b.remove();a=$(".modalDialog");a.hide(100);a.remove();$("#"+PAPAYA_CONTAINER_ID).removeClass("modalBackground")};papaya.ui.Toolbar.prototype.isShowingMenus=function(){var a,b;a=$(".menu").is(":visible");b=$(".modalDialog").is(":visible");return(a||b)};papaya.ui.Toolbar.prototype.doAction=function(g,d,f){var a,b,c,h,e;if(!f){this.closeAllMenus()}if(g){if(g.startsWith("ImageButton")){a=parseInt(g.substring(g.length-1),10);papayaMain.papayaViewer.setCurrentScreenVol(a);this.updateImageButtons()}else{if(g.startsWith("Open-")){e=g.substring(g.indexOf("-")+1);papayaMain.papayaViewer.loadImage(e)}else{if(g==="OpenImage"){papayaMain.papayaViewer.loadImage(d)}else{if(g.startsWith("ColorTable")){b=g.substring(g.indexOf("-")+1,g.lastIndexOf("-"));a=g.substring(g.lastIndexOf("-")+1);papayaMain.papayaViewer.screenVolumes[a].changeColorTable(b);this.updateImageButtons()}else{if(g.startsWith("CloseAllImages")){papayaMain.papayaViewer.resetViewer();this.updateImageButtons()}else{if(g==="Preferences"){c=new papaya.ui.Dialog("Preferences",papaya.ui.Toolbar.PREFERENCES_DATA,papayaMain.preferences,bind(papayaMain.preferences,papayaMain.preferences.updatePreference));c.showDialog()}else{if(g.startsWith("ImageInfo")){a=g.substring(g.lastIndexOf("-")+1);c=new papaya.ui.Dialog("Image Info",papaya.ui.Toolbar.IMAGE_INFO_DATA,papayaMain.papayaViewer,null,a.toString());c.showDialog()}else{if(g.startsWith("SPACE")){papayaMain.papayaViewer.toggleWorldSpace();papayaMain.papayaViewer.drawViewer(true)}else{if(g.startsWith("AtlasChanged")){h=g.substring(g.lastIndexOf("-")+1);papayaMain.papayaViewer.atlas.currentAtlas=h;papayaMain.papayaViewer.drawViewer(true)}}}}}}}}}}};"use strict";var papaya=papaya||{};var papayaMain=null;var papayaParams=papayaParams||{};papaya.viewer=papaya.viewer||{};var papayaLoadableImages=papayaLoadableImages||[];papaya.Main=papaya.Main||function(){this.loadingImageIndex=0;resetComponents()};function resetComponents(){var a=$("#"+PAPAYA_CONTAINER_ID);a.css({height:"auto"});a.css({width:"auto"});a.css({margin:"auto"});$("#"+PAPAYA_VIEWER_ID).removeClass("checkForJS");$("head").append("<style>div#papayaViewer:before{ content:'' }</style>")}function isShowingToolbar(){return $("#"+PAPAYA_TOOLBAR_ID).length}function isShowingDisplay(){return $("#"+PAPAYA_DISPLAY_ID).length}function isShowingViewer(){return $("#"+PAPAYA_VIEWER_ID).length}function getViewerDimensions(){var h=1,b=PAPAYA_MINIMUM_SIZE,d=PAPAYA_MINIMUM_SIZE,g=$("#"+PAPAYA_CONTAINER_ID),a,c,e,f;if(isShowingDisplay()){h+=1}if(isShowingToolbar()){h+=1}if(g.parent().get(0).tagName.toLowerCase()==="div"){b=g.parent().height();d=g.parent().width()}else{if(g.parent().get(0).tagName.toLowerCase()==="body"){b=window.innerHeight;d=window.innerWidth}}if(b<PAPAYA_MINIMUM_SIZE){b=PAPAYA_MINIMUM_SIZE;g.parent().height(PAPAYA_MINIMUM_SIZE)}if(d<PAPAYA_MINIMUM_SIZE){d=PAPAYA_MINIMUM_SIZE;g.parent().width(PAPAYA_MINIMUM_SIZE)}a=b-PAPAYA_SECTION_HEIGHT*h;c=a*1.5;if(c>d){c=d-PAPAYA_SPACING*2;a=Math.ceil(c/1.5)}e=(d-c)/2;f=new papaya.core.Dimensions(c,a);f.widthPadding=e;f.heightPadding=PAPAYA_CONTAINER_PADDING_TOP;return f}function resizeViewerComponents(b){papayaMain.papayaToolbar.closeAllMenus();var e=getViewerDimensions(),c=$("#"+PAPAYA_TOOLBAR_ID),d=$("#"+PAPAYA_VIEWER_ID),a=$("#"+PAPAYA_DISPLAY_ID);c.css({paddingLeft:e.widthPadding+"px"});c.css({paddingBottom:PAPAYA_SPACING+"px"});c.css({width:e.width+"px"});c.css({height:papaya.ui.Toolbar.SIZE+"px"});d.css({height:"100%"});d.css({width:e.width+"px"});d.css({paddingLeft:e.widthPadding+"px"});if(b){papayaMain.papayaViewer.resizeViewer(e)}if(papayaMain.papayaDisplay){a.css({height:PAPAYA_SECTION_HEIGHT+"px"});a.css({paddingLeft:e.widthPadding+"px"});papayaMain.papayaDisplay.canvas.width=e.width}$("#"+PAPAYA_CONTAINER_ID).css({paddingTop:e.heightPadding+"px"});if(papayaMain.papayaViewer.initialized){papayaMain.papayaViewer.drawViewer(true)}else{papayaMain.papayaViewer.drawEmptyViewer();if(papayaMain.papayaDisplay){papayaMain.papayaDisplay.drawEmptyDisplay()}}}papaya.Main.prototype.buildViewer=function(c){var a,b;if(isShowingViewer()){a=$("#"+PAPAYA_VIEWER_ID);a.html("");b=getViewerDimensions();this.papayaViewer=new papaya.viewer.Viewer(b.width,b.height,c);a.append($(this.papayaViewer.canvas))}else{alert("You are missing a viewer div!")}};papaya.Main.prototype.buildDisplay=function(){if(isShowingDisplay()){var a=getViewerDimensions();this.papayaDisplay=new papaya.viewer.Display(a.width,PAPAYA_SECTION_HEIGHT);$("#"+PAPAYA_DISPLAY_ID).append($(this.papayaDisplay.canvas))}};papaya.Main.prototype.buildToolbar=function(){this.papayaToolbar=new papaya.ui.Toolbar();this.papayaToolbar.buildToolbar()};papaya.Main.prototype.setUpDnD=function(){var a=$("#"+PAPAYA_CONTAINER_ID);a[0].ondragover=function(){papayaMain.papayaViewer.draggingOver=true;if(!papayaMain.papayaViewer.initialized){papayaMain.papayaViewer.drawEmptyViewer()}return false};a[0].ondragleave=function(){papayaMain.papayaViewer.draggingOver=false;if(!papayaMain.papayaViewer.initialized){papayaMain.papayaViewer.drawEmptyViewer()}return false};a[0].ondragend=function(){papayaMain.papayaViewer.draggingOver=false;if(!papayaMain.papayaViewer.initialized){papayaMain.papayaViewer.drawEmptyViewer()}return false};a[0].ondrop=function(b){b.preventDefault();if(b.dataTransfer.files.length>1){papayaMain.papayaDisplay.drawError("Please drop one file at a time.")}else{papayaMain.papayaViewer.loadImage(b.dataTransfer.files[0])}return false}};papaya.Main.prototype.loadNext=function(){this.loadingImageIndex+=1;if(papayaParams.images){if(this.loadingImageIndex<papayaParams.images.length){papayaMain.papayaViewer.loadImage(papayaParams.images[this.loadingImageIndex],true,false)}}else{if(papayaParams.encodedImages){if(this.loadingImageIndex<papayaParams.encodedImages.length){papayaMain.papayaViewer.loadImage(papayaParams.encodedImages[this.loadingImageIndex],false,true)}}}};papaya.Main.prototype.findLoadableImage=function(a){var b;for(b=0;b<papayaLoadableImages.length;b+=1){if(papayaLoadableImages[b].name===a){return papayaLoadableImages[b]}}return null};function main(){var c,d,a,b;c=checkForBrowserCompatibility();d=$("#"+PAPAYA_VIEWER_ID);if(c!==null){d.removeClass("checkForJS");d.addClass("checkBrowser");d.html("<div class='checkBrowserMessage'>"+c+"</div>")}else{papayaMain=new papaya.Main();papayaMain.preferences=new papaya.viewer.Preferences();a=d.data("params");if(a){papayaParams=$.extend(papayaParams,window[a])}getQueryParams(papayaParams);papayaMain.buildViewer(papayaParams);papayaMain.buildDisplay();papayaMain.buildToolbar();papayaMain.setUpDnD();b=d.data("load-url");if(b){papayaMain.papayaViewer.loadImage(b,true,false)}else{if(papayaParams.images){papayaMain.papayaViewer.loadImage(papayaParams.images[0],true,false)}else{if(papayaParams.encodedImages){papayaMain.papayaViewer.loadImage(papayaParams.encodedImages[0],false,true)}}}resizeViewerComponents(false)}}window.onload=main;window.onresize=function(){resizeViewerComponents(true)};